{"version":3,"sources":["webpack:///./src/html/welcome.html","webpack:///./src/footer.js","webpack:///./src/svg/donate.svg","webpack:///./src/app.js","webpack:///./src/asset.js","webpack:///./src/side-frame.js","webpack:///./src/market-data.js","webpack:///./src/orderbook.js","webpack:///./src/balance.js","webpack:///./src/order.js","webpack:///./src/click-wall.js","webpack:///./src/portfolio.js","webpack:///./src/anchor.js","webpack:///./src/offers.js","webpack:///./src/helpers.js","webpack:///./src/activity-gui.js","webpack:///./src/portfolio-gui.js","webpack:///./src/highcharts-theme.js","webpack:///./src/asset-gui.js","webpack:///./src/settings-gui.js","webpack:///./src/rebalance-gui.js","webpack:///./src/target.js","webpack:///./src/strategy.js","webpack:///./src/target-gui.js","webpack:///./src/html/license.html"],"names":["module","exports","CosmicLink","require","Gui","html","__","global","SideFrame","MYPUBKEY","Footer","icons","links","_classCallCheck","this","_possibleConstructorReturn","_getPrototypeOf","call","Icon","image","name","action","_this","link","title","onclick","href","match","target","rel","amount","prompt","concat","isNaN","confirm","cosmicLink","memo","network","addOperation","destination","uri","demoConfig","footer","displayDemo","localStorage","location","displayLicense","tabs","select","displayAbout","append","document","body","dom","Form","Tabs","params","clickWall","Portfolio","isOverflowing","ActivityGui","PortfolioGui","SettingsGui","RebalanceGui","license","welcome","nav","header","view","main","add","loginForm","hash","selected","fitScreen","replace","domNode","selector","ledger","addValidator","login","_callee","_regeneratorRuntime","wrap","_context","prev","next","Promise","all","__webpack_require__","e","then","t","bind","sent","setInfo","connect","loginAddressBox","value","publicKey","t0","console","error","setError","stop","_callee2","address","_args2","arguments","_context2","length","undefined","Error","disconnect","$set","enable","resolve","portfolio","setTimeout","listen","initGui","disable","remove","show","autocomplete","ledgerLoginButton","loginWithLedgerWallet","page","window","scrollTo","FIAT_BASEURL","FIAT_IMAGEFORMAT","Mirrorable","Projectable","marketData","Orderbook","Asset","_Projectable","id","table","_assertThisInitialized","info","code","Object","assign","type","fiats","push","toLowerCase","cryptos","anchors","balances","offers","mirror","balance","anchor","watch","compute","orderbook","forAsset","define","globalPrice","price","_inherits","_createClass","key","_getInfo","_asyncToGenerator","mark","abrupt","crypto","small","apply","addChild","reduce","sum","el","rawLiabilities","entry","buying","selling","refreshPrices","_ref","array","refreshCryptoPrices","refreshFiatPrices","filter","asset","map","_x","_callee3","assets","prices","_args3","_context3","forEach","_callee4","_args4","_context4","fiat","USD","EUR","CNY","BTC","ETH","XRP","XLM","KIN","BAT","ZRX","BCH","STEEM","SBD","LINK","SLT","MOBI","SHX","RMT","TERN","PEDI","GRAT","REPO","currency","setInterval","log","Observable","timeout","url","current","close","create","className","src","sandbox","hidden","style","_this2","htmlOverflow","documentElement","overflow","bodyOverflow","shadow","animationName","background","trigger","_this3","hide","_this4","destroy","addEventListener","event","frameWindow","contentWindow","source","data","position","zIndex","right","top","width","maxWidth","height","border","backgroundImage","backgroundRepeat","backgroundPosition","backgroundSize","padding","color","fontSize","fontWeight","cursor","borderBottomLeftRadius","insertBefore","firstChild","transition","axios","nice","day","coingeckoCall","get","exchangeratesCall","_callee8","symbols","_args8","_context8","base","x","join","response","start_at","rates","cacheHistory","JSON","stringify","cachedHistory","json","parse","assetHistory","limit","history","list","symbol","toUpperCase","stellarNative","tickers","coin_id","_ref3","localization","market_data","community_data","developer_data","sparkline","_ref4","ids","quote","vs_currencies","assetData","_x2","_ref5","_callee5","_args5","_context5","vs_currency","days","record","index","time","volume","total_volumes","_x3","_ref6","_callee6","_context6","_x6","_ref7","_callee7","cached","end_at","today","_args7","_context7","Date","toISOString","slice","setDate","getDate","keys","sort","date","getTime","_x7","cosmicLib","StellarSdk","offersCallBuilder","updateOffersPrices","childs","streamOffers","addOrderbook","_streamOffers","getOffers","_getOffers","ingest","areOffersEquals","bids","normalizeOffers","asks","set","side","merged","child","sortOffers","a","b","baseVolume","quoteVolume","row","mergedRow","quoteAmount","mergeOffers","baseAsset","quoteAsset","server","array1","array2","basePrice","bestBid","bestAsk","marketPrice","spread","prototype","findOffer","last","childsNum","offer","findAsk","findBid","depth","Anchor","Balance","entryId","asset_code","asset_issuer","known","buying_liabilities","selling_liabilities","project","forBalance","issuer","Order","method","operations","_len","parameters","Array","_key","refresh","order","splice","_toConsumableArray","make","operation","find","newOperation","getOperation","setOperation","Number","cost","operationDirection","op","filterTradableBalances","amountTraded","amountTradable","addBalancingOperation","size","noMinValue","mode","skipMarginalOffers","minOfferValue","makeOfferFilter","Math","abs","clamp","min","max","operationsToCosmicLink","operationsToDescription","maxTime","accountId","odesc","price_r","n","d","toFixed","offerId","operationToOdesc","desc","market","percentage","spreadTightening","clone","diff","maxSpread","refPrice","clampOfferPrice","updateOfferPriceR","tightenSpread","amountDelta","liabilities","outdated","description","deviation","balanceTargetDeviation","amountTarget","amountMin","amountMax","amountDiff","setBalancesLimits","isOneOperationEnough","tradableBalances","tradableAmounts","tradableTotal","tradeAmounts","addSplitTrade","_len2","_key2","_construct","_loop","overlay","Offers","checkNetwork","horizon","accountCallBuilder","isSupported","_resolve","isAccountEmpty","account_id","config","streamAccount","_streamAccount","getAccount","_getAccount","account","_ingest","indexOf","getInfo","forPortfolio","stream","accounts","total","aliases","helpers","alias","shorter","USD:GDUKMGUGDZQK6YHYA5Z6AY2G4XDSZPSZ3SW5UN3ARVMO6QSRDWP5YLEX","WSD:GDSVWEA7XV6M5XNLODVTPCGMAJTNBLZBXOFNQD3BNPNYALEYBNT6CE2V","USD:GDSRCV5VTM3U7Y3L6DFRP3PEGBNQMGOWSRTGSBWX6Z3H6C7JHRI4XFJP","USD:GBUYUAI75XXWDZEKLY66CFYKQPET5JR4EENXZBUZ3YXZ7DS56Z4OKOFU","CNY:GAREELUB43IRHWEASCFBLKHURCGMHE5IF6XSE7EXDLACYHGRHM43RFOX","XCN:GCNY5OXYSY4FKHOPT2SPOQZAOEIGXB5LBYW3HVU3OWSTQITS65M5RCNY","BCNY:GBCNYBHAAPDSU3UIHXXQTHYZVSBJBI4YUNWXMKJBCPDHTVYR75G6NFHD","EURT:GAP5LETOV6YIE62YAM56STDANPRDO7ZFDBGSNHJQIYGGKSMOZAHOOS2S","SLT:GCKA6K5PCQ6PNF5RQBF7PQDJWRHO6UOGFMRLK3DYHDOI244V47XKQ4GP","MOBI:GA6HCMBLTZS5VYYBCATRBRZ3BZJMAFUDKYYF6AH6MVCMGWMRDNSWJPIH","SHX:GDSTRSHXHGJ7ZIVRBXEYE5Q74XUVCUSEKEBR7UCHEUUEK72N7I7KJ6JH","RMT:GDEGOXPCHXWFYY234D2YZSPEJ24BX42ESJNVHY5H7TWWQSYRN5ZKZE3N","TERN:GDGQDVO6XPFSY4NMX75A7AOVYCF5JYGW2SHCJJNWCQWIDGOZB53DGP6C","PEDI:GBVUDZLMHTLMZANLZB6P4S4RYF52MVWTYVYXTQ2EJBPBX4DZI2SDOLLY","GRAT:GAJ7V3EMD3FRWAPBEJAP7EC4223XI5EACDZ46RFMY5DYOMCIMWEFR5II","REPO:GCZNF24HPMYTV6NOEHI7Q5RJFFUI23JKUKY3H3XTQAFBQIBOHD5OXG3B","BTC:GATEMHCCKCY67ZUCKTROYN24ZYT5GK4EQZ65JJLDHKHRUZI3EUEKMTCH","BTC:GAUTUYY2THLF7SGITDFMXJVYH3LHDSMGEAKSBU267M2K7A3W543CKUEF","BTC:GCNSGHUCG5VMGLT5RIYYZSO7VQULQKAJ62QA33DBC5PPBSO57LFWVV6P","BTC:GBVOL67TMUQBGL4TZYNMY3ZQ5WGQYFPFD5VJRWXR72VA33VFNL225PL5","ETH:GCNSGHUCG5VMGLT5RIYYZSO7VQULQKAJ62QA33DBC5PPBSO57LFWVV6P","ETH:GBVOL67TMUQBGL4TZYNMY3ZQ5WGQYFPFD5VJRWXR72VA33VFNL225PL5","ETH:GBETHKBL5TCUTQ3JPDIYOZ5RDARTMHMEKIO2QZQ7IOZ4YC5XV3C2IKYU","ETH:GBDEVU63Y6NTHJQQZIKVTC23NWLQVP3WJ2RI2OTSJTNYOIGICST6DUXR","LTC:GC5LOR3BK6KIOK7GKAUD5EGHQCMFOGHJTC7I3ELB66PTDFXORC2VM5LP","LTC:GBVOL67TMUQBGL4TZYNMY3ZQ5WGQYFPFD5VJRWXR72VA33VFNL225PL5","LTC:GCNSGHUCG5VMGLT5RIYYZSO7VQULQKAJ62QA33DBC5PPBSO57LFWVV6P","XRP:GBVOL67TMUQBGL4TZYNMY3ZQ5WGQYFPFD5VJRWXR72VA33VFNL225PL5","XRP:GCNSGHUCG5VMGLT5RIYYZSO7VQULQKAJ62QA33DBC5PPBSO57LFWVV6P","KIN:GBDEVU63Y6NTHJQQZIKVTC23NWLQVP3WJ2RI2OTSJTNYOIGICST6DUXR","BAT:GBDEVU63Y6NTHJQQZIKVTC23NWLQVP3WJ2RI2OTSJTNYOIGICST6DUXR","ZRX:GBDEVU63Y6NTHJQQZIKVTC23NWLQVP3WJ2RI2OTSJTNYOIGICST6DUXR","BCH:GAEGOS7I6TYZSVHPSN76RSPIVL3SELATXZWLFO4DIAFYJF7MPAHFE7H4","STEEM:GB3KBOFUCVTWEZ7YIZ7PAKLQMKPCTGWU3LOMANMCT7V6I3AAK4USTEEM","SBD:GB3KBOFUCVTWEZ7YIZ7PAKLQMKPCTGWU3LOMANMCT7V6I3AAK4USTEEM","LINK:GBDEVU63Y6NTHJQQZIKVTC23NWLQVP3WJ2RI2OTSJTNYOIGICST6DUXR","loopcall","hiddenKey","setHiddenProperty","delay","callBuilder","records","alive","Offer","clean","forAccount","intern","recordToId","rawPrice","update","rawAmount","last_modified_time","last_modified_ledger","element","scrollHeight","clientHeight","scrollWidth","clientWidth","_Gui2","ActivityOffers","globalCurrency","txParams","_Gui3","ActivityOffer","number","toLocaleDateString","Highcharts","Highstock","AssetGui","summary","Summary","coingecko","chart","Chart","makeAssetPoint","y","PortfolioSummary","parent","Table","Graph","PortfolioTable","assetsGui","assetGui","simpleView","detailledView","_Gui4","PortfolioGraph","makePie","_this5","container","legend","enabled","tooltip","pointFormat","plotOptions","pie","dataLabels","format","point","events","options","legendItemClick","series","colorByPoint","ignoreHiddenPoint","_Gui5","PortfolioChart","_this6","makeChart","stockChart","rangeSelector","backgroundColor","yAxis","labels","align","resize","offset","credits","theme","allowPointSelect","animation","responsive","rules","condition","chartOptions","showInLegend","distance","colors","setOptions","msg","cell","amounts","node","object","trap","priceDetails","values","feed","anchorName","simple","anchorTotal","anchorHeader","func","reload","i18n","Target","TargetGui","targetKey","template","init","setup","Setup","hideRebalance","hideApply","modified","toJson","listOperations","remaining","pop","RebalanceTable","targets","toTargetGui","sortTargets","targetGui","localeCompare","strategy","rebalance","computeAll","root","group","valueDiff","share","hasChanged","message","sortChilds","fromJson","isValid","findIndex","fromObject","beautifyFlag","toObject","_target$childs","percentChilds","delayed","weights","remains","weight","allocated","available","checkUnderFlag","over","overP","under","underP","checkAllocationLimits","ignore","toCommand","toPercent","obj","TargetSetup","targetIsXlm","maybeSwitchMode"],"mappings":"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","file":"app.js","sourcesContent":["module.exports = \"<section><h2>February, 16th  Beta 1 Release</h2>\\n  <section><h3>Welcome!</h3>\\n\\n    <p>Equilibre.io is a portfolio balancer that runs on the Stellar\\n    Decentralized Exchange. It is a convenient trading tool to manage positions\\n    over the long term.</p>\\n\\n    <p>Regularly balancing an investment portfolio is known to boost its\\n    performances, providing you choose wisely the assets to bet on. Equilibre.io\\n    also lets you spread your position over several anchors, for better fund\\n    safety.</p>\\n\\n    <p>Equilibre.io is still under testing & development. If you use it now,\\n    I'll ask you to consider yourself as a tester. Please report any bug you\\n    could encounter, and double-check transactions before signing them.</p>\\n\\n    <p>Your feedback matters to me and will be listened to.</p>\\n\\n    <p>Respectfully, <br>MisterTicot</p>\\n\\n  </section>\\n\\n  <section><h3>To Be Implemented</h3>\\n    <ul>\\n      <li>Interface to add/remove assets</li>\\n      <li>Portfolio historic value</li>\\n      <li>Customizable rebalancing periodicity</li>\\n      <li>Pie graph for rebalancing tab</li>\\n    </ul>\\n  </section>\\n\\n  <section><h3>Known Limitations</h3>\\n    <ul>\\n\\n      <li>It is required to \\\"Cancel All\\\" offers between applying a new balance\\n      setup</li>\\n\\n    </ul>\\n  </section>\\n</section>\\n\"","\"use_strict\"\n/**\n * Footer\n */\nconst { CosmicLink } = require(\"cosmic-lib\")\n\nconst Gui = require(\"@cosmic-plus/domutils/es5/gui\")\nconst html = require(\"@cosmic-plus/domutils/es5/html\")\nconst { __ } = require(\"@cosmic-plus/i18n\")\n\nconst global = require(\"./global\")\nconst SideFrame = require(\"./side-frame\")\n\nconst MYPUBKEY = \"GAWO2C52D57XBT7SQL6YB3XPHFLFD2J4Z5RN7HPFZSHXJMXH72HRXNV3\"\n\n/**\n * Class\n */\n\nclass Footer extends Gui {\n  constructor (icons, links) {\n    super(\n      `\n<footer id=\"footer\" class=\"scrollable\">\n  <div class=\"nobreak\">%icons...</div>\n  %links\n</footer>\n    `,\n      { icons, links }\n    )\n  }\n}\n\n/**\n * Footer Icons\n */\n\nclass Icon extends Gui {\n  constructor (image, name, action) {\n    super(`<a -ref=%link class=\"Icon\">%image</a>`)\n\n    this.image = typeof image === \"string\" ? new Gui(image) : image\n    this.link.title = name\n\n    if (typeof action === \"function\") {\n      this.link.onclick = action\n    } else if (typeof action === \"string\") {\n      this.link.href = action\n      if (action.match(/^http/)) {\n        this.link.target = \"_blank\"\n        this.link.rel = \"noopener\"\n      }\n    }\n  }\n}\n\n/**\n * Donate\n */\n\nfunction donate () {\n  const amount = prompt(`\\\n${__(\"Equilibre.io runs on donation.\")}\n\n${__(\n    \"Please contribute to its development according to what you think the service worth.\"\n  )}\n\n${__(\"Enter an amount (in Lumens)\")}:\\\n`)\n\n  if (amount === \"0\" || isNaN(+amount)) {\n    confirm(`${__(\"Not a valid amount\")}: ${amount}`)\n  } else if (amount) {\n    const cosmicLink = new CosmicLink({\n      memo: __(\"Donation to Equilibre.io\"),\n      network: \"public\"\n    }).addOperation(\"payment\", { amount, destination: MYPUBKEY })\n    new SideFrame(cosmicLink.uri)\n  }\n}\n\n/**\n * Icons\n *\n * SVG from @fortawesome/font-awesome-free\n * CC BY 4.0 License (https://creativecommons.org/licenses/by/4.0/)\n */\n\nconst icons = [\n  new Icon(\n    require(\"@fortawesome/fontawesome-free/svgs/brands/keybase.svg\"),\n    \"Keybase\",\n    \"https://keybase.io/team/cosmic_plus\"\n  ),\n  new Icon(\n    require(\"@fortawesome/fontawesome-free/svgs/brands/telegram-plane.svg\"),\n    \"Telegram\",\n    \"https://t.me/cosmic_plus\"\n  ),\n  new Icon(\n    require(\"@fortawesome/fontawesome-free/svgs/brands/reddit.svg\"),\n    \"Reddit\",\n    \"https://reddit.com/r/cosmic_plus\"\n  ),\n  new Icon(\n    require(\"@fortawesome/fontawesome-free/svgs/brands/twitter.svg\"),\n    \"Twitter\",\n    \"https://twitter.com/cosmic_plus\"\n  ),\n  new Icon(\n    require(\"@fortawesome/fontawesome-free/svgs/brands/medium.svg\"),\n    \"Medium\",\n    \"https://medium.com/cosmic-plus\"\n  ),\n  new Icon(\n    require(\"@fortawesome/fontawesome-free/svgs/brands/github.svg\"),\n    \"GitHub\",\n    \"https://github.com/cosmic-plus/webapp-equilibre-io\"\n  ),\n  new Icon(\n    require(\"@fortawesome/fontawesome-free/svgs/solid/globe.svg\"),\n    __(\"Website\"),\n    \"https://cosmic.plus\"\n  ),\n  new Icon(\n    require(\"@fortawesome/fontawesome-free/svgs/solid/envelope.svg\"),\n    __(\"Email\"),\n    \"mailto:mister.ticot@cosmic.plus\"\n  ),\n  new Icon(require(\"./svg/donate.svg\"), __(\"Donate\"), donate)\n]\n\n/**\n * Demo Page\n */\nfunction displayDemo () {\n  localStorage[`target:${MYPUBKEY}`] = demoConfig\n  location.href = `?address=${MYPUBKEY}`\n}\n\nconst demoConfig = `{\"childs\":[\"EUR\",\"CNY\",\"USD\",{\"size\":12.5,\"mode\":\"percentage\",\"asset\":\"XLM\"},{\"size\":12.5,\"mode\":\"percentage\",\"asset\":\"ETH\"},{\"size\":12.5,\"mode\":\"percentage\",\"asset\":\"BTC\"},{\"size\":4,\"mode\":\"percentage\",\"asset\":\"SLT\"},{\"size\":4,\"mode\":\"percentage\",\"asset\":\"REPO\"},{\"size\":2.25,\"mode\":\"percentage\",\"asset\":\"PEDI\"},{\"size\":2.25,\"mode\":\"percentage\",\"asset\":\"TERN\"}]}`\n\n/**\n * Links\n */\nconst links = new Gui(\n  `\n<p>\n  <a target=\"_blank\" rel=\"noopener\" href=\"https://cosmic.plus\">${__(\n    \"A Cosmic.Plus Software\"\n  )}</a>\n   <a onclick=%displayDemo>${__(\"Demo\")}</a>\n   <a target=\"_blank\" rel=\"noopener\" href=\"https://nucleo.fi/leaderboard/top/?span=3m\">Performance</a>\n   <a onclick=%displayLicense>${__(\"License\")}</a>\n   <a onclick=%displayAbout>${__(\"About\")}</a>\n</p>\n`,\n  {\n    displayDemo,\n    displayLicense: () => global.tabs.select(\"#license\"),\n    displayAbout: () => global.tabs.select(\"#about\")\n  }\n)\n\n/**\n * Create footer\n */\n\nconst footer = new Footer(icons, links)\nhtml.append(document.body, footer)\n","module.exports = \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" viewBox=\\\"0 0 512 512\\\"><path fill=\\\"none\\\" d=\\\"M0 0h512v512H0z\\\"/><path d=\\\"M211.719 367.797C219.469 379.281 224 393.109 224 408c0 39.734-32.266 72-72 72-39.758 0-72-32.266-72-72 0-23.172 11.148-43.563 28.164-56.734 1.852 5.594 4.336 11.125 8.289 15.906 7.055 8.516 20.336 18.266 43.531 16.344 7.578-.641 15.844-2.547 24.586-5.641 8.875-3.078 18.508-6.5 27.149-10.078zM389.875 32.578c-13.344 3.797-24.156 10.672-38.813 18.328-90 47-196.25 39.25-220 77-27.469 51.672-48.883 89.203-48.945 107.625-.016.063-.055.094-.07.141.586 19.953 19.625 58.438 29.07 75.969 6.789-15.516 17.492-29.219 32.25-40.688 7.414-5.766 13.289-9.922 18.617-13.5-3.016-9.25-6.945-20.016-10.875-28.203 10.742-7.391 26.078-26.484 31.398-40.313 13.227.094 30.25-3.172 44.773-6.938 6.406 6.844 12.977 13.563 21.766 20.016-3.961 14.344-7.07 27.063-23.438 38.359-22.313 15.438-42.734 21.578-69.484 43.109-16.086 12.953-26.07 28.203-30.625 45.641-3.148 12.094 4.734 53.016 58 33.141 10.023-3.75 23.398-8.531 34.875-14.25 23.797-11.813 52.922-40.781 61-44.828 15.234-7.641 49.813-10.656 86.313-35.016 12.531-8.375 22.063-20.688 26.477-33.625 33.242-64.828 60.883-59.656 68.633-72.563C477.734 133.734 423.563 23 389.875 32.578z\\\"/></svg>\\n\"","\"use_strict\"\n/**\n * Login interface\n */\nconst dom = require(\"@cosmic-plus/domutils/es5/dom\")\nconst Form = require(\"@cosmic-plus/domutils/es5/form\")\nconst Gui = require(\"@cosmic-plus/domutils/es5/gui\")\nconst html = require(\"@cosmic-plus/domutils/es5/html\")\nconst Tabs = require(\"@cosmic-plus/domutils/es5/tabs\")\nconst params = require(\"@cosmic-plus/domutils/es5/params\")\nconst { __ } = require(\"@cosmic-plus/i18n\")\n\nconst clickWall = require(\"./click-wall\")\nconst global = require(\"./global\")\nconst Portfolio = require(\"./portfolio\")\nconst { isOverflowing } = require(\"./helpers\")\n\nconst ActivityGui = require(\"./activity-gui\")\nconst PortfolioGui = require(\"./portfolio-gui\")\nconst SettingsGui = require(\"./settings-gui\")\nconst RebalanceGui = require(\"./rebalance-gui\")\n\nconst license = new Gui(require(\"./html/license.html\"))\nconst welcome = new Gui(require(\"./html/welcome.html\"))\n\nrequire(\"./footer\")\n\n/**\n * Init\n */\nconst tabs = global.tabs = new Tabs({ nav: dom.header, view: dom.main })\ntabs.add(\"#welcome\", __(\"Welcome\"), welcome)\ntabs.add(\"#login\", __(\"Login\"), dom.loginForm)\ntabs.add(\"#license\", null, license)\ntabs.add(\"#about\", null, welcome)\n\ntabs.select(location.hash)\nif (!tabs.selected) tabs.select(\"#welcome\")\n\ntabs.fitScreen = function () {\n  if (isOverflowing(dom.header)) {\n    html.replace(tabs.nav.domNode, tabs.selector.domNode)\n  }\n}\ntabs.fitScreen()\n\nconst loginForm = new Form(dom.loginForm).addValidator(login)\nhtml.show(dom.loginForm)\ndom.loginForm.autocomplete = \"on\"\nif (params.address) {\n  tabs.select(\"#login\")\n  dom.loginAddressBox.value = params.address\n  login()\n} else {\n  dom.ledgerLoginButton.onclick = () => loginWithLedgerWallet()\n}\n\ntabs.listen(\"select\", page => {\n  location.hash = page\n  window.scrollTo(0, 0)\n})\n\n/**\n * Functions\n */\n\nlet ledger\nasync function loginWithLedgerWallet () {\n  ledger = await getLedgerModule()\n  loginForm.setInfo(__(\"Please open the Stellar App in your Ledger Wallet\"))\n  try {\n    await ledger.connect()\n    dom.loginAddressBox.value = ledger.publicKey\n    login()\n  } catch (error) {\n    console.error(error)\n    loginForm.setError(error)\n  }\n}\n\nasync function login (address = dom.loginAddressBox.value) {\n  if (!address) throw new Error(__(\"Please enter an address.\"))\n  if (ledger) ledger.disconnect()\n\n  loginForm.setInfo(__(\"Connecting to your account...\"))\n  params.$set({ address })\n  clickWall.enable()\n\n  try {\n    global.portfolio = await Portfolio.resolve(address)\n    loginForm.setInfo(`${__(\"Fetching market data\")}...`)\n    setTimeout(\n      () => loginForm.setInfo(`${__(\"Sorry, it takes a while (^.^)\\\"\")}...`),\n      10000\n    )\n    setTimeout(() => loginForm.setInfo(`${__(\"Almost there\")}...`), 20000)\n    setTimeout(\n      () => loginForm.setInfo(`${__(\"I'm running, I'm running\")}...`),\n      30000\n    )\n    global.portfolio.listen(\"open\", () => {\n      initGui()\n      clickWall.disable()\n    })\n  } catch (error) {\n    console.error(error)\n    loginForm.setError(error)\n    clickWall.disable()\n  }\n}\n\nfunction initGui () {\n  const portfolio = global.portfolio\n\n  const selected = location.hash\n  tabs.remove(\"#welcome\")\n  tabs.remove(\"#login\")\n  tabs.add(\"#portfolio\", __(\"Portfolio\"), new PortfolioGui(portfolio))\n  tabs.add(\"#rebalance\", __(\"Rebalance\"), new RebalanceGui(portfolio))\n  tabs.add(\"#activity\", __(\"Activity\"), new ActivityGui(portfolio))\n  tabs.add(\"#settings\", __(\"Settings\"), new SettingsGui())\n  tabs.add(\"#logout\", __(\"Logout\"), () => {\n    location.replace(location.href.replace(/\\?.*$/, \"#login\"))\n  })\n  tabs.fitScreen()\n\n  tabs.select(selected)\n  if (!tabs.selected) tabs.select(\"#portfolio\")\n}\n\n/**\n * Module loading\n */\n\nfunction getLedgerModule () {\n  return import(\n    /* webpackChunkName: \"ledger\" */ \"@cosmic-plus/ledger-wallet\"\n  ).then(ledger => ledger.default)\n}\n","\"use_strict\"\n/**\n * Asset class\n */\n\nconst AUTO_REFRESH_PRICES = true\nconst CRYPTO_PRICES_REFRESH_DELAY = 60 * 1000\nconst FIAT_PRICES_REFRESH_DELAY = 60 * 60 * 1000\nconst FIAT_BASEURL = \"https://www.xe.com/themes/xe/images/flags/svg/\"\nconst FIAT_IMAGEFORMAT = \".svg\"\n\nconst Mirrorable = require(\"@cosmic-plus/jsutils/es5/mirrorable\")\nconst Projectable = require(\"@cosmic-plus/jsutils/es5/projectable\")\n\nconst global = require(\"./global\")\nconst marketData = require(\"./market-data\")\nconst Orderbook = require(\"./orderbook\")\n\n/**\n * Class\n */\n\nconst Asset = module.exports = class Asset extends Projectable {\n  static resolve (id) {\n    return Asset.table[id] || new Asset(id)\n  }\n\n  constructor (id) {\n    super()\n\n    this.id = id\n    Asset.table[id] = this\n\n    // Empty image by default\n    this.image = \"data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=\"\n\n    if (Asset.info[id]) {\n      this.code = id\n      Object.assign(this, Asset.info[id])\n      if (this.type === \"fiat\") {\n        Asset.fiats.push(this)\n        this.image = `${FIAT_BASEURL}${id.toLowerCase()}${FIAT_IMAGEFORMAT}`\n      } else {\n        Asset.cryptos.push(this)\n        this.type = \"crypto\"\n      }\n    } else {\n      this.code = id.replace(/:.*/, \"\")\n      this.name = this.code\n      this.type = \"unknown\"\n    }\n\n    this.anchors = new Mirrorable()\n    this.balances = new Mirrorable()\n    this.offers = new Mirrorable()\n\n    this.balances.mirror(balance => {\n      this.anchors.push(balance.anchor)\n      this.watch(balance, \"amount\", () => this.compute(\"amount\"))\n      this.watch(balance, [\"buying\", \"selling\"], () => {\n        this.compute(\"liabilities\")\n      })\n    })\n\n    this.orderbook = Orderbook.forAsset(this)\n    this.define(\"price\", \"globalPrice\", () => {\n      return this.globalPrice || this.orderbook.price\n    })\n    this.watch(this.orderbook, \"price\", () => this.compute(\"price\"))\n  }\n\n  async getInfo () {\n    // Happens once & only for cryptos.\n    if (this.name || this.type !== \"crypto\") return\n    this.info = await marketData.crypto.info(this)\n    this.name = this.info.name\n    this.image = this.info.image.small\n  }\n\n  addOrderbook (orderbook) {\n    this.orderbook.addChild(orderbook)\n  }\n}\n\nAsset.define(\"amount\", \"balances\", function () {\n  return this.balances && this.balances.reduce((sum, el) => sum + el.amount, 0)\n})\n\nAsset.define(\"value\", [\"amount\", \"price\"], function () {\n  return this.amount === 0 ? 0 : this.amount * this.price\n})\n\nAsset.define(\"liabilities\", [\"balances\", \"price\"], function () {\n  if (this.balances) {\n    const rawLiabilities = this.balances.reduce(\n      (sum, entry) => sum + entry.buying - entry.selling,\n      0\n    )\n    return this.price * rawLiabilities\n  }\n})\n\nAsset.define(\"isSupported\", [\"type\", \"price\"], function () {\n  return !!(this.type !== \"unknown\" || this.price)\n})\n\n/**\n * Utilities\n */\n\nAsset.refreshPrices = async function (array) {\n  if (!array) {\n    await Asset.refreshCryptoPrices()\n    await Asset.refreshFiatPrices()\n  } else {\n    await Asset.refreshCryptoPrices(\n      array.filter(asset => asset.type === \"crypto\").map(asset => asset.code)\n    )\n    await Asset.refreshFiatPrices(\n      array.filter(asset => asset.type === \"fiat\").map(asset => asset.code)\n    )\n  }\n}\n\nAsset.refreshCryptoPrices = async function (assets = Asset.cryptos) {\n  if (!assets.length) return\n  const prices = await marketData.crypto.prices(assets)\n  assets.forEach(asset => asset.globalPrice = prices[asset.code])\n}\n\nAsset.refreshFiatPrices = async function (fiats = Asset.fiats) {\n  if (!fiats.length) return\n  const prices = await marketData.fiat.prices(fiats)\n  fiats.forEach(asset => asset.price = asset.globalPrice = prices[asset.code])\n}\n\n/**\n * Known Assets\n */\n\nAsset.info = {\n  USD: { type: \"fiat\", name: \"US Dollar\" },\n  EUR: { type: \"fiat\", name: \"Euro\" },\n  CNY: { type: \"fiat\", name: \"Renminbi\" },\n\n  BTC: { id: \"bitcoin\" },\n  ETH: { id: \"ethereum\" },\n  XRP: { id: \"ripple\" },\n  XLM: { id: \"stellar\" },\n  KIN: { id: \"kin\" },\n  BAT: { id: \"basic-attention-token\" },\n  ZRX: { id: \"0x\" },\n  BCH: { id: \"bitcoin-cash\" },\n  STEEM: { id: \"steem\" },\n  SBD: { id: \"steem-dollar\" },\n  LINK: { id: \"chainlink\" },\n\n  SLT: { id: \"smartlands\" },\n  MOBI: { id: \"mobius\" },\n  SHX: { id: \"stronghold-token\" },\n  RMT: { id: \"sureremit\" },\n  TERN: { id: \"ternio\" },\n  PEDI: { id: \"pedity\" },\n  GRAT: { id: \"gratz\" },\n  REPO: { id: \"repo\" }\n}\n\n/**\n * Init\n */\n\nAsset.table = {}\nAsset.cryptos = []\nAsset.fiats = []\nnew Asset(global.currency)\n\n// Automatic global price refresh\nif (AUTO_REFRESH_PRICES) {\n  setInterval(Asset.refreshCryptoPrices, CRYPTO_PRICES_REFRESH_DELAY)\n  setInterval(Asset.refreshFiatPrices, FIAT_PRICES_REFRESH_DELAY)\n}\n\n// eslint-disable-next-line no-console\nconsole.log(Asset.table)\n","\"use_strict\"\n/**\n * Signing Side Frame\n */\nconst html = require(\"@cosmic-plus/domutils/es5/html\")\nconst Observable = require(\"@cosmic-plus/jsutils/es5/observable\")\nconst { timeout } = require(\"@cosmic-plus/jsutils/es5/misc\")\nconst { __ } = require(\"@cosmic-plus/i18n\")\n\n/**\n * Class\n */\n\nclass SideFrame extends Observable {\n  constructor (url) {\n    super()\n\n    if (SideFrame.current) SideFrame.current.close()\n    SideFrame.current = this\n\n    this.domNode = html.create(\"iframe\", {\n      title: \"Signing Frame\",\n      className: \"animated\",\n      src: url,\n      sandbox: \"allow-same-origin allow-scripts allow-forms allow-popups\",\n      hidden: true\n    })\n    Object.assign(this.domNode.style, SideFrame.style)\n    html.append(document.body, this.domNode)\n\n    this.show()\n  }\n\n  show () {\n    if (!this.domNode.hidden) return\n\n    this.htmlOverflow = document.documentElement.style.overflow\n    this.bodyOverflow = document.body.style.overflow\n    document.documentElement.style.overflow = \"hidden\"\n    document.body.style.overflow = \"hidden\"\n\n    html.show(SideFrame.shadow, SideFrame.close, this.domNode)\n    this.domNode.style.animationName = \"slideInRight\"\n    SideFrame.shadow.style.background = \"rgba(0,0,0,0.3)\"\n\n    return timeout(400).then(() => {\n      SideFrame.shadow.onclick = () => this.close()\n      SideFrame.close.onclick = () => this.close()\n      this.trigger(\"show\")\n    })\n  }\n\n  hide () {\n    if (this.domNode.hidden) return\n\n    document.documentElement.style.overflow = this.htmlOverflow\n    document.body.style.overflow = this.bodyOverflow\n\n    SideFrame.shadow.onclick = null\n    html.hide(SideFrame.close)\n\n    this.domNode.style.animationName = \"slideOutRight\"\n    SideFrame.shadow.style.background = \"transparent\"\n\n    return timeout(400).then(() => {\n      html.hide(SideFrame.shadow, SideFrame.close, this.domNode)\n      this.trigger(\"hide\")\n    })\n  }\n\n  close () {\n    SideFrame.current = null\n    this.hide().then(() => {\n      html.destroy(this.domNode)\n      this.trigger(\"close\")\n      this.destroy()\n    })\n  }\n}\n\n/**\n * Event\n */\n\nwindow.addEventListener(\"message\", event => {\n  const frameWindow =\n    SideFrame.current && SideFrame.current.domNode.contentWindow\n\n  if (event.source === frameWindow) {\n    switch (event.data) {\n    case \"show\":\n      SideFrame.current.show()\n      break\n    case \"hide\":\n      SideFrame.current.hide()\n      break\n    case \"close\":\n      SideFrame.current.close()\n      break\n    }\n  }\n})\n\n/**\n * Frame style\n */\n\nSideFrame.style = {\n  position: \"fixed\",\n  zIndex: 998,\n  right: 0,\n  top: 0,\n  width: \"30em\",\n  maxWidth: \"100%\",\n  height: \"100vh\",\n  border: \"0.1em solid hsl(240, 10%, 75%)\",\n  background: \"hsl(240, 40%, 98%)\",\n  backgroundImage: `url('./images/cosmic-link.svg')`,\n  backgroundRepeat: \"no-repeat\",\n  backgroundPosition: \"center\",\n  backgroundSize: \"12em 12em\",\n  padding: 0\n}\n\n/**\n * Closing button\n */\n\nSideFrame.close = html.create(\"span\", { hidden: true }, ` ${__(\"Close\")}`)\nObject.assign(SideFrame.close.style, {\n  position: \"fixed\",\n  zIndex: 999,\n  top: \"0.1em\",\n  right: \"0.1em\",\n  color: \"hsl(0, 0%, 40%)\",\n  fontSize: \"0.9em\",\n  fontWeight: \"bold\",\n  cursor: \"pointer\",\n  background: \"hsl(0, 0%, 95%)\",\n  borderBottomLeftRadius: \"0.1em\",\n  padding: \"0.1em 0.3em\"\n})\ndocument.body.insertBefore(SideFrame.close, document.body.firstChild)\n\n/**\n * Shadow Layer\n */\n\nSideFrame.shadow = html.create(\"div\", { hidden: true })\nObject.assign(SideFrame.shadow.style, {\n  position: \"fixed\",\n  zIndex: 997,\n  top: 0,\n  width: \"100%\",\n  height: \"100%\",\n  background: \"transparent\",\n  transition: \"background 0.4s\"\n})\ndocument.body.insertBefore(SideFrame.shadow, document.body.firstChild)\n\n/**\n * Export\n */\n\nmodule.exports = SideFrame\n","\"use_strict\"\n/**\n * Markets statistics & data\n *\n * @exports marketData\n */\nconst marketData = exports\n\nconst axios = require(\"@cosmic-plus/base/es5/axios\")\nconst nice = require(\"@cosmic-plus/jsutils/es5/nice\")\nconst { day } = require(\"@cosmic-plus/jsutils/es5/misc\")\n\nconst global = require(\"./global\")\n\n/**\n * Generic price/history\n */\n\nmarketData.assetHistory = function (asset, limit = 1000) {\n  if (asset.type === \"crypto\") return marketData.crypto.history(asset, limit)\n  else if (asset.type === \"fiat\") return marketData.fiat.history(asset, limit)\n}\n\n/**\n * Crypto price/history by \"https://www.coingecko.com\"\n */\n\nmarketData.crypto = {}\n\nfunction coingeckoCall (page, params) {\n  return axios.get(`https://api.coingecko.com/api/v3/${page}`, { params })\n}\n\nmarketData.crypto.list = async function () {\n  const response = await coingeckoCall(\"coins/list\")\n  const list = {}\n  response.data.forEach(entry => {\n    const symbol = entry.symbol.toUpperCase()\n    list[symbol] = { id: entry.id, name: entry.name }\n  })\n  return list\n}\n\nmarketData.crypto.stellarNative = async function () {\n  const response = await coingeckoCall(\"exchanges/stellar_term\")\n  return response.data.tickers.map(x => x.coin_id).filter(x => x)\n}\n\nmarketData.crypto.info = async function (asset) {\n  const response = await coingeckoCall(`coins/${asset.id}`, {\n    localization: false,\n    tickers: false,\n    market_data: false,\n    community_data: false,\n    developer_data: false,\n    sparkline: false\n  })\n  return response.data\n}\n\nmarketData.crypto.prices = async function (assets) {\n  const ids = assets.map(asset => asset.id).join(\",\")\n  const quote = global.currency.toLowerCase()\n  const response = await coingeckoCall(\"simple/price\", {\n    ids,\n    vs_currencies: quote\n  })\n  const prices = {}\n  assets.forEach(asset => {\n    const assetData = response.data[asset.id]\n    if (assetData) prices[asset.code] = assetData[quote]\n  })\n  return prices\n}\n\nmarketData.crypto.history = async function (asset, limit = 1000) {\n  const response = await coingeckoCall(`coins/${asset.id}/market_chart`, {\n    vs_currency: global.currency,\n    days: limit\n  })\n  const data = response.data.prices.map((record, index) => {\n    return {\n      time: record[0],\n      price: record[1],\n      // volume: response.data.total_volumes[index][1]\n      volume: +nice(response.data.total_volumes[index][1] / record[1])\n    }\n  })\n  return data\n}\n\n/**\n * Fiat prices / history by \"https://exchangeratesapi.io\"\n */\n\nmarketData.fiat = {}\n\nasync function exchangeratesCall (page, symbols, params = {}) {\n  params.base = global.currency\n  if (typeof symbols === \"string\") {\n    params.symbols = symbols\n  } else {\n    if (global.currency === \"EUR\") symbols = symbols.filter(x => x !== \"EUR\")\n    params.symbols = symbols.join(\",\")\n  }\n  params.source = \"equilibre.io\"\n\n  return axios\n    .get(`https://api.exchangeratesapi.io/${page}`, { params })\n    .then(response => {\n      if (global.currency === \"EUR\" && !response.data.start_at) {\n        response.data.rates.EUR = 1\n      }\n      return response\n    })\n}\n\nmarketData.fiat.prices = async function (assets) {\n  const symbols = assets.map(asset => asset.code)\n  const response = await exchangeratesCall(\"latest\", symbols)\n  const data = response.data.rates\n  for (let symbol in data) {\n    data[symbol] = nice(1 / data[symbol], 8)\n  }\n  return data\n}\n\nmarketData.fiat.history = async function (asset, limit = 1000) {\n  const cached = cachedHistory(asset)\n  if (cached) return cached\n\n  const end_at = new Date().toISOString().slice(0, 10)\n  const today = new Date(end_at)\n  today.setDate(today.getDate() - limit)\n  const start_at = today.toISOString().slice(0, 10)\n  const response = await exchangeratesCall(\"history\", asset.code, {\n    start_at,\n    end_at\n  })\n\n  const data = Object.keys(response.data.rates)\n    .sort()\n    .map(date => {\n      return {\n        time: new Date(date).getTime(),\n        price: +nice(1 / response.data.rates[date][asset.code], 8)\n      }\n    })\n  cacheHistory(asset, data)\n  return data\n}\n\n/**\n * Helpers\n */\n\nfunction cacheHistory (asset, data) {\n  localStorage[`prices.${asset.code}`] = JSON.stringify([day(), data])\n}\n\nfunction cachedHistory (asset) {\n  const json = localStorage[`prices.${asset.code}`]\n  if (!json) return\n  const data = JSON.parse(json)\n  if (data[0] === day()) return data[1]\n}\n","\"use_strict\"\n/**\n * Orderbook class\n */\n\nconst cosmicLib = require(\"cosmic-lib\")\nconst nice = require(\"@cosmic-plus/jsutils/es5/nice\")\nconst Projectable = require(\"@cosmic-plus/jsutils/es5/projectable\")\nconst StellarSdk = require(\"@cosmic-plus/base/es5/stellar-sdk\")\nconst { timeout } = require(\"@cosmic-plus/jsutils/es5/misc\")\nconst { __ } = require(\"@cosmic-plus/i18n\")\n\nconst Orderbook = module.exports = class Orderbook extends Projectable {\n  static forBalance (balance, quote) {\n    if (balance.asset === quote) return\n\n    const orderbook = new Orderbook({ balance, quote })\n    orderbook.streamOffers()\n\n    balance.orderbook = orderbook\n    balance.asset.addOrderbook(orderbook)\n\n    return orderbook\n  }\n\n  static forAsset (asset) {\n    return new Orderbook({ asset })\n  }\n\n  constructor (params) {\n    super()\n\n    if (params.balance) {\n      this.type = \"native\"\n      this.balance = params.balance\n      this.base = params.balance.asset\n      this.quote = params.quote\n      this.name = `${this.base.code}/${this.quote.code}`\n      this.offersCallBuilder = Orderbook.offersCallBuilder(this.balance)\n\n      this.watch(this.quote, \"price\", () => this.updateOffersPrices())\n    } else if (params.asset) {\n      this.type = \"agregated\"\n      this.base = params.asset\n      this.name = `${this.base.code} (${__(\"Agregated\")})`\n      this.childs = []\n    }\n\n    this.watch(this.base, \"globalPrice\", () => this.compute(\"price\"))\n  }\n\n  static offersCallBuilder (balance) {\n    const baseAsset = new StellarSdk.Asset(balance.code, balance.anchor.address)\n    const quoteAsset = StellarSdk.Asset.native()\n    const server = cosmicLib.resolve.server()\n    return server.orderbook(baseAsset, quoteAsset)\n  }\n\n  async streamOffers () {\n    // eslint-disable-next-line no-constant-condition\n    while (true) {\n      await this.getOffers()\n      await timeout(15000)\n    }\n  }\n\n  async getOffers () {\n    try {\n      const offers = await this.offersCallBuilder.call()\n      this.ingest(offers)\n    } catch (error) {\n      console.error(error)\n    }\n  }\n\n  ingest (offers) {\n    if (!areOffersEquals(this.bids, offers.bids)) {\n      this.bids = normalizeOffers(offers.bids, this.quote, this.balance, \"bids\")\n    }\n    if (!areOffersEquals(this.asks, offers.asks)) {\n      this.asks = normalizeOffers(offers.asks, this.quote, this.balance, \"asks\")\n    }\n  }\n\n  updateOffersPrices () {\n    if (this.bids) {\n      this.set(\"bids\", updateOffersPrices(this.bids, this.quote))\n    }\n    if (this.asks) {\n      this.set(\"asks\", updateOffersPrices(this.asks, this.quote))\n    }\n  }\n\n  mergeOffers (side) {\n    if (this.childs.length < 2) {\n      this.set(side, this.childs[0] && this.childs[0][side])\n      return\n    }\n\n    /// Merge order books\n    const merged = this.childs.reduce((merged, child) => {\n      return child[side] ? merged.concat(child[side]) : merged\n    }, [])\n    if (!merged.length) {\n      this[side] = null\n      return\n    }\n\n    const sortOffers =\n      side === \"bids\"\n        ? (a, b) => b.price - a.price\n        : (a, b) => a.price - b.price\n\n    /// Update volumes.\n    let volume = 0,\n      baseVolume = 0,\n      quoteVolume = 0\n    this.set(\n      side,\n      merged.sort(sortOffers).map(row => {\n        const mergedRow = Object.assign({}, row)\n        mergedRow.volume = volume += +nice(row.amount * row.price, 7)\n        mergedRow.baseVolume = baseVolume += +row.amount\n        mergedRow.quoteVolume = quoteVolume += +row.quoteAmount\n        return mergedRow\n      })\n    )\n  }\n\n  addChild (orderbook) {\n    this.childs.push(orderbook)\n    this.watch(orderbook, \"bids\", () => this.mergeOffers(\"bids\"))\n    this.watch(orderbook, \"asks\", () => this.mergeOffers(\"asks\"))\n  }\n}\n\nOrderbook.define(\"bestBid\", \"bids\", function () {\n  return this.bids && this.bids[0] && this.bids[0].price\n})\nOrderbook.define(\"bestAsk\", \"asks\", function () {\n  return this.asks && this.asks[0] && this.asks[0].price\n})\nOrderbook.define(\"price\", [\"bestBid\", \"bestAsk\"], function () {\n  if (this.base.globalPrice) return (this.bestBid + this.bestAsk) / 2\n  else return this.marketPrice()\n})\nOrderbook.define(\"spread\", [\"bestBid\", \"bestAsk\"], function () {\n  return this.bestAsk - this.bestBid\n})\nOrderbook.define(\"spread%\", [\"spread\", \"bestAsk\"], function () {\n  return 100 * this.spread / this.bestAsk\n})\n\n/**\n * Utilities\n */\n\n/**\n * Look for the best first offer in **orderbook** **side** that match **filter**\n * (if provided) among child orderbooks.\n *\n * @param  {Orderbook} orderbook [description]\n * @param  {String}    side      `bids` or `asks`\n * @param  {Function}  [filter]  A filter that is passed by the returned offer\n * @return {Object}    An orderbook offer\n */\nOrderbook.prototype.findOffer = function (side, filter) {\n  const offers = this[side]\n  const childsNum = this.childs ? this.childs.length : 1\n  const anchors = {}\n\n  let last\n  for (let index in offers) {\n    const offer = offers[index]\n    if (filter && !filter(offer)) continue\n    const anchor = offer.balance.anchor.address\n    if (!anchors[anchor]) {\n      anchors[anchor] = true\n      last = offer\n    }\n    if (Object.keys(anchors).length === childsNum) break\n  }\n  return last\n}\n\nOrderbook.prototype.findAsk = function (filter) {\n  return this.findOffer(\"asks\", filter)\n}\nOrderbook.prototype.findBid = function (filter) {\n  return this.findOffer(\"bids\", filter)\n}\n\n/**\n * Returns the price of asset at **depth** XLM of orderbook's **side**.\n *\n * @param  {String} [side=\"bids\"] Either \"bids\" or \"asks\"\n * @param  {Number} [depth] The depth to look at, in term of XLM\n * @return {Number} Offer price at requested depth\n */\nOrderbook.prototype.marketPrice = function (side = \"bids\", depth = 50) {\n  const offer = this.findOffer(side, offer => offer.quoteVolume > depth)\n  return offer ? offer.price : 0\n}\n\n/**\n * Helpers\n */\n\nfunction areOffersEquals (array1, array2) {\n  if (!array1) return false\n  if (array1.length !== array2.length) return false\n  for (let index in array1.length) {\n    if (array1[index].amount !== array2[index].amount) return false\n    if (array1[index].price !== array2[index].price) return false\n  }\n  return true\n}\n\nfunction normalizeOffers (offers, quote, balance, side) {\n  offers.forEach(row => {\n    row.volume = undefined\n    row.baseVolume = undefined\n    row.basePrice = +row.price\n    row.quoteAmount = +row.amount\n    row.quoteVolume = undefined\n    row.balance = balance\n    row.side = side\n  })\n  return updateOffersPrices(offers, quote)\n}\n\nfunction updateOffersPrices (offers, quote) {\n  let volume = 0,\n    quoteVolume = 0,\n    baseVolume = 0\n  offers.forEach(row => {\n    if (row.side === \"asks\") {\n      row.quoteAmount = +nice(row.amount * row.basePrice, 7)\n    } else {\n      row.amount = +nice(row.quoteAmount / row.basePrice, 7)\n    }\n    row.price = +nice(row.basePrice * quote.price, 7)\n    row.volume = volume += +nice(row.amount * row.price, 7)\n    row.baseVolume = baseVolume += +row.amount\n    row.quoteVolume = quoteVolume += +row.quoteAmount\n  })\n  return offers\n}\n","\"use_strict\"\n/**\n * Balance entry\n */\nconst Mirrorable = require(\"@cosmic-plus/jsutils/es5/mirrorable\")\nconst Projectable = require(\"@cosmic-plus/jsutils/es5/projectable\")\n\nconst Anchor = require(\"./anchor\")\nconst Asset = require(\"./asset\")\nconst Orderbook = require(\"./orderbook\")\n\nconst Balance = module.exports = class Balance extends Projectable {\n  static resolve (code, issuer) {\n    const id = code ? `${code}:${issuer}` : \"XLM\"\n    return Balance.table[id]\n  }\n\n  static ingest (entry) {\n    const id = entryId(entry)\n    const balance = Balance.table[id]\n    if (!balance) return new Balance(entry, id)\n\n    balance.amount = +entry.balance\n    balance.buying = +entry.buying_liabilities\n    balance.selling = +entry.selling_liabilities\n    return balance\n  }\n\n  constructor (entry) {\n    super()\n\n    this.id = entryId(entry)\n    this.code = entry.asset_code || \"XLM\"\n    this.anchor = Anchor.resolve(entry.asset_issuer || \"stellar.org\")\n    Balance.table[this.id] = this\n\n    if (this.id === \"XLM\" || this.id in Anchor.known) {\n      this.asset = Asset.resolve(Anchor.known[this.id] || this.code)\n      this.known = true\n    } else {\n      this.asset = Asset.resolve(this.id)\n      this.known = false\n    }\n    this.amount = +entry.balance\n    this.buying = +entry.buying_liabilities\n    this.offers = new Mirrorable()\n    this.selling = +entry.selling_liabilities\n\n    this.asset.balances.push(this)\n\n    if (this.code === \"XLM\") {\n      this.asset.project(\"price\", this)\n    } else {\n      this.orderbook = Orderbook.forBalance(this, Asset.resolve(\"XLM\"))\n      this.orderbook.project(\"price\", this)\n    }\n  }\n}\n\nBalance.table = {}\nBalance.define(\"value\", [\"amount\", \"price\"], function () {\n  return this.amount === 0 ? 0 : this.amount * this.price\n})\n\n/**\n * Helpers\n */\n\nfunction entryId (entry) {\n  return entry.asset_code ? `${entry.asset_code}:${entry.asset_issuer}` : \"XLM\"\n}\n","\"use_strict\"\n/**\n * Order class\n */\n\nconst cosmicLib = require(\"cosmic-lib\")\nconst CosmicLink = cosmicLib.CosmicLink\nconst Mirrorable = require(\"@cosmic-plus/jsutils/es5/mirrorable\")\nconst nice = require(\"@cosmic-plus/jsutils/es5/nice\")\nconst Projectable = require(\"@cosmic-plus/jsutils/es5/projectable\")\nconst { __ } = require(\"@cosmic-plus/i18n\")\n\nconst global = require(\"./global\")\n\n/**\n * Class\n */\n\nconst Order = module.exports = class Order extends Projectable {\n  static rebalance (target) {\n    if (target.asset.code === \"XLM\") return\n\n    const order = new Order(\"balance\", target.asset.orderbook, target)\n    order.watch(target, \"amount\", () => order.refresh())\n    order.watch(target.asset.orderbook, [\"bids\", \"asks\"], () => order.refresh())\n    target.asset.offers.listen(\"change\", () => order.refresh(), order)\n\n    return order\n  }\n\n  constructor (type, orderbook, ...parameters) {\n    super()\n    this.type = type\n    this.method = Order.type[this.type]\n    this.operations = new Mirrorable()\n    this.orderbook = orderbook\n    this.parameters = parameters\n\n    this.operations.listen(\"update\", () => {\n      this.compute([\"cosmicLink\", \"description\"])\n    })\n\n    this.refresh()\n  }\n\n  refresh () {\n    this.operations.splice(0, this.operations.length)\n    this.operations.trigger(\"update\")\n    this.method(this, ...this.parameters)\n    this.trigger(\"refresh\")\n  }\n\n  /**\n   * Operations Management\n   */\n\n  getOperation (offer, make) {\n    const id = `${offer.balance.anchor.name}:${make ? offer.price : \"take\"}`\n    const operation = this.operations.find(x => x.id === id)\n    if (operation) {\n      return operation\n    } else {\n      const newOperation = { id }\n      this.operations.push(newOperation)\n      return newOperation\n    }\n  }\n\n  addOperation (offer, amount) {\n    const operation = this.getOperation(offer, amount > 0)\n    this.setOperation(operation, offer, Number(amount) || operation.amount)\n  }\n\n  setOperation (operation, offer, amount) {\n    operation.amount = amount\n    operation.cost = amount * offer.price\n    operation.offer = offer\n    this.operations.trigger(\"update\")\n  }\n}\n\nOrder.define(\"cosmicLink\", \"operations\", function () {\n  return Order.operationsToCosmicLink(this.operations)\n})\nOrder.define(\"description\", \"operations\", function () {\n  return Order.operationsToDescription(this.operations)\n})\n\n/**\n * Utilities\n */\n\nOrder.operationsToCosmicLink = function (operations = []) {\n  const cosmicLink = new CosmicLink({\n    memo: \"Equilibre.io\",\n    maxTime: \"+5\",\n    source: global.portfolio.accountId\n  })\n  operations.forEach(operation => {\n    cosmicLink.addOperation(\"manageOffer\", operationToOdesc(operation))\n  })\n\n  return cosmicLink\n}\n\nOrder.operationsToDescription = function (operations = []) {\n  const desc = []\n  operations.forEach(op => {\n    if (operationDirection(op) === \"buy\") {\n      desc.push(`\n${__(\"Buy\")} ${nice(op.amount)} ${op.offer.balance.code} ${__(\"at\")} \\\n${nice(op.offer.price)} ${global.currency}\n      `)\n    } else {\n      desc.push(`\n${__(\"Sell\")} ${nice(op.amount)} ${op.offer.balance.code} ${__(\"at\")} \\\n${nice(op.offer.price)} ${global.currency}\n      `)\n    }\n  })\n  return desc\n}\n\n/**\n * Helpers\n */\n\nfunction operationDirection (op) {\n  if (\n    op.amount > 0 && op.offer.side === \"bids\"\n    || op.amount < 0 && op.offer.side === \"asks\"\n  ) {\n    return \"buy\"\n  } else {\n    return \"sell\"\n  }\n}\n\nfunction operationToOdesc (operation) {\n  const offer = operation.offer\n  const base = offer.balance.code + \":\" + offer.balance.anchor.address\n  const quote = \"XLM\"\n\n  let odesc\n  if (operationDirection(operation) === \"buy\") {\n    odesc = {\n      buying: base,\n      selling: quote,\n      amount: operation.amount * offer.price_r.n / offer.price_r.d,\n      price: { n: offer.price_r.d, d: offer.price_r.n }\n    }\n  } else {\n    odesc = {\n      buying: quote,\n      selling: base,\n      amount: operation.amount,\n      price: offer.price_r\n    }\n  }\n  odesc.amount = Math.abs(odesc.amount).toFixed(7)\n  odesc.offerId = operation.offer.id\n\n  return odesc\n}\n\n/**\n * Orders types\n */\n\nOrder.type = {}\n\nOrder.type.market = function (order, size) {\n  if (!size) return\n\n  const side = size > 0 ? \"asks\" : \"bids\"\n  const amount = Math.abs(size)\n  const offer = order.orderbook.findOffer(side, offer => {\n    return offer.baseVolume > amount\n  })\n  order.addOperation(offer, amount)\n}\n\nOrder.type.limit = function (order, size, { orderbook, filter }) {\n  if (!size) return\n\n  const side = size > 0 ? \"bids\" : \"asks\"\n  const offer = (orderbook || order.orderbook).findOffer(side, filter)\n  if (offer) order.addOperation(tightenSpread(offer), Math.abs(size))\n}\n\n/**\n * Rebalancing\n */\n\nOrder.type.balance = function (order, target) {\n  const asset = target.asset\n  const orderbook = asset.orderbook\n\n  // Requirements\n\n  if (target.amount == null || target.amountDelta === 0) return\n\n  if (!orderbook.bestBid || !orderbook.bestAsk) {\n    order.description = [__(\"Fetching orderbook...\")]\n    return\n  }\n\n  if (asset.liabilities) {\n    const currentOffers = asset.offers.filter(offer => !offer.outdated)\n    if (currentOffers.length) {\n      order.description = [__(\"Rebalancing...\")]\n      return\n    }\n  }\n\n  // Rebalancing\n\n  setBalancesLimits(target)\n  if (isOneOperationEnough(target)) {\n    addBalancingOperation(target, orderbook, target.amountDiff)\n  } else {\n    addSplitTrade(target)\n  }\n}\n\n/**\n * Set the `amountTradable` property of **target** balances according to\n * **target** target.\n */\nfunction setBalancesLimits (target, deviation = global.balanceTargetDeviation) {\n  // Empty orderbooks cannot be traded.\n  const balances = []\n  target.asset.balances.forEach(balance => {\n    if (balance.orderbook.price != null) balances.push(balance)\n    else balance.amountTradable = 0\n  })\n\n  // Special cases.\n  if (!balances.length) {\n    return\n  } else if (balances.length === 1) {\n    return balances[0].amountTradable = target.amountDelta\n  }\n\n  // Set each balance tradable amount.\n  const amountTarget = +nice(target.amount / balances.length, 7)\n  const amountMin = +nice(amountTarget * (1 - deviation), 7)\n  const amountMax = +nice(amountTarget * (1 + deviation), 7)\n\n  balances.forEach(balance => {\n    if (target.amountDiff > 0) {\n      balance.amountTradable = amountMax - balance.amount\n    } else {\n      balance.amountTradable = balance.amount - amountMin\n    }\n  })\n}\n\n/**\n * Returns whether or not it is possible meet **target** rebalancing target in\n * one operation.\n */\nfunction isOneOperationEnough (target) {\n  const balances = target.asset.balances\n  return !!filterTradableBalances(balances, target.amountDelta).length\n}\n\n/**\n * Return the **balances** that can be traded for **amountTraded**.\n */\nfunction filterTradableBalances (balances, amountTraded = 0) {\n  return balances.filter(balance => balance.amountTradable >= amountTraded)\n}\n\n/**\n * Adds an operation to `target.order` that trades **size** `target.asset` on\n * **orderbook**.\n */\nfunction addBalancingOperation (target, orderbook, size) {\n  const filter = makeOfferFilter(target, Math.abs(size))\n  Order.type.limit(target.order, size, { orderbook, filter })\n}\n\n/**\n * Split a trade over multiple anchors.\n */\nfunction addSplitTrade (target) {\n  const tradableBalances = filterTradableBalances(target.asset.balances)\n  const tradableAmounts = tradableBalances.map(x => x.amountTradable)\n  const tradableTotal = tradableAmounts.reduce((x, sum) => x + sum, 0)\n  const tradeShares = tradableAmounts.map(x => x / tradableTotal)\n  const tradeAmounts = tradeShares.map(x => +nice(x * target.amountDiff, 7))\n\n  tradableBalances.forEach((balance, index) => {\n    addBalancingOperation(target, balance.orderbook, tradeAmounts[index])\n  })\n}\n\n/**\n * Returns a balancing offer filter for **tradedAmount** to be used with\n * `Orderbook.findOffer()`.\n */\nfunction makeOfferFilter (target, amountTraded) {\n  const noMinValue = target.mode === \"quantity\" || target.amount === 0\n  return offer => {\n    return (\n      offer.balance.amountTradable >= amountTraded\n      && offer.baseVolume > amountTraded * global.skipMarginalOffers\n      && (noMinValue || amountTraded * offer.basePrice > global.minOfferValue)\n    )\n  }\n}\n\n/**\n * Create a copy of **offer** with a delta to global market price reduced by\n * **percentage**.\n */\nfunction tightenSpread (offer, percentage = global.spreadTightening) {\n  const clone = Object.assign({}, offer)\n  const diff = percentage * offer.balance.asset.orderbook[\"spread%\"] / 100\n\n  if (offer.side === \"bids\") clone.price = offer.price * (1 + diff)\n  else clone.price = offer.price * (1 - diff)\n\n  if (offer.balance.asset.globalPrice) clampOfferPrice(clone)\n  updateOfferPriceR(clone)\n\n  return clone\n}\n\n/**\n * Floor/ceil **offer**'s price to maintain a maximum spread of **spread**\n * from its price.\n *\n * @param {Object} offer offer to price-cap\n * @param {Number} [spread=0.025] Maximum spread from asset price (in percent)\n */\nfunction clampOfferPrice (offer, spread = global.maxSpread / 2) {\n  const refPrice = offer.balance.asset.price\n  if (offer.side === \"bids\") {\n    offer.price = clamp(offer.price, refPrice * (1 - spread), refPrice)\n  } else {\n    offer.price = clamp(offer.price, refPrice, refPrice * (1 + spread))\n  }\n}\n\n/**\n * Returns a number whose value is limited to the given range.\n *\n * @param  {Number} value An arbitrary number\n * @param  {Number} min Lower boundary\n * @param  {[type]} max Upper boundary\n * @return {Number}\n */\nfunction clamp (value, min, max) {\n  return Math.min(Math.max(value, min), max)\n}\n\n/**\n * Set `offer.price_r` according to `offer.price`.\n *\n * @param  {Object} offer\n */\nfunction updateOfferPriceR (offer) {\n  const quote = offer.balance.orderbook.quote\n\n  offer.price_r = {\n    n: nice(offer.price * 10000000000, 0),\n    d: nice(quote.price * 10000000000, 0)\n  }\n\n  // Ten characters maximum\n  while (offer.price_r.n > 999999999 || offer.price_r.d > 999999999) {\n    offer.price_r.n = nice(offer.price_r.n / 10, 0)\n    offer.price_r.d = nice(offer.price_r.d / 10, 0)\n  }\n}\n\n/**\n * Append Order.type to Order class\n */\n\nfor (let key in Order.type) {\n  if (!Order[key]) Order[key] = (...parameters) => new Order(key, ...parameters)\n}\n","\"use_strict\"\n/**\n * Overlay that prevent user interaction\n */\nconst clickWall = module.exports\n\nconst html = require(\"@cosmic-plus/domutils/es5/html\")\n\nconst overlay = html.create(\"div\", { hidden: true })\nhtml.append(document.body, overlay)\n\nObject.assign(overlay.style, {\n  position: \"fixed\",\n  zIndex: 999,\n  top: 0,\n  width: \"100%\",\n  height: \"100%\"\n})\n\nclickWall.enable = () => html.show(overlay)\nclickWall.disable = () => html.hide(overlay)\n","\"use_strict\"\n/**\n * Compute portfolio data from Account object.\n */\nconst axios = require(\"@cosmic-plus/base/es5/axios\")\nconst cosmicLib = require(\"cosmic-lib\")\nconst Mirrorable = require(\"@cosmic-plus/jsutils/es5/mirrorable\")\nconst Projectable = require(\"@cosmic-plus/jsutils/es5/projectable\")\nconst { timeout } = require(\"@cosmic-plus/jsutils/es5/misc\")\nconst { __ } = require(\"@cosmic-plus/i18n\")\n\nconst Asset = require(\"./asset\")\nconst Balance = require(\"./balance\")\nconst global = require(\"./global\")\n// const History = require(\"./portfolio-history\")\nconst Offers = require(\"./offers\")\n\n/**\n * Class\n */\n\nmodule.exports = class Portfolio extends Projectable {\n  static async resolve (address) {\n    await checkNetwork()\n\n    const destination = await cosmicLib.resolve.address(address)\n    if (destination.memo)\n      throw new Error(__(\"Invalid federated address: shared account.\"))\n    if (await cosmicLib.resolve.isAccountEmpty(destination.account_id))\n      throw new Error(__(\"Empty account\"))\n\n    const portfolio = new Portfolio(destination.account_id)\n    cosmicLib.config.source = portfolio.address = address\n    portfolio.streamAccount()\n\n    return portfolio\n  }\n\n  constructor (accountId) {\n    super()\n\n    // eslint-disable-next-line no-console\n    console.log(this)\n\n    this.accountId = accountId\n    this.assets = new Mirrorable()\n    this.balances = new Mirrorable()\n    this.accountCallBuilder = Portfolio.accountCallBuilder(accountId)\n\n    this.define(\"total\", \"assets\", () => {\n      return this.assets\n        .filter(asset => asset.isSupported)\n        .reduce((sum, x) => sum + x.value, 0)\n    })\n    this.assets.mirror(asset =>\n      this.watch(asset, [\"value\", \"isSupported\"], () => this.compute(\"total\"))\n    )\n\n    this.new = true\n  }\n\n  static accountCallBuilder (accountId) {\n    const server = cosmicLib.resolve.server()\n    return server.accounts().accountId(accountId)\n  }\n\n  async streamAccount () {\n    // eslint-disable-next-line no-constant-condition\n    while (true) {\n      await this.getAccount()\n      await timeout(5000)\n    }\n  }\n\n  async getAccount () {\n    try {\n      const account = await this.accountCallBuilder.call()\n      this.ingest(account)\n    } catch (error) {\n      console.error(error)\n    }\n  }\n\n  async ingest (account) {\n    this.account = account\n\n    for (let index in account.balances) {\n      const balance = Balance.ingest(account.balances[index])\n      const asset = balance.asset\n\n      if (this.assets.indexOf(asset) === -1) {\n        this.assets.push(asset)\n        this.balances.push(balance)\n        asset.watch(this, \"total\", () => asset.compute(\"share\"))\n        asset.getInfo()\n      } else if (this.balances.indexOf(balance) === -1) {\n        this.balances.push(balance)\n      }\n    }\n\n    if (this.new) {\n      delete this.new\n      await Asset.refreshPrices()\n      this.offers = Offers.forPortfolio(this)\n      await this.offers.stream()\n      this.trigger(\"open\")\n    }\n  }\n}\n\n/**\n * Extension\n */\n\nAsset.define(\"share\", \"value\", function () {\n  return global.portfolio && this.value / global.portfolio.total\n})\n\n/**\n * Helpers\n */\n\nasync function checkNetwork () {\n  const horizon = cosmicLib.resolve.horizon()\n  try {\n    await axios.get(horizon)\n  } catch (error) {\n    throw new Error(__(\"Can't connect to the Stellar blockchain\"))\n  }\n}\n","\"use_strict\"\n/**\n * Anchor class\n */\nconst aliases = require(\"@cosmic-plus/base/es5/aliases\")\nconst helpers = require(\"@cosmic-plus/jsutils/es5/misc\")\nconst Projectable = require(\"@cosmic-plus/jsutils/es5/projectable\")\n\n/**\n * Class\n */\n\nconst Anchor = module.exports = class Anchor extends Projectable {\n  static resolve (address) {\n    return Anchor.all[address] || new Anchor(address)\n  }\n\n  constructor (address) {\n    super()\n\n    this.address = address\n    this.alias = aliases.all[address]\n    this.name = helpers.shorter(this.alias || this.address)\n    Anchor.all[address] = this\n\n    this.assets = {}\n  }\n}\n\nAnchor.all = {}\n\n/**\n * Known Anchors\n */\n\nAnchor.known = {\n  \"USD:GDUKMGUGDZQK6YHYA5Z6AY2G4XDSZPSZ3SW5UN3ARVMO6QSRDWP5YLEX\": \"USD\",\n  \"WSD:GDSVWEA7XV6M5XNLODVTPCGMAJTNBLZBXOFNQD3BNPNYALEYBNT6CE2V\": \"USD\",\n  \"USD:GDSRCV5VTM3U7Y3L6DFRP3PEGBNQMGOWSRTGSBWX6Z3H6C7JHRI4XFJP\": \"USD\",\n  \"USD:GBUYUAI75XXWDZEKLY66CFYKQPET5JR4EENXZBUZ3YXZ7DS56Z4OKOFU\": \"USD\",\n  \"CNY:GAREELUB43IRHWEASCFBLKHURCGMHE5IF6XSE7EXDLACYHGRHM43RFOX\": \"CNY\",\n  \"XCN:GCNY5OXYSY4FKHOPT2SPOQZAOEIGXB5LBYW3HVU3OWSTQITS65M5RCNY\": \"CNY\",\n  \"BCNY:GBCNYBHAAPDSU3UIHXXQTHYZVSBJBI4YUNWXMKJBCPDHTVYR75G6NFHD\": \"CNY\",\n  \"EURT:GAP5LETOV6YIE62YAM56STDANPRDO7ZFDBGSNHJQIYGGKSMOZAHOOS2S\": \"EUR\",\n\n  \"SLT:GCKA6K5PCQ6PNF5RQBF7PQDJWRHO6UOGFMRLK3DYHDOI244V47XKQ4GP\": null,\n  \"MOBI:GA6HCMBLTZS5VYYBCATRBRZ3BZJMAFUDKYYF6AH6MVCMGWMRDNSWJPIH\": null,\n  \"SHX:GDSTRSHXHGJ7ZIVRBXEYE5Q74XUVCUSEKEBR7UCHEUUEK72N7I7KJ6JH\": null,\n  \"RMT:GDEGOXPCHXWFYY234D2YZSPEJ24BX42ESJNVHY5H7TWWQSYRN5ZKZE3N\": null,\n  \"TERN:GDGQDVO6XPFSY4NMX75A7AOVYCF5JYGW2SHCJJNWCQWIDGOZB53DGP6C\": null,\n  \"PEDI:GBVUDZLMHTLMZANLZB6P4S4RYF52MVWTYVYXTQ2EJBPBX4DZI2SDOLLY\": null,\n  \"GRAT:GAJ7V3EMD3FRWAPBEJAP7EC4223XI5EACDZ46RFMY5DYOMCIMWEFR5II\": null,\n  \"REPO:GCZNF24HPMYTV6NOEHI7Q5RJFFUI23JKUKY3H3XTQAFBQIBOHD5OXG3B\": null,\n\n  \"BTC:GATEMHCCKCY67ZUCKTROYN24ZYT5GK4EQZ65JJLDHKHRUZI3EUEKMTCH\": null,\n  \"BTC:GAUTUYY2THLF7SGITDFMXJVYH3LHDSMGEAKSBU267M2K7A3W543CKUEF\": null,\n  \"BTC:GCNSGHUCG5VMGLT5RIYYZSO7VQULQKAJ62QA33DBC5PPBSO57LFWVV6P\": null,\n  \"BTC:GBVOL67TMUQBGL4TZYNMY3ZQ5WGQYFPFD5VJRWXR72VA33VFNL225PL5\": null,\n  \"ETH:GCNSGHUCG5VMGLT5RIYYZSO7VQULQKAJ62QA33DBC5PPBSO57LFWVV6P\": null,\n  \"ETH:GBVOL67TMUQBGL4TZYNMY3ZQ5WGQYFPFD5VJRWXR72VA33VFNL225PL5\": null,\n  \"ETH:GBETHKBL5TCUTQ3JPDIYOZ5RDARTMHMEKIO2QZQ7IOZ4YC5XV3C2IKYU\": null,\n  \"ETH:GBDEVU63Y6NTHJQQZIKVTC23NWLQVP3WJ2RI2OTSJTNYOIGICST6DUXR\": null,\n  \"LTC:GC5LOR3BK6KIOK7GKAUD5EGHQCMFOGHJTC7I3ELB66PTDFXORC2VM5LP\": null,\n  \"LTC:GBVOL67TMUQBGL4TZYNMY3ZQ5WGQYFPFD5VJRWXR72VA33VFNL225PL5\": null,\n  \"LTC:GCNSGHUCG5VMGLT5RIYYZSO7VQULQKAJ62QA33DBC5PPBSO57LFWVV6P\": null,\n  \"XRP:GBVOL67TMUQBGL4TZYNMY3ZQ5WGQYFPFD5VJRWXR72VA33VFNL225PL5\": null,\n  \"XRP:GCNSGHUCG5VMGLT5RIYYZSO7VQULQKAJ62QA33DBC5PPBSO57LFWVV6P\": null,\n  \"KIN:GBDEVU63Y6NTHJQQZIKVTC23NWLQVP3WJ2RI2OTSJTNYOIGICST6DUXR\": null,\n  \"BAT:GBDEVU63Y6NTHJQQZIKVTC23NWLQVP3WJ2RI2OTSJTNYOIGICST6DUXR\": null,\n  \"ZRX:GBDEVU63Y6NTHJQQZIKVTC23NWLQVP3WJ2RI2OTSJTNYOIGICST6DUXR\": null,\n  \"BCH:GAEGOS7I6TYZSVHPSN76RSPIVL3SELATXZWLFO4DIAFYJF7MPAHFE7H4\": null,\n  \"STEEM:GB3KBOFUCVTWEZ7YIZ7PAKLQMKPCTGWU3LOMANMCT7V6I3AAK4USTEEM\": null,\n  \"SBD:GB3KBOFUCVTWEZ7YIZ7PAKLQMKPCTGWU3LOMANMCT7V6I3AAK4USTEEM\": null,\n  \"LINK:GBDEVU63Y6NTHJQQZIKVTC23NWLQVP3WJ2RI2OTSJTNYOIGICST6DUXR\": null\n}\n","\"use_strict\"\n/**\n * Account offers\n */\n\nconst cosmicLib = require(\"cosmic-lib\")\nconst loopcall = require(\"@cosmic-plus/loopcall\")\nconst Mirrorable = require(\"@cosmic-plus/jsutils/es5/mirrorable\")\nconst nice = require(\"@cosmic-plus/jsutils/es5/nice\")\nconst Projectable = require(\"@cosmic-plus/jsutils/es5/projectable\")\nconst hiddenKey = require(\"@cosmic-plus/jsutils/es5/misc\").setHiddenProperty\nconst { day } = require(\"@cosmic-plus/jsutils/es5/misc\")\n\nconst Asset = require(\"./asset\")\nconst Balance = require(\"./balance\")\n\n/**\n * Class\n */\n\nclass Offers extends Mirrorable {\n  static forPortfolio (portfolio) {\n    const offers = Offers.forAccount(portfolio.accountId)\n    hiddenKey(offers, \"portfolio\", portfolio)\n    return offers\n  }\n\n  static forAccount (accountId) {\n    const offers = new Offers()\n    hiddenKey(offers, \"accountId\", accountId)\n    hiddenKey(offers, \"callBuilder\", Offers.callBuilder(accountId))\n    return offers\n  }\n\n  static callBuilder (accountId) {\n    const server = cosmicLib.resolve.server()\n    return server.offers(\"accounts\", accountId)\n  }\n\n  async stream (delay = 15000) {\n    // Resolves after first get().\n    return this.get().then(() => setTimeout(() => this.stream(), delay))\n  }\n\n  async get () {\n    try {\n      const records = await loopcall(this.callBuilder, { limit: 200 })\n      this.ingest(records)\n    } catch (error) {\n      console.error(error)\n    }\n  }\n\n  ingest (records) {\n    this.forEach(offer => offer.alive = false)\n    const offers = records.map(record => Offer.ingest(record)).filter(x => x)\n    this.splice(0, 0, ...offers)\n    this.clean()\n  }\n\n  clean () {\n    for (let index = this.length - 1; index > -1; index--) {\n      const offer = this[index]\n      if (!offer.alive) {\n        this.splice(index, 1)\n        offer.destroy()\n      }\n    }\n  }\n}\n\nclass Offer extends Projectable {\n  static resolve (record) {\n    return Offer.table[recordToId(record)]\n  }\n\n  static ingest (record) {\n    const offer = Offer.resolve(record)\n    if (offer) offer.update(record)\n    else return new Offer(record)\n  }\n\n  constructor (record) {\n    super()\n\n    this.intern = recordToId(record)\n    Offer.table[this.intern] = this\n\n    const quote = Asset.resolve(\"XLM\")\n    const asset = record.buying.asset_code ? record.buying : record.selling\n    this.balance = Balance.resolve(asset.asset_code, asset.asset_issuer)\n    this.asset = this.balance.asset\n    this.side = record.buying.asset_code ? \"buy\" : \"sell\"\n\n    this.define(\n      \"price\",\n      \"rawPrice\",\n      this.side === \"sell\"\n        ? () => quote.price * this.rawPrice\n        : () => quote.price / this.rawPrice\n    )\n    this.watch(quote, \"price\", () => this.compute(\"price\"))\n\n    this.update(record)\n\n    this.balance.offers.push(this)\n    this.asset.offers.push(this)\n\n    this.listen(\"destroy\", () => {\n      delete Offer.table[this.intern]\n      this.balance.offers.splice(this.balance.offers.indexOf(this), 1)\n      this.asset.offers.splice(this.asset.offers.indexOf(this), 1)\n    })\n  }\n\n  update (record) {\n    Object.assign(this, record)\n    this.alive = true\n\n    this.rawPrice = record.price\n    this.compute(\"price\")\n    this.rawAmount = record.amount\n    if (this.side === \"buy\") {\n      this.amount = nice(this.rawAmount * this.rawPrice, 7)\n    }\n\n    this.date = day(this.last_modified_time)\n    this.outdated = this.date !== day()\n  }\n}\n\nOffer.table = {}\n\n/**\n * Helpers\n */\n\nfunction recordToId (record) {\n  return `${record.id}-${record.last_modified_ledger}`\n}\n\n/**\n * Export\n */\n\nmodule.exports = Offers\n","\"use_strict\"\n/**\n * Various helpers\n */\n\nconst helpers = exports\n\nhelpers.isOverflowing = function (element) {\n  return (\n    element.scrollHeight > element.clientHeight\n    || element.scrollWidth > element.clientWidth\n  )\n}\n","\"use_strict\"\n/**\n * Activity Gui\n */\n\nconst Gui = require(\"@cosmic-plus/domutils/es5/gui\")\nconst nice = require(\"@cosmic-plus/jsutils/es5/nice\")\nconst Tabs = require(\"@cosmic-plus/domutils/es5/tabs\")\nconst { __ } = require(\"@cosmic-plus/i18n\")\nconst { CosmicLink } = require(\"cosmic-lib\")\n\nconst SideFrame = require(\"./side-frame\")\nconst global = require(\"./global\")\n\n/**\n * Class\n */\n\nclass ActivityGui extends Gui {\n  constructor (portfolio) {\n    super(`\n<section>\n  <h2>${__(\"Activity\")}</h2>\n  %selector\n  %view\n</section>\n    `)\n\n    this.portfolio = portfolio\n\n    const tabs = new Tabs()\n    // tabs.project([\"selector\", \"view\"], this)\n    tabs.project(\"view\", this)\n\n    tabs.add(\n      \"offers\",\n      __(\"Open Orders\"),\n      new ActivityGui.Offers(portfolio),\n      \"select\"\n    )\n    // tabs.add(\"orders\", __(\"Orders\"), new ActivityGui.Orders(portfolio))\n    // tabs.add(\"transfers\", __(\"Transfers\"), new ActivityGui.Transfers(portfolio))\n    // tabs.select(__(\"Orders\"))\n  }\n}\n\nActivityGui.Offers = class ActivityOffers extends Gui {\n  constructor (portfolio) {\n    super(`\n<section>\n  <table>\n    <tr>\n      <th>${__(\"Date\")}</th>\n      <th>${__(\"Asset\")}</th>\n      <th>${__(\"Direction\")}</th>\n      <th>${__(\"Amount\")}</th>\n      <th>${__(\"Price\")} (%globalCurrency)</th>\n    </tr>\n    %formatOffer:offers...\n    <tr><td colspan=\"5\" align=\"center\" onclick=%cancelOffers>\n      <h3>${__(\"Cancel All\")}</h3>\n    </td></tr>\n  </table>\n</section>\n\n<p class=\"note\">\n  ${__(\"All orders are passed against Stellar Lumens (XLM).\")}\n  ${__(\n    \"For your comfort, prices are displayed in their %%globalCurrency equivalent.\"\n  )}\n  ${__(\n    \"However, those converted values will change according to XLM price movement.\"\n  )}\n</p>\n    `)\n\n    this.portfolio = portfolio\n    this.offers = portfolio.offers\n    this.globalCurrency = global.currency\n  }\n\n  formatOffer (offer) {\n    return new ActivityGui.Offer(offer)\n  }\n\n  cancelOffers () {\n    if (!this.offers.length) return\n\n    const txParams = {\n      memo: \"Equilibre.io\",\n      network: \"public\",\n      maxTime: \"+5\",\n      source: this.portfolio.accountId\n    }\n\n    const cosmicLink = new CosmicLink(txParams)\n    this.offers.forEach(offer => {\n      cosmicLink.addOperation(\"manageOffer\", { offerId: offer.id, amount: 0 })\n    })\n\n    const sideFrame = new SideFrame(cosmicLink.uri)\n    sideFrame.listen(\"destroy\", () => {\n      this.portfolio.getAccount()\n      this.portfolio.offers.get()\n    })\n  }\n}\n\nActivityGui.Offer = class ActivityOffer extends Gui {\n  constructor (offer) {\n    super(`\n<tr>\n  <td>%formatDate:last_modified_time</td>\n  <td>\n    <img src=%image alt=\"\">\n    <span>%name / %anchor</span>\n  </td>\n  <td>%side</td>\n  <td align=\"right\">%nice:amount</td>\n  <td align=\"right\">%nice:price</td>\n</tr>\n    `)\n\n    this.offer = offer\n    offer.project([\"last_modified_time\", \"amount\", \"price\"], this)\n\n    this.name = offer.asset.code\n    this.side = offer.side === \"buy\" ? __(\"Buy\") : __(\"Sell\")\n    this.anchor = offer.balance.anchor.name\n    offer.asset.link(\"image\", this)\n  }\n\n  nice (number) {\n    return nice(number)\n  }\n\n  formatDate (value) {\n    const date = value ? new Date(value) : new Date()\n    return date.toLocaleDateString()\n  }\n}\n\n// ## Unused code\n//\n// ActivityGui.Orders = class ActivityOrders extends Gui {\n//   constructor (portfolio) {\n//     super(`\n// <table>\n//   <tr>\n//     <th>${__(\"Date\")}</th>\n//     <th>${__(\"Asset\")}</th>\n//     <th>${__(\"Direction\")}</th>\n//     <th>${__(\"Amount\")}</th>\n//     <th>${__(\"Price\")}</th>\n//   </tr>\n//   <tr>\n//     <td colspan=\"6\"><h3><i18n>${__(\"Open Orders\")}</i18n></h3></td>\n//   </tr>\n//   %openOrders...\n//   <tr>\n//     <td colspan=\"6\"><h3><i18n>${__(\"Completed Orders\")}</i18n></h3></td>\n//   </tr>\n//   %completedOrders...\n// </table>\n//     `)\n//     this.portfolio = portfolio\n//   }\n// }\n\n// ActivityGui.Transfers = class ActivityTransfers extends Gui {\n//   constructor (portfolio) {\n//     super(`\n// <table>\n//   <tr>\n//     <th>${__(\"Date\")}</th>\n//     <th>${__(\"Asset\")}</th>\n//     <th>${__(\"With\")}</th>\n//     <th>${__(\"Amount\")}</th>\n//   </tr>\n//   %transfers...\n// </table>\n//     `)\n//     this.portfolio = portfolio\n//   }\n// }\n\n/**\n * Export\n */\n\nmodule.exports = ActivityGui\n","\"use_strict\"\n/**\n * Portfolio Graphical User Interface\n */\nconst Highcharts = require(\"highcharts\")\nconst Highstock = require(\"highcharts/highstock\")\nrequire(\"./highcharts-theme\")\n\nconst Gui = require(\"@cosmic-plus/domutils/es5/gui\")\nconst nice = require(\"@cosmic-plus/jsutils/es5/nice\")\nconst Tabs = require(\"@cosmic-plus/domutils/es5/tabs\")\nconst { __ } = require(\"@cosmic-plus/i18n\")\n\nconst AssetGui = require(\"./asset-gui\")\nconst global = require(\"./global\")\nconst marketData = require(\"./market-data\")\n\n/**\n * Class\n */\n\nclass PortfolioGui extends Gui {\n  constructor (portfolio) {\n    super(`\n<section><h2>${__(\"Portfolio\")}: %total %currency</h2>\n  %summary\n  %chart\n\n  <p class=\"note\" align=\"center\">\n    ${__(\"Anchor prices are from Stellar DEX\")} /\n    ${__(\"Global prices are from %%coingecko when available.\")}\n    </p>\n\n</section>`)\n\n    this.portfolio = portfolio\n\n    portfolio.project(\"total\", this, x => nice(x, 2))\n    this.currency = global.currency\n    this.summary = new PortfolioGui.Summary(this)\n    this.coingecko = new Gui(\n      `<a target=\"_blank\" rel=\"noopener\" href=\"https://coingecko.com\">coingecko</a>`\n    )\n  }\n\n  select (asset) {\n    if (this.chart) this.chart.destroy()\n    if (asset && asset.globalPrice && asset.code !== global.currency) {\n      this.chart = new PortfolioGui.Chart(asset)\n    } else {\n      this.chart = null\n    }\n  }\n}\n\nPortfolioGui.Summary = class PortfolioSummary extends Gui {\n  constructor (parent) {\n    const tabs = new Tabs()\n    super(`%nav <section>%view</section>`, tabs)\n\n    tabs.add(\"table\", __(\"Table\"), new PortfolioGui.Table(parent))\n    tabs.add(\"graph\", __(\"Graph\"), () => new PortfolioGui.Graph(parent))\n    tabs.listen(\"select\", id => localStorage[\"PortfolioSummary.tab\"] = id)\n    tabs.select(localStorage[\"PortfolioSummary.tab\"] || \"table\")\n  }\n}\n\nPortfolioGui.Table = class PortfolioTable extends Gui {\n  constructor (parent) {\n    super(`\n<table>\n  <tr>\n    <th>${__(\"Name\")}</th>\n    <th>${__(\"Anchor\")}</th>\n    <th>${__(\"Amount\")}</th>\n    <th>${__(\"Price\")}</th>\n    <th>${__(\"Value\")}</th>\n  </tr>\n  %assetsGui...\n</table>\n`)\n\n    this.parent = parent\n\n    this.assetsGui = parent.portfolio.assets.mirror(asset => {\n      const assetGui = new AssetGui(asset)\n      assetGui.domNode.onclick = () => this.select(assetGui)\n      return assetGui\n    })\n\n    this.watch(parent.portfolio, \"total\", () => this.sort())\n  }\n\n  sort () {\n    this.assetsGui.sort((a, b) => b.asset.value - a.asset.value)\n  }\n\n  select (assetGui) {\n    if (this.selected) {\n      this.selected.domNode.className = \"\"\n      this.selected.simpleView()\n    }\n\n    if (this.selected === assetGui) {\n      this.parent.select()\n      this.selected = null\n    } else {\n      this.parent.select(assetGui.asset)\n      assetGui.domNode.className = \"selected\"\n      this.selected = assetGui\n      assetGui.detailledView()\n    }\n  }\n}\n\nPortfolioGui.Graph = class PortfolioGraph extends Gui {\n  constructor (parent) {\n    super(`<div -ref=%container align=\"center\"></div>`)\n    this.parent = parent\n\n    this.listen(\"destroy\", () => this.chart && this.chart.destroy())\n    this.watch(parent.portfolio, \"total\", () => {\n      // For some unknow reason the timeout makes the chart draw better.\n      setTimeout(() => this.makePie(), 1)\n    })\n  }\n\n  makePie () {\n    if (this.chart) this.chart.destroy()\n\n    this.chart = Highcharts.chart(this.container, {\n      title: \"\",\n      legend: { enabled: false },\n      chart: { type: \"pie\" },\n      tooltip: {\n        pointFormat: `\n${__(\"Amount\")}: {point.amount} {point.code}<br>\n${__(\"Price\")}: {point.price} ${global.currency}<br>\n<b>${__(\"Value\")}: {point.y} ${global.currency}</b>\n`\n      },\n\n      plotOptions: {\n        pie: {\n          dataLabels: {\n            format: \"{point.amount} {point.code}<br>({point.percentage:.0f}%)\"\n          },\n          point: {\n            events: {\n              select: x => this.parent.select(x.target.options.asset),\n              legendItemClick: () => false\n            }\n          }\n        }\n      },\n\n      series: [\n        {\n          name: __(\"Amount\"),\n          colorByPoint: true,\n          ignoreHiddenPoint: true,\n          data: this.parent.portfolio.assets\n            .filter(asset => asset.value)\n            .map(makeAssetPoint)\n            .sort((a, b) => b.y - a.y)\n        }\n      ]\n    })\n  }\n}\n\nfunction makeAssetPoint (asset) {\n  return {\n    name: asset.name,\n    code: asset.code,\n    asset: asset,\n    y: +nice(asset.value, 2),\n    amount: nice(asset.amount),\n    price: nice(asset.price),\n    percentage: asset.percentage\n  }\n}\n\nPortfolioGui.Chart = class PortfolioChart extends Gui {\n  constructor (asset) {\n    super(`\n      <section><h3>${asset.code} ${__(\"to\")} ${global.currency}</h3>\n        <div -ref=%container><p>${__(\"Loading...\")}</p></div>\n      </section>\n    `)\n\n    this.asset = asset\n    this.listen(\"destroy\", () => this.chart && this.chart.destroy())\n    marketData.assetHistory(asset).then(data => this.makeChart(data))\n  }\n\n  makeChart (data) {\n    this.chart = Highstock.stockChart(this.container, {\n      rangeSelector: { selected: 2 },\n      chart: {\n        backgroundColor: \"#fbfbfd\"\n      },\n      yAxis: [\n        { labels: { align: \"left\" }, height: \"80%\", resize: { enabled: true } },\n        { labels: { align: \"left\" }, top: \"80%\", height: \"20%\", offset: 0 }\n      ],\n      series: [\n        {\n          type: \"spline\",\n          name: \"Price\",\n          data: data.map(x => [x.time, +nice(x.price)])\n        },\n        {\n          type: \"column\",\n          name: \"Volume\",\n          data: data.map(x => [x.time, x.volume]),\n          yAxis: 1\n        }\n      ],\n      credits: { enabled: false }\n    })\n  }\n}\n\n/**\n * Export\n */\n\nmodule.exports = PortfolioGui\n","\"use_strict\"\n/**\n * Theme for Highchart\n */\n\nconst Highcharts = require(\"highcharts\")\n\nHighcharts.theme = {\n  chart: { backgroundColor: \"#fbfbfd\" },\n  tooltip: { style: { fontSize: \"14px\" } },\n  credits: { enabled: false },\n\n  plotOptions: {\n    pie: {\n      allowPointSelect: true,\n      animation: false,\n      cursor: \"pointer\",\n      dataLabels: { style: { fontSize: \"14px\" } }\n    }\n  },\n\n  responsive: {\n    rules: [\n      {\n        condition: {\n          maxWidth: 500\n        },\n        chartOptions: {\n          legend: { enabled: true },\n          plotOptions: {\n            pie: {\n              showInLegend: true,\n              dataLabels: {\n                format: \"{point.percentage:.0f}%\",\n                distance: -20\n              }\n            }\n          }\n        }\n      }\n    ]\n  },\n\n  colors: [\n    \"rgba(231,  76,  60, 0.8)\",\n    \"rgba(230, 126,  34, 0.8)\",\n    \"rgba(242, 202,  39, 0.8)\",\n    \"rgba(46,  204, 112, 0.8)\",\n    \"rgba(52,  152, 219, 0.8)\",\n    \"rgba(155,  89, 182, 0.8)\",\n\n    \"rgba(231,  76,  60, 0.6)\",\n    \"rgba(230, 126,  34, 0.6)\",\n    \"rgba(242, 202,  39, 0.6)\",\n    \"rgba(46,  204, 112, 0.6)\",\n    \"rgba(52,  152, 219, 0.6)\",\n    \"rgba(155,  89, 182, 0.6)\",\n\n    \"rgba(231,  76,  60, 0.4)\",\n    \"rgba(230, 126,  34, 0.4)\",\n    \"rgba(242, 202,  39, 0.4)\",\n    \"rgba(46,  204, 112, 0.4)\",\n    \"rgba(52,  152, 219, 0.4)\",\n    \"rgba(155,  89, 182, 0.4)\"\n  ]\n}\n\nHighcharts.setOptions(Highcharts.theme)\n","\"use_strict\"\n/**\n * Asset GUI\n */\nconst Gui = require(\"@cosmic-plus/domutils/es5/gui\")\nconst html = require(\"@cosmic-plus/domutils/es5/html\")\nconst nice = require(\"@cosmic-plus/jsutils/es5/nice\")\nconst msg = require(\"@cosmic-plus/i18n\").__\n\n/**\n * Class\n */\n\nclass AssetGui extends Gui {\n  constructor (asset) {\n    super(`\n<tr %style>\n  <td align=\"left\">\n    <img src=%image alt=\"\">\n    <span>%name</span>\n  </td>\n  <td align=\"left\">\n    <div hidden=%simple>%anchors...</div>\n    <div %class>%anchorTotal</div>\n  </td>\n  <td align=\"right\">\n    <div hidden=%simple>%amounts...</div>\n    <div %class>%amountTotal</div>\n  </td>\n  <td align=\"right\">\n    <div hidden=%simple>%prices...</div>\n    <div %class title=%priceDetails>%priceTotal</div>\n  </td>\n  <td align=\"right\">\n    <div hidden=%simple>%values...</div>\n    <div %class>%valueTotal</div>\n  </td>\n</tr>\n    `)\n\n    this.asset = asset\n\n    this.name = asset.code\n    this.anchors = asset.balances.mirror(x => cell(x.anchor, \"name\"))\n    this.amounts = asset.balances.mirror(x => cell(x, \"amount\", nice))\n    this.prices = asset.balances.mirror(x => priceCell(x, \"price\", nice))\n    this.values = asset.balances.mirror(x => cell(x, \"value\", x => nice(x, 2)))\n    asset.link(\"image\", this)\n    asset.link(\"amount\", this, \"amountTotal\", nice)\n    asset.link(\"price\", this, \"priceTotal\", nice)\n    asset.link(\"value\", this, \"valueTotal\", x => nice(x, 2))\n    asset.anchors.feed(this, \"anchorHeader\", anchorName)\n\n    const orderbook = this.asset.orderbook\n    this.define(\"priceDetails\", \"orderbook\", () => priceDetails(orderbook))\n    this.watch(orderbook, [\"bestAsk\", \"bestBid\", \"spread%\"], () => {\n      this.compute(\"priceDetails\")\n    })\n\n    this.simpleView()\n  }\n\n  simpleView () {\n    this.simple = true\n    this.class = \"\"\n    this.anchorTotal = this.anchorHeader\n  }\n\n  detailledView () {\n    this.simple = false\n    this.class = \"footer\"\n    this.anchorTotal = \"Total\"\n  }\n}\n\n/**\n * Export\n */\n\nmodule.exports = AssetGui\n\n/**\n * Helpers\n */\n\nfunction anchorName (anchors) {\n  if (anchors.length === 1) return anchors[0].name\n  else return `${msg(\"Multiple\")} (${anchors.length})`\n}\n\nfunction cell (object, key, func) {\n  const node = html.create(\"div\", null, object[key])\n  object.link(key, node, \"textContent\", func)\n  return node\n}\n\nfunction priceCell (object, key, func) {\n  const node = cell(object, \"price\", func)\n  object.trap(\"orderbook\", () => {\n    if (object.orderbook) {\n      object.orderbook.trap([\"bestAsk\", \"bestBid\", \"spread%\"], () => {\n        node.title = priceDetails(object.orderbook)\n      })\n    }\n  })\n  return node\n}\n\nfunction priceDetails (orderbook) {\n  if (orderbook.base.code === \"XLM\") return \"\"\n  return `\nBuy: ${nice(orderbook.bestBid)} \\\n- Sell: ${nice(orderbook.bestAsk)} \\\n- Spread: ${nice(orderbook[\"spread%\"], 2)}%\n  `\n}\n","\"use_strict\"\n/**\n * Settings Graphical User Interface\n */\nconst Gui = require(\"@cosmic-plus/domutils/es5/gui\")\nconst { __ } = require(\"@cosmic-plus/i18n\")\n\nconst global = require(\"./global\")\n\n/**\n * Class\n */\n\nclass SettingsGui extends Gui {\n  constructor () {\n    super(`\n      <section><h2>${__(\"Settings\")}</h2>\n        <section><h3>${__(\"General Settings\")}</h3>\n          <form>\n            <label><span>${__(\"Language\")}:</span>\n              <select value=%language>\n                <option value=\"us\">English</option>\n                <option value=\"fr\">Franais</option>\n              </select>\n            </label>\n            <label><span>${__(\"Currency\")}:</span>\n              <select value=%currency>\n                <option value=\"CNY\">CNY</option>\n                <option value=\"EUR\">EUR</option>\n                <option value=\"USD\">USD</option>\n              </select>\n            </label>\n          </form>\n        </section>\n      </section>\n    `)\n\n    // Two-way binding\n    global.project([\"currency\", \"language\"], this)\n    this.project([\"currency\", \"language\"], global)\n\n    // Refresh interface\n    this.listen(\"change:currency\", () => location.reload())\n    this.listen(\"change:language\", () => location.reload())\n  }\n}\n\n/**\n * Export\n */\n\nmodule.exports = SettingsGui\n","\"use_strict\"\n/**\n * Target Graphical User Interface\n */\nconst Gui = require(\"@cosmic-plus/domutils/es5/gui\")\nconst i18n = require(\"@cosmic-plus/i18n\")\nconst html = require(\"@cosmic-plus/domutils/es5/html\")\nconst { __ } = i18n\n\nconst SideFrame = require(\"./side-frame\")\nconst Order = require(\"./order\")\nconst Target = require(\"./target\")\nconst TargetGui = require(\"./target-gui\")\n\n/**\n * Class\n */\n\nclass RebalanceGui extends Gui {\n  constructor (portfolio) {\n    super(`\n<section class=\"RebalanceGui\">\n  <h2>${__(\"Rebalance\")}</h2>\n\n  %table\n\n  %setup\n\n  <section hidden=%hideControls>\n    <form onsubmit=\"return false\" hidden=%hideRebalance>\n      <button onclick=%rebalance disabled=%invalid>${__(\"Rebalance\")}</button>\n    </form>\n\n    <form onsubmit=\"return false\" hidden=%hideApply>\n      <button onclick=%apply disabled=%invalid>${__(\"Save\")}</button>\n      <button onclick=%cancel>${__(\"Cancel\")}</button>\n    </form>\n\n    %toParagraph:error\n  </section>\n\n</section>\n    `)\n\n    this.portfolio = portfolio\n\n    // Load & bind template from localStorage.\n    const targetKey = `target:${portfolio.account.id}`\n    const template = localStorage[targetKey]\n    this.target = Target.forPortfolio(portfolio, template)\n    this.target.link(\"json\", localStorage, targetKey, null, { init: false })\n\n    // Targets table.\n    this.table = new RebalanceGui.Table(this.target)\n    this.table.project(\"selected\", this)\n    this.project(\"selected\", this.table)\n\n    // Target Setup.\n    this.trap(\"selected\", () => {\n      if (this.setup) this.setup.destroy()\n      if (this.selected) {\n        this.setup = new TargetGui.Setup(this.selected)\n        this.setup.listen(\"close\", () => this.selected = null)\n      } else {\n        this.setup = null\n      }\n    })\n\n    // Control Panel.\n    this.target.project([\"error\", \"modified\"], this)\n\n    this.define(\"hideControls\", [\"hideRebalance\", \"hideApply\"], () => {\n      return this.hideRebalance && this.hideApply\n    })\n    this.define(\"hideRebalance\", [\"selected\", \"modified\"], () => {\n      return this.selected || this.modified\n    })\n    this.define(\"hideApply\", [\"selected\", \"modified\"], () => {\n      return this.selected || !this.modified\n    })\n    this.define(\"invalid\", [\"error\"], () => !!this.error)\n  }\n\n  toParagraph (error) {\n    if (error) return html.create(\"p\", \".error\", error)\n  }\n\n  cancel () {\n    location.reload()\n  }\n\n  apply () {\n    this.target.json = this.target.toJson()\n    this.target.modified = false\n  }\n\n  rebalance () {\n    // TODO: Move this logic to Order & Offers models.\n    const operations = listOperations(this.target)\n    const outdated = this.portfolio.offers.filter(offer => offer.outdated)\n    const remaining = outdated.filter(offer => {\n      return !operations.find(op => op.offer.id === offer.id)\n    })\n    operations.forEach(op => {\n      if (!op.offer.id && remaining.length) op.offer.id = remaining.pop().id\n    })\n\n    if (!operations.length) return false\n    const cosmicLink = Order.operationsToCosmicLink(operations)\n    remaining.forEach(offer => {\n      cosmicLink.addOperation(\"manageOffer\", { amount: 0, offerId: offer.id })\n    })\n    if (cosmicLink) {\n      const sideFrame = new SideFrame(cosmicLink.uri)\n      sideFrame.listen(\"destroy\", () => {\n        this.portfolio.getAccount()\n        this.portfolio.offers.get()\n      })\n    }\n  }\n}\n\nfunction listOperations (target) {\n  let operations = []\n  target.childs.forEach(child => {\n    if (child.order) operations = operations.concat(child.order.operations)\n  })\n  return operations\n}\n\nRebalanceGui.Table = class RebalanceTable extends Gui {\n  constructor (target) {\n    super(`\n<section class=\"RebalanceTable\">\n  <table>\n    <tr>\n      <th>${__(\"Name\")}</th>\n      <th>${__(\"Goal\")}</th>\n      <th>${__(\"Divergence\")}</th>\n      <th>${__(\"Operation\")}</th>\n    </tr>\n\n    %targets...\n\n    <tr hidden=true>\n      <td align=\"center\" colspan=\"4\"><h3>${__(\"Add Asset\")}</h3></td>\n    </tr>\n  </table>\n</section>\n    `)\n\n    this.targets = target.childs.mirror(child => this.toTargetGui(child))\n    this.selected = undefined\n\n    target.listen(\"update\", () => this.sortTargets())\n    this.sortTargets()\n  }\n\n  toTargetGui (target) {\n    const targetGui = new TargetGui(target)\n    targetGui.domNode.onclick = () => this.selected = target\n    return targetGui\n  }\n\n  sortTargets () {\n    this.targets.sort((a, b) => {\n      a = a.target\n      b = b.target\n      if (b.mode === \"ignore\" && a.mode !== \"ignore\") return -1\n      else if (a.mode === \"ignore\" && b.mode !== \"ignore\") return 1\n      return b.value - a.value || a.asset.code.localeCompare(b.asset.code)\n    })\n  }\n}\n\n/**\n * Export\n */\n\nmodule.exports = RebalanceGui\n","\"use_strict\"\n/**\n * Target class.\n *\n * A (portfolio) Target object represents a statically or dynamically allocated\n * target slice of the user portfolio. It is a theoric goal that the rebalancing\n * process aims to reach as much as possible.\n *\n * A Target may be composed by several Target subentries, in such a way that the\n * complete portfolio balancing target ends up being a tree made of Targets.\n */\nconst Mirrorable = require(\"@cosmic-plus/jsutils/es5/mirrorable\")\nconst nice = require(\"@cosmic-plus/jsutils/es5/nice\")\nconst Projectable = require(\"@cosmic-plus/jsutils/es5/projectable\")\n\nconst Asset = require(\"./asset\")\nconst Order = require(\"./order\")\nconst strategy = require(\"./strategy\")\n\n/**\n * Definition\n */\n\nclass Target extends Projectable {\n  constructor (asset) {\n    super()\n\n    if (asset) {\n      this.asset = asset\n      this.mode = \"ignore\"\n      this.order = Order.rebalance(this)\n\n      asset.target = this\n      this.watch(asset, \"value\", () => this.compute(\"valueDiff\"))\n    } else {\n      this.childs = new Mirrorable()\n      this.childs.listen(\"add\", child => child.parent = this)\n      this.childs.listen(\"change\", () => this.computeAll())\n    }\n\n    // Normalize & compute\n    this.trap(\"size\", () => {\n      if (this.size) {\n        this.size = Math.max(0, this.size)\n        if (this.mode === \"percentage\") this.size = Math.min(100, this.size)\n      }\n      this.computeAll()\n    })\n  }\n\n  get root () {\n    if (this.parent) return this.parent.root\n    else return this\n  }\n}\n\nTarget.define(\"name\", [\"group\", \"asset\"], function () {\n  return this.group || this.asset.type === \"unknow\"\n    ? this.asset.id\n    : this.asset.code\n})\nTarget.define(\"valueDiff\", [\"value\", \"asset\"], function () {\n  return this.asset && this.asset.value - this.value\n})\nTarget.define(\"valueDiffP\", \"valueDiff\", function () {\n  return this.value ? this.valueDiff / this.value : null\n})\nTarget.define(\"amountDiff\", [\"amount\"], function () {\n  return +nice(this.amount - this.asset.amount, 7)\n})\nTarget.define(\"amountDelta\", [\"amountDiff\"], function () {\n  return Math.abs(this.amountDiff)\n})\n// Gets computed by \"strategy.js\".\nTarget.define(\"share\", null, function () {\n  return this.value / this.root.portfolio.total\n})\nTarget.define(\"shareDiff\", [\"share\"], function () {\n  return this.asset.share - this.share\n})\n\n/**\n * Actions\n */\n\nTarget.prototype.computeAll = function () {\n  if (this.parent) {\n    this.root.computeAll()\n  } else if (this.portfolio && this.portfolio.total) {\n    try {\n      this.error = null\n      this.value = this.portfolio.total\n      this.modified = this.hasChanged()\n      strategy.apply(this)\n    } catch (error) {\n      this.error = error.message\n      console.error(error)\n    }\n    this.trigger(\"update\")\n  }\n}\n\n/**\n * Utilities\n */\n\n/**\n * Return deterministically sorted **target** childs without mutating source\n * object.\n */\nTarget.sortChilds = function (target) {\n  const childs = target.childs.slice()\n  return childs.sort((a, b) => a.name.localeCompare(b.name))\n}\n\n/**\n * Source: Portfolio\n */\n\nTarget.forPortfolio = function (portfolio, json) {\n  const target = json ? Target.fromJson(json) : new Target()\n  target.portfolio = portfolio\n\n  portfolio.target = target\n  target.watch(portfolio, \"total\", () => target.computeAll())\n\n  // Add/Remove assets after trustline change.\n  portfolio.assets.forEach(asset => {\n    if (\n      !target.childs.find(child => asset === child.asset)\n      && asset.isSupported\n    )\n      target.childs.push(new Target(asset))\n  })\n  target.childs.forEach((child, index) => {\n    if (\n      !portfolio.assets.find(asset => asset === child.asset)\n      || !child.asset.isSupported\n    )\n      target.childs.splice(index, 1)\n  })\n  portfolio.assets.listen(\"add\", asset => {\n    if (asset.isValid) target.childs.push(new Target(asset))\n  })\n  portfolio.assets.listen(\"remove\", asset => {\n    const index = target.childs.findIndex(child => child.asset === asset)\n    target.childs.splice(index, 1)\n  })\n\n  return target\n}\n\n/**\n * Format: JSON\n */\n\nTarget.fromJson = function (json) {\n  const object = JSON.parse(json)\n  const target = Target.fromObject(object)\n  target.json = json\n  return target\n}\n\nTarget.prototype.toJson = function (beautifyFlag) {\n  const object = this.toObject()\n  return JSON.stringify(object, null, beautifyFlag && 2)\n}\n\nTarget.prototype.hasChanged = function () {\n  return this.toJson() !== (this.json || \"{\\\"childs\\\":[]}\")\n}\n\n/**\n * Format: Object\n */\n\nTarget.fromObject = function (object) {\n  if (typeof object === \"string\") object = { asset: object }\n\n  // Create Target instance.\n  const asset = object.asset && Asset.resolve(object.asset)\n  const target = new Target(asset)\n  target.size = object.size\n  target.mode = object.mode\n\n  // Conversion from versions <= 0.5  REMOVAL: 2020-05 (one year).\n  if (target.mode === \"equal\") target.mode = \"weight\"\n  if (target.mode === \"skip\") target.mode = \"ignore\"\n\n  // Set defaults.\n  if (!target.mode) target.mode = \"weight\"\n  if (target.size == null && target.mode === \"weight\") target.size = 1\n\n  // Parse childs.\n  if (object.childs) {\n    target.group = object.group\n    const childs = object.childs.map(entry => Target.fromObject(entry))\n\n    // Conversion from versions <= 0.5  REMOVAL: 2020-05 (one year).\n    //\n    // When there was no \"equal\" target, percentage targets whose sum is under\n    // 100 would act like \"weight\".\n    const percentChilds = childs.filter(child => child.mode === \"percentage\")\n    if (\n      percentChilds.length\n      && !childs.find(child => child.mode === \"weight\")\n      && 100 !== percentChilds.reduce((child, sum) => child.size + sum, 0)\n    ) {\n      percentChilds.forEach(child => child.mode = \"weight\")\n    }\n\n    target.childs.push(...childs)\n  }\n\n  return target\n}\n\nTarget.prototype.toObject = function () {\n  if (this.mode === \"ignore\") return\n  let object = { mode: this.mode, size: this.size }\n  if (object.mode === \"weight\") {\n    delete object.mode\n    if (object.size === 1) delete object.size\n  }\n\n  if (this.asset) {\n    object.asset = this.name\n    if (Object.keys(object).length === 1) object = object.asset\n  } else if (this.childs) {\n    object.group = this.group\n    const childs = Target.sortChilds(this)\n    object.childs = childs.map(target => target.toObject()).filter(x => x)\n  }\n\n  return object\n}\n\n/**\n * Export\n */\n\nmodule.exports = Target\n","\"use_strict\"\n/**\n * Rebalancing strategies\n */\nconst strategy = exports\n\nconst nice = require(\"@cosmic-plus/jsutils/es5/nice\")\nconst { __ } = require(\"@cosmic-plus/i18n\")\n\nconst global = require(\"./global\")\n\n/**\n * Applicator\n */\n\nstrategy.apply = function (target) {\n  const delayed = []\n  let sum = 0,\n    weights = 0\n\n  target.childs.forEach(child => {\n    const mode = child.mode\n    if (mode === \"weight\") {\n      delayed.push(child)\n      weights += child.size\n    } else {\n      strategy[mode](child)\n      sum += child.value\n    }\n  })\n\n  const remains = Math.max(0, target.value - sum)\n  delayed.forEach(child => strategy.weight(child, remains, weights))\n\n  checkAllocationLimits(sum, target.value, delayed.length)\n}\n\nfunction checkAllocationLimits (allocated, available, checkUnderFlag) {\n  if (allocated > available) {\n    const over = +nice(allocated - available, 2)\n    const overP = +nice(100 * over / available, 2)\n    let msg = __(\"Rebalance setup is over portfolio value by\")\n    msg += ` ${over} ${global.currency} (${overP}%) `\n    throw new Error(msg)\n  } else if (!checkUnderFlag && allocated < available) {\n    const under = +nice(available - allocated, 2)\n    const underP = +nice(100 * under / available, 2)\n    let msg = __(\"Rebalance setup is under portfolio value by\")\n    msg += ` ${under} ${global.currency} (${underP}%) `\n    throw new Error(msg)\n  }\n}\n\n/**\n * Strategies\n */\n\nstrategy.amount = function (target) {\n  target.amount = target.size\n  target.value = target.amount * target.asset.price\n  target.compute(\"share\")\n}\n\nstrategy.ignore = function (target) {\n  target.value = target.asset.value\n  target.amount = target.asset.amount\n  target.compute(\"share\")\n}\n\nstrategy.percentage = function (target) {\n  strategy.weight(target, target.parent.value, 100)\n}\n\nstrategy.weight = function (target, remains, weights) {\n  if (!weights) {\n    target.value = target.amount = 0\n  } else {\n    target.value = target.size * remains / weights\n    target.amount = +nice(target.value / target.asset.price, 7)\n  }\n  target.compute(\"share\")\n}\n","\"use_strict\"\n/**\n * Target Graphical User Interface\n */\nconst Gui = require(\"@cosmic-plus/domutils/es5/gui\")\nconst i18n = require(\"@cosmic-plus/i18n\")\nconst html = require(\"@cosmic-plus/domutils/es5/html\")\nconst nice = require(\"@cosmic-plus/jsutils/es5/nice\")\nconst { __ } = i18n\n\n/**\n * Class\n */\n\nclass TargetGui extends Gui {\n  constructor (target) {\n    super(`\n<tr class=\"TargetGui\">\n  <td align=\"left\">\n    <img src=%image alt=\"\">\n    <span>%name</span>\n  </td>\n  <td align=\"right\">%command</td>\n  <td align=\"right\">%toPercent:shareDiff</td>\n  <td align=\"right\">%toDiv:description...</td>\n</tr>\n    `)\n\n    this.target = target\n    this.name = target.name || target.asset && target.asset.code\n\n    this.define(\"command\", null, () => this.toCommand(target))\n    this.watch(target, [\"size\", \"mode\", \"share\"], () => this.compute(\"command\"))\n\n    target.asset.project(\"image\", this)\n    target.project(\"shareDiff\", this)\n\n    if (target.order) target.order.project(\"description\", this)\n  }\n\n  toCommand (target) {\n    switch (target.mode) {\n    case \"ignore\":\n      return __(\"Ignore\")\n    case \"amount\":\n      return `${target.amount} ${target.asset.code}`\n    case \"weight\":\n      return `${target.size}  ${this.toPercent(target.share)}`\n    case \"percentage\":\n      return this.toPercent(target.share)\n    }\n  }\n\n  toPercent (x) {\n    return !x ? \"-\" : nice(x * 100, 2) + \"%\"\n  }\n\n  toDiv (obj) {\n    return html.create(\"div\", null, obj)\n  }\n}\n\nTargetGui.Setup = class TargetSetup extends Gui {\n  constructor (target) {\n    super(`\n<section>\n  <form onsubmit=\"return false\">\n\n    <h3>%name</h3>\n    <hr>\n\n    <label><span>${__(\"Size\")}:</span>\n\n      <input class=\"half\" type=\"number\" step=\"any\" min=\"0\" %max\n        value=%size placeholder=%share onchange=%maybeSwitchMode>\n\n      <select class=\"half\" onchange=%setMode value=%mode>\n        <option value=\"weight\">${__(\"Weight\")}</option>\n        <option value=\"percentage\">${__(\"Percentage\")}</option>\n        <option value=\"amount\">${__(\"Amount\")}</option>\n        <option value=\"ignore\" hidden=%targetIsXlm>${__(\"Ignore\")}</option>\n      </select>\n\n    </label>\n\n    <hr>\n    <input type=\"submit\" onclick=%close value=\"${__(\"Close\")}\">\n\n  </form>\n</section>\n    `)\n\n    this.target = target\n    this.name = target.asset.name\n    this.targetIsXlm = target.asset.id === \"stellar\"\n\n    target.project(\"share\", this, x => nice(100 * x, 2))\n\n    target.project(\"size\", this)\n    this.project(\"size\", target, x => x != null ? Number(x) : null)\n\n    target.project(\"mode\", this)\n    this.project(\"mode\", target)\n  }\n\n  maybeSwitchMode () {\n    if (this.size === 0) {\n      this.mode = \"amount\"\n    } else if (this.size === \"\") {\n      this.mode = \"ignore\"\n    } else if (this.mode === \"ignore\") {\n      this.mode = \"percentage\"\n      this.target.computeAll()\n    }\n  }\n\n  setMode () {\n    // TODO: Move this logic to Target model.\n    switch (this.mode) {\n    case \"weight\":\n      this.size = 1\n      this.max = null\n      break\n    case \"percentage\":\n      this.size = +nice(100 * this.target.asset.share, 2)\n      this.max = 100\n      break\n    case \"amount\":\n      this.size = this.target.asset.amount\n      this.max = null\n      break\n    case \"ignore\":\n      this.size = null\n      break\n    }\n  }\n\n  close () {\n    this.maybeSwitchMode()\n    this.trigger(\"close\")\n    this.destroy()\n  }\n}\n\n/**\n * Export\n */\n\nmodule.exports = TargetGui\n","module.exports = \"<section><h2>License</h2>\\n  <section><h3>MIT License</h3>\\n\\n    <p>Copyright (c) 2019 Antoine Bodin &lt;<a\\n    href=\\\"mailto:mister.ticot@cosmic.plus\\\">mister.ticot@cosmic.plus</a>&gt;</p>\\n\\n    <p>Permission is hereby granted, free of charge, to any person obtaining a\\n    copy of this software and associated documentation files (the \\\"Software\\\"),\\n    to deal in the Software without restriction, including without limitation\\n    the rights to use, copy, modify, merge, publish, distribute, sublicense,\\n    and/or sell copies of the Software, and to permit persons to whom the\\n    Software is furnished to do so, subject to the following conditions:</p>\\n\\n    <p>The above copyright notice and this permission notice shall be included\\n    in all copies or substantial portions of the Software.</p>\\n\\n    <p>THE SOFTWARE IS PROVIDED \\\"AS IS\\\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\\n    OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\\n    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\\n    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\\n    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\\n    FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS\\n    IN THE SOFTWARE.</p>\\n  </section>\\n</section>\\n\""],"sourceRoot":""}
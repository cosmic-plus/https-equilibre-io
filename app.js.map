{"version":3,"sources":["webpack:///./src/app.js","webpack:///./src/helpers/misc.js","webpack:///./src/logic/asset.js","webpack:///./src/logic/balance.js","webpack:///./src/logic/anchor.js","webpack:///./src/widgets/helpers/highstock-theme.js","webpack:///./src/logic/history.js","webpack:///./src/logic/orderbook.js","webpack:///./src/helpers/click-wall.js","webpack:///./src/helpers/form.js","webpack:///./src/helpers/html-extra.js","webpack:///./src/helpers/dialog.js","webpack:///./src/logic/portfolio.js","webpack:///./src/logic/market-data.js","webpack:///./src/logic/offers.js","webpack:///./src/logic/portfolio-historic-value.js","webpack:///./src/logic/portfolio-historic-balances.js","webpack:///./src/helpers/bind-dom-key.js","webpack:///./src/helpers/handle-extra-attributes.js","webpack:///./src/activity-gui.js","webpack:///./src/widgets/active-offers-table.js","webpack:///./src/portfolio-gui.js","webpack:///./src/widgets/asset-price-chart.js","webpack:///./src/widgets/portfolio-pie-chart.js","webpack:///./src/widgets/portfolio-historic-value-chart.js","webpack:///./src/widgets/portfolio-table.js","webpack:///./src/settings-gui.js","webpack:///./src/rebalance-gui.js","webpack:///./src/helpers/modal.js","webpack:///./src/logic/target.js","webpack:///./src/logic/order.js","webpack:///./src/logic/strategy.js","webpack:///./src/widgets/target-setup.js","webpack:///./src/widgets/target-setup-anchors.js","webpack:///./src/widgets/target-setup-size.js","webpack:///./src/widgets/targets-controls.js","webpack:///./src/widgets/targets-table.js","webpack:///./src/widgets/asset-selector.js","webpack:///./bundled/welcome.html","webpack:///./bundled/disclaimer.html","webpack:///./src/footer.js","webpack:///./src/helpers/donate.js","webpack:///./src/helpers/icon.js"],"names":["dom","require","Gui","html","Tabs","params","__","global","Portfolio","ClickWall","Form","ActivityGui","PortfolioGui","SettingsGui","RebalanceGui","license","welcome","disclaimer","ledger","trezor","disconnectHardwareWallets","disconnect","async","login","address","loginForm","error","info","$set","clickWall","enable","portfolio","resolve","setTimeout","listen","selected","location","hash","tabs","remove","add","replace","href","content","reflow","select","initGui","destroy","MYPUBKEY","displayDemo","localStorage","demoConfig","Asset","knownAssets","register","fiat","type","isTether","foreign","native","currency","nav","header","selector","view","main","loginTab","demoLink","onclick","show","onsubmit","loginWithLedger","then","default","connect","publicKey","loginWithTrezor","getTrezorModule","page","window","scrollTo","misc","exports","positive","number","Math","max","negative","min","fixed7","Number","toFixed","clamp","value","absoluteMin","value1","value2","abs","arrayContains","array","indexOf","arrayRemove","item","index","length","splice","arrayOnlyInFirst","array1","array2","filter","arraySum","key","reduce","sum","obj","x","arrayScale","targetSum","map","Mirrorable","Projectable","marketData","Orderbook","module","id","table","constructor","super","Object","assign","this","image","code","fiats","push","toLowerCase","useGlobalPrice","cryptos","name","anchors","balances","offers","mirror","balance","watch","compute","orderbook","forAsset","define","globalPrice","price","maybeAddBalance","streamPrice","maybeRemoveBalance","crypto","small","historicPrice","assetHistory","trap","amount","amountMin","rawLiabilities","entry","buying","selling","assets","defaults","getAllInfo","values","forEach","asset","getInfo","refreshPrices","refreshCryptoPrices","refreshFiatPrices","prices","setInterval","console","log","Anchor","Balance","issuer","makeId","record","recordToParams","update","hasTrustline","anchor","known","project","forBalance","addChild","target","opening","pubkey","action","targetAmount","balanceTargetDeviation","targetMin","targetMax","targetMinDiff","targetMaxDiff","Error","fromRecord","create","asset_type","asset_code","asset_issuer","buying_liabilities","selling_liabilities","aliases","helpers","alias","all","shorter","emit","addAsset","prototype","tetherCode","assetCode","Array","isArray","Highstock","theme","rangeSelector","inputBoxBorderColor","buttonTheme","fill","states","hover","style","color","chart","backgroundColor","fontFamily","xAxis","lineColor","tickColor","yAxis","navigator","maskFill","outlineColor","gridLineColor","series","tooltip","fontSize","scrollbar","enabled","credits","plotOptions","column","dataGrouping","pie","allowPointSelect","animation","cursor","dataLabels","spline","setOptions","pieColors","pieResponsive","rules","condition","maxWidth","chartOptions","legend","showInLegend","format","distance","History","setCache","history","json","JSON","stringify","getCache","parse","cut","diff","latest","join","oldData","newData","start","time","findIndex","day","slice","concat","oneDay","today","roundTime","Date","date","setUTCHours","missingDays","numberToDays","cosmicLib","StellarSdk","timeout","quote","streamOffers","base","offersCallBuilder","updateOffersPrices","childs","baseAsset","quoteAsset","server","getOffers","limit","call","ingest","areOffersEquals","bids","normalizeOffers","asks","set","mergeOffers","side","merged","child","sortOffers","a","b","volume","baseVolume","quoteVolume","sort","row","mergedRow","quoteAmount","undefined","basePrice","bestBid","bestAsk","midpoint","marketPrice","spread","isFetched","and","findOffer","childsNum","last","offer","keys","findAsk","findBid","depth","domNode","className","click","hidden","document","body","insertBefore","firstChild","opacity","delay","isEnabled","htmlOverflow","documentElement","overflow","bodyOverflow","setOpacity","hide","disable","transition","background","position","zIndex","top","width","height","hiddenKey","setHiddenProperty","bindDomKey","handleExtraAttributes","tagName","element","addEventListener","getAttribute","event","preventDefault","trigger","bindInputs","status","append","submit","reset","report","$status","rewrite","spinner","message","binder","$node","object","walk","attributes","disabled","label","button","control","tag","required","textarea","placeholder","unshift","selectedIndex","input","datetime","shift","func","childNodes","parent","children","i","Modal","Dialog","title","actions","hasNoTitle","hasNoContent","toButton","bind","alert","dialog","modal","close","open","Promise","confirm","promise","finally","el","querySelector","focus","axios","Offers","portfolioHistoricValue","horizon","get","checkNetwork","destination","memo","isAccountEmpty","account_id","config","source","streamAccount","accountId","accountCallBuilder","isSupported","new","accounts","getAccount","account","accountMinimumBalance","forPortfolio","stream","maybeAddAsset","maybeRemoveAsset","entries","data_attr","signers","availableAssets","allAssets","getHistory","total","nice","coingeckoCall","exchangeratesCall","symbols","response","data","start_at","rates","EUR","cache","missing","getPriceHistory","list","symbol","toUpperCase","apiId","stellarNative","tickers","coin_id","localization","market_data","community_data","developer_data","sparkline","ids","vs_currencies","assetData","vs_currency","days","total_volumes","twoEntriesBefore","end_at","toISOString","setDate","getDate","loopcall","forAccount","callBuilder","records","alive","Offer","clean","listOutdated","outdated","recordToId","intern","rawPrice","rawAmount","last_modified_time","last_modified_ledger","portfolioHistoricBalances","hasBeenHeld","markHeldAssets","historicPrices","promises","getHistoricPrice","getHistoricPrices","shrinkHistoricPrices","filtered","marginals","share","others","computeDayValues","updateBalance","loopUntil","now","breaker","effects","order","effectsLoopcall","recordDate","created_at","STRONGHOLD_SHUTDOWN","applyStrongholdFix","handler","handle","ingestRecord","getPortfolioHistory","updateData","assetForBalance","recordToBalance","prefix","codeKey","issuerKey","trade","bought_amount","sold_amount","account_credited","account_debited","trustline_removed","trustline_created","account_created","XLM","STRONGHOLD_KEY1","STRONGHOLD_KEY2","substr","split","objKey","$input","nodeKey","importKeyOn","eventName","setCustomValidity","link","init","SELECT","$select","interactive","TEXTAREA","$textarea","INPUT","radio","arguments","checkbox","$radio","setter","checked","checkBox","$checkbox","setAliases","$label","for","$span","handleLabel","validate","hasProperty","reportValidity","validateNodeValue","handleValidate","ActiveOffersTable","globalCurrency","CosmicLink","toOfferRow","OfferRow","cancelOffers","txParams","network","maxTime","cosmicLink","addOperation","offerId","AssetPriceChart","PortfolioPieChart","PortfolioHistoricValueChart","PortfolioTable","coingecko","pieChart","maybeDrawPriceChart","historyChart","overview","priceChart","drawChart","stockChart","container","labels","align","resize","offset","makePoint","point","y","niceAmount","nicePrice","draw","colors","responsive","pointFormat","events","options","legendItemClick","colorByPoint","ignoreHiddenPoint","hasBeenReflown","historyToSeries","shared","footerFormat","formatter","area","stacking","connectNulls","lineWidth","inactive","isEmpty","rows","toAssetRow","onselect","AssetRow","selectedRow","simpleView","find","detailledView","cell","amounts","node","priceDetails","priceCell","feed","anchorName","simple","class","mode","anchorTotal","anchorHeader","languages","us","fr","currencies","GeneralSettings","reload","general","Target","TargetSetup","TargetsControls","TargetsTable","targetKey","template","toJson","controls","showTargetSetup","setup","cancel","computeAll","styleParams","setPosition","translate","left","right","bottom","transform","shadow","Order","strategy","rebalance","size","closing","root","group","hasChanged","valueDiff","amountDiff","apply","unpeg","addAnchor","refresh","removeAnchor","sortChilds","localeCompare","fromJson","isValid","fromObject","beautifyFlag","toObject","percentChilds","toCosmicLink","operations","toOperations","remaining","o","operation","pop","operationsToCosmicLink","shouldOpenTrustline","insertOperation","shouldCloseTrustline","tdesc","parameters","method","getOperation","make","newOperation","setOperation","cost","isDust","operationDirection","op","addOneOperation","noMinValue","baseAsk","minOfferValue","sizeMin","sizeMax","skipMarginalOffers","makeOfferFilter","addMultipleOperations","tradeSize","liquidate","_addToTrade","misallocatedKey","misallocated","sizeKey","tradable","amountsSum","operationsToDescription","emitter","odesc","price_r","n","d","operationToOdesc","desc","market","percentage","spreadTightening","clone","premium","maxSpread","anchorPrice","minPrice","maxPrice","clampOfferPrice","updateOfferPriceR","tightenSpread","amountDelta","liabilities","description","isActive","setBalancesTargets","areTargetAnchorsBalanced","riskMax","anchorsRebalanceRiskMax","under","over","currentRisk","valueDiffP","amountCap","transferAmount","buy","sell","balanceTargetAnchors","undersizedClosing","canTakeTrade","isOneOperationEnough","delayed","weights","remains","weight","allocated","available","checkUnderFlag","margin","misallocationTolerance","overP","msg","underP","checkAllocationLimits","targets","t","liquidity","valueMin","buyTargets","buyValue","sellTargets","sellValue","canSell","throttleRatio","maybeThrottleTargetAmounts","ignore","TargetSetupAnchors","TargetSetupSize","backup","sizeSetup","anchorsSetup","maybeSwitchMode","activeElement","blur","doesPortfolioUseAnchor","toAnchorCheckbox","AnchorCheckbox","getState","isTargetAnchorActive","callback","switchAnchor","targetIsXlm","setMode","modified","toParagraph","save","AssetSelector","toTargetRow","sortTargets","TargetRow","assetSelector","toCommand","toPercent","toDiv","groups","natives","addGroup","AssetGroup","toAssetRadio","AssetRadio","onchange","donate","Icon","icons","links","displayLicense","displayDisclaimer","displayAbout","footer","prompt","isNaN","showDonateFrame","match","rel"],"mappings":"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","file":"app.js","sourcesContent":["\"use strict\"\n/**\n * Login interface\n */\nconst dom = require(\"@cosmic-plus/domutils/es5/dom\")\nconst Gui = require(\"@cosmic-plus/domutils/es5/gui\")\nconst html = require(\"@cosmic-plus/domutils/es5/html\")\nconst Tabs = require(\"@cosmic-plus/domutils/es5/tabs\")\nconst params = require(\"@cosmic-plus/domutils/es5/params\")\nconst { __ } = require(\"@cosmic-plus/i18n\")\n\nconst global = require(\"./logic/global\")\nconst Portfolio = require(\"./logic/portfolio\")\n\nconst ClickWall = require(\"./helpers/click-wall\")\nconst Form = require(\"./helpers/form\")\n\nconst ActivityGui = require(\"./activity-gui\")\nconst PortfolioGui = require(\"./portfolio-gui\")\nconst SettingsGui = require(\"./settings-gui\")\nconst RebalanceGui = require(\"./rebalance-gui\")\n\nconst license = new Gui(require(\"@cosmic-plus/assets/html/license.html\"))\nconst welcome = new Gui(require(\"../bundled/welcome.html\"))\nconst disclaimer = new Gui(require(\"../bundled/disclaimer.html\"))\n\n/**\n * Functions\n */\n\nlet ledger\nasync function loginWithLedgerWallet () {\n  disconnectHardwareWallets()\n  loginForm[\"stellar-public-key\"] = null\n  ledger = await getLedgerModule()\n  loginForm.info(__(\"Please open the Stellar App in your Ledger Wallet\"))\n  try {\n    await ledger.connect()\n    loginForm[\"stellar-public-key\"] = ledger.publicKey\n    login()\n  } catch (error) {\n    loginForm.error(error)\n  }\n}\n\nlet trezor\nasync function loginWithTrezorWallet () {\n  disconnectHardwareWallets()\n  loginForm[\"stellar-public-key\"] = null\n  trezor = await getTrezorModule()\n  loginForm.info(__(\"Please import your Trezor public key\"))\n  try {\n    await trezor.connect()\n    loginForm[\"stellar-public-key\"] = trezor.publicKey\n    login()\n  } catch (error) {\n    loginForm.error(error)\n  }\n}\n\nfunction disconnectHardwareWallets () {\n  if (ledger) ledger.disconnect()\n  if (trezor) trezor.disconnect()\n}\n\nasync function login () {\n  const address = loginForm[\"stellar-public-key\"]\n  if (!address) loginForm.error(__(\"Please enter an address.\"))\n  disconnectHardwareWallets()\n\n  loginForm.info(__(\"Connecting to your account...\"))\n  params.$set({ address })\n\n  const clickWall = new ClickWall()\n  clickWall.enable()\n\n  try {\n    global.portfolio = await Portfolio.resolve(address)\n    loginForm.info(`${__(\"Fetching market data\")}...`)\n    setTimeout(\n      () => loginForm.info(`${__(\"Sorry, it takes a while (^.^)\\\"\")}...`),\n      10000\n    )\n    setTimeout(() => loginForm.info(`${__(\"Almost there\")}...`), 20000)\n    setTimeout(\n      () => loginForm.info(`${__(\"I'm running, I'm running\")}...`),\n      30000\n    )\n    global.portfolio.listen(\"open\", () => {\n      initGui()\n      clickWall.destroy()\n    })\n  } catch (error) {\n    clickWall.destroy()\n    loginForm.error(error)\n  }\n}\n\nfunction initGui () {\n  const portfolio = global.portfolio\n\n  const selected = location.hash\n  tabs.remove(\"#welcome\")\n  tabs.remove(\"#login\")\n  tabs.remove(\"#demo\")\n  tabs.add(\"#portfolio\", __(\"Portfolio\"), new PortfolioGui(portfolio))\n  tabs.add(\"#rebalance\", __(\"Rebalance\"), new RebalanceGui(portfolio))\n  tabs.add(\"#activity\", __(\"Activity\"), new ActivityGui(portfolio))\n  tabs.add(\"#settings\", __(\"Settings\"), new SettingsGui())\n  tabs.add(\"#logout\", __(\"Logout\"), () => {\n    location.replace(location.href.replace(/\\?.*$/, \"#login\"))\n  })\n\n  // Fix portfolio pie chart positioning.\n  tabs.listen(\"select\", () => {\n    if (!tabs.selected) return\n    const content = tabs.selected.content\n    if (content.reflow) content.reflow()\n  })\n\n  tabs.select(selected)\n  if (!tabs.selected) tabs.select(\"#portfolio\")\n}\n\n/**\n * Demo Page\n */\nconst MYPUBKEY = \"GAWO2C52D57XBT7SQL6YB3XPHFLFD2J4Z5RN7HPFZSHXJMXH72HRXNV3\"\nfunction displayDemo () {\n  localStorage[`target:${MYPUBKEY}`] = demoConfig\n  location.href = `?address=${MYPUBKEY}`\n}\n\nconst demoConfig = `{\"childs\":[{\"size\":24,\"asset\":\"BTC\",\"closing\":[\"GCNSGHUCG5VMGLT5RIYYZSO7VQULQKAJ62QA33DBC5PPBSO57LFWVV6P\"]},{\"size\":32,\"asset\":\"CNY\"},{\"size\":24,\"asset\":\"ETH\"},{\"size\":32,\"asset\":\"EUR\"},{\"size\":6,\"asset\":\"LTC\"},{\"size\":3,\"asset\":\"MOBI\"},{\"size\":3,\"asset\":\"RMT\"},{\"size\":3,\"asset\":\"SHX\"},{\"size\":3,\"asset\":\"TERN\"},{\"size\":32,\"asset\":\"USD\",\"closing\":[\"GDSRCV5VTM3U7Y3L6DFRP3PEGBNQMGOWSRTGSBWX6Z3H6C7JHRI4XFJP\"]},{\"size\":24,\"asset\":\"XLM\"},{\"size\":6,\"asset\":\"XRP\"}]}`\n\n/**\n * Module loading\n */\n\nfunction getLedgerModule () {\n  return import(\n    /* webpackChunkName: \"ledger\" */ \"@cosmic-plus/ledger-wallet\"\n  ).then((ledger) => ledger.default)\n}\n\nasync function getTrezorModule () {\n  const trezor = await import(\n    /* webpackChunkName: \"trezor\" */ \"@cosmic-plus/trezor-wallet\"\n  ).then((trezor) => trezor.default)\n  trezor.register(\"equilibre.io\", \"mister.ticot@cosmic.plus\")\n  return trezor\n}\n\n/**\n * Init\n */\n\n// Load known assets.\nconst Asset = require(\"./logic/asset\")\nconst knownAssets = require(\"./data/assets.json\")\nAsset.register(knownAssets.fiat, { type: \"fiat\", isTether: true })\nAsset.register(knownAssets.foreign, { type: \"crypto\", isTether: true })\nAsset.register(knownAssets.native, { type: \"crypto\", isTether: false })\nAsset.resolve(global.currency, { type: \"fiat\", isTether: true })\n\n// Load known anchors.\nconst Anchor = require(\"./logic/anchor\")\nAnchor.register(require(\"./data/anchors.json\"))\n\n// Load footer.\nrequire(\"./footer\")\n\n// Init navigation.\nconst tabs = global.tabs = new Tabs({\n  nav: dom.header,\n  selector: dom.header,\n  view: dom.main\n})\ntabs.add(\"#welcome\", __(\"Welcome\"), welcome)\ntabs.add(\"#demo\", __(\"Demo\"), displayDemo)\ntabs.add(\"#login\", __(\"Login\"), dom.loginTab)\ntabs.add(\"#license\", null, license)\ntabs.add(\"#disclaimer\", null, disclaimer)\ntabs.add(\"#about\", null, welcome)\ndom.demoLink.onclick = displayDemo\nhtml.show(dom.loginTab)\n\ntabs.select(null)\ntabs.select(location.hash)\nif (!tabs.selected) {\n  if (!localStorage[\"PortfolioSummary.tab\"]) tabs.select(\"#welcome\")\n  else tabs.select(\"#login\")\n}\n\n// Init login.\nconst loginForm = new Form(dom.loginForm, { onsubmit: login })\nloginForm.dom.loginWithLedger.onclick = loginWithLedgerWallet\nloginForm.dom.loginWithTrezor.onclick = loginWithTrezorWallet\n\nif (params.address) {\n  tabs.select(\"#login\")\n  loginForm[\"stellar-public-key\"] = params.address\n  login()\n}\n\n// Scrollup on navigation.\ntabs.listen(\"select\", (page) => {\n  location.hash = page\n  window.scrollTo(0, 0)\n})\n","\"use strict\"\n/**\n * Various independent helpers.\n */\nconst misc = exports\n\n/**\n * Returns **number** if it is greater than 0, else returns 0.\n */\nmisc.positive = function (number) {\n  return Math.max(0, number)\n}\n\n/**\n * Returns **number** if it is lesser than 0, else returns 0.\n */\nmisc.negative = function (number) {\n  return Math.min(0, number)\n}\n\n/**\n * Returns **number** with 7 digits after the dot.\n */\nmisc.fixed7 = function (number) {\n  return +Number(number).toFixed(7)\n}\n\n/**\n * Returns a number whose value is limited to the given range.\n */\nmisc.clamp = function (value, min, max) {\n  return Math.min(Math.max(value, min), max)\n}\n\n/**\n * Returns **value1** if its absolute is lesser than or equal **value2**\n * absolute, else returns **value2**.\n */\nmisc.absoluteMin = function (value1, value2) {\n  return Math.abs(value1) <= Math.abs(value2) ? value1 : value2\n}\n\n/**\n * Return whether or not **array** contains **value**.\n */\nmisc.arrayContains = function (array, value) {\n  return array.indexOf(value) !== -1\n}\n\n/**\n * Remove all the occurences of **item** from **array**.\n */\nmisc.arrayRemove = function (array, item) {\n  for (let index = array.length - 1; index >= 0; index--) {\n    if (array[index] === item) array.splice(index, 1)\n  }\n}\n\n/**\n * Returns values that are in **array1** but not in **array2**.\n */\nmisc.arrayOnlyInFirst = function (array1, array2) {\n  return array1.filter((item) => !misc.arrayContains(array2, item))\n}\n\n/**\n * Sum array values, or array elements `key` if specified.\n */\nmisc.arraySum = function (array, key) {\n  if (key) return array.reduce((sum, obj) => sum + obj[key], 0)\n  else return array.reduce((sum, x) => sum + x, 0)\n}\n\n/**\n * Proportionally scale **array** values, or **array** elements **key** property\n * if provided, to make their sum equal **targetSum**.\n */\nmisc.arrayScale = function (array, targetSum, key) {\n  const sum = misc.arraySum(array, key)\n  if (!sum) return array.map(() => 0)\n\n  if (key) return array.map((obj) => obj[key] * targetSum / sum)\n  else return array.map((x) => x * targetSum / sum)\n}\n","\"use strict\"\n/**\n * Asset class\n */\n\nconst AUTO_REFRESH_PRICES = true\nconst CRYPTO_PRICES_REFRESH_DELAY = 60 * 1000\nconst FIAT_PRICES_REFRESH_DELAY = 60 * 60 * 1000\nconst FIAT_BASEURL = \"https://www.xe.com/themes/xe/images/flags/svg/\"\nconst FIAT_IMAGEFORMAT = \".svg\"\n\nconst Mirrorable = require(\"@cosmic-plus/jsutils/es5/mirrorable\")\nconst Projectable = require(\"@cosmic-plus/jsutils/es5/projectable\")\n\nconst marketData = require(\"./market-data\")\nconst Orderbook = require(\"./orderbook\")\nconst {\n  fixed7,\n  arrayContains,\n  arrayRemove,\n  arraySum\n} = require(\"../helpers/misc\")\n\n/**\n * Class\n */\n\nconst Asset = module.exports = class Asset extends Projectable {\n  static resolve (id, params) {\n    return Asset.table[id] || new Asset(id, params)\n  }\n\n  constructor (id, params) {\n    super()\n    if (params) Object.assign(this, params)\n\n    this.id = id\n    Asset.table[id] = this\n\n    // Empty image by default\n    this.image = \"data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=\"\n\n    if (this.type) {\n      this.code = id\n      if (this.type === \"fiat\") {\n        Asset.fiats.push(this)\n        this.image = `${FIAT_BASEURL}${id.toLowerCase()}${FIAT_IMAGEFORMAT}`\n        this.useGlobalPrice = true\n      } else {\n        Asset.cryptos.push(this)\n        this.type = \"crypto\"\n        if (this.isTether || this.id === \"XLM\") this.useGlobalPrice = true\n      }\n    } else {\n      this.code = id.replace(/:.*/, \"\")\n      this.name = this.code\n      this.type = \"unknown\"\n    }\n\n    this.anchors = new Mirrorable()\n    this.balances = new Mirrorable()\n    this.offers = new Mirrorable()\n\n    this.balances.mirror((balance) => {\n      this.watch(balance, \"amount\", () => this.compute(\"amount\"))\n      this.watch(balance, [\"buying\", \"selling\"], () => {\n        this.compute(\"liabilities\")\n      })\n    })\n\n    this.orderbook = Orderbook.forAsset(this)\n    this.define(\"price\", \"globalPrice\", () => {\n      return this.globalPrice || this.orderbook.price\n    })\n    this.watch(this.orderbook, \"price\", () => this.compute(\"price\"))\n  }\n\n  maybeAddBalance (balance) {\n    if (arrayContains(this.balances, balance)) return\n    this.balances.push(balance)\n    if (!balance.orderbook) balance.streamPrice()\n  }\n\n  maybeRemoveBalance (balance) {\n    arrayRemove(this.balances, balance)\n  }\n\n  async getInfo () {\n    // Happens once & only for cryptos.\n    if (this.name || this.type !== \"crypto\") return\n    this.info = await marketData.crypto.info(this)\n    this.name = this.info.name\n    this.image = this.info.image.small\n  }\n\n  async getHistoricPrice () {\n    if (this.historicPrice) return this.historicPrice\n\n    this.historicPrice = await marketData.assetHistory(this)\n    if (!this.historicPrice) return\n\n    // Keep today's price in sync.\n    this.trap(\"price\", () => {\n      const dailyData = this.historicPrice[this.historicPrice.length - 1]\n      dailyData.price = this.price\n    })\n\n    return this.historicPrice\n  }\n}\n\nAsset.define(\"amount\", \"balances\", function () {\n  return this.balances && fixed7(arraySum(this.balances, \"amount\"))\n})\n\nAsset.define(\"value\", [\"amount\", \"price\"], function () {\n  return this.amount === 0 ? 0 : this.amount * this.price\n})\n\nAsset.define(\"valueMin\", [\"amountMin\", \"price\"], function () {\n  return !this.amountMin ? 0 : this.amountMin * this.price\n})\n\nAsset.define(\"liabilities\", [\"balances\", \"price\"], function () {\n  if (this.balances) {\n    const rawLiabilities = this.balances.reduce(\n      (sum, entry) => sum + entry.buying - entry.selling,\n      0\n    )\n    return this.price * rawLiabilities\n  }\n})\n\nAsset.define(\"isSupported\", [\"type\", \"price\"], function () {\n  return !!(this.type !== \"unknown\" || this.price)\n})\n\n/**\n * Utilities\n */\n\n/**\n * Registers **assets** as known assets, assigns **params** to them.\n */\nAsset.register = function (assets, defaults) {\n  for (let code in assets) {\n    const params = Object.assign({}, defaults, assets[code])\n    Asset.resolve(code, params)\n  }\n}\n\n/**\n * Get general information (name, logo, ...) for all known assets.\n */\nAsset.getAllInfo = function () {\n  const assets = Object.values(Asset.table)\n  assets.forEach((asset) => asset.getInfo())\n}\n\nAsset.refreshPrices = async function (array) {\n  if (!array) {\n    await Asset.refreshCryptoPrices()\n    await Asset.refreshFiatPrices()\n  } else {\n    await Asset.refreshCryptoPrices(\n      array\n        .filter((asset) => asset.type === \"crypto\")\n        .map((asset) => asset.code)\n    )\n    await Asset.refreshFiatPrices(\n      array.filter((asset) => asset.type === \"fiat\").map((asset) => asset.code)\n    )\n  }\n}\n\nAsset.refreshCryptoPrices = async function (assets = Asset.cryptos) {\n  if (!assets.length) return\n  const prices = await marketData.crypto.prices(assets)\n  assets.forEach((asset) => {\n    if (asset.useGlobalPrice) asset.globalPrice = prices[asset.code]\n  })\n}\n\nAsset.refreshFiatPrices = async function (fiats = Asset.fiats) {\n  if (!fiats.length) return\n  const prices = await marketData.fiat.prices(fiats)\n  fiats.forEach((asset) => {\n    if (asset.useGlobalPrice) asset.globalPrice = prices[asset.code]\n  })\n}\n\n/**\n * Init\n */\n\nAsset.table = {}\nAsset.cryptos = []\nAsset.fiats = []\n\n// Automatic global price refresh\nif (AUTO_REFRESH_PRICES) {\n  setInterval(Asset.refreshCryptoPrices, CRYPTO_PRICES_REFRESH_DELAY)\n  setInterval(Asset.refreshFiatPrices, FIAT_PRICES_REFRESH_DELAY)\n}\n\n// eslint-disable-next-line no-console\nconsole.log(Asset.table)\n","\"use strict\"\n/**\n * Balance\n */\nconst Mirrorable = require(\"@cosmic-plus/jsutils/es5/mirrorable\")\nconst Projectable = require(\"@cosmic-plus/jsutils/es5/projectable\")\n\nconst Anchor = require(\"./anchor\")\nconst Asset = require(\"./asset\")\nconst Orderbook = require(\"./orderbook\")\n\nconst global = require(\"./global\")\nconst { fixed7, positive, negative, arrayRemove } = require(\"../helpers/misc\")\n\n/**\n * Definition\n */\nclass Balance extends Projectable {\n  static resolve (code, issuer) {\n    const id = Balance.makeId(code, issuer)\n    return Balance.table[id] || new Balance({ code, issuer })\n  }\n\n  static ingest (record) {\n    const params = Balance.recordToParams(record)\n    const balance = Balance.resolve(params.code, params.issuer)\n    balance.update(params)\n    balance.hasTrustline = true\n    return balance\n  }\n\n  constructor (params) {\n    const { code, issuer } = params\n\n    super()\n\n    // Identification\n    this.code = code\n    this.anchor = Anchor.resolve(issuer || \"stellar.org\")\n    this.id = Balance.makeId(code, issuer)\n    Balance.table[this.id] = this\n\n    // Link with an asset object.\n    if (this.code in this.anchor.assets) {\n      this.asset = this.anchor.assets[this.code]\n      this.known = true\n    } else {\n      this.asset = Asset.resolve(this.id)\n      this.known = false\n    }\n\n    // Set updatable properties.\n    this.update(params)\n    this.offers = new Mirrorable()\n  }\n\n  update (params) {\n    const { amount, buying, selling } = params\n    this.amount = amount || 0\n    this.buying = buying || 0\n    this.selling = selling || 0\n  }\n\n  streamPrice () {\n    if (this.orderbook) return\n\n    if (this.id === \"XLM\") {\n      this.asset.project(\"price\", this)\n    } else {\n      this.orderbook = Orderbook.forBalance(this, Asset.resolve(\"XLM\"))\n      this.orderbook.project(\"price\", this)\n      this.asset.orderbook.addChild(this.orderbook)\n    }\n  }\n}\n\nBalance.table = {}\n\nBalance.trap(\"hasTrustline\", () => {\n  if (this.hasTrustline) {\n    arrayRemove(this.asset.target.opening, this.anchor.pubkey)\n  }\n})\n\nBalance.define(\"isActive\", [\"action\", \"hasTrustline\"], function () {\n  if (this.hasTrustline) return this.action !== \"closing\"\n  else return this.action === \"opening\"\n})\n\nBalance.define(\"value\", [\"amount\", \"price\"], function () {\n  return this.amount === 0 ? 0 : this.amount * this.price\n})\n\n// targetAmount is set by \"./order.js\"\nBalance.define(\"targetMin\", [\"targetAmount\"], function () {\n  return fixed7(this.targetAmount * (1 - global.balanceTargetDeviation))\n})\nBalance.define(\"targetMax\", [\"targetAmount\"], function () {\n  return fixed7(this.targetAmount * (1 + global.balanceTargetDeviation))\n})\nBalance.define(\"targetMinDiff\", [\"amount\", \"targetMin\"], function () {\n  return fixed7(this.targetMin - this.amount)\n})\nBalance.define(\"targetMaxDiff\", [\"amount\", \"targetMax\"], function () {\n  return fixed7(this.targetMax - this.amount)\n})\nBalance.define(\"sizeMin\", [\"targetMinDiff\"], function () {\n  return negative(this.targetMinDiff)\n})\nBalance.define(\"sizeMax\", [\"targetMaxDiff\"], function () {\n  return positive(this.targetMaxDiff)\n})\nBalance.define(\"underMin\", [\"targetMinDiff\"], function () {\n  return negative(-this.targetMinDiff)\n})\nBalance.define(\"overMax\", [\"targetMaxDiff\"], function () {\n  return positive(-this.targetMaxDiff)\n})\n\n/**\n * Utilities\n */\n\nBalance.makeId = function (code, issuer) {\n  if (issuer) return `${code}:${issuer}`\n  else if (code === \"XLM\") return \"XLM\"\n  else throw new Error(`Missing issuer for ${code}.`)\n}\n\n/**\n * API-Specific Format: Record\n **/\n\nBalance.fromRecord = function (record) {\n  const params = Balance.recordToParams(record)\n  return new Balance(params)\n}\n\nBalance.recordToParams = function (record) {\n  const params = Object.create(record)\n  params.code = record.asset_type === \"native\" ? \"XLM\" : record.asset_code\n  params.issuer = record.asset_issuer\n  params.amount = +record.balance\n  params.buying = +record.buying_liabilities\n  params.selling = +record.selling_liabilities\n  return params\n}\n\n/**\n * Export\n */\nmodule.exports = Balance\n","\"use strict\"\n/**\n * Anchor\n */\nconst aliases = require(\"@cosmic-plus/base/es5/aliases\")\nconst helpers = require(\"@cosmic-plus/jsutils/es5/misc\")\nconst Projectable = require(\"@cosmic-plus/jsutils/es5/projectable\")\n\nconst Asset = require(\"./asset\")\n\n/**\n * Definition\n */\n\nclass Anchor extends Projectable {\n  static resolve (pubkey, params) {\n    return Anchor.table[pubkey] || new Anchor(pubkey, params)\n  }\n\n  constructor (pubkey, params) {\n    super()\n    if (params) Object.assign(this, params)\n\n    Anchor.table[pubkey] = this\n\n    this.pubkey = pubkey\n    this.alias = aliases.all[pubkey]\n    this.name = helpers.shorter(this.alias || this.pubkey)\n\n    this.assets = {}\n\n    if (this.emit)\n      this.emit.forEach((entry) => {\n        if (typeof entry !== \"string\") this.addAsset(entry[0], entry[1])\n        else this.addAsset(entry)\n      })\n  }\n\n  addAsset (code, alias = code) {\n    this.assets[alias] = Asset.resolve(code)\n    this.assets[alias].anchors.push(this)\n  }\n}\n\nAnchor.table = {}\n\n/**\n * Utilities\n */\n\n/**\n * Register known **anchors**.\n */\nAnchor.register = function (anchors) {\n  for (let pubkey in anchors) {\n    Anchor.resolve(pubkey, anchors[pubkey])\n  }\n}\n\n/**\n * Returns the anchor local code for **assetCode**.\n */\nAnchor.prototype.tetherCode = function (assetCode) {\n  for (let index in this.emit) {\n    const entry = this.emit[index]\n\n    if (entry === assetCode) {\n      return assetCode\n    } else if (Array.isArray(entry)) {\n      if (entry[0] === assetCode) return entry[1]\n    }\n  }\n}\n\n/**\n * Export\n */\nmodule.exports = Anchor\n","\"use strict\"\n/**\n * Theme for Highstock\n */\nconst Highstock = require(\"highcharts/highstock\")\n\n/**\n * Theme Colors\n */\nconst primaryLight = \"#daeeff\"\nconst primaryDark = \"#003f90\"\nconst white = \"#fff\"\nconst black = \"#292929\"\nconst greyLight = \"#eaeaea\"\nconst greyMedium = \"#a9a9a9\"\nconst greyDark = \"#545454\"\n\n/**\n * Main Theme\n */\n\nHighstock.theme = {\n  rangeSelector: {\n    selected: 2,\n    inputBoxBorderColor: greyMedium,\n    buttonTheme: {\n      fill: greyLight,\n      states: {\n        hover: { fill: primaryLight },\n        select: { fill: primaryDark, style: { color: white } }\n      }\n    }\n  },\n\n  chart: {\n    backgroundColor: white,\n    style: {\n      fontFamily: \"'Source Sans Pro', arial, sans-serif\",\n      color: black\n    }\n  },\n\n  xAxis: {\n    lineColor: greyMedium,\n    tickColor: greyMedium\n  },\n\n  yAxis: {\n    lineColor: greyMedium,\n    tickColor: greyMedium\n  },\n\n  navigator: {\n    maskFill: \"rgba(119, 153, 213, 0.07)\",\n    outlineColor: greyMedium,\n    xAxis: { gridLineColor: greyMedium },\n    series: { color: primaryDark }\n  },\n\n  tooltip: { style: { fontSize: \"16px\" } },\n  scrollbar: { enabled: false },\n  credits: { enabled: false },\n\n  plotOptions: {\n    column: {\n      color: greyDark,\n      dataGrouping: { enabled: false }\n    },\n\n    pie: {\n      allowPointSelect: true,\n      animation: false,\n      cursor: \"pointer\",\n      dataLabels: { style: { fontSize: \"16px\" } }\n    },\n\n    spline: {\n      color: primaryDark,\n      dataGrouping: { enabled: false }\n    }\n  }\n}\n\nHighstock.setOptions(Highstock.theme)\n\n/**\n * Individual Theme Components\n */\n\nHighstock.pieColors = [\n  \"rgba(231,  76,  60, 0.8)\",\n  \"rgba(230, 126,  34, 0.8)\",\n  \"rgba(242, 202,  39, 0.8)\",\n  \"rgba(46,  204, 112, 0.8)\",\n  \"rgba(52,  152, 219, 0.8)\",\n  \"rgba(155,  89, 182, 0.8)\",\n\n  \"rgba(231,  76,  60, 0.6)\",\n  \"rgba(230, 126,  34, 0.6)\",\n  \"rgba(242, 202,  39, 0.6)\",\n  \"rgba(46,  204, 112, 0.6)\",\n  \"rgba(52,  152, 219, 0.6)\",\n  \"rgba(155,  89, 182, 0.6)\",\n\n  \"rgba(231,  76,  60, 0.4)\",\n  \"rgba(230, 126,  34, 0.4)\",\n  \"rgba(242, 202,  39, 0.4)\",\n  \"rgba(46,  204, 112, 0.4)\",\n  \"rgba(52,  152, 219, 0.4)\",\n  \"rgba(155,  89, 182, 0.4)\"\n]\n\nHighstock.pieResponsive = {\n  rules: [\n    {\n      condition: { maxWidth: 500 },\n      chartOptions: {\n        legend: { enabled: true },\n        plotOptions: {\n          pie: {\n            showInLegend: true,\n            dataLabels: {\n              format: \"{point.percentage:.0f}%\",\n              distance: -20\n            }\n          }\n        }\n      }\n    }\n  ]\n}\n","\"use strict\"\n/**\n * History - Generic history data abstraction\n */\nconst global = require(\"./global\")\n\n/**\n * Definition\n */\n\nclass History extends Array {}\n\n/**\n * Caching\n */\n\nHistory.setCache = function (key, history) {\n  const json = JSON.stringify({ [global.currency]: history })\n  localStorage[`history:${key}`] = json\n}\n\nHistory.getCache = function (key) {\n  const json = localStorage[`history:${key}`]\n  if (json) return JSON.parse(json)[global.currency]\n}\n\n/**\n * Utilities\n */\n\nHistory.cut = function (history, length) {\n  const diff = history.length - length\n  if (diff > 0) history.splice(0, diff)\n}\n\nHistory.latest = function (history) {\n  return history[history.length - 1]\n}\n\nHistory.join = function (oldData, newData) {\n  const start = newData[0].time\n  const index = oldData.findIndex((day) => day.time === start)\n  return oldData.slice(0, index).concat(newData)\n}\n\n/**\n * Time Calculations\n */\n\nHistory.oneDay = 24 * 60 * 60 * 1000\n\nHistory.today = function () {\n  return History.roundTime(new Date())\n}\n\nHistory.roundTime = function (time) {\n  const date = new Date(time)\n  date.setUTCHours(0, 0, 0, 0)\n  return +date\n}\n\nHistory.time = function (time) {\n  return +new Date(time)\n}\n\nHistory.missingDays = function (history) {\n  return History.numberToDays(History.today() - History.latest(history).time)\n}\n\nHistory.numberToDays = function (number) {\n  return number / History.oneDay\n}\n\n/**\n * Export\n */\nmodule.exports = History\n","\"use strict\"\n/**\n * Orderbook class\n */\n\nconst cosmicLib = require(\"cosmic-lib\")\nconst Projectable = require(\"@cosmic-plus/jsutils/es5/projectable\")\nconst StellarSdk = require(\"@cosmic-plus/base/es5/stellar-sdk\")\nconst { timeout } = require(\"@cosmic-plus/jsutils/es5/misc\")\nconst { __ } = require(\"@cosmic-plus/i18n\")\n\nconst { fixed7 } = require(\"../helpers/misc\")\n\nconst Orderbook = module.exports = class Orderbook extends Projectable {\n  static forBalance (balance, quote) {\n    if (balance.asset === quote) return\n\n    const orderbook = new Orderbook({ balance, quote })\n    orderbook.streamOffers()\n\n    return orderbook\n  }\n\n  static forAsset (asset) {\n    return new Orderbook({ asset })\n  }\n\n  constructor (params) {\n    super()\n\n    if (params.balance) {\n      this.type = \"native\"\n      this.balance = params.balance\n      this.base = params.balance.asset\n      this.quote = params.quote\n      this.name = `${this.base.code}/${this.quote.code}`\n      this.offersCallBuilder = Orderbook.offersCallBuilder(this.balance)\n\n      this.watch(this.quote, \"price\", () => this.updateOffersPrices())\n    } else if (params.asset) {\n      this.type = \"agregated\"\n      this.base = params.asset\n      this.name = `${this.base.code} (${__(\"Agregated\")})`\n      this.childs = []\n    }\n\n    this.watch(this.base, \"globalPrice\", () => this.compute(\"price\"))\n  }\n\n  static offersCallBuilder (balance) {\n    const baseAsset = new StellarSdk.Asset(balance.code, balance.anchor.pubkey)\n    const quoteAsset = StellarSdk.Asset.native()\n    const server = cosmicLib.resolve.server()\n    return server.orderbook(baseAsset, quoteAsset)\n  }\n\n  async streamOffers () {\n    // eslint-disable-next-line no-constant-condition\n    while (true) {\n      await this.getOffers()\n      await timeout(15000)\n    }\n  }\n\n  async getOffers () {\n    try {\n      const offers = await this.offersCallBuilder.limit(200).call()\n      this.ingest(offers)\n    } catch (error) {\n      console.error(error)\n    }\n  }\n\n  ingest (offers) {\n    if (!areOffersEquals(this.bids, offers.bids)) {\n      this.bids = normalizeOffers(offers.bids, this.quote, this.balance, \"bids\")\n    }\n    if (!areOffersEquals(this.asks, offers.asks)) {\n      this.asks = normalizeOffers(offers.asks, this.quote, this.balance, \"asks\")\n    }\n  }\n\n  updateOffersPrices () {\n    if (this.bids) {\n      this.set(\"bids\", updateOffersPrices(this.bids, this.quote))\n    }\n    if (this.asks) {\n      this.set(\"asks\", updateOffersPrices(this.asks, this.quote))\n    }\n  }\n\n  mergeOffers (side) {\n    if (this.childs.length < 2) {\n      this.set(side, this.childs[0] && this.childs[0][side])\n      return\n    }\n\n    /// Merge order books\n    const merged = this.childs.reduce((merged, child) => {\n      return child[side] ? merged.concat(child[side]) : merged\n    }, [])\n    if (!merged.length) {\n      this[side] = null\n      return\n    }\n\n    const sortOffers =\n      side === \"bids\"\n        ? (a, b) => b.price - a.price\n        : (a, b) => a.price - b.price\n\n    /// Update volumes.\n    let volume = 0,\n      baseVolume = 0,\n      quoteVolume = 0\n    this.set(\n      side,\n      merged.sort(sortOffers).map((row) => {\n        const mergedRow = Object.assign({}, row)\n        mergedRow.volume = volume += fixed7(row.amount * row.price)\n        mergedRow.baseVolume = baseVolume += +row.amount\n        mergedRow.quoteVolume = quoteVolume += +row.quoteAmount\n        return mergedRow\n      })\n    )\n  }\n\n  addChild (orderbook) {\n    this.childs.push(orderbook)\n    this.watch(orderbook, \"bids\", () => this.mergeOffers(\"bids\"))\n    this.watch(orderbook, \"asks\", () => this.mergeOffers(\"asks\"))\n  }\n}\n\nOrderbook.define(\"bestBid\", \"bids\", function () {\n  return this.bids && this.bids[0] && this.bids[0].price\n})\nOrderbook.define(\"bestAsk\", \"asks\", function () {\n  return this.asks && this.asks[0] && this.asks[0].price\n})\nOrderbook.define(\"midpoint\", [\"bestBid\", \"bestAsk\"], function () {\n  return (this.bestBid + this.bestAsk) / 2\n})\nOrderbook.define(\"price\", [\"midpoint\"], function () {\n  if (this.base.globalPrice) return this.midpoint\n  else return this.marketPrice()\n})\nOrderbook.define(\"spread\", [\"bestBid\", \"bestAsk\"], function () {\n  return this.bestAsk - this.bestBid\n})\nOrderbook.define(\"spread%\", [\"spread\", \"bestAsk\"], function () {\n  return 100 * this.spread / this.bestAsk\n})\n\n/**\n * Utilities\n */\n\n/**\n * Returns whether or not an orderbook offers has been fetched at least once.\n * Agregated orderbooks return `true` only when each child orderbook has been\n * fetched.\n */\nOrderbook.prototype.isFetched = function () {\n  if (this.childs) {\n    return this.childs.reduce((and, child) => and && child.isFetched(), true)\n  } else {\n    return this.asks != null && this.bids != null\n  }\n}\n\n/**\n * Look for the best first offer in **orderbook** **side** that match **filter**\n * (if provided) among child orderbooks.\n *\n * @param  {Orderbook} orderbook [description]\n * @param  {String}    side      `bids` or `asks`\n * @param  {Function}  [filter]  A filter that is passed by the returned offer\n * @return {Object}    An orderbook offer\n */\nOrderbook.prototype.findOffer = function (side, filter) {\n  const offers = this[side]\n  const childsNum = this.childs ? this.childs.length : 1\n  const anchors = {}\n\n  let last\n  for (let index in offers) {\n    const offer = offers[index]\n    if (filter && !filter(offer)) continue\n    const anchor = offer.balance.anchor.pubkey\n    if (!anchors[anchor]) {\n      anchors[anchor] = true\n      last = offer\n    }\n    if (Object.keys(anchors).length === childsNum) break\n  }\n  return last\n}\n\nOrderbook.prototype.findAsk = function (filter) {\n  return this.findOffer(\"asks\", filter)\n}\nOrderbook.prototype.findBid = function (filter) {\n  return this.findOffer(\"bids\", filter)\n}\n\n/**\n * Returns the price of asset at **depth** XLM of orderbook's **side**.\n *\n * @param  {String} [side=\"bids\"] Either \"bids\" or \"asks\"\n * @param  {Number} [depth] The depth to look at, in term of XLM\n * @return {Number} Offer price at requested depth\n */\nOrderbook.prototype.marketPrice = function (side = \"bids\", depth = 50) {\n  const offer = this.findOffer(side, (offer) => offer.quoteVolume > depth)\n  return offer ? offer.price : 0\n}\n\n/**\n * Helpers\n */\n\nfunction areOffersEquals (array1, array2) {\n  if (!array1) return false\n  if (array1.length !== array2.length) return false\n  for (let index in array1.length) {\n    if (array1[index].amount !== array2[index].amount) return false\n    if (array1[index].price !== array2[index].price) return false\n  }\n  return true\n}\n\nfunction normalizeOffers (offers, quote, balance, side) {\n  offers.forEach((row) => {\n    row.volume = undefined\n    row.baseVolume = undefined\n    row.basePrice = +row.price\n    row.quoteAmount = +row.amount\n    row.quoteVolume = undefined\n    row.balance = balance\n    row.side = side\n  })\n  return updateOffersPrices(offers, quote)\n}\n\nfunction updateOffersPrices (offers, quote) {\n  let volume = 0,\n    quoteVolume = 0,\n    baseVolume = 0\n  offers.forEach((row) => {\n    if (row.side === \"asks\") {\n      row.quoteAmount = fixed7(row.amount * row.basePrice)\n    } else {\n      row.amount = fixed7(row.quoteAmount / row.basePrice)\n    }\n    row.price = fixed7(row.basePrice * quote.price)\n    row.volume = volume += fixed7(row.amount * row.price)\n    row.baseVolume = baseVolume += +row.amount\n    row.quoteVolume = quoteVolume += +row.quoteAmount\n  })\n  return offers\n}\n","\"use strict\"\n/**\n * Overlay that prevent user interaction\n */\nconst html = require(\"@cosmic-plus/domutils/es5/html\")\nconst { timeout } = require(\"@cosmic-plus/jsutils/es5/misc\")\n\n/**\n * Definition\n */\n\nclass ClickWall {\n  constructor (params = {}) {\n    this.domNode = html.create(\"div\", {\n      className: \"ClickWall\",\n      onclick: () => this.click(),\n      hidden: true\n    })\n\n    Object.assign(this.domNode.style, ClickWall.style)\n    document.body.insertBefore(this.domNode, document.body.firstChild)\n\n    this.onclick = params.onclick\n    this.scrollbar = params.scrollbar\n    this.opacity = params.opacity\n    this.delay = params.delay || ClickWall.delay\n  }\n\n  click () {\n    if (this.isEnabled && this.onclick) this.onclick()\n  }\n\n  async enable () {\n    // Scrollbar hidding.\n    if (this.scrollbar === \"hide\") {\n      this.htmlOverflow = document.documentElement.style.overflow\n      this.bodyOverflow = document.body.style.overflow\n      document.documentElement.style.overflow = \"hidden\"\n      document.body.style.overflow = \"hidden\"\n    }\n\n    // Fade in.\n    html.show(this.domNode)\n    if (this.opacity) await this.setOpacity(this.opacity)\n    this.isEnabled = true\n  }\n\n  async disable () {\n    // Handle scrollbar hidding.\n    if (this.scrollbar === \"hide\") {\n      document.documentElement.style.overflow = this.htmlOverflow\n      document.body.style.overflow = this.bodyOverflow\n    }\n\n    // Fade out.\n    this.isEnabled = false\n    if (this.opacity) await this.setOpacity(0)\n    html.hide(this.domNode)\n  }\n\n  async destroy () {\n    await this.disable()\n    html.destroy(this.domNode)\n  }\n\n  async setOpacity (opacity = this.opacity) {\n    await timeout(0)\n    Object.assign(this.domNode.style, {\n      transition: `background ${this.delay}ms`,\n      background: `rgba(0, 0, 0, ${opacity})`\n    })\n    return timeout(this.delay)\n  }\n}\n\n/**\n * Configuration\n */\n\nClickWall.delay = 500\n\nClickWall.style = {\n  position: \"fixed\",\n  zIndex: 999,\n  top: 0,\n  width: \"100%\",\n  height: \"100%\"\n}\n\n/**\n * Export\n */\nmodule.exports = ClickWall\n","\"use strict\"\n/**\n * form.js  Generate formulary with ease\n *\n * Differences with ordinary interface:\n *\n * - Form request is sent only if `method=\"get\"` or `method=\"post\"` is\n *   explicitely set.\n * - Form inputs are `required` by default.\n * - Select control is renamed selector (verbs are reserved).\n */\n\nconst Projectable = require(\"@cosmic-plus/jsutils/es5/projectable\")\nconst hiddenKey = require(\"@cosmic-plus/jsutils/es5/misc\").setHiddenProperty\n\nconst bindDomKey = require(\"./bind-dom-key\")\nconst handleExtraAttributes = require(\"./handle-extra-attributes\")\nconst html = require(\"./html-extra\")\n\n/**\n * Definition\n */\n\nclass Form extends Projectable {\n  /**\n   * Two forms:\n   *\n   * * new Form($form, attributes)\n   * * new Form([attributes], ...childs)\n   */\n  constructor (...params) {\n    super()\n\n    // Import or create the form DOM node.\n    if (params.length && params[0].tagName === \"FORM\") {\n      hiddenKey(this, \"domNode\", params[0])\n      if (params[1]) Object.assign(this.domNode, params[1])\n    } else {\n      hiddenKey(this, \"domNode\", html.element(\"form\", ...params))\n    }\n\n    // Validation - request is sent only if a method is explicitely set.\n    this.domNode.addEventListener(\"submit\", () => {\n      const method = this.domNode.getAttribute(\"method\")\n      if (!method) event.preventDefault()\n      this.trigger(\"submit\")\n    })\n\n    // Bind values\n    Form.bindInputs(this, this.domNode)\n    hiddenKey(this, \"dom\", handleExtraAttributes(this.domNode))\n\n    // Add message box if none exists.\n    if (!this.dom.status) {\n      this.dom.status = [Form.status()]\n      html.append(this.domNode, this.dom.status[0])\n    }\n  }\n\n  /**\n   * Controls\n   */\n\n  submit () {\n    this.domNode.submit()\n  }\n\n  reset () {\n    this.domNode.reset()\n  }\n\n  /**\n   * Status Display\n   */\n\n  report (type, ...content) {\n    const $status = this.dom.status[0]\n    if ($status) {\n      $status.className = type\n      html.rewrite($status, ...content)\n    }\n  }\n\n  info (content) {\n    this.report(\"info\", content, Form.spinner())\n  }\n\n  error (content) {\n    // Extract message from Error object. (TODO: handle it in html)\n    this.report(\"error\", content.message || content)\n    if (content instanceof Error) throw content\n    else throw new Error(content)\n  }\n}\n\n// Automatically clean report on user input.\nForm.listen(\"change\", (event) => event.report(null))\n\n/**\n * Binding\n */\n\nForm.bindInputs = function (object, $node) {\n  html.walk($node, binder, object)\n}\n\nfunction binder ($node, object) {\n  if ($node.name) bindDomKey(object, $node.name, $node)\n}\n\n/**\n * Helpers (Actions)\n */\n\nForm.enable = function (element, attributes) {\n  element.disabled = false\n  Object.assign(element, attributes)\n}\n\nForm.disable = function (element, attributes) {\n  element.enabled = true\n  Object.assign(element, attributes)\n}\n\nForm.hide = html.hide\nForm.show = html.show\n\n/**\n * Elements\n */\n\nForm.element = html.element\n\nForm.status = function (message = \"\") {\n  return Form.element(\"p\", { alias: \"status\" }, message)\n}\n\nForm.spinner = function () {\n  return Form.element(\"span\", { className: \"spinner\" })\n}\n\nForm.label = function (...params) {\n  return Form.element(\"label\", ...params)\n}\n\nForm.button = function (params, ...childs) {\n  if (!childs.length) childs = [params.value]\n  return Form.element(\"button\", params, ...childs)\n}\n\nForm.control = function (tag, params) {\n  const defaults = { required: true }\n  const attributes = Object.assign(defaults, params)\n  return Form.element(tag, attributes)\n}\n\nForm.textarea = function (params) {\n  return Form.control(\"textarea\", params)\n}\n\nForm.selector = function (params) {\n  const selector = Form.control(\"select\", params)\n  if (selector.values) {\n    html.append(selector, ...makeOptions(selector.values))\n  }\n  if (selector.placeholder) {\n    const placeholder = html.element(\n      \"option\",\n      { value: \"\", disabled: true, selected: true, hidden: true },\n      selector.placeholder\n    )\n    html.unshift(selector, placeholder)\n    if (params.selectedIndex != null) params.selectedIndex++\n  }\n\n  if (params.selectedIndex) selector.selectedIndex = params.selectedIndex\n  else if (params.value) selector.value = params.value\n\n  return selector\n}\n\nForm.input = function (type, params = {}) {\n  const input = Form.control(\"input\", params)\n  input.type = type\n  return input\n}\n\n// Exclude: button, datetime-local, reset, submit, select, search (no verbs)\nconst inputTypes = [\n  \"checkbox\",\n  \"color\",\n  \"date\",\n  \"email\",\n  \"file\",\n  \"hidden\",\n  \"image\",\n  \"month\",\n  \"number\",\n  \"password\",\n  \"radio\",\n  \"range\",\n  \"tel\",\n  \"text\",\n  \"time\",\n  \"url\",\n  \"week\"\n]\n\ninputTypes.forEach(\n  (type) => Form[type] = (params) => Form.input(type, params)\n)\nForm.datetime = (params) => Form.input(\"datetime-local\", params)\n\n/**\n * Elements Helpers\n */\n\nfunction makeOptions (object) {\n  if (object instanceof Array) {\n    return object.map((value) => {\n      return html.element(\"option\", { value }, value)\n    })\n  } else {\n    return Object.keys(object).map((value) => {\n      return html.element(\"option\", { value }, object[value])\n    })\n  }\n}\n\n/**\n * Export\n */\n\nmodule.exports = Form\n","\"use strict\"\n/**\n * Additional methods for html.\n */\nconst html = Object.create(require(\"@cosmic-plus/domutils/es5/html\"))\nmodule.exports = html\n\n/**\n * Creates an new HTML element.\n */\nhtml.element = function (tag, ...params) {\n  let attributes\n  if (\n    params[0]\n    && params[0].constructor === Object\n    && params[0].domNode === undefined\n  ) {\n    attributes = params.shift()\n  }\n\n  return html.create(tag, attributes, ...params)\n}\n\n/**\n * Walks **element** dom tree, applying **func** to each node.\n */\nhtml.walk = function (element, func, ...params) {\n  func(element, ...params)\n  element.childNodes.forEach((child) => html.walk(child, func, ...params))\n}\n\n/**\n * Add **...children** as first **parent** children.\n */\nhtml.unshift = function (parent, ...children) {\n  for (let i = 0; i < children.length; i++) {\n    parent.insertBefore(children[i], parent.childNodes[i])\n  }\n}\n","\"use strict\"\n/**\n * Dialog\n */\nconst Gui = require(\"@cosmic-plus/domutils/es5/gui\")\nconst html = require(\"@cosmic-plus/domutils/es5/html\")\nconst { __ } = require(\"@cosmic-plus/i18n\")\n\nconst Modal = require(\"./modal\")\n\n/**\n * Definition\n */\n\nclass Dialog extends Gui {\n  constructor (params = {}) {\n    const { title, content, actions } = params\n\n    super(`\n<form class=\"Dialog\" onsubmit=\"return false\">\n\n  <h3>%title</h3>\n\n  <hr hidden=%hasNoTitle>\n\n  %content\n\n  <hr hidden=%hasNoContent>\n\n  <div class=\"Actions\">\n    %toButton:actions...\n  </div>\n</form>\n    `)\n\n    this.title = title\n    this.content = typeof params === \"string\" ? params : content\n    this.actions = actions\n\n    this.hasNoTitle = !this.title\n    this.hasNoContent = !this.content\n  }\n\n  toButton ([name, onclick, type = \"button\"]) {\n    return html.create(\"button\", { type, onclick: onclick.bind(this) }, name)\n  }\n}\n\n/**\n * Utilities\n */\n\nDialog.alert = function (params = {}) {\n  const dialog = new Dialog(params)\n  const modal = new Modal({ content: dialog })\n  dialog.actions = [[__(\"OK\"), () => modal.close()]]\n\n  modal.open()\n  return new Promise((resolve) => modal.listen(\"close\", resolve))\n}\n\nDialog.confirm = function (params = {}) {\n  const dialog = new Dialog(params)\n  const modal = new Modal({ content: dialog })\n\n  const promise = new Promise((resolve) => {\n    modal.listen(\"close\", () => resolve(false))\n    dialog.actions = [\n      [__(\"OK\"), () => resolve(true), \"submit\"],\n      [__(\"Cancel\"), () => resolve(false)]\n    ]\n  })\n  promise.finally(() => modal.close())\n\n  modal.open()\n  const el = dialog.domNode.querySelector(\"[autofocus]\")\n  if (el) el.focus()\n\n  return promise\n}\n\n/**\n * Export\n */\nmodule.exports = Dialog\n","\"use strict\"\n/**\n * Compute portfolio data from Account object.\n */\nconst axios = require(\"@cosmic-plus/base/es5/axios\")\nconst cosmicLib = require(\"cosmic-lib\")\nconst Mirrorable = require(\"@cosmic-plus/jsutils/es5/mirrorable\")\nconst Projectable = require(\"@cosmic-plus/jsutils/es5/projectable\")\nconst { timeout } = require(\"@cosmic-plus/jsutils/es5/misc\")\nconst { __ } = require(\"@cosmic-plus/i18n\")\n\nconst Asset = require(\"./asset\")\nconst Balance = require(\"./balance\")\nconst global = require(\"./global\")\nconst Offers = require(\"./offers\")\n\nconst portfolioHistoricValue = require(\"./portfolio-historic-value\")\n\nconst {\n  arrayContains,\n  arrayRemove,\n  arraySum,\n  arrayOnlyInFirst\n} = require(\"../helpers/misc\")\n/**\n * Class\n */\n\nclass Portfolio extends Projectable {\n  static async resolve (address) {\n    await checkNetwork()\n\n    const destination = await cosmicLib.resolve.address(address)\n    if (destination.memo)\n      throw new Error(__(\"Invalid federated address: shared account.\"))\n    if (await cosmicLib.resolve.isAccountEmpty(destination.account_id))\n      throw new Error(__(\"Empty account\"))\n\n    const portfolio = new Portfolio(destination.account_id)\n    cosmicLib.config.source = portfolio.address = address\n    portfolio.streamAccount()\n\n    return portfolio\n  }\n\n  constructor (accountId) {\n    super()\n\n    // eslint-disable-next-line no-console\n    console.log(this)\n\n    this.accountId = accountId\n    this.assets = new Mirrorable()\n    this.balances = new Mirrorable()\n    this.accountCallBuilder = Portfolio.accountCallBuilder(accountId)\n\n    this.define(\"total\", \"assets\", () => {\n      const assets = this.assets.filter((asset) => asset.isSupported)\n      return arraySum(assets, \"value\")\n    })\n    this.assets.mirror((asset) =>\n      this.watch(asset, [\"value\", \"isSupported\"], () => this.compute(\"total\"))\n    )\n\n    this.new = true\n  }\n\n  static accountCallBuilder (accountId) {\n    const server = cosmicLib.resolve.server()\n    return server.accounts().accountId(accountId)\n  }\n\n  async streamAccount () {\n    // eslint-disable-next-line no-constant-condition\n    while (true) {\n      await this.getAccount()\n      await timeout(5000)\n    }\n  }\n\n  async getAccount () {\n    try {\n      const account = await this.accountCallBuilder.call()\n      this.ingest(account)\n    } catch (error) {\n      console.error(error)\n    }\n  }\n\n  async ingest (account) {\n    this.account = account\n\n    for (let index in account.balances) {\n      const balance = Balance.ingest(account.balances[index])\n      this.maybeAddBalance(balance)\n\n      if (balance.id === \"XLM\") {\n        balance.asset.amountMin = Portfolio.accountMinimumBalance(account)\n      }\n    }\n\n    if (this.new) {\n      delete this.new\n      await Asset.refreshPrices()\n      this.offers = Offers.forPortfolio(this)\n      await this.offers.stream()\n      this.trigger(\"open\")\n      Asset.getAllInfo()\n    }\n  }\n\n  maybeAddBalance (balance) {\n    if (!arrayContains(this.balances, balance)) {\n      this.balances.push(balance)\n      balance.asset.maybeAddBalance(balance)\n    }\n    this.maybeAddAsset(balance.asset)\n  }\n\n  maybeAddAsset (asset) {\n    if (arrayContains(this.assets, asset)) return\n\n    this.assets.push(asset)\n    asset.watch(this, \"total\", () => asset.compute(\"share\"))\n    asset.getInfo()\n  }\n\n  maybeRemoveBalance (balance) {\n    arrayRemove(this.balances, balance)\n    balance.asset.maybeRemoveBalance(balance)\n    this.maybeRemoveAsset(balance.asset)\n  }\n\n  maybeRemoveAsset (asset) {\n    if (asset.balances.length) return\n    // TODO: unwatch\n    arrayRemove(this.assets, asset)\n  }\n}\n\n/**\n * Utilities\n */\n\n/**\n * Returns the minimum XLM balance for an account. It includes the mandatory\n * network reserve, the required amount to support 1 open offer for each\n * trustline, and an additional 0.5 Lumens to cover for fees & algorithm\n * rounding issues.\n */\nPortfolio.accountMinimumBalance = function (account) {\n  const baseReserve = 0.5\n\n  let entries = (account.balances.length - 1) * 2 // Reserve an offer entry\n  entries += Object.keys(account.data_attr).length\n  entries += account.signers.length - 1\n\n  return (3 + entries) * baseReserve\n}\n\n/**\n * List known assets for which account doesn't have any trustline.\n */\nPortfolio.prototype.availableAssets = function () {\n  const allAssets = Object.values(Asset.table)\n  return arrayOnlyInFirst(allAssets, this.assets)\n}\n\n/**\n * Download & compute portfolio history.\n */\nPortfolio.prototype.getHistory = async function () {\n  if (!this.history) this.history = await portfolioHistoricValue(this)\n  return this.history\n}\n\n/**\n * Extension\n */\n\nAsset.define(\"share\", \"value\", function () {\n  return global.portfolio && this.value / global.portfolio.total\n})\n\n/**\n * Helpers\n */\n\nasync function checkNetwork () {\n  const horizon = cosmicLib.resolve.horizon()\n  try {\n    await axios.get(horizon)\n  } catch (error) {\n    throw new Error(__(\"Can't connect to the Stellar blockchain\"))\n  }\n}\n\n/**\n * Export\n */\nmodule.exports = Portfolio\n","\"use strict\"\n/**\n * Markets statistics & data\n *\n * @exports marketData\n */\nconst marketData = exports\n\nconst axios = require(\"@cosmic-plus/base/es5/axios\")\nconst nice = require(\"@cosmic-plus/jsutils/es5/nice\")\n\nconst global = require(\"./global\")\nconst History = require(\"./history\")\n\n/**\n * Generic price/history\n */\n\nmarketData.assetHistory = async function (asset, limit = 1000) {\n  // Remove old prices cache from version <= 0.9.1\n  // REMOVAL: 2020-07 (one year)\n  delete localStorage[`prices.${asset.code}`]\n\n  const cache = History.getCache(asset.id)\n\n  if (cache) {\n    const missing = History.missingDays(cache)\n    if (!missing) return cache\n    if (cache.length) limit = missing + 3\n  }\n\n  const newData = await getPriceHistory(asset, limit)\n  if (!newData) return\n\n  const history = cache ? History.join(cache, newData) : newData\n  History.cut(history, 1000)\n\n  History.setCache(asset.id, history)\n  return history\n}\n\nfunction getPriceHistory (asset, limit) {\n  if (asset.type === \"crypto\") return marketData.crypto.history(asset, limit)\n  else if (asset.type === \"fiat\") return marketData.fiat.history(asset, limit)\n}\n\n/**\n * Crypto price/history by \"https://www.coingecko.com\"\n */\n\nmarketData.crypto = {}\n\nfunction coingeckoCall (page, params) {\n  return axios.get(`https://api.coingecko.com/api/v3/${page}`, { params })\n}\n\nmarketData.crypto.list = async function () {\n  const response = await coingeckoCall(\"coins/list\")\n  const list = {}\n  response.data.forEach((entry) => {\n    const symbol = entry.symbol.toUpperCase()\n    list[symbol] = { apiId: entry.id, name: entry.name }\n  })\n  return list\n}\n\nmarketData.crypto.stellarNative = async function () {\n  const response = await coingeckoCall(\"exchanges/stellar_term\")\n  return response.data.tickers.map((x) => x.coin_id).filter((x) => x)\n}\n\nmarketData.crypto.info = async function (asset) {\n  const response = await coingeckoCall(`coins/${asset.apiId}`, {\n    localization: false,\n    tickers: false,\n    market_data: false,\n    community_data: false,\n    developer_data: false,\n    sparkline: false\n  })\n  return response.data\n}\n\nmarketData.crypto.prices = async function (assets) {\n  const ids = assets.map((asset) => asset.apiId).join(\",\")\n  const quote = global.currency.toLowerCase()\n  const response = await coingeckoCall(\"simple/price\", {\n    ids,\n    vs_currencies: quote\n  })\n  const prices = {}\n  assets.forEach((asset) => {\n    const assetData = response.data[asset.apiId]\n    if (assetData) prices[asset.code] = assetData[quote]\n  })\n  return prices\n}\n\nmarketData.crypto.history = async function (asset, limit = 1000) {\n  const response = await coingeckoCall(`coins/${asset.apiId}/market_chart`, {\n    vs_currency: global.currency,\n    days: Math.max(limit, 100)\n  })\n\n  const data = response.data.prices.map((record, index) => {\n    return {\n      time: record[0],\n      price: record[1],\n      // volume: response.data.total_volumes[index][1]\n      volume: +nice(response.data.total_volumes[index][1] / record[1])\n    }\n  })\n\n  // Work around end of serie inconsistencies.\n  const today = History.today()\n  const twoEntriesBefore = data[data.length - 2]\n  if (twoEntriesBefore && twoEntriesBefore.time === today) {\n    data.length = data.length - 1\n  } else {\n    History.latest(data).time = today\n  }\n\n  if (limit < 100) History.cut(data, limit)\n  return data\n}\n\n/**\n * Fiat prices / history by \"https://exchangeratesapi.io\"\n */\n\nmarketData.fiat = {}\n\nasync function exchangeratesCall (page, symbols, params = {}) {\n  params.base = global.currency\n  if (typeof symbols === \"string\") {\n    params.symbols = symbols\n  } else {\n    if (global.currency === \"EUR\") symbols = symbols.filter((x) => x !== \"EUR\")\n    params.symbols = symbols.join(\",\")\n  }\n\n  return axios\n    .get(`https://api.exchangerate.host/${page}`, { params })\n    .then((response) => {\n      if (global.currency === \"EUR\" && !response.data.start_at) {\n        response.data.rates.EUR = 1\n      }\n      return response\n    })\n}\n\nmarketData.fiat.prices = async function (assets) {\n  const symbols = assets.map((asset) => asset.code)\n  const response = await exchangeratesCall(\"latest\", symbols)\n  const data = response.data.rates\n  for (let symbol in data) {\n    data[symbol] = nice(1 / data[symbol], 8)\n  }\n  return data\n}\n\nmarketData.fiat.history = async function (asset, limit = 1000) {\n  const end_at = new Date().toISOString().slice(0, 10)\n  const today = new Date(end_at)\n  today.setDate(today.getDate() - limit)\n  const start_at = today.toISOString().slice(0, 10)\n\n  // Exchangeratesapi doesn't returns EUR/EUR rate.\n  if (global.currency === \"EUR\" && asset.id === \"EUR\") {\n    return [{ time: History.today(), price: 1 }]\n  }\n\n  // Get history.\n  const response = await exchangeratesCall(\"history\", asset.code, {\n    start_at,\n    end_at\n  })\n\n  // Format data.\n  const data = Object.keys(response.data.rates)\n    .sort()\n    .map((date) => {\n      return {\n        time: History.time(date),\n        price: +nice(1 / response.data.rates[date][asset.code], 8)\n      }\n    })\n\n  // Add today's entry.\n  if (History.latest(data).time !== History.today()) {\n    data.push({\n      time: History.today(),\n      price: History.latest(data).price\n    })\n  }\n\n  return data\n}\n","\"use strict\"\n/**\n * Account offers\n */\n\nconst cosmicLib = require(\"cosmic-lib\")\nconst loopcall = require(\"@cosmic-plus/loopcall\")\nconst Mirrorable = require(\"@cosmic-plus/jsutils/es5/mirrorable\")\nconst Projectable = require(\"@cosmic-plus/jsutils/es5/projectable\")\nconst hiddenKey = require(\"@cosmic-plus/jsutils/es5/misc\").setHiddenProperty\nconst { day } = require(\"@cosmic-plus/jsutils/es5/misc\")\n\nconst Asset = require(\"./asset\")\nconst Balance = require(\"./balance\")\n\nconst { fixed7 } = require(\"../helpers/misc\")\n\n/**\n * Definition: Offers (collection)\n */\n\nclass Offers extends Mirrorable {\n  static forPortfolio (portfolio) {\n    const offers = Offers.forAccount(portfolio.accountId)\n    hiddenKey(offers, \"portfolio\", portfolio)\n    return offers\n  }\n\n  static forAccount (accountId) {\n    const offers = new Offers()\n    hiddenKey(offers, \"accountId\", accountId)\n    hiddenKey(offers, \"callBuilder\", Offers.callBuilder(accountId))\n    return offers\n  }\n\n  static callBuilder (accountId) {\n    const server = cosmicLib.resolve.server()\n    return server.offers().forAccount(accountId)\n  }\n\n  async stream (delay = 15000) {\n    // Resolves after first get().\n    return this.get().then(() => setTimeout(() => this.stream(), delay))\n  }\n\n  async get () {\n    try {\n      const records = await loopcall(this.callBuilder, { limit: 200 })\n      this.ingest(records)\n    } catch (error) {\n      console.error(error)\n    }\n  }\n\n  ingest (records) {\n    this.forEach((offer) => offer.alive = false)\n    const offers = records\n      .map((record) => Offer.ingest(record))\n      .filter((x) => x)\n    this.splice(0, 0, ...offers)\n    this.clean()\n  }\n\n  clean () {\n    for (let index = this.length - 1; index > -1; index--) {\n      const offer = this[index]\n      if (!offer.alive) {\n        this.splice(index, 1)\n        offer.destroy()\n      }\n    }\n  }\n}\n\n/**\n * Utilities\n */\n\nOffers.prototype.listOutdated = function () {\n  return this.filter((offer) => offer.outdated)\n}\n\n/**\n * Definition: Offer (one)\n */\n\nclass Offer extends Projectable {\n  static resolve (record) {\n    return Offer.table[recordToId(record)]\n  }\n\n  static ingest (record) {\n    const offer = Offer.resolve(record)\n    if (offer) offer.update(record)\n    else return new Offer(record)\n  }\n\n  constructor (record) {\n    super()\n\n    this.intern = recordToId(record)\n    Offer.table[this.intern] = this\n\n    const quote = Asset.resolve(\"XLM\")\n    const asset = record.buying.asset_code ? record.buying : record.selling\n    this.balance = Balance.resolve(asset.asset_code, asset.asset_issuer)\n    this.asset = this.balance.asset\n    this.side = record.buying.asset_code ? \"buy\" : \"sell\"\n\n    this.define(\n      \"price\",\n      \"rawPrice\",\n      this.side === \"sell\"\n        ? () => quote.price * this.rawPrice\n        : () => quote.price / this.rawPrice\n    )\n    this.watch(quote, \"price\", () => this.compute(\"price\"))\n\n    this.update(record)\n\n    this.balance.offers.push(this)\n    this.asset.offers.push(this)\n\n    this.listen(\"destroy\", () => {\n      delete Offer.table[this.intern]\n      this.balance.offers.splice(this.balance.offers.indexOf(this), 1)\n      this.asset.offers.splice(this.asset.offers.indexOf(this), 1)\n    })\n  }\n\n  update (record) {\n    Object.assign(this, record)\n    this.alive = true\n\n    this.rawPrice = record.price\n    this.compute(\"price\")\n    this.rawAmount = record.amount\n    if (this.side === \"buy\") {\n      this.amount = fixed7(this.rawAmount * this.rawPrice)\n    }\n\n    this.date = day(this.last_modified_time)\n    this.outdated = this.date !== day()\n  }\n}\n\nOffer.table = {}\n\n/**\n * Helpers\n */\n\nfunction recordToId (record) {\n  return `${record.id}-${record.last_modified_ledger}`\n}\n\n/**\n * Export\n */\n\nmodule.exports = Offers\n","\"use strict\"\n/**\n * Compute Historic Value from historic balances\n */\nconst Asset = require(\"./asset\")\nconst portfolioHistoricBalances = require(\"./portfolio-historic-balances\")\nconst { arraySum } = require(\"../helpers/misc\")\n\n/**\n * Function\n */\n\nmodule.exports = async function portfolioHistoricValue (portfolio) {\n  const history = await portfolioHistoricBalances(portfolio)\n  const assets = markHeldAssets(history)\n  const historicPrices = await getHistoricPrices(assets)\n\n  history.forEach((day) => {\n    shrinkHistoricPrices(day.time, historicPrices)\n    computeDayValues(day, historicPrices)\n  })\n\n  // eslint-disable-next-line no-console\n  console.log(history)\n  return history\n}\n\nfunction markHeldAssets (history) {\n  const ids = {}\n  history.forEach((day) => {\n    Object.keys(day.asset).forEach((key) => ids[key] = true)\n  })\n\n  const assets = Object.keys(ids).map(Asset.resolve)\n  assets.forEach((asset) => asset.hasBeenHeld = true)\n  return assets\n}\n\n/**\n * Returns an object containing the historic price of each **asset**.\n */\nasync function getHistoricPrices (assets) {\n  const historicPrices = {}\n\n  const promises = assets.map((asset) => asset.getHistoricPrice())\n  await Promise.all(promises)\n\n  assets.forEach((asset) => {\n    if (asset.historicPrice) historicPrices[asset.id] = asset.historicPrice\n  })\n\n  return historicPrices\n}\n\n/**\n * Remove oldest prices from **historicPrices** until the first element of each\n * serie is the price just before **time**.\n */\nfunction shrinkHistoricPrices (time, historicPrices) {\n  for (let asset in historicPrices) {\n    const prices = historicPrices[asset]\n    const index = prices.findIndex((entry) => entry.time > time)\n    if (index > 1) historicPrices[asset] = prices.slice(index - 1)\n    else if (index === -1) historicPrices[asset] = prices.slice(-1)\n  }\n}\n\n/**\n * Computes `price` & `value` fields for portfolio history using\n * **historicPrices**.\n */\nfunction computeDayValues (day, historicPrices) {\n  day.price = {}\n  day.value = {}\n  day.total = 0\n\n  // Compute each asset value at `day.time` as well as the portfolio total.\n  for (let asset in day.asset) {\n    day.price[asset] = historicPrices[asset]\n      ? historicPrices[asset][0].price\n      : 0\n    day.value[asset] = day.asset[asset] * day.price[asset]\n    day.total += day.value[asset]\n  }\n\n  // Filter data for display in chart.\n  day.filtered = {}\n  const marginals = []\n\n  for (let asset in day.value) {\n    const share = day.value[asset] / day.total\n    if (share) {\n      day.filtered[asset] = day.value[asset]\n      if (share < 0.03) marginals.push(asset)\n    }\n  }\n\n  if (marginals.length > 1) {\n    day.filtered.others = arraySum(marginals.map((asset) => day.value[asset]))\n    marginals.forEach((asset) => delete day.filtered[asset])\n  }\n}\n","\"use strict\"\n/**\n * Account Historic Balances\n */\nconst cosmicLib = require(\"cosmic-lib\")\nconst loopcall = require(\"@cosmic-plus/loopcall\")\n\nconst Asset = require(\"./asset\")\nconst Balance = require(\"./balance\")\nconst History = require(\"./history\")\n\nconst { fixed7 } = require(\"../helpers/misc\")\n\n/**\n * Function\n */\n\nmodule.exports = async function portfolioHistoricBalances (\n  portfolio,\n  limit = 1000\n) {\n  const cache = History.getCache(portfolio.account.id)\n\n  if (cache) {\n    const missing = History.missingDays(cache)\n    if (!missing) return cache\n    if (cache.length) limit = missing + 1\n  }\n\n  const newData = await getPortfolioHistory(portfolio, limit)\n  if (!newData) return\n\n  const history = cache ? History.join(cache, newData) : newData\n  History.cut(history, 1000)\n\n  History.setCache(portfolio.account.id, history)\n  return history\n}\n\nasync function getPortfolioHistory (portfolio, limit = 100) {\n  // Start from today...\n  const day = { time: History.today(), asset: {}, balance: {} }\n  portfolio.balances.forEach((balance) => {\n    updateBalance(day, balance, +balance.amount)\n  })\n  const history = [day]\n\n  const loopUntil = Date.now() - History.oneDay * limit\n  await effectsLoopcall(portfolio.accountId, {\n    filter: (record) => ingestRecord(history, record),\n    breaker: () => history[0].time < loopUntil\n  })\n\n  History.cut(history, limit)\n  return history\n}\n\nfunction ingestRecord (history, record) {\n  // ... then go back in time...\n  let day = history[0]\n  const recordDate = History.roundTime(record.created_at) - History.oneDay\n\n  // ... filling each day with previous state...\n  while (recordDate !== day.time) {\n    day = {\n      time: day.time - History.oneDay,\n      asset: Object.assign({}, day.asset),\n      balance: Object.assign({}, day.balance)\n    }\n    if (day.time === STRONGHOLD_SHUTDOWN) applyStrongholdFix(day)\n    history.unshift(day)\n  }\n\n  // ... and mutating that day after recorded effects.\n  const handler = handle[record.type]\n  if (handler) handler(day, record)\n}\n\nfunction effectsLoopcall (accountId, { filter, breaker }) {\n  const server = cosmicLib.resolve.server()\n  const callBuilder = server.effects().forAccount(accountId).order(\"desc\")\n  return loopcall(callBuilder, { filter, breaker })\n}\n\n/**\n * Effect handlers\n */\n\nconst handle = {}\n\nhandle.trade = function (day, record) {\n  const bought = recordToBalance(record, \"bought\")\n  updateBalance(day, bought, -record.bought_amount)\n\n  const sold = recordToBalance(record, \"sold\")\n  updateBalance(day, sold, +record.sold_amount)\n}\n\nhandle.account_credited = function (day, record) {\n  updateBalance(day, recordToBalance(record), -record.amount)\n}\n\nhandle.account_debited = function (day, record) {\n  updateBalance(day, recordToBalance(record), +record.amount)\n}\n\nhandle.trustline_removed = function (day, record) {\n  updateBalance(day, recordToBalance(record), 0)\n}\n\nhandle.trustline_created = function (day, record) {\n  const balance = recordToBalance(record)\n  if (day.balance[balance.id] !== 0) {\n    console.error(\"Balances mismatch: \", day.balance[balance.id], record)\n  }\n  delete day.balance[balance.id]\n\n  const asset = assetForBalance(balance, day)\n  if (day.asset[asset.id] === 0) delete day.asset[asset.id]\n}\n\nhandle.account_created = function (day) {\n  day.balance.XLM = 0\n  day.asset.XLM = 0\n}\n\nfunction updateBalance (day, balance, amount) {\n  updateData(day.balance, balance.id, amount)\n  const asset = assetForBalance(balance, day)\n  updateData(day.asset, asset.id, amount)\n}\n\nfunction updateData (data, id, amount) {\n  if (!data[id]) data[id] = 0\n  data[id] = Math.max(0, fixed7(data[id] + amount))\n}\n\nfunction recordToBalance (record, prefix) {\n  const codeKey = prefix ? `${prefix}_asset_code` : \"asset_code\"\n  const issuerKey = prefix ? `${prefix}_asset_issuer` : \"asset_issuer\"\n\n  if (!record[codeKey]) return Balance.resolve(\"XLM\")\n  else return Balance.resolve(record[codeKey], record[issuerKey])\n}\n\n/**\n * Special cases\n */\n\nconst STRONGHOLD_KEY1 =\n  \"GBSTRH4QOTWNSVA6E4HFERETX4ZLSR3CIUBLK7AXYII277PFJC4BBYOG\"\nconst STRONGHOLD_KEY2 =\n  \"GBSTRUSD7IRX73RQZBL3RQUH6KS3O4NYFY3QCALDLZD77XMZOPWAVTUK\"\nconst STRONGHOLD_SHUTDOWN = 1556582400000\n\n/**\n * Account for Stronhold balances until they redeemed their tether the\n * 2019-04-30.\n */\nfunction applyStrongholdFix (day) {\n  for (let asset in day.asset) {\n    const anchor = asset.substr(-56)\n    if (anchor === STRONGHOLD_KEY1 || anchor === STRONGHOLD_KEY2) {\n      const id = asset.split(\":\")[0]\n      updateData(day.asset, id, day.asset[asset])\n      delete day.asset[asset]\n    }\n  }\n}\n\n/**\n * Return **balance**'s asset at `day.time`, which may not be the same as today\n * as anchors have been shutdown/unpegged in the past.\n */\nfunction assetForBalance (balance, day) {\n  // Optimizations.\n  if (balance.asset.id.length < 60) return balance.asset\n  if (day.time > STRONGHOLD_SHUTDOWN) return balance.asset\n\n  switch (balance.anchor.pubkey) {\n  case STRONGHOLD_KEY1:\n  case STRONGHOLD_KEY2:\n    return Asset.table[balance.code] || balance.asset\n  }\n  return balance.asset\n}\n","\"use strict\"\n\nconst Projectable = require(\"@cosmic-plus/jsutils/es5/projectable\")\n\n/**\n * Bind **$input**'s **nodeKey** to **object** **objKey**. If **nodeKey** is not\n * provided, the default value is used.\n */\nmodule.exports = function bindnodeKey (object, objKey, $input, nodeKey) {\n  const binder = bind[$input.tagName]\n  if (binder) binder(object, objKey, $input, nodeKey)\n  else object[objKey] = $input[nodeKey || \"value\"]\n}\n\n/**\n * Element-specific binders\n */\nconst bind = {}\n\nbind.SELECT = function (object, objKey, $select, nodeKey = \"value\") {\n  object[objKey] = $select[nodeKey]\n  if (bind.SELECT.interactive.indexOf(nodeKey) !== -1) {\n    importKeyOn(\"change\", object, objKey, $select, nodeKey)\n  }\n}\nbind.SELECT.interactive = [\"selectedIndex\", \"selectedOptions\", \"value\"]\n\nbind.TEXTAREA = function (object, objKey, $textarea, nodeKey = \"value\") {\n  object[objKey] = $textarea[nodeKey]\n  if (nodeKey === \"value\") {\n    importKeyOn(\"input\", object, objKey, $textarea, nodeKey)\n  }\n}\n\nbind.INPUT = function (object, objKey, $input, nodeKey) {\n  object[objKey] = $input[nodeKey]\n  if ($input.type === \"radio\") {\n    bind.radio(...arguments)\n  } else if ($input.type === \"checkbox\") {\n    bind.checkbox(...arguments)\n  } else if (!nodeKey || nodeKey === \"value\") {\n    importKeyOn(\"input\", object, objKey, $input, nodeKey || \"value\")\n  }\n}\n\nbind.radio = function (object, objKey, $radio) {\n  const setter = () => {\n    if ($radio.checked) object[objKey] = $radio.value\n  }\n  $radio.addEventListener(\"change\", setter)\n  setter()\n}\n\nbind.checkBox = function (object, objKey, $checkbox, nodeKey = \"checked\") {\n  object[objKey] = $checkbox[nodeKey]\n  if (nodeKey === \"checked\") {\n    importKeyOn(\"change\", object, objKey, $checkbox, nodeKey)\n  }\n}\n\n/**\n * Event setter.\n */\nfunction importKeyOn (eventName, object, objKey, $input, nodeKey) {\n  $input.addEventListener(eventName, () => {\n    object[objKey] = $input[nodeKey]\n    $input.setCustomValidity(\"\")\n  })\n  if (object instanceof Projectable) {\n    object.link(objKey, $input, nodeKey, null, { init: false })\n  }\n}\n","\"use strict\"\n\nconst { timeout } = require(\"@cosmic-plus/jsutils/es5/misc\")\n\nconst html = require(\"./html-extra\")\n\n/**\n * Walk **$node** tree and handle extra attributes for each domNode. Extra\n * attributes are:\n *\n * * alias:  Define an identifier for the local context.\n * * label:  Enclose the node into a dedicated label element.\n */\nmodule.exports = function walkNodeTree ($node) {\n  const aliases = {}\n  html.walk($node, handleExtraAttributes, aliases)\n  return aliases\n}\n\nfunction handleExtraAttributes ($node, aliases) {\n  setAliases($node, aliases)\n  handleLabel($node)\n  handleValidate($node)\n}\n\n/**\n * Bind **$node** to **aliases** properties for to its className, alias, name\n * and/or id.\n */\nfunction setAliases ($node, aliases) {\n  // Ordered by priority\n  if ($node.className) {\n    if (!aliases[$node.className]) aliases[$node.className] = []\n    aliases[$node.className].push($node)\n  } else if ($node.alias) {\n    aliases[$node.alias] = $node\n    delete aliases[$node.alias]\n  } else if ($node.name) {\n    aliases[$node.name] = $node\n  } else if ($node.id) {\n    aliases[$node.id] = $node\n  }\n}\n\n/**\n * Enclose **$node** into its own label if it has a `label=` attribute.\n */\nfunction handleLabel ($node) {\n  // `<option>` tags have a `label` attribute in HTML5.\n  if (!$node.label || $node.tagName === \"OPTION\") return\n\n  const $label = html.element(\"label\", { for: $node })\n  const $span = html.element(\"span\", $node.label)\n  html.replace($node, $label)\n  html.append($label, $span, $node)\n  delete $node.label\n}\n\n/**\n * Setup automatic validation using **$node**'s validate function.\n */\nfunction handleValidate ($node) {\n  const validate = $node.validate\n  if (!validate || !$node.hasProperty(\"oninput\")) return\n\n  $node.addEventListener(\"input\", () => {\n    $node.setCustomValidity(\"\")\n    timeout(0).then(() => validateNodeValue($node, validate))\n  })\n  delete $node.validate\n}\n\nfunction validateNodeValue ($node, validate) {\n  try {\n    validate($node.value)\n  } catch (error) {\n    $node.setCustomValidity(error.message)\n    $node.reportValidity()\n    console.error(error)\n  }\n}\n","\"use strict\"\n/**\n * Activity Gui\n */\n\nconst Gui = require(\"@cosmic-plus/domutils/es5/gui\")\nconst { __ } = require(\"@cosmic-plus/i18n\")\n\nconst ActiveOffersTable = require(\"./widgets/active-offers-table\")\nconst global = require(\"./logic/global\")\n\n/**\n * Class\n */\n\nmodule.exports = class ActivityGui extends Gui {\n  constructor (portfolio) {\n    super(`\n<section class=\"ActivityGui\">\n  <h2>${__(\"Activity\")}</h2>\n\n  %table\n\n  <p class=\"note\">\n    ${__(\"All orders are passed against Stellar Lumens (XLM).\")}\n    ${__(\n    \"For your comfort, prices are displayed in their %%globalCurrency equivalent.\"\n  )}\n    ${__(\n    \"However, those converted values will change according to XLM price movement.\"\n  )}\n  </p>\n\n</section>\n    `)\n\n    this.portfolio = portfolio\n    this.table = new ActiveOffersTable(portfolio)\n    this.globalCurrency = global.currency\n  }\n}\n","\"use strict\"\n/**\n * Active Offers Table\n */\nconst Gui = require(\"@cosmic-plus/domutils/es5/gui\")\nconst nice = require(\"@cosmic-plus/jsutils/es5/nice\")\nconst { CosmicLink } = require(\"cosmic-lib\")\nconst { __ } = require(\"@cosmic-plus/i18n\")\n\nconst global = require(\"../logic/global\")\n\nmodule.exports = class ActiveOffersTable extends Gui {\n  constructor (portfolio) {\n    super(`\n<section class=\"ActiveOffersTable\">\n  <table>\n    <tr>\n      <th class=\"name\">${__(\"Name\")}</th>\n      <th align=\"left\">${__(\"Anchor\")}</th>\n      <th align=\"left\">${__(\"Direction\")}</th>\n      <th align=\"right\">${__(\"Amount\")}</th>\n      <th align=\"right\">${__(\"Price\")} (%globalCurrency)</th>\n    </tr>\n    %toOfferRow:offers...\n    <tr><td colspan=\"5\" align=\"center\" onclick=%cancelOffers>\n      <h3>${__(\"Cancel All\")}</h3>\n    </td></tr>\n  </table>\n</section>\n    `)\n\n    this.portfolio = portfolio\n    this.offers = portfolio.offers\n    this.globalCurrency = global.currency\n  }\n\n  toOfferRow (offer) {\n    return new OfferRow(offer)\n  }\n\n  cancelOffers () {\n    if (!this.offers.length) return\n\n    const txParams = {\n      memo: \"Equilibre.io\",\n      network: \"public\",\n      maxTime: \"+5\",\n      source: this.portfolio.accountId\n    }\n\n    const cosmicLink = new CosmicLink(txParams)\n    this.offers.forEach((offer) => {\n      cosmicLink.addOperation(\"manageOffer\", { offerId: offer.id, amount: 0 })\n    })\n\n    const sideFrame = cosmicLink.open()\n    sideFrame.listen(\"destroy\", () => {\n      this.portfolio.getAccount()\n      this.portfolio.offers.get()\n    })\n  }\n}\n\nclass OfferRow extends Gui {\n  constructor (offer) {\n    super(`\n<tr>\n  <td>\n    <img src=%image alt=\"\">\n    <span>%name</span>\n  </td>\n  <td>%anchor</td>\n  <td>%side</td>\n  <td align=\"right\">%nice:amount</td>\n  <td align=\"right\">%nice:price</td>\n</tr>\n    `)\n\n    this.offer = offer\n    offer.project([\"amount\", \"price\"], this)\n\n    this.name = offer.balance.code\n    this.side = offer.side === \"buy\" ? __(\"Buy\") : __(\"Sell\")\n    this.anchor = offer.balance.anchor.name\n    offer.asset.link(\"image\", this)\n  }\n\n  nice (number) {\n    return nice(number)\n  }\n}\n","\"use strict\"\n/**\n * Portfolio Graphical User Interface\n */\nconst Gui = require(\"@cosmic-plus/domutils/es5/gui\")\nconst nice = require(\"@cosmic-plus/jsutils/es5/nice\")\nconst Tabs = require(\"@cosmic-plus/domutils/es5/tabs\")\nconst { __ } = require(\"@cosmic-plus/i18n\")\n\nconst AssetPriceChart = require(\"./widgets/asset-price-chart\")\nconst PortfolioPieChart = require(\"./widgets/portfolio-pie-chart\")\nconst PortfolioHistoricValueChart = require(\"./widgets/portfolio-historic-value-chart\")\nconst PortfolioTable = require(\"./widgets/portfolio-table\")\n\nconst global = require(\"./logic/global\")\n\n/**\n * Class\n */\n\nmodule.exports = class PortfolioGui extends Gui {\n  constructor (portfolio) {\n    super(`\n<section><h2>${__(\"Portfolio\")}: %total %currency</h2>\n\n  %nav\n  <section>%view</section>\n\n  %priceChart\n\n  <p class=\"note\">\n    ${__(\"Anchor prices are from Stellar DEX\")} /\n    ${__(\"Global prices are from %%coingecko when available.\")}\n  </p>\n\n</section>`)\n\n    this.portfolio = portfolio\n\n    // Init.\n    portfolio.project(\"total\", this, (x) => nice(x, 2))\n    this.currency = global.currency\n    this.coingecko = new Gui(\n      `<a target=\"_blank\" rel=\"noopener\" href=\"https://coingecko.com\">coingecko</a>`\n    )\n\n    // Bind components together.\n    this.table = new PortfolioTable(portfolio)\n    this.project(\"selected\", this.table)\n    this.table.project(\"selected\", this)\n\n    this.pieChart = new PortfolioPieChart(portfolio)\n    this.project(\"selected\", this.pieChart)\n    this.pieChart.project(\"selected\", this)\n\n    this.trap(\"selected\", () => this.maybeDrawPriceChart())\n\n    // Create history chart.\n    this.historyChart = new PortfolioHistoricValueChart(portfolio)\n\n    // Create overview.\n    const overview = this.overview = new Tabs()\n    overview.add(\"table\", __(\"Balances\"), this.table)\n    overview.add(\"chart\", __(\"Repartition\"), this.pieChart)\n    overview.add(\"history\", __(\"History\"), this.historyChart)\n\n    overview.project([\"nav\", \"view\"], this)\n    overview.listen(\"select\", () => this.reflow())\n\n    // Save & load last selected tab.\n    overview.listen(\n      \"select\",\n      (id) => localStorage[\"PortfolioSummary.tab\"] = id\n    )\n    overview.select(localStorage[\"PortfolioSummary.tab\"])\n    if (!overview.selected) overview.select(\"table\")\n  }\n\n  reflow () {\n    if (!this.overview.selected) return\n    const content = this.overview.selected.content\n    if (content.reflow) content.reflow()\n  }\n\n  maybeDrawPriceChart () {\n    if (this.priceChart) this.priceChart.destroy()\n\n    const asset = this.selected\n    const assetHasChart = asset && (asset.isTether || asset.apiId)\n\n    if (assetHasChart && asset.code !== global.currency) {\n      this.priceChart = new AssetPriceChart(asset)\n    } else {\n      this.priceChart = null\n    }\n  }\n}\n","\"use strict\"\n/**\n * Asset Price Chart\n */\nconst Highstock = require(\"highcharts/highstock\")\nrequire(\"./helpers/highstock-theme\")\n\nconst Gui = require(\"@cosmic-plus/domutils/es5/gui\")\nconst nice = require(\"@cosmic-plus/jsutils/es5/nice\")\nconst { __ } = require(\"@cosmic-plus/i18n\")\n\nconst global = require(\"../logic/global\")\n\n/**\n * Class\n */\n\nmodule.exports = class AssetPriceChart extends Gui {\n  constructor (asset) {\n    super(`\n      <section><h3>${asset.code} ${__(\"to\")} ${global.currency}</h3>\n        <div -ref=%container><p>${__(\"Loading...\")}</p></div>\n      </section>\n    `)\n\n    this.asset = asset\n\n    asset.getHistoricPrice().then((data) => this.drawChart(data))\n    this.listen(\"destroy\", () => this.chart && this.chart.destroy())\n  }\n\n  drawChart (data) {\n    this.chart = Highstock.stockChart(this.container, {\n      yAxis: [\n        { labels: { align: \"left\" }, height: \"80%\", resize: { enabled: true } },\n        { labels: { align: \"left\" }, top: \"80%\", height: \"20%\", offset: 0 }\n      ],\n      series: [\n        {\n          type: \"spline\",\n          name: \"Price\",\n          data: data.map((x) => [x.time, +nice(x.price)])\n        },\n        {\n          type: \"column\",\n          name: \"Volume\",\n          data: data.map((x) => [x.time, x.volume]),\n          yAxis: 1\n        }\n      ]\n    })\n  }\n}\n","\"use strict\"\n/**\n * Portfolio Pie Chart\n */\nconst Highstock = require(\"highcharts/highstock\")\nrequire(\"./helpers/highstock-theme\")\n\nconst Gui = require(\"@cosmic-plus/domutils/es5/gui\")\nconst nice = require(\"@cosmic-plus/jsutils/es5/nice\")\nconst { __ } = require(\"@cosmic-plus/i18n\")\n\nconst global = require(\"../logic/global\")\n\n/**\n * Class\n */\n\nmodule.exports = class PortfolioPieChart extends Gui {\n  constructor (portfolio) {\n    super(`\n<div class=\"PortfolioPieChart\">\n  <h3>${__(\"Repartition by Asset\")}</h3>\n\n  <div -ref=%container align=\"center\"></div>\n</div>\n    `)\n    this.portfolio = portfolio\n\n    this.watch(this.portfolio, \"total\", () => this.draw())\n    this.listen(\"destroy\", () => this.chart && this.chart.destroy())\n  }\n\n  reflow () {\n    if (this.chart) this.chart.reflow()\n  }\n\n  draw () {\n    if (this.chart) this.chart.destroy()\n\n    this.chart = Highstock.chart(this.container, {\n      colors: Highstock.pieColors,\n      responsive: Highstock.pieResponsive,\n\n      title: \"\",\n      legend: { enabled: false },\n      chart: { type: \"pie\" },\n      tooltip: {\n        pointFormat: `\n${__(\"Amount\")}: {point.niceAmount} {point.code}<br>\n${__(\"Price\")}: {point.nicePrice} ${global.currency}<br>\n<b>${__(\"Value\")}: {point.y} ${global.currency}</b>\n`\n      },\n\n      plotOptions: {\n        pie: {\n          dataLabels: {\n            format:\n              \"{point.niceAmount} {point.code}<br>({point.percentage:.0f}%)\"\n          },\n          point: {\n            events: {\n              select: (x) => this.selected = x.target.options.asset,\n              legendItemClick: () => false\n            }\n          }\n        }\n      },\n\n      series: [\n        {\n          name: __(\"Amount\"),\n          colorByPoint: true,\n          ignoreHiddenPoint: true,\n          data: this.portfolio.assets\n            .filter((asset) => asset.value)\n            .map(makePoint)\n            .sort((a, b) => b.y - a.y)\n        }\n      ]\n    })\n  }\n}\n\n/**\n * Helpers\n */\n\nfunction makePoint (asset) {\n  const point = Object.create(asset)\n  point.y = +nice(asset.value, 2)\n  point.niceAmount = +nice(asset.amount)\n  point.nicePrice = +nice(asset.price)\n  return point\n}\n","\"use strict\"\n/**\n * Portfolio Historic Value Chart\n */\nconst Highstock = require(\"highcharts/highstock\")\nrequire(\"./helpers/highstock-theme\")\n\nconst Gui = require(\"@cosmic-plus/domutils/es5/gui\")\nconst nice = require(\"@cosmic-plus/jsutils/es5/nice\")\nconst { __ } = require(\"@cosmic-plus/i18n\")\n\nconst Asset = require(\"../logic/asset\")\nconst global = require(\"../logic/global\")\n\n/**\n * Definition\n */\n\nmodule.exports = class PortfolioHistoryChart extends Gui {\n  constructor (portfolio) {\n    super(`\n<div class=\"PortfolioHistoryChart\">\n  <h3>${__(\"Portfolio Historical Value\")}</h3>\n\n  <div -ref=%container>\n    <p>\n      ${__(\"Downloading historical data...\")}\n      <span class=\"spinner\"></span>\n    </p>\n    <p>\n      ${__(\"The very first time, it may take about a minute.\")}\n  </div>\n\n</div>\n    `)\n\n    this.portfolio = portfolio\n    this.portfolio.getHistory().then((history) => this.drawChart(history))\n    this.listen(\"destroy\", () => this.chart && this.chart.destroy())\n  }\n\n  reflow () {\n    if (this.chart) {\n      // Work around a rangeSelector position bug.\n      if (!this.hasBeenReflown) {\n        setTimeout(() =>\n          this.chart.update({ rangeSelector: { enabled: true } })\n        )\n      }\n      this.chart.reflow()\n    }\n    this.hasBeenReflown = true\n  }\n\n  drawChart (history) {\n    const series = this.historyToSeries(history)\n\n    this.chart = Highstock.stockChart(this.container, {\n      chart: { type: \"area\" },\n\n      navigator: {\n        series: {\n          data: history.map((x) => [x.time, +nice(x.total) || null])\n        }\n      },\n\n      tooltip: {\n        shared: true,\n        split: false,\n        pointFormat: `\n<span style=\"color:{point.color}\">\\u25CF</span>\n{series.name}: {point.percentage:.0f}%\n<br>`,\n        footerFormat: `<b>Total: {point.total} ${global.currency}</b>`\n      },\n\n      yAxis: [\n        {\n          labels: {\n            align: \"left\",\n            formatter: function () {\n              return `${this.value} ${global.currency}`\n            }\n          },\n          resize: { enabled: true }\n        }\n      ],\n\n      plotOptions: {\n        series: {},\n        area: {\n          stacking: \"normal\",\n          connectNulls: true,\n          lineWidth: 0,\n          states: {\n            hover: { enabled: false },\n            inactive: { enabled: false }\n          }\n        }\n      },\n\n      series,\n      colors: Highstock.pieColors\n    })\n\n    // Work around a rangeSelector position bug.\n    if (!this.hasBeenReflown) {\n      this.chart.update({ rangeSelector: { enabled: false } })\n    }\n  }\n\n  historyToSeries (history) {\n    const series = []\n\n    const assets = Object.values(Asset.table).filter((a) => a.hasBeenHeld)\n    assets.sort((a, b) => b.value - a.value)\n\n    // Main assets historical values.\n    assets.forEach((asset) => {\n      let isEmpty = true\n      const data = history.map((day) => {\n        const value = +nice(day.filtered[asset.id], 2) || null\n        if (value) isEmpty = false\n        return [day.time, value]\n      })\n      if (!isEmpty) series.push({ name: asset.id, data })\n    })\n\n    // Add merged marginal balances.\n    series.push({\n      name: __(\"Others\"),\n      color: \"#DDD\",\n      data: history.map((x) => [x.time, +nice(x.filtered.others, 2)])\n    })\n\n    return series\n  }\n}\n","\"use strict\"\n/**\n * Portfolio Table\n */\nconst Gui = require(\"@cosmic-plus/domutils/es5/gui\")\nconst html = require(\"@cosmic-plus/domutils/es5/html\")\nconst nice = require(\"@cosmic-plus/jsutils/es5/nice\")\nconst { __ } = require(\"@cosmic-plus/i18n\")\n\n/**\n * Class\n */\nmodule.exports = class PortfolioTable extends Gui {\n  constructor (portfolio) {\n    super(`\n<table class=\"PortfolioTable\">\n  <tr>\n    <th class=\"name\">${__(\"Name\")}</th>\n    <th align=\"left\">${__(\"Anchor\")}</th>\n    <th align=\"right\">${__(\"Amount\")}</th>\n    <th align=\"right\">${__(\"Price\")}</th>\n    <th align=\"right\">${__(\"Value\")}</th>\n  </tr>\n  %rows...\n</table>\n`)\n\n    this.portfolio = portfolio\n    this.rows = portfolio.assets.mirror((asset) => this.toAssetRow(asset))\n    this.watch(portfolio, \"total\", () => this.sort())\n    this.trap(\"selected\", () => this.onselect(this.selected))\n  }\n\n  toAssetRow (asset) {\n    const row = new AssetRow(asset)\n    row.domNode.onclick = () => {\n      if (this.selected === row.asset) this.selected = null\n      else this.selected = row.asset\n    }\n    return row\n  }\n\n  sort () {\n    this.rows.sort((a, b) => b.asset.value - a.asset.value)\n  }\n\n  onselect (asset) {\n    if (this.selectedRow) this.selectedRow.simpleView()\n    this.selectedRow = this.rows.find((row) => row.asset === asset)\n    if (this.selectedRow) this.selectedRow.detailledView()\n  }\n}\n\nclass AssetRow extends Gui {\n  constructor (asset) {\n    super(`\n<tr %class>\n  <td align=\"left\">\n    <img src=%image alt=\"\">\n    <span>%name</span>\n  </td>\n  <td align=\"left\">\n    <div hidden=%simple>%anchors...</div>\n    <div class=%mode>%anchorTotal</div>\n  </td>\n  <td align=\"right\">\n    <div hidden=%simple>%amounts...</div>\n    <div class=%mode>%amountTotal</div>\n  </td>\n  <td align=\"right\">\n    <div hidden=%simple>%prices...</div>\n    <div class=%mode title=%priceDetails>%priceTotal</div>\n  </td>\n  <td align=\"right\">\n    <div hidden=%simple>%values...</div>\n    <div class=%mode>%valueTotal</div>\n  </td>\n</tr>\n    `)\n\n    this.asset = asset\n\n    this.name = asset.code\n    this.anchors = asset.balances.mirror((x) => cell(x.anchor, \"name\"))\n    this.amounts = asset.balances.mirror((x) => cell(x, \"amount\", nice))\n    this.prices = asset.balances.mirror((x) => priceCell(x, \"price\", nice))\n    this.values = asset.balances.mirror((x) =>\n      cell(x, \"value\", (x) => nice(x, 2))\n    )\n    asset.link(\"image\", this)\n    asset.link(\"amount\", this, \"amountTotal\", nice)\n    asset.link(\"price\", this, \"priceTotal\", nice)\n    asset.link(\"value\", this, \"valueTotal\", (x) => nice(x, 2))\n    asset.balances.feed(this, \"anchorHeader\", anchorName)\n\n    const orderbook = this.asset.orderbook\n    this.define(\"priceDetails\", \"orderbook\", () => priceDetails(orderbook))\n    this.watch(orderbook, [\"bestAsk\", \"bestBid\", \"spread%\"], () => {\n      this.compute(\"priceDetails\")\n    })\n\n    this.simpleView()\n  }\n\n  simpleView () {\n    this.simple = true\n    this.class = \"\"\n    this.mode = \"\"\n    this.anchorTotal = this.anchorHeader\n  }\n\n  detailledView () {\n    this.simple = false\n    this.class = \"selected\"\n    this.mode = \"footer\"\n    this.anchorTotal = \"Total\"\n  }\n}\n\n/**\n * Helpers\n */\n\nfunction anchorName (balances) {\n  if (balances.length === 1) return balances[0].anchor.name\n  else return `${__(\"multiple\")} (${balances.length})`\n}\n\nfunction cell (object, key, func) {\n  const node = html.create(\"div\", null, object[key])\n  object.link(key, node, \"textContent\", func)\n  return node\n}\n\nfunction priceCell (object, key, func) {\n  const node = cell(object, \"price\", func)\n  object.trap(\"orderbook\", () => {\n    if (object.orderbook) {\n      object.orderbook.trap([\"bestAsk\", \"bestBid\", \"spread%\"], () => {\n        node.title = priceDetails(object.orderbook)\n      })\n    }\n  })\n  return node\n}\n\nfunction priceDetails (orderbook) {\n  if (orderbook.base.code === \"XLM\") return \"\"\n  return `\nBuy: ${nice(orderbook.bestBid)} \\\n- Sell: ${nice(orderbook.bestAsk)} \\\n- Spread: ${nice(orderbook[\"spread%\"], 2)}%\n  `\n}\n","\"use strict\"\n/**\n * Settings Graphical User Interface\n */\nconst Gui = require(\"@cosmic-plus/domutils/es5/gui\")\nconst { __ } = require(\"@cosmic-plus/i18n\")\n\nconst Form = require(\"./helpers/form\")\nconst global = require(\"./logic/global\")\n\n/**\n * Available translations.\n */\nconst languages = {\n  us: \"English\",\n  fr: \"Franais\"\n}\n\n/**\n * Possible reference currencies.\n */\nconst currencies = [\n  \"AUD\",\n  \"BRL\",\n  \"CAD\",\n  \"CHF\",\n  \"CNY\",\n  \"CZK\",\n  \"DKK\",\n  \"EUR\",\n  \"GBP\",\n  \"HKD\",\n  \"HUF\",\n  \"IDR\",\n  \"ILS\",\n  \"INR\",\n  \"JPY\",\n  \"KRW\",\n  \"MXN\",\n  \"MYR\",\n  \"NOK\",\n  \"NZD\",\n  \"PHP\",\n  \"PLN\",\n  \"RUB\",\n  \"SEK\",\n  \"SGD\",\n  \"THB\",\n  \"TRY\",\n  \"USD\",\n  \"ZAR\"\n]\n\n/**\n * Class\n */\n\nclass SettingsGui extends Gui {\n  constructor () {\n    super(`\n      <section><h2>${__(\"Settings\")}</h2>\n        <section><h3>${__(\"General Settings\")}</h3>\n          %general\n        </section>\n      </section>\n    `)\n\n    this.general = new GeneralSettings(global)\n  }\n}\n\nclass GeneralSettings extends Form {\n  constructor (global) {\n    super(\n      Form.selector({\n        label: __(\"Language\"),\n        name: \"language\",\n        values: languages\n      }),\n      Form.selector({\n        label: __(\"Currency\"),\n        name: \"currency\",\n        values: currencies\n      })\n    )\n\n    // Two-way binding.\n    global.project([\"currency\", \"language\"], this)\n    this.project([\"currency\", \"language\"], global)\n\n    // Refresh interface.\n    this.listen(\"change\", () => location.reload())\n  }\n}\n\n/**\n * Export\n */\n\nmodule.exports = SettingsGui\n","\"use strict\"\n/**\n * Target Graphical User Interface\n */\nconst Gui = require(\"@cosmic-plus/domutils/es5/gui\")\nconst { __ } = require(\"@cosmic-plus/i18n\")\n\nconst Dialog = require(\"./helpers/dialog\")\nconst Target = require(\"./logic/target\")\nconst TargetSetup = require(\"./widgets/target-setup\")\nconst TargetsControls = require(\"./widgets/targets-controls\")\nconst TargetsTable = require(\"./widgets/targets-table\")\n\n/**\n * Class\n */\n\nmodule.exports = class RebalanceGui extends Gui {\n  constructor (portfolio) {\n    super(`\n<section class=\"RebalanceGui\">\n  <h2>${__(\"Rebalance\")}</h2>\n\n  %table\n\n  %controls\n\n</section>\n    `)\n\n    this.portfolio = portfolio\n\n    // Load & bind template from localStorage.\n    const targetKey = `target:${portfolio.account.id}`\n    const template = localStorage[targetKey]\n    this.target = Target.forPortfolio(portfolio, template)\n    this.target.link(\"json\", localStorage, targetKey, null, { init: false })\n    this.target.json = this.target.toJson()\n\n    // Targets table.\n    this.table = new TargetsTable(this.target)\n    this.table.project(\"selected\", this)\n    this.project(\"selected\", this.table)\n\n    // Controls.\n    this.controls = new TargetsControls(this.target)\n\n    this.trap(\"selected\", () => {\n      if (this.selected) this.showTargetSetup(this.selected)\n    })\n  }\n\n  async showTargetSetup (target) {\n    const setup = new TargetSetup(target)\n    const dialog = Dialog.confirm({ content: setup })\n\n    if (await dialog) setup.confirm()\n    else setup.cancel()\n\n    this.selected = null\n    target.computeAll()\n  }\n}\n","\"use strict\"\n/**\n * Modal boxes helper\n */\nconst Gui = require(\"@cosmic-plus/domutils/es5/gui\")\n\nconst ClickWall = require(\"./click-wall\")\n\n/**\n * Definition\n */\n\nclass Modal extends Gui {\n  constructor (params = {}) {\n    super(`\n<div class=\"Modal\" %style %hidden>%content</div>\n    `)\n\n    Object.assign(this.style, Modal.style)\n    this.hidden = true\n    this.content = params.content\n\n    // Handle styling parameters.\n    this.trap(\n      Modal.styleParams,\n      (event) => this.style[event.key] = event.value\n    )\n    Modal.styleParams.forEach((key) => this[key] = params[key])\n\n    // Initialization.\n    document.body.insertBefore(this.domNode, document.body.firstChild)\n  }\n\n  setPosition () {\n    const translate = { x: 0, y: 0 }\n    if (!this.left && !this.right) {\n      this.style.left = \"50%\"\n      translate.x = \"-50%\"\n    }\n    if (!this.top && !this.bottom) {\n      this.style.bottom = \"50%\"\n      translate.y = \"50%\"\n    }\n    this.style.transform = `translate(${translate.x}, ${translate.y})`\n  }\n\n  async open () {\n    Modal.clickWall.enable()\n\n    this.hidden = false\n    this.setPosition()\n\n    await Modal.shadow.enable()\n    Modal.shadow.onclick = () => this.close()\n\n    Modal.clickWall.disable()\n    this.trigger(\"open\")\n  }\n\n  async close () {\n    Modal.clickWall.enable()\n\n    this.hidden = true\n    await Modal.shadow.disable()\n\n    Modal.clickWall.disable()\n    this.trigger(\"close\")\n    this.destroy()\n  }\n}\n\n/**\n * Configuration\n */\n\nModal.styleParams = [\n  \"height\",\n  \"width\",\n  \"top\",\n  \"right\",\n  \"bottom\",\n  \"left\",\n  \"padding\"\n]\n\nModal.style = {\n  zIndex: 1000,\n  position: \"fixed\"\n}\n\nModal.shadow = new ClickWall({\n  scrollbar: \"hide\",\n  opacity: 0.3,\n  delay: 300\n})\n\nModal.clickWall = new ClickWall()\nModal.clickWall.domNode.style.zIndex = \"2000\"\n\n/**\n * Export\n */\nmodule.exports = Modal\n","\"use strict\"\n/**\n * Target class.\n *\n * A (portfolio) Target object represents a statically or dynamically allocated\n * target slice of the user portfolio. It is a theoric goal that the rebalancing\n * process aims to reach as much as possible.\n *\n * A Target may be composed by several Target subentries, in such a way that the\n * complete portfolio balancing target ends up being a tree made of Targets.\n */\nconst Mirrorable = require(\"@cosmic-plus/jsutils/es5/mirrorable\")\nconst Projectable = require(\"@cosmic-plus/jsutils/es5/projectable\")\n\nconst Asset = require(\"./asset\")\nconst Balance = require(\"./balance\")\nconst Order = require(\"./order\")\n\nconst strategy = require(\"./strategy\")\nconst {\n  arrayContains,\n  arrayRemove,\n  arraySum,\n  fixed7,\n  positive\n} = require(\"../helpers/misc\")\n\n/**\n * Definition\n */\n\nclass Target extends Projectable {\n  constructor (asset) {\n    super()\n\n    if (asset) {\n      this.asset = asset\n      this.mode = \"ignore\"\n      this.order = Order.rebalance(this)\n\n      asset.target = this\n      this.watch(asset, \"value\", () => this.compute(\"valueDiff\"))\n\n      // Asset with 0 amount won't trigger recompute by moving portfolio total\n      // value.\n      this.watch(asset, \"price\", () => {\n        if (!this.asset.amount && this.size) this.computeAll()\n      })\n\n      // Operations on trustlines.\n      this.opening = []\n      this.closing = []\n\n      // XLM is never ignored.\n      if (asset.id === \"XLM\") {\n        this.mode = \"weight\"\n        this.size = 1\n      }\n    } else {\n      this.childs = new Mirrorable()\n      this.childs.listen(\"add\", (child) => child.parent = this)\n      this.childs.listen(\"change\", () => this.computeAll())\n    }\n\n    // Normalize & compute\n    this.trap(\"size\", () => {\n      if (this.size) {\n        this.size = positive(this.size)\n        if (this.mode === \"percentage\") this.size = Math.min(100, this.size)\n      }\n      this.computeAll()\n    })\n  }\n\n  get root () {\n    if (this.parent) return this.parent.root\n    else return this\n  }\n}\n\nTarget.define(\"name\", [\"group\", \"asset\"], function () {\n  return this.group || this.asset.id\n})\nTarget.define(\"modified\", [\"json\"], function () {\n  return this.hasChanged()\n})\nTarget.define(\"valueDiff\", [\"value\", \"asset\"], function () {\n  return this.asset && this.value - this.asset.value\n})\nTarget.define(\"valueDiffP\", \"valueDiff\", function () {\n  return this.value ? this.valueDiff / this.value : null\n})\nTarget.define(\"amountDiff\", [\"amount\"], function () {\n  return fixed7(this.amount - this.asset.amount)\n})\nTarget.define(\"amountDelta\", [\"amountDiff\"], function () {\n  return Math.abs(this.amountDiff)\n})\n// Gets computed by \"strategy.js\".\nTarget.define(\"share\", null, function () {\n  return this.value / this.root.portfolio.total\n})\nTarget.define(\"shareDiff\", [\"share\"], function () {\n  return this.share - this.asset.share\n})\n\n/**\n * Actions\n */\n\nTarget.prototype.computeAll = function () {\n  if (this.parent) {\n    this.root.computeAll()\n  } else if (this.portfolio && this.portfolio.total) {\n    try {\n      this.error = null\n      this.value = this.portfolio.total\n      this.compute(\"modified\")\n      strategy.apply(this)\n    } catch (error) {\n      this.error = error.message\n      console.error(error)\n    }\n    this.trigger(\"update\")\n  }\n}\n\n/**\n * Add a target for **asset** into portfolio.\n */\nTarget.prototype.addAsset = function (asset) {\n  if (!this.childs) throw new Error(\"Target is not a group: \", target)\n  if (asset.target) throw new Error(\"Asset already has a target: \", asset)\n\n  // Add asset & target to current portfolio.\n  const target = new Target(asset)\n  target.parent = this\n  asset.anchors\n    .filter((anchor) => !anchor.unpeg)\n    .forEach((anchor) => target.addAnchor(anchor))\n  this.childs.push(target)\n\n  // Default setup.\n  target.mode = \"weight\"\n  target.size = 1\n\n  return target\n}\n\n/**\n * Open a new trustline then fund the new position.\n */\nTarget.prototype.addAnchor = function (anchor) {\n  const code = anchor.tetherCode(this.asset.code)\n  const issuer = anchor.pubkey\n  const balance = Balance.resolve(code, issuer)\n\n  if (balance.action === \"closing\") {\n    arrayRemove(this.closing, issuer)\n    balance.action = null\n  } else {\n    this.root.portfolio.maybeAddBalance(balance)\n    this.opening.push(issuer)\n    balance.action = \"opening\"\n  }\n\n  this.root.compute(\"modified\")\n  this.order.refresh()\n}\n\n/**\n * Begin anchor liquidation process, remove the trustline once done.\n */\nTarget.prototype.removeAnchor = function (anchor) {\n  const code = anchor.tetherCode(this.asset.code)\n  const issuer = anchor.pubkey\n  const balance = Balance.resolve(code, issuer)\n\n  if (balance.action === \"opening\") {\n    this.root.portfolio.maybeRemoveBalance(balance)\n    arrayRemove(this.opening, issuer)\n    balance.action = null\n  } else {\n    this.closing.push(issuer)\n    balance.action = \"closing\"\n  }\n\n  this.root.compute(\"modified\")\n  this.order.refresh()\n}\n\n/**\n * Utilities\n */\n\n/**\n * Return deterministically sorted **target** childs without mutating source\n * object.\n */\nTarget.sortChilds = function (target) {\n  const childs = target.childs.slice()\n  return childs.sort((a, b) => a.name.localeCompare(b.name))\n}\n\n/**\n * Source: Portfolio\n */\n\nTarget.forPortfolio = function (portfolio, json) {\n  const target = json ? Target.fromJson(json) : new Target()\n  target.portfolio = portfolio\n\n  portfolio.target = target\n  target.watch(portfolio, \"total\", () => target.computeAll())\n\n  // Add/Remove assets after trustline change.\n  portfolio.assets.forEach((asset) => {\n    if (\n      !target.childs.find((child) => asset === child.asset)\n      && asset.isSupported\n    )\n      target.childs.push(new Target(asset))\n  })\n  target.childs.forEach((child, index) => {\n    if (\n      !portfolio.assets.find((asset) => asset === child.asset)\n      || !child.asset.isSupported\n    )\n      target.childs.splice(index, 1)\n  })\n  portfolio.assets.listen(\"add\", (asset) => {\n    if (asset.isValid) target.childs.push(new Target(asset))\n  })\n  portfolio.assets.listen(\"remove\", (asset) => {\n    const index = target.childs.findIndex((child) => child.asset === asset)\n    target.childs.splice(index, 1)\n  })\n\n  return target\n}\n\n/**\n * Format: JSON\n */\n\nTarget.fromJson = function (json) {\n  const object = JSON.parse(json)\n  const target = Target.fromObject(object)\n  target.json = json\n  return target\n}\n\nTarget.prototype.toJson = function (beautifyFlag) {\n  const object = this.toObject()\n  return JSON.stringify(object, null, beautifyFlag && 2)\n}\n\nTarget.prototype.hasChanged = function () {\n  return this.toJson() !== (this.json || \"{\\\"childs\\\":[]}\")\n}\n\n/**\n * Format: Object\n */\n\nTarget.fromObject = function (object) {\n  if (typeof object === \"string\") object = { asset: object }\n\n  // Create Target instance.\n  const asset = object.asset && Asset.resolve(object.asset)\n  const target = new Target(asset)\n  target.size = object.size\n  target.mode = object.mode\n\n  // Conversion from versions <= 0.5  REMOVAL: 2020-05 (one year).\n  if (target.mode === \"equal\") target.mode = \"weight\"\n  if (target.mode === \"skip\") target.mode = \"ignore\"\n\n  // Fix for versions <= 0.6.1 - REMOVAL: 2020-06 (one year).\n  if (target.asset && target.asset.id === \"XLM\" && target.mode === \"ignore\") {\n    target.mode = \"weight\"\n    target.size = 1\n  }\n\n  // Set defaults.\n  if (!target.mode) target.mode = \"weight\"\n  if (target.size == null && target.mode === \"weight\") target.size = 1\n\n  // Group Target: Parse childs.\n  if (object.childs) {\n    target.group = object.group\n    const childs = object.childs.map((entry) => Target.fromObject(entry))\n\n    // Conversion from versions <= 0.5  REMOVAL: 2020-05 (one year).\n    //\n    // When there was no \"equal\" target, percentage targets whose sum is under\n    // 100 would act like \"weight\".\n    const percentChilds = childs.filter((child) => child.mode === \"percentage\")\n    if (\n      percentChilds.length\n      && !childs.find((child) => child.mode === \"weight\")\n      && arraySum(percentChilds, \"size\") !== 100\n    ) {\n      percentChilds.forEach((child) => child.mode = \"weight\")\n    }\n\n    target.childs.push(...childs)\n  } else {\n    // Asset Target: Deal with trustline opening/closing.\n    const balances = target.asset.balances\n    if (object.opening) target.opening = object.opening\n    if (object.closing) target.closing = object.closing\n\n    balances.forEach((balance) => {\n      const issuer = balance.anchor.pubkey\n      if (arrayContains(target.closing, issuer)) {\n        // Trustline is still not closed.\n        balance.action = \"closing\"\n      } else {\n        // Trustline has been opened.\n        arrayRemove(target.opening, issuer)\n      }\n    })\n\n    // Trustline has been closed.\n    target.closing.forEach((issuer) => {\n      if (!balances.find((balance) => balance.anchor.pubkey === issuer)) {\n        arrayRemove(target.closing, issuer)\n      }\n    })\n\n    // No balance for asset.\n    if (!balances.length) asset.target = null\n  }\n\n  return target\n}\n\nTarget.prototype.toObject = function () {\n  if (this.mode === \"ignore\") return\n\n  // Parameters reduction.\n  let object = { mode: this.mode, size: this.size }\n  if (object.mode === \"weight\") {\n    delete object.mode\n    if (object.size === 1) delete object.size\n  }\n\n  // Asset target.\n  if (this.asset) {\n    object.asset = this.name\n    if (this.opening.length) object.opening = this.opening\n    if (this.closing.length) object.closing = this.closing\n    if (Object.keys(object).length === 1) object = object.asset\n\n    // Group target.\n  } else if (this.childs) {\n    object.group = this.group\n    const childs = Target.sortChilds(this)\n    object.childs = childs.map((target) => target.toObject()).filter((x) => x)\n  }\n\n  return object\n}\n\n/**\n * Format: CosmicLink\n */\n\nTarget.prototype.toCosmicLink = function () {\n  if (this !== this.root) {\n    throw new Error(\"Only root target can be converted to CosmicLink\")\n  }\n\n  // Create operations.\n  const operations = this.toOperations()\n\n  // Set outdated offers to be replaced.\n  const outdated = this.portfolio.offers.listOutdated()\n  const remaining = []\n\n  operations.forEach((o) => o.offer.id = null)\n  outdated.forEach((offer) => {\n    const operation = operations.find((o) => o.offer.balance === offer.balance)\n    if (operation) operation.offer.id = offer.id\n    else remaining.push(offer)\n  })\n\n  operations.forEach((operation) => {\n    if (!operation.offer.id && remaining.length) {\n      operation.offer.id = remaining.pop().id\n    }\n  })\n\n  // Create CosmicLink.\n  const cosmicLink = Order.operationsToCosmicLink(operations)\n\n  // Open/close trustlines.\n  this.portfolio.balances\n    .filter((b) => b.asset.target)\n    .forEach((balance) => {\n      if (shouldOpenTrustline(balance)) {\n        cosmicLink.insertOperation(0, \"changeTrust\", { asset: balance.id })\n      }\n      if (shouldCloseTrustline(balance)) {\n        cosmicLink.insertOperation(0, \"changeTrust\", {\n          asset: balance.id,\n          limit: 0\n        })\n      }\n    })\n\n  // Close outdated offers which are not replaced.\n  remaining.forEach((offer) => {\n    cosmicLink.insertOperation(0, \"manageOffer\", {\n      offerId: offer.id,\n      amount: 0\n    })\n  })\n\n  return cosmicLink.tdesc.operations.length ? cosmicLink : null\n}\n\nfunction shouldOpenTrustline (balance) {\n  if (balance.asset.target.mode === \"remove\") return false\n  else return balance.action === \"opening\"\n}\n\nfunction shouldCloseTrustline (balance) {\n  if (!balance.hasTrustline) return false\n  else\n    return (\n      balance.amount === 0 && balance.action === \"closing\"\n      || balance.asset.target.mode === \"remove\" && balance.asset.amount === 0\n    )\n}\n\n/**\n * Format: Operations\n */\nTarget.prototype.toOperations = function () {\n  if (this.childs) {\n    return [].concat(...this.childs.map((child) => child.toOperations()))\n  } else if (this.order) {\n    return this.order.operations\n  } else {\n    return []\n  }\n}\n\n/**\n * Export\n */\n\nmodule.exports = Target\n","\"use strict\"\n/**\n * Order class\n */\n\nconst cosmicLib = require(\"cosmic-lib\")\nconst CosmicLink = cosmicLib.CosmicLink\nconst Mirrorable = require(\"@cosmic-plus/jsutils/es5/mirrorable\")\nconst nice = require(\"@cosmic-plus/jsutils/es5/nice\")\nconst Projectable = require(\"@cosmic-plus/jsutils/es5/projectable\")\nconst { __ } = require(\"@cosmic-plus/i18n\")\n\nconst global = require(\"./global\")\nconst {\n  positive,\n  negative,\n  fixed7,\n  clamp,\n  absoluteMin,\n  arraySum,\n  arrayScale\n} = require(\"../helpers/misc\")\n\n/**\n * Class\n */\n\nconst Order = module.exports = class Order extends Projectable {\n  static rebalance (target) {\n    if (target.asset.code === \"XLM\") return\n\n    const order = new Order(\"balance\", target.asset.orderbook, target)\n    order.watch(target, \"amount\", () => order.refresh())\n    order.watch(target.asset.orderbook, [\"bids\", \"asks\"], () => order.refresh())\n    target.asset.offers.listen(\"change\", () => order.refresh(), order)\n\n    return order\n  }\n\n  constructor (type, orderbook, ...parameters) {\n    super()\n    this.type = type\n    this.method = Order.type[this.type]\n    this.operations = new Mirrorable()\n    this.orderbook = orderbook\n    this.parameters = parameters\n\n    this.operations.listen(\"update\", () => {\n      this.compute([\"cosmicLink\", \"description\"])\n    })\n\n    this.refresh()\n  }\n\n  refresh () {\n    this.operations.splice(0, this.operations.length)\n    this.operations.trigger(\"update\")\n    this.method(this, ...this.parameters)\n    this.trigger(\"refresh\")\n  }\n\n  /**\n   * Operations Management\n   */\n\n  getOperation (offer, make) {\n    const id = `${offer.balance.anchor.name}:${make ? offer.price : \"take\"}`\n    const operation = this.operations.find((x) => x.id === id)\n    if (operation) {\n      return operation\n    } else {\n      const newOperation = { id }\n      this.operations.push(newOperation)\n      return newOperation\n    }\n  }\n\n  addOperation (offer, amount) {\n    const operation = this.getOperation(offer, amount > 0)\n    this.setOperation(operation, offer, Number(amount) || operation.amount)\n  }\n\n  setOperation (operation, offer, amount) {\n    operation.amount = fixed7(amount)\n    operation.cost = amount * offer.price\n    operation.offer = offer\n    operation.isDust =\n      operation.amount > 0 && operation.amount * offer.basePrice < 1e-7\n    this.operations.trigger(\"update\")\n  }\n}\n\nOrder.define(\"description\", \"operations\", function () {\n  return Order.operationsToDescription(this.operations)\n})\n\n/**\n * Utilities\n */\n\nOrder.operationsToCosmicLink = function (operations = []) {\n  // Create CosmicLink.\n  const cosmicLink = new CosmicLink({\n    network: \"public\",\n    memo: \"Equilibre.io\",\n    maxTime: \"+5\",\n    source: global.portfolio.accountId\n  })\n\n  // Set operations.\n  operations.forEach((operation) => {\n    if (operation.isDust) {\n      // Burn dust.\n      const balance = operation.offer.balance\n      const emitter = balance.anchor.pubkey\n      const asset = `${balance.code}:${emitter}`\n      cosmicLink.addOperation(\"payment\", {\n        amount: operation.amount,\n        asset,\n        destination: emitter\n      })\n      cosmicLink.addOperation(\"changeTrust\", { asset, limit: 0 })\n    } else {\n      cosmicLink.addOperation(\"manageOffer\", operationToOdesc(operation))\n    }\n  })\n\n  return cosmicLink\n}\n\nOrder.operationsToDescription = function (operations = []) {\n  const desc = []\n  operations.forEach((op) => {\n    if (operationDirection(op) === \"buy\") {\n      desc.push(`\n${__(\"Buy\")} ${nice(op.amount)} ${op.offer.balance.code} ${__(\"at\")} \\\n${nice(op.offer.price)} ${global.currency}\n      `)\n    } else {\n      if (op.isDust) {\n        desc.push(`\n${__(\"Burn dust\")} (${nice(op.amount)} ${op.offer.balance.code})\n        `)\n      } else {\n        desc.push(`\n${__(\"Sell\")} ${nice(op.amount)} ${op.offer.balance.code} ${__(\"at\")} \\\n${nice(op.offer.price)} ${global.currency}\n      `)\n      }\n    }\n  })\n  return desc\n}\n\n/**\n * Helpers\n */\n\nfunction operationDirection (op) {\n  if (\n    op.amount > 0 && op.offer.side === \"bids\"\n    || op.amount < 0 && op.offer.side === \"asks\"\n  ) {\n    return \"buy\"\n  } else {\n    return \"sell\"\n  }\n}\n\nfunction operationToOdesc (operation) {\n  const offer = operation.offer\n  const base = offer.balance.code + \":\" + offer.balance.anchor.pubkey\n  const quote = \"XLM\"\n\n  let odesc\n  if (operationDirection(operation) === \"buy\") {\n    odesc = {\n      buying: base,\n      selling: quote,\n      amount: fixed7(operation.amount * offer.price_r.n / offer.price_r.d),\n      price: { n: offer.price_r.d, d: offer.price_r.n }\n    }\n  } else {\n    odesc = {\n      buying: quote,\n      selling: base,\n      amount: operation.amount,\n      price: offer.price_r\n    }\n  }\n  odesc.offerId = operation.offer.id\n\n  return odesc\n}\n\n/**\n * Orders types\n */\n\nOrder.type = {}\n\nOrder.type.market = function (order, size) {\n  if (!size) return\n\n  const side = size > 0 ? \"asks\" : \"bids\"\n  const amount = Math.abs(size)\n  const offer = order.orderbook.findOffer(side, (offer) => {\n    return offer.baseVolume > amount\n  })\n  order.addOperation(offer, amount)\n}\n\nOrder.type.limit = function (order, size, { orderbook, filter }) {\n  if (!size) return\n\n  const side = size > 0 ? \"bids\" : \"asks\"\n  const offer = (orderbook || order.orderbook).findOffer(side, filter)\n  if (offer) order.addOperation(tightenSpread(offer), Math.abs(size))\n}\n\n/**\n * Rebalancing\n */\n\nOrder.type.balance = function (order, target) {\n  const asset = target.asset\n  const orderbook = asset.orderbook\n\n  // Requirements\n\n  if (target.amount == null || target.amountDelta === 0) return\n\n  if (!orderbook.isFetched()) {\n    order.description = [__(\"Fetching orderbook...\")]\n    return\n  }\n\n  if (asset.liabilities) {\n    const currentOffers = asset.offers.filter((offer) => !offer.outdated)\n    if (currentOffers.length) {\n      order.description = [__(\"Rebalancing...\")]\n      return\n    }\n  }\n\n  // Rebalancing\n\n  setBalancesTargets(target)\n  if (!areTargetAnchorsBalanced(target)) {\n    balanceTargetAnchors(target, target.amountDiff)\n  } else if (isOneOperationEnough(target, target.amountDiff)) {\n    addOneOperation(target, target.amountDiff)\n  } else {\n    addMultipleOperations(target, target.amountDiff)\n  }\n}\n\n/**\n * Set the `targetAmount` property of **target** balances according to\n * `target.amount`.\n */\nfunction setBalancesTargets (target) {\n  // Empty orderbooks cannot be traded.\n  const balances = []\n  target.asset.balances.forEach((balance) => {\n    if (balance.orderbook.price == null || !balance.isActive) {\n      balance.targetAmount = null\n    } else {\n      balances.push(balance)\n    }\n  })\n\n  // Special cases.\n  if (!balances.length) {\n    return\n  } else if (balances.length === 1) {\n    return balances[0].targetAmount = target.amount\n  }\n\n  // Set each balance tradable amount.\n  const targetAmount = fixed7(target.amount / balances.length)\n  balances.forEach((balance) => balance.targetAmount = targetAmount)\n}\n\n/**\n * Returns whether or not **target** asset anchors current funds are risk\n * balanced.\n */\nfunction areTargetAnchorsBalanced (target) {\n  const balances = target.asset.balances\n  return !(arraySum(balances, \"underMin\") && arraySum(balances, \"overMax\"))\n}\n\n/**\n * Create a set of operations that even out anchor amounts of `target.asset`.\n */\nfunction balanceTargetAnchors (\n  target,\n  size = target.amountDiff,\n  riskMax = global.anchorsRebalanceRiskMax\n) {\n  const balances = target.asset.balances\n\n  // Compute the amount to transfer between anchors.\n  const under = -arraySum(balances, \"underMin\")\n  const over = arraySum(balances, \"overMax\")\n  const misallocated = Math.max(under - positive(size), over + negative(size))\n\n  // Eventually limit risk by capping that amount.\n  const currentRisk = Math.abs(target.valueDiffP)\n  const amountCap = target.amount * positive(riskMax - currentRisk)\n  const transferAmount = Math.min(misallocated, amountCap)\n\n  // Factor in the amount of asset to buy/sell to balance portfolio.\n  const buy = fixed7(transferAmount + positive(size))\n  const sell = fixed7(transferAmount - negative(size))\n\n  // Generate operations accordingly.\n  addMultipleOperations(target, buy)\n  addMultipleOperations(target, -sell)\n}\n\n/**\n * Returns whether or not it is possible meet **target** rebalancing target in\n * one operation.\n */\nfunction isOneOperationEnough (target, size) {\n  const balances = target.asset.balances\n\n  const undersizedClosing = balances.filter((b) => {\n    return b.action === \"closing\" && size < b.sizeMin\n  })\n  const canTakeTrade = balances.filter((b) => {\n    return b.sizeMin <= size && size <= b.sizeMax\n  })\n\n  return !undersizedClosing.length && !!canTakeTrade.length\n}\n\n/**\n * Adds an operation to `target.order` that trades **size** `target.asset` on\n * **orderbook**.\n */\nfunction addOneOperation (target, size, orderbook = target.asset.orderbook) {\n  const noMinValue = target.mode === \"quantity\" || target.amount === 0\n  const baseAsk = orderbook.asks[0].basePrice\n  if (!noMinValue && Math.abs(size * baseAsk) < global.minOfferValue) return\n\n  const filter = makeOfferFilter(target, size)\n  Order.type.limit(target.order, size, { orderbook, filter })\n}\n\n/**\n * Split a trade over multiple anchors.\n */\nfunction addMultipleOperations (target, size) {\n  const balances = target.asset.balances\n  let tradeSize = 0,\n    trade = balances.map(() => 0)\n\n  // 1. Sell balances being closed.\n  if (negative(size)) {\n    const liquidate = balances.map((balance) => {\n      return balance.action === \"closing\" ? -balance.amount : 0\n    })\n    tradeSize = _addToTrade(trade, liquidate, size)\n  }\n\n  // 2. If this was not enough, trade imbalanced anchors.\n  const misallocatedKey = positive(size) ? \"underMin\" : \"overMax\"\n  if (tradeSize !== size) {\n    const misallocated = balances.map((balance) => {\n      return balance.action === \"closing\" ? 0 : -balance[misallocatedKey]\n    })\n    tradeSize = _addToTrade(trade, misallocated, size - tradeSize)\n  }\n\n  // 3. If this was not enough, trade balanced anchors.\n  if (tradeSize !== size) {\n    const sizeKey = positive(size) ? \"sizeMax\" : \"sizeMin\"\n    const tradable = balances.map((balance) => {\n      if (balance.action === \"closing\") return 0\n      else return balance[sizeKey] - balance[misallocatedKey]\n    })\n    _addToTrade(trade, tradable, size - tradeSize)\n  }\n\n  // Create operations according to **trade**.\n  balances.forEach((balance, index) => {\n    const size = fixed7(trade[index])\n    addOneOperation(target, size, balance.orderbook)\n  })\n}\n\n/**\n * Adds **amounts** to **trade**, which is an array of trade sizes. Caps summed\n * **trade** sizes to **sizeMax**. Returns the summed **trade** size.\n */\nfunction _addToTrade (trade, amounts, sizeMax) {\n  const amountsSum = arraySum(amounts)\n  const tradeSize = absoluteMin(sizeMax, amountsSum)\n  const toBeAdded = arrayScale(amounts, tradeSize)\n  toBeAdded.forEach((value, index) => trade[index] += value)\n  return +nice(arraySum(trade), 7)\n}\n\n/**\n * Returns a balancing offer filter for **tradedAmount** to be used with\n * `Orderbook.findOffer()`.\n */\nfunction makeOfferFilter (target, size) {\n  return (offer) => {\n    return (\n      size >= offer.balance.sizeMin\n      && size <= offer.balance.sizeMax\n      && offer.baseVolume > Math.abs(size) * global.skipMarginalOffers\n    )\n  }\n}\n\n/**\n * Create a copy of **offer** with a delta to global market price reduced by\n * **percentage**.\n */\nfunction tightenSpread (offer, percentage = global.spreadTightening) {\n  const clone = Object.assign({}, offer)\n  const diff = percentage * offer.balance.asset.orderbook[\"spread%\"] / 100\n\n  if (offer.side === \"bids\") clone.price = offer.price * (1 + diff)\n  else clone.price = offer.price * (1 - diff)\n\n  if (offer.balance.asset.globalPrice) clampOfferPrice(clone)\n  updateOfferPriceR(clone)\n\n  return clone\n}\n\n/**\n * Floor/ceil **offer**'s price between global market price and a **premium**.\n * **premium** soft cap is given in argument; hard cap is the average anchor\n * price.\n */\nfunction clampOfferPrice (offer, premium = global.maxSpread / 2) {\n  const globalPrice = offer.balance.asset.price\n  const anchorPrice = offer.balance.orderbook.price\n\n  if (offer.side === \"bids\") {\n    const minPrice = Math.min(anchorPrice, globalPrice * (1 - premium))\n    offer.price = clamp(offer.price, minPrice, globalPrice)\n  } else {\n    const maxPrice = Math.max(anchorPrice, globalPrice * (1 + premium))\n    offer.price = clamp(offer.price, globalPrice, maxPrice)\n  }\n}\n\n/**\n * Set `offer.price_r` according to `offer.price`.\n *\n * @param  {Object} offer\n */\nfunction updateOfferPriceR (offer) {\n  const quote = offer.balance.orderbook.quote\n\n  offer.price_r = {\n    n: nice(offer.price * 10000000000, 0),\n    d: nice(quote.price * 10000000000, 0)\n  }\n\n  // Ten characters maximum\n  while (offer.price_r.n > 999999999 || offer.price_r.d > 999999999) {\n    offer.price_r.n = nice(offer.price_r.n / 10, 0)\n    offer.price_r.d = nice(offer.price_r.d / 10, 0)\n  }\n}\n\n/**\n * Append Order.type to Order class\n */\n\nfor (let key in Order.type) {\n  if (!Order[key]) Order[key] = (...parameters) => new Order(key, ...parameters)\n}\n","\"use strict\"\n/**\n * Rebalancing strategies\n */\nconst strategy = exports\n\nconst nice = require(\"@cosmic-plus/jsutils/es5/nice\")\nconst { __ } = require(\"@cosmic-plus/i18n\")\n\nconst global = require(\"./global\")\nconst { arraySum, fixed7, positive } = require(\"../helpers/misc\")\n\n/**\n * Applicator\n */\n\nstrategy.apply = function (target) {\n  const delayed = []\n  let sum = 0,\n    weights = 0\n\n  target.childs.forEach((child) => {\n    const mode = child.mode\n    if (mode === \"weight\") {\n      delayed.push(child)\n      weights += child.size\n    } else {\n      strategy[mode](child)\n      sum += child.value\n    }\n  })\n\n  const remains = positive(target.value - sum)\n  delayed.forEach((child) => strategy.weight(child, remains, weights))\n\n  checkAllocationLimits(sum, target.value, delayed.length)\n  maybeThrottleTargetAmounts(target)\n}\n\nfunction checkAllocationLimits (allocated, available, checkUnderFlag) {\n  const margin = global.misallocationTolerance\n\n  if (allocated > available * (1 + margin)) {\n    const over = +nice(allocated - available, 2)\n    const overP = +nice(100 * over / available, 2)\n    let msg = __(\"Rebalance setup is over portfolio value by\")\n    msg += ` ${over} ${global.currency} (${overP}%) `\n    throw new Error(msg)\n  } else if (!checkUnderFlag && allocated < available * (1 - margin)) {\n    const under = +nice(available - allocated, 2)\n    const underP = +nice(100 * under / available, 2)\n    let msg = __(\"Rebalance setup is under portfolio value by\")\n    msg += ` ${under} ${global.currency} (${underP}%) `\n    throw new Error(msg)\n  }\n}\n\n/**\n * When not enough Lumens are available to fully rebalance the portfolio,\n * harmoniously reduce traded amounts in order to reach target in several steps\n * in a risk-managed way.\n */\nfunction maybeThrottleTargetAmounts (target) {\n  // Check if `target.amount` throttling is required.\n  const Asset = require(\"./asset\")\n  const XLM = Asset.resolve(\"XLM\")\n  const targets = target.childs.filter((t) => t.asset !== XLM)\n  const liquidity = XLM.value - XLM.valueMin\n\n  const buyTargets = targets.filter((t) => t.valueDiff > 0)\n  const buyValue = arraySum(buyTargets, \"valueDiff\")\n\n  if (liquidity > buyValue) return\n\n  // Throttle `target.amount`.\n  const sellTargets = targets.filter((t) => t.valueDiff < 0)\n  const sellValue = -arraySum(sellTargets, \"valueDiff\")\n\n  const canSell = XLM.target.value - XLM.valueMin\n  const throttleRatio = 1 - positive(canSell / sellValue)\n\n  targets.forEach((child) => {\n    child.amount = fixed7(child.amount - child.amountDiff * throttleRatio)\n  })\n\n  if (throttleRatio > 0.95) {\n    throw new Error(__(\"The XLM share is too low\"))\n  }\n}\n\n/**\n * Strategies\n */\n\nstrategy.amount = function (target) {\n  target.amount = target.size\n  target.value = target.amount * target.asset.price\n  target.compute(\"share\")\n}\n\nstrategy.ignore = function (target) {\n  target.value = target.asset.value\n  target.amount = target.asset.amount\n  target.compute(\"share\")\n}\n\nstrategy.remove = function (target) {\n  target.amount = 0\n  target.value = 0\n  target.compute(\"share\")\n}\n\nstrategy.percentage = function (target) {\n  strategy.weight(target, target.parent.value, 100)\n}\n\nstrategy.weight = function (target, remains, weights) {\n  if (!weights) {\n    target.value = target.amount = 0\n  } else {\n    target.value = target.size * remains / weights\n    target.amount = fixed7(target.value / target.asset.price)\n  }\n  target.compute(\"share\")\n}\n","\"use strict\"\n/**\n * Target Setup Form\n */\nconst Gui = require(\"@cosmic-plus/domutils/es5/gui\")\n\nconst Anchor = require(\"../logic/anchor\")\nconst TargetSetupAnchors = require(\"./target-setup-anchors\")\nconst TargetSetupSize = require(\"./target-setup-size\")\nconst { arrayOnlyInFirst } = require(\"../helpers/misc\")\n\n/** Definition **/\n\nmodule.exports = class TargetSetup extends Gui {\n  constructor (target) {\n    super(`\n<div class=\"TargetSetup\">\n  <h3>%name</h3>\n  <hr>\n\n  %sizeSetup\n  %anchorsSetup\n\n</div>\n    `)\n\n    this.target = target\n    this.backup = {\n      size: target.size,\n      mode: target.mode,\n      opening: target.opening.slice(),\n      closing: target.closing.slice()\n    }\n\n    this.name = target.asset.name\n    this.sizeSetup = new TargetSetupSize(target)\n\n    if (this.target.asset.anchors.length > 1) {\n      this.anchorsSetup = new TargetSetupAnchors(target)\n    }\n  }\n\n  confirm () {\n    this.sizeSetup.maybeSwitchMode()\n\n    const asset = this.target.asset\n    if (asset.id === \"XLM\") {\n      // Use `target.value` as `target.amount` gets modified in throttle mode.\n      if (this.target.value < asset.amountMin * asset.price) {\n        this.target.mode = \"amount\"\n        this.target.size = asset.amountMin\n      }\n    }\n\n    this.close()\n  }\n\n  cancel () {\n    this.target.mode = this.backup.mode\n    this.target.size = this.backup.size\n\n    const opened = arrayOnlyInFirst(\n      this.target.opening,\n      this.backup.opening\n    ).concat(arrayOnlyInFirst(this.backup.closing, this.target.closing))\n    opened\n      .map(Anchor.resolve)\n      .forEach((anchor) => this.target.removeAnchor(anchor))\n\n    const closed = arrayOnlyInFirst(\n      this.target.closing,\n      this.backup.closing\n    ).concat(arrayOnlyInFirst(this.backup.opening, this.target.opening))\n    closed\n      .map(Anchor.resolve)\n      .forEach((anchor) => this.target.addAnchor(anchor))\n\n    this.close()\n  }\n\n  close () {\n    document.activeElement.blur()\n    this.sizeSetup.destroy()\n    if (this.anchorsSetup) this.anchorsSetup.destroy()\n    this.destroy()\n  }\n}\n","\"use strict\"\n/**\n * Target Setup Anchors\n */\nconst Gui = require(\"@cosmic-plus/domutils/es5/gui\")\nconst { __ } = require(\"@cosmic-plus/i18n\")\n\n/* Definition */\n\nmodule.exports = class TargetSetupAnchors extends Gui {\n  constructor (target) {\n    super(`\n<fieldset class=\"TargetSetupAnchors\">\n  <legend>${__(\"Anchor\")}:</legend>\n  %toAnchorCheckbox:anchors...\n</fieldset>\n  `)\n\n    this.target = target\n    this.anchors = target.asset.anchors.filter((anchor) => {\n      const portfolio = target.root.portfolio\n      return !anchor.unpeg || doesPortfolioUseAnchor(portfolio, anchor)\n    })\n  }\n\n  toAnchorCheckbox (anchor) {\n    return new AnchorCheckbox(anchor, {\n      getState: () => isTargetAnchorActive(this.target, anchor),\n      callback: this.switchAnchor.bind(this)\n    })\n  }\n\n  switchAnchor (anchor, checked) {\n    if (checked) {\n      this.target.addAnchor(anchor)\n    } else if (areTwoOrMoreAnchorsActive(this.target)) {\n      this.target.removeAnchor(anchor)\n    }\n  }\n}\n\nfunction doesPortfolioUseAnchor (portfolio, anchor) {\n  return portfolio.balances.find((b) => b.anchor === anchor)\n}\n\nfunction isTargetAnchorActive (target, anchor) {\n  const balance = target.asset.balances.find((b) => b.anchor === anchor)\n  return balance && balance.isActive\n}\n\nfunction areTwoOrMoreAnchorsActive (target) {\n  const count = target.asset.balances.reduce((sum, balance) => {\n    return balance.isActive ? sum + 1 : sum\n  }, 0)\n  return count > 1\n}\n\nclass AnchorCheckbox extends Gui {\n  constructor (anchor, params = {}) {\n    const { getState, callback } = params\n\n    super(`\n<span class=\"AnchorCheckbox half\">\n  <input -ref=%checkbox type=\"checkbox\" %checked>\n  <label -ref=%label %onclick>%name</label>\n</span>\n`)\n    this.name = anchor.name\n    this.checked = getState()\n\n    this.onclick = () => {\n      callback(anchor, !this.checked)\n      this.checked = getState()\n    }\n  }\n}\n","\"use strict\"\n/**\n * Target Setup Size\n */\nconst Gui = require(\"@cosmic-plus/domutils/es5/gui\")\n\nconst nice = require(\"@cosmic-plus/jsutils/es5/nice\")\nconst { __ } = require(\"@cosmic-plus/i18n\")\n\n/** Definition **/\n\nmodule.exports = class TargetSetupSize extends Gui {\n  constructor (target) {\n    super(`\n<fieldset class=\"TargetSetupSize\">\n  <legend>${__(\"Size\")}:</legend>\n\n  <input autofocus class=\"half\" type=\"number\" step=\"any\" min=\"0\" %max\n    value=%size placeholder=%share onchange=%maybeSwitchMode>\n\n  <select class=\"half\" onchange=%setMode value=%mode>\n    <option value=\"weight\">${__(\"Weight\")}</option>\n    <option value=\"percentage\">${__(\"Percentage\")}</option>\n    <option value=\"amount\">${__(\"Amount\")}</option>\n    <option value=\"ignore\" hidden=%targetIsXlm>${__(\"Ignore\")}</option>\n    <option value=\"remove\" hidden=%targetIsXlm>${__(\"Remove\")}</option>\n  </select>\n\n</fieldset>\n    `)\n\n    this.target = target\n    this.targetIsXlm = target.asset.id === \"XLM\"\n\n    target.project(\"share\", this, (x) => nice(100 * x, 2))\n\n    target.project(\"size\", this)\n    this.project(\"size\", target, (x) => x != null ? Number(x) : null)\n\n    target.project(\"mode\", this)\n    this.project(\"mode\", target)\n  }\n\n  maybeSwitchMode () {\n    if (this.size == 0) {\n      this.mode = \"amount\"\n    } else if (!this.size) {\n      if (this.mode !== \"remove\") this.mode = \"ignore\"\n    } else if (this.mode === \"ignore\" || this.mode === \"remove\") {\n      this.mode = \"percentage\"\n      this.target.computeAll()\n    }\n  }\n\n  setMode () {\n    // TODO: Move this logic to Target model.\n    switch (this.mode) {\n    case \"weight\":\n      this.size = 1\n      this.max = null\n      break\n    case \"percentage\":\n      this.size = +nice(100 * this.target.asset.share, 2)\n      this.max = 100\n      break\n    case \"amount\":\n      this.size = this.target.asset.amount\n      this.max = null\n      break\n    case \"ignore\":\n    case \"remove\":\n      this.target.set(\"size\", null)\n      break\n    }\n  }\n}\n","\"use strict\"\n/**\n * Targets Controls\n */\nconst Gui = require(\"@cosmic-plus/domutils/es5/gui\")\nconst html = require(\"@cosmic-plus/domutils/es5/html\")\nconst { __ } = require(\"@cosmic-plus/i18n\")\n\n/**\n * Class\n */\n\nmodule.exports = class TargetsControls extends Gui {\n  constructor (target) {\n    super(`\n<section class=\"TargetControls\">\n  <form %onsubmit hidden=%hideRebalance>\n    <button onclick=%rebalance disabled=%invalid>${__(\"Rebalance\")}</button>\n  </form>\n\n  <form %onsubmit hidden=%hideSave>\n    <button onclick=%save disabled=%invalid>${__(\"Save\")}</button>\n    <button onclick=%cancel>${__(\"Cancel\")}</button>\n  </form>\n\n  %toParagraph:error\n</section>\n    `)\n\n    this.target = target\n    target.project([\"error\", \"modified\"], this)\n\n    this.define(\"hideRebalance\", [\"modified\"], () => this.modified)\n    this.define(\"hideSave\", [\"modified\"], () => !this.modified)\n    this.define(\"invalid\", [\"error\"], () => !!this.error)\n  }\n\n  toParagraph (error) {\n    if (error) return html.create(\"p\", \".error\", error)\n  }\n\n  onsubmit () {\n    return false\n  }\n\n  cancel () {\n    location.reload()\n  }\n\n  save () {\n    this.target.json = this.target.toJson()\n  }\n\n  rebalance () {\n    const cosmicLink = this.target.toCosmicLink()\n\n    if (cosmicLink) {\n      const sideFrame = cosmicLink.open()\n      sideFrame.listen(\"destroy\", () => {\n        this.target.portfolio.getAccount()\n        this.target.portfolio.offers.get()\n      })\n    }\n  }\n}\n","\"use strict\"\n/**\n * Targets Table\n */\nconst Gui = require(\"@cosmic-plus/domutils/es5/gui\")\nconst html = require(\"@cosmic-plus/domutils/es5/html\")\nconst nice = require(\"@cosmic-plus/jsutils/es5/nice\")\nconst { __ } = require(\"@cosmic-plus/i18n\")\n\nconst AssetSelector = require(\"./asset-selector\")\nconst Dialog = require(\"../helpers/dialog\")\n\n/**\n * Definition\n */\n\nmodule.exports = class TargetsTable extends Gui {\n  constructor (target) {\n    super(`\n<section class=\"TargetsTable\">\n  <table>\n    <tr>\n      <th class=\"name\">${__(\"Name\")}</th>\n      <th align=\"right\">${__(\"Goal\")}</th>\n      <th align=\"right\">${__(\"Divergence\")}</th>\n      <th align=\"right\">${__(\"Operation\")}</th>\n    </tr>\n\n    %targets...\n\n    <tr><td colspan=\"4\" align=\"center\" onclick=%addAsset>\n      <h3>${__(\"Add Asset\")}</h3>\n    </td></tr>\n\n  </table>\n</section>\n    `)\n\n    this.target = target\n\n    this.targets = target.childs.mirror((child) => this.toTargetRow(child))\n    this.selected = undefined\n\n    target.listen(\"update\", () => this.sortTargets())\n    this.sortTargets()\n  }\n\n  toTargetRow (target) {\n    const row = new TargetRow(target)\n    row.domNode.onclick = () => this.selected = target\n    return row\n  }\n\n  sortTargets () {\n    this.targets.sort((a, b) => {\n      a = a.target\n      b = b.target\n      if (b.mode === \"ignore\" && a.mode !== \"ignore\") return -1\n      else if (a.mode === \"ignore\" && b.mode !== \"ignore\") return 1\n      if (b.mode === \"remove\" && a.mode !== \"remove\") return -1\n      else if (a.mode === \"remove\" && b.mode !== \"remove\") return 1\n      return b.value - a.value || a.asset.code.localeCompare(b.asset.code)\n    })\n  }\n\n  async addAsset () {\n    const assets = this.target.portfolio.availableAssets().filter((a) => a.show)\n\n    const assetSelector = new AssetSelector(assets)\n    const dialog = Dialog.confirm({\n      title: __(\"Pick an Asset\"),\n      content: assetSelector\n    })\n\n    if (await dialog && assetSelector.selected) {\n      this.target.addAsset(assetSelector.selected)\n    }\n  }\n}\n\nclass TargetRow extends Gui {\n  constructor (target) {\n    super(`\n<tr class=\"TargetRow\">\n  <td align=\"left\">\n    <img src=%image alt=\"\">\n    <span>%name</span>\n  </td>\n  <td align=\"right\">%command</td>\n  <td align=\"right\">%toPercent:shareDiff</td>\n  <td align=\"right\">%toDiv:description...</td>\n</tr>\n    `)\n\n    this.target = target\n    this.name = target.asset.code\n\n    this.define(\"command\", null, () => this.toCommand(target))\n    this.watch(target, [\"size\", \"mode\", \"share\"], () => this.compute(\"command\"))\n\n    target.asset.project(\"image\", this)\n    target.project(\"shareDiff\", this, (x) => -x)\n\n    if (target.order) target.order.project(\"description\", this)\n  }\n\n  toCommand (target) {\n    switch (target.mode) {\n    case \"ignore\":\n      return __(\"Ignore\")\n    case \"remove\":\n      return __(\"Remove\")\n    case \"amount\":\n      return `${target.size} ${target.asset.code}`\n    case \"weight\":\n      return `${target.size}  ${this.toPercent(target.share)}`\n    case \"percentage\":\n      return this.toPercent(target.share)\n    }\n  }\n\n  toPercent (x) {\n    return !x ? \"-\" : nice(x * 100, 2) + \"%\"\n  }\n\n  toDiv (obj) {\n    return html.create(\"div\", null, obj)\n  }\n}\n","\"use strict\"\n/**\n * Asset Selector\n */\nconst Gui = require(\"@cosmic-plus/domutils/es5/gui\")\nconst Mirrorable = require(\"@cosmic-plus/jsutils/es5/mirrorable\")\nconst { __ } = require(\"@cosmic-plus/i18n\")\n\n/**\n * Definition\n */\n\nmodule.exports = class AssetSelector extends Gui {\n  constructor (assets) {\n    super(`\n<div class=\"AssetSelector\">\n  %groups...\n</div>\n    `)\n\n    this.groups = new Mirrorable()\n\n    const fiats = assets.filter((a) => a.type === \"fiat\")\n    const cryptos = assets.filter((a) => a.type === \"crypto\" && a.isTether)\n    const natives = assets.filter((a) => a.type === \"crypto\" && !a.isTether)\n\n    this.addGroup(__(\"Fiat Tethers\"), fiats)\n    this.addGroup(__(\"Crypto Tethers\"), cryptos)\n    this.addGroup(__(\"Native Assets\"), natives)\n  }\n\n  addGroup (name, assets) {\n    if (!assets.length) return\n\n    const onselect = (asset) => this.selected = asset\n    const group = new AssetGroup(name, assets, onselect)\n    this.groups.push(group)\n  }\n}\n\n/**\n * Helpers\n */\n\nclass AssetGroup extends Gui {\n  constructor (name, assets, onselect) {\n    super(`\n<fieldset class=\"AssetGroup\">\n  <legend>%name</legend>\n  %toAssetRadio:assets...\n</fieldset>\n    `)\n\n    this.name = name\n    this.assets = assets\n    this.onselect = onselect\n  }\n\n  toAssetRadio (asset) {\n    return new AssetRadio(asset, () => this.onselect(asset))\n  }\n}\n\nclass AssetRadio extends Gui {\n  constructor (asset, onselect) {\n    super(`\n<span class=\"AssetRadio half\">\n  <input -ref=%radio type=\"radio\" name=\"asset-selector-group\" %onchange>\n  <label -ref=%label for=%radio>\n    <img src=%image>\n    %name\n  </label>\n</span>\n    `)\n\n    this.name = asset.name\n    this.image = asset.image\n    this.onchange = () => this.radio.checked && onselect()\n\n    this.label.for = this.radio\n    this.label.onclick = () => this.radio.click()\n  }\n}\n","module.exports = \"<section>\\n  <h2>What is Equilibre.io?</h2>\\n\\n  <section class=\\\"landing\\\">\\n    <h3>A Portfolio Balancer for Stellar</h3>\\n\\n    <div><img src=\\\"./images/repartition.png\\\" alt=\\\"\\\">\\n\\n    <p>\\n      Equilibre.io is a portfolio balancer for Stellar. In other words, it is\\n      a software which helps you to spread your funds across various\\n      currencies and crypto assets.\\n    </p>\\n\\n    <p>\\n      I initially created it to protect my funds against a possible bear market.\\n      As it proved reliable, I decided to make it publicly available.\\n    </p>\\n\\n    <p>\\n      Equilibre.io is merely a sophisticated front-end for the Stellar\\n      Decentralized exchange: your account, holdings & operations live on the\\n      blockchain.\\n    </p>\\n\\n    <p>\\n      It works a bit like a multi-currency bank account. Except there's no bank.\\n      And you are the only one in control.\\n    </p>\\n\\n    </div>\\n  </section>\\n\\n  <section class=\\\"landing\\\">\\n    <h3>A Risk Management Solution</h3>\\n\\n    <div><img src=\\\"./images/history.png\\\" alt=\\\"\\\">\\n    <p>\\n      Equilibre.io can help you to implement what is known as a \\\"balanced\\n      investment strategy\\\". Basically, the idea is that balancing funds over\\n      multiple assets will average a portfolio performance & mitigate the risks.\\n    </p>\\n\\n    <p>\\n      Here's how it works: we choose a number of assets we want to be exposed\\n      to, and we attribute a share of the portfolio to each of them (e.g: 20%\\n      each). Then, we \\\"rebalance\\\" the portfolio on a regular basis. This means\\n      that we pass trades that bring back each asset to its allocated share.\\n    </p>\\n\\n    <p>\\n      It is important to understand that Equilibre.io is not an automated\\n      trading bot, nor a magic-free-money scheme. It is a product made for\\n      people who can decide on their own strategy & who understand the risks\\n      they are taking.\\n    </p>\\n    </div>\\n  </section>\\n\\n  <section class=\\\"landing\\\">\\n    <h3>A Fancy Account Viewer</h3>\\n\\n    <div><img src=\\\"./images/balances.png\\\" alt=\\\"\\\">\\n    <p>\\n      Equilibre.io offers a live view of the latest blockchain state. It is also\\n      in sync with the latest market data & displays values and historical data\\n      in your national currency.\\n    <p>\\n\\n    <p>\\n      It is one of the few applications (if not the only one) that can retrieves\\n      the complete history of any Stellar account, and pack that data into a\\n      fancy chart.\\n    </p>\\n    </div>\\n  </section>\\n\\n  <section class=\\\"landing\\\">\\n    <h3>A Sophisticated Trading Engine</h3>\\n\\n\\n    <div><img src=\\\"./images/activity.png\\\" alt=\\\"\\\">\\n    <p>\\n      Equilibre.io is, first of all, a collection of fine-tuned trading\\n      algorithms.  Since a year, I've crash-tested them in every way I could\\n      imagine and packed what worked the best in an easy-to-use interface.\\n    <p>\\n\\n    <p>\\n      It can transform templates such as \\\"I want 50% of my portfolio in BTC and\\n      50% in XLM\\\" into a transaction that passes the required orders. Forget\\n      about trust lines, order books and price picking: all that stuff is dealt\\n      with in the background.\\n    <p>\\n\\n    <p>\\n      The trading engine has a defensive behavior: it prioritizes not losing\\n      money over taking risks to make a profit.\\n    </p>\\n    </div>\\n  </section>\\n\\n\\n  <section class=\\\"landing\\\">\\n    <h3>A New Security Standard for the Years to Come</h3>\\n\\n    <div><img src=\\\"./images/side-frame.png\\\" alt=\\\"\\\">\\n    <p>\\n      Equilibre.io strictly enforce cryptography good practices: I certainly\\n      don't want to know about your private key, nor to obtain any kind of\\n      control over your account. <em>Who can protect a house full of gold and\\n      jewels?</em>\\n    </p>\\n\\n    <p>\\n      When you want to rebalance your portfolio, Equilibre.io generates a\\n      transaction request that you can sign using your own wallet. This is\\n      possible thanks to protocols known as CosmicLink &SEP-0007.\\n    </p>\\n\\n    <p>\\n      Those protocols turn any compatible Stellar wallet into something like\\n      Metamask for Ethereum. At that time, only a few services are compatibles.\\n      However, a number of wallets announced their intention to support\\n      transactions requests in the future, including Keybase, Lobster, and\\n      Stargazer.\\n    <p>\\n    </div>\\n  </section>\\n\\n  <section class=\\\"landing\\\">\\n    <h3>A Free Software, as in Freedom</h3>\\n\\n    <div>\\n    <p>\\n      I think that the free software cooperative mindset can go a long way in\\n      improving a project such as Stellar. That's why I released Equilibre.io in\\n      the public domain. Here are some of the benefits of it:\\n    </p>\\n\\n    <p>\\n      Auditability: The software can be proven to contain no malware and no\\n      tracker. It can be audited for flaws & proven safe.\\n    </p>\\n\\n    <p>\\n      Forkability: Any feature implemented by the software becomes <em>de\\n      facto</em> available to every other developer. For example, the code I\\n      wrote to support Ledger Wallets is <a\\n      href=\\\"https://www.npmjs.com/package/@cosmic-plus/ledger-wallet\\\"\\n      target=\\\"_blank\\\" rel=\\\"noopener\\\">freely available to all</a>.\\n    </p>\\n    </div>\\n  </section>\\n\\n</section>\\n\"","module.exports = \"<section>\\n  <h2>Legal Disclaimer</h2>\\n\\n  <section>\\n    <h3>Risks Related to the Use of Equilibre.io</h3>\\n\\n    <p>\\n      The Application author will not be responsible for any losses, damages or\\n      claims arising from any event related to its use, including but not\\n      limited to:\\n    </p>\\n\\n    <p> Mistakes made by the users of the Application.</p>\\n\\n    <p> Software problems of the Application and/or any\\n    related software or service.</p>\\n\\n    <p> Technical failures in the hardware of the users.</p>\\n\\n    <p> Security problems experienced by the users.</p>\\n\\n    <p> Actions or inactions of third parties and/or events experienced by\\n    third parties.</p>\\n  </section>\\n\\n  <section>\\n    <h3>Not an Exchange</h3>\\n\\n    <p>\\n      The Application is not an exchange. It is an independent front-end for the\\n      Stellar Decentralized Exchange. The Application doesn't have any control\\n      over the user's account, assets that can be bought or sell or the exchange\\n      as a whole.\\n    </p>\\n\\n    <p>\\n      The assets made available through the Application have been selected on\\n      the sole basis of the thickness and the daily volumes of their order book.\\n      Their availability in the Application doesn't constitute a guarantee of\\n      any sort. In particular, no research has been conducted about their\\n      fundamentals or their compliance with national laws that may apply\\n      to them or to the users.\\n    </p>\\n\\n    <p>\\n      The Application doesn't pass any transaction on behalf of the users. The\\n      users are solely responsible for the transactions that they are signing\\n      and sending to the blockchain.\\n    </p>\\n  </section>\\n\\n  <section>\\n    <h3>No Guarantee of Profit</h3>\\n\\n    <p>\\n      Past performance may not be indicative of future results. Different types\\n      of investments involve varying degrees of risk, and there can be no\\n      assurance that the future performance of any specific investment,\\n      investment strategy, or product will be profitable, equal any\\n      corresponding indicated historical performance level(s), or be suitable\\n      for your portfolio.\\n   </p>\\n\\n    <p>\\n      The Application doesn't provide investment advice, financial advice,\\n      trading advice, or any other sort of advice, and none of the Application\\n      content should be treated as such. The users are responsible to conduct\\n      their own diligence and consult their financial advisory before making\\n      investment decisions.\\n    </p>\\n  </section>\\n\\n  <section>\\n    <h3>Compliance With Tax Obligations</h3>\\n\\n    <p>\\n      The users of the Application are solely responsible to determinate what,\\n      if any, taxes apply to their transactions. The author of the Application\\n      is NOT responsible for determining the taxes that apply to transactions.\\n    </p>\\n    \\n    <p>\\n      Some countries are taxing investments on a per-transaction basis, which\\n      can heavily affect the performance of strategies involving high quantities\\n      of micro-transactions.\\n    </p>\\n  </section>\\n\\n</section>\\n\\n\"","\"use strict\"\n/**\n * Footer\n */\nconst Gui = require(\"@cosmic-plus/domutils/es5/gui\")\nconst html = require(\"@cosmic-plus/domutils/es5/html\")\nconst { __ } = require(\"@cosmic-plus/i18n\")\n\nconst donate = require(\"./helpers/donate\")\nconst Icon = require(\"./helpers/icon\")\n\nconst global = require(\"./logic/global\")\n\n/**\n * Class\n */\n\nclass Footer extends Gui {\n  constructor (icons, links) {\n    super(\n      `\n<footer id=\"footer\" class=\"scrollable\">\n  <div class=\"nobreak\">%icons...</div>\n  %links\n</footer>\n    `,\n      { icons, links }\n    )\n  }\n}\n\n/**\n * Icons\n *\n * SVG from @fortawesome/font-awesome-free\n * CC BY 4.0 License (https://creativecommons.org/licenses/by/4.0/)\n */\n\nconst icons = [\n  new Icon(\n    require(\"@cosmic-plus/assets/svg/cosmic-plus.svg\"),\n    __(\"by Cosmic.plus\"),\n    \"https://cosmic.plus\"\n  ),\n  new Icon(\n    require(\"@fortawesome/fontawesome-free/svgs/brands/twitter.svg\"),\n    __(\"Follow on Twitter\"),\n    \"https://twitter.com/cosmic_plus\"\n  ),\n  new Icon(\n    require(\"@fortawesome/fontawesome-free/svgs/brands/reddit.svg\"),\n    __(\"Follow on Reddit\"),\n    \"https://reddit.com/r/cosmic_plus\"\n  ),\n  new Icon(\n    require(\"@fortawesome/fontawesome-free/svgs/brands/medium.svg\"),\n    __(\"Follow on Medium\"),\n    \"https://medium.com/cosmic-plus\"\n  ),\n  new Icon(\n    require(\"@fortawesome/fontawesome-free/svgs/brands/telegram-plane.svg\"),\n    __(\"Chat on Telegram\"),\n    \"https://t.me/cosmic_plus\"\n  ),\n  new Icon(\n    require(\"@fortawesome/fontawesome-free/svgs/brands/keybase.svg\"),\n    __(\"Chat on Keybase\"),\n    \"https://keybase.io/team/cosmic_plus\"\n  ),\n  new Icon(\n    require(\"@fortawesome/fontawesome-free/svgs/brands/github.svg\"),\n    __(\"GitHub Repository\"),\n    \"https://git.cosmic.plus\"\n  ),\n  new Icon(\n    require(\"@fortawesome/fontawesome-free/svgs/solid/envelope.svg\"),\n    __(\"Contact by Email\"),\n    \"mailto:mister.ticot@cosmic.plus\"\n  ),\n  new Icon(\n    require(\"@cosmic-plus/assets/svg/donate.svg\"),\n    __(\"Donate Lumens\"),\n    donate\n  )\n]\n\n/**\n * Links\n */\nconst links = new Gui(\n  `\n<p>\n  <a onclick=%displayLicense>${__(\"License\")}</a>\n   <a onclick=%displayDisclaimer>${__(\"Disclaimer\")}</a>\n   <a onclick=%displayAbout>${__(\"About\")}</a>\n</p>\n`,\n  {\n    displayLicense: () => global.tabs.select(\"#license\"),\n    displayDisclaimer: () => global.tabs.select(\"#disclaimer\"),\n    displayAbout: () => global.tabs.select(\"#about\")\n  }\n)\n\n/**\n * Create footer\n */\n\nconst footer = new Footer(icons, links)\nhtml.append(document.body, footer)\n","\"use strict\"\n/**\n * Donate Interface\n */\nconst { CosmicLink } = require(\"cosmic-lib\")\nconst { __ } = require(\"@cosmic-plus/i18n\")\n\nmodule.exports = function promptDonation () {\n  const amount = prompt(`\\\n${__(\"Donations are put to good use.\")} \\\n${__(\"Thank you!\")}\n\n${__(\"Enter an amount (in Lumens)\")}:\\\n`)\n\n  if (amount === \"0\" || isNaN(+amount)) {\n    confirm(`${__(\"Not a valid amount\")}: ${amount}`)\n  } else if (amount) {\n    showDonateFrame(amount)\n  }\n}\n\nfunction showDonateFrame (amount) {\n  const memo = __(\"Donation to Cosmic.plus\")\n  const network = \"public\"\n  const destination = \"tips*cosmic.plus\"\n  const cosmicLink = new CosmicLink({ memo, network }).addOperation(\"payment\", {\n    amount,\n    destination\n  })\n\n  cosmicLink.open()\n}\n","\"use strict\"\n/**\n * Footer Icons\n */\nconst Gui = require(\"@cosmic-plus/domutils/es5/gui\")\n\nclass Icon extends Gui {\n  constructor (image, name, action) {\n    super(`<a -ref=%link class=\"Icon\">%image</a>`)\n\n    this.image = typeof image === \"string\" ? new Gui(image) : image\n    this.link.title = name\n\n    if (typeof action === \"function\") {\n      this.link.onclick = action\n    } else if (typeof action === \"string\") {\n      this.link.href = action\n      if (action.match(/^http/)) {\n        this.link.target = \"_blank\"\n        this.link.rel = \"noopener\"\n      }\n    }\n  }\n}\n\nmodule.exports = Icon\n"],"sourceRoot":""}
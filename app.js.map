{"version":3,"sources":["webpack:///./src/app.js","webpack:///./src/helpers/misc.js","webpack:///./src/logic/asset.js","webpack:///./src/logic/balance.js","webpack:///./src/helpers/click-wall.js","webpack:///./src/helpers/side-frame.js","webpack:///./src/logic/market-data.js","webpack:///./src/logic/orderbook.js","webpack:///./src/logic/anchor.js","webpack:///./src/helpers/form.js","webpack:///./src/helpers/html-extra.js","webpack:///./src/logic/portfolio.js","webpack:///./src/logic/offers.js","webpack:///./src/helpers/bind-dom-key.js","webpack:///./src/helpers/handle-extra-attributes.js","webpack:///./src/helpers/dom.js","webpack:///./src/activity-gui.js","webpack:///./src/widgets/active-offers-table.js","webpack:///./src/portfolio-gui.js","webpack:///./src/widgets/asset-price-chart.js","webpack:///./src/widgets/portfolio-pie-chart.js","webpack:///./src/widgets/helpers/highcharts-theme.js","webpack:///./src/widgets/portfolio-table.js","webpack:///./src/settings-gui.js","webpack:///./src/rebalance-gui.js","webpack:///./src/logic/target.js","webpack:///./src/logic/order.js","webpack:///./src/logic/strategy.js","webpack:///./src/widgets/target-setup.js","webpack:///./src/widgets/target-setup-anchors.js","webpack:///./src/widgets/target-setup-size.js","webpack:///./src/widgets/targets-controls.js","webpack:///./src/widgets/targets-table.js","webpack:///./src/widgets/asset-prompt.js","webpack:///./src/widgets/asset-selector.js","webpack:///./src/helpers/dialog.js","webpack:///./src/helpers/modal.js","webpack:///./bundled/license.html","webpack:///./bundled/welcome.html","webpack:///./src/footer.js","webpack:///./src/helpers/donate.js","webpack:///./src/helpers/icon.js","webpack:///./bundled/donate.svg"],"names":["dom","require","Gui","html","Tabs","params","__","global","Portfolio","ClickWall","Form","isOverflowing","ActivityGui","PortfolioGui","SettingsGui","RebalanceGui","license","welcome","Asset","knownAssets","register","fiat","type","isTether","foreign","resolve","currency","tabs","nav","header","view","main","add","loginForm","select","location","hash","selected","fitScreen","replace","domNode","selector","ledger","hidden","onsubmit","login","_callee","_regeneratorRuntime","wrap","_context","prev","next","Promise","all","__webpack_require__","e","then","t","bind","sent","info","connect","publicKey","t0","error","stop","_callee2","address","clickWall","_context2","disconnect","$set","enable","portfolio","concat","setTimeout","listen","initGui","destroy","remove","href","id","content","pieChart","reflow","loginWithLedger","onclick","page","window","scrollTo","misc","exports","positive","number","Math","max","negative","min","fixed7","Number","toFixed","clamp","value","absoluteMin","value1","value2","abs","arrayContains","array","indexOf","arrayRemove","item","index","length","splice","arrayOnlyInFirst","array1","array2","filter","arraySum","key","reduce","sum","obj","x","arrayScale","targetSum","map","FIAT_BASEURL","FIAT_IMAGEFORMAT","Mirrorable","Projectable","marketData","Orderbook","module","_Projectable","_this","_classCallCheck","this","_possibleConstructorReturn","_getPrototypeOf","call","Object","assign","_assertThisInitialized","table","image","code","fiats","push","toLowerCase","useGlobalPrice","cryptos","name","anchors","balances","offers","mirror","balance","watch","compute","orderbook","forAsset","define","globalPrice","price","_inherits","_createClass","_getInfo","_asyncToGenerator","mark","abrupt","crypto","small","apply","arguments","addChild","amount","rawLiabilities","entry","buying","selling","assets","defaults","getAllInfo","values","forEach","asset","getInfo","refreshPrices","_ref","refreshCryptoPrices","refreshFiatPrices","_x","_callee3","prices","_args3","_context3","undefined","_callee4","_args4","_context4","setInterval","console","log","Anchor","Balance","issuer","anchor","makeId","known","update","project","forBalance","record","recordToParams","hasTrustline","trap","_this2","target","opening","pubkey","action","targetAmount","balanceTargetDeviation","targetMin","targetMax","targetMinDiff","targetMaxDiff","Error","fromRecord","create","asset_type","asset_code","asset_issuer","buying_liabilities","selling_liabilities","timeout","className","click","style","document","body","insertBefore","firstChild","scrollbar","opacity","delay","isEnabled","htmlOverflow","documentElement","overflow","bodyOverflow","show","setOpacity","hide","disable","transition","background","position","zIndex","top","width","height","Observable","SideFrame","url","current","close","title","src","sandbox","append","animationName","shadow","trigger","_this3","_this4","addEventListener","event","frameWindow","contentWindow","source","data","right","maxWidth","border","backgroundImage","backgroundRepeat","backgroundPosition","backgroundSize","padding","color","fontSize","fontWeight","cursor","borderBottomLeftRadius","axios","nice","day","coingeckoCall","get","exchangeratesCall","_callee8","symbols","_args8","_context8","base","join","response","start_at","rates","EUR","cacheHistory","localStorage","JSON","stringify","cachedHistory","json","_JSON$parse","parse","_JSON$parse2","_slicedToArray","date","setHistoryLatestPrice","assetHistory","limit","history","list","symbol","toUpperCase","apiId","stellarNative","tickers","coin_id","_ref3","localization","market_data","community_data","developer_data","sparkline","_ref4","ids","quote","vs_currencies","assetData","_x2","_ref5","_callee5","_args5","_context5","vs_currency","days","time","volume","total_volumes","_x3","_ref6","_callee6","_context6","_x6","_ref7","_callee7","cached","end_at","today","_args7","_context7","Date","toISOString","slice","setDate","getDate","keys","sort","getTime","_x7","cosmicLib","StellarSdk","offersCallBuilder","updateOffersPrices","childs","streamOffers","addOrderbook","_streamOffers","getOffers","_getOffers","ingest","areOffersEquals","bids","normalizeOffers","asks","set","side","merged","child","sortOffers","a","b","baseVolume","quoteVolume","row","mergedRow","quoteAmount","mergeOffers","baseAsset","quoteAsset","server","basePrice","bestBid","bestAsk","marketPrice","spread","prototype","isFetched","and","findOffer","last","childsNum","offer","findAsk","findBid","depth","aliases","helpers","alias","shorter","emit","addAsset","tetherCode","assetCode","Array","isArray","hiddenKey","setHiddenProperty","bindDomKey","handleExtraAttributes","_len","_key","tagName","element","getAttribute","preventDefault","bindInputs","status","submit","reset","$status","_len2","_key2","rewrite","report","spinner","message","binder","$node","object","walk","attributes","disabled","enabled","label","_len3","_key3","button","_len4","_key4","_toConsumableArray","control","tag","required","textarea","placeholder","unshift","selectedIndex","input","datetime","constructor","shift","func","childNodes","parent","i","Offers","accountId","accountCallBuilder","isSupported","checkNetwork","destination","memo","isAccountEmpty","account_id","config","streamAccount","getAccount","account","_loop","forPortfolio","stream","accounts","horizon","availableAssets","allAssets","total","loopcall","callBuilder","records","alive","Offer","clean","forAccount","listOutdated","outdated","intern","recordToId","rawPrice","rawAmount","last_modified_time","last_modified_ledger","objKey","$input","nodeKey","importKeyOn","eventName","setCustomValidity","link","init","SELECT","$select","interactive","TEXTAREA","$textarea","INPUT","radio","checkbox","$radio","setter","checked","checkBox","$checkbox","setAliases","$label","for","$span","handleLabel","validate","hasProperty","reportValidity","validateNodeValue","handleValidate","scrollHeight","clientHeight","scrollWidth","clientWidth","ActiveOffersTable","_Gui","globalCurrency","CosmicLink","OfferRow","txParams","network","maxTime","cosmicLink","addOperation","offerId","uri","toLocaleDateString","AssetPriceChart","PortfolioPieChart","PortfolioTable","coingecko","maybeDrawPriceChart","overview","priceChart","Highstock","drawChart","chart","stockChart","container","rangeSelector","backgroundColor","fontFamily","yAxis","labels","align","resize","offset","series","credits","Highcharts","makePoint","y","percentage","draw","legend","tooltip","pointFormat","plotOptions","pie","dataLabels","format","point","events","options","legendItemClick","colorByPoint","ignoreHiddenPoint","theme","allowPointSelect","animation","responsive","rules","condition","chartOptions","showInLegend","distance","colors","setOptions","rows","toAssetRow","onselect","AssetRow","selectedRow","simpleView","find","detailledView","cell","amounts","node","priceDetails","feed","anchorName","simple","mode","anchorTotal","anchorHeader","languages","us","fr","currencies","general","GeneralSettings","reload","Target","TargetSetup","TargetsControls","TargetsTable","targetKey","template","toJson","controls","Order","strategy","order","rebalance","size","computeAll","closing","root","group","hasChanged","valueDiff","amountDiff","share","addAnchor","refresh","removeAnchor","sortChilds","localeCompare","fromJson","isValid","findIndex","fromObject","beautifyFlag","toObject","_target$childs","percentChilds","toCosmicLink","operations","toOperations","operationsToCosmicLink","tdesc","odesc","pop","remains","shouldOpenTrustline","setOperation","shouldCloseTrustline","method","parameters","make","operation","newOperation","getOperation","cost","operationDirection","op","addOneOperation","noMinValue","baseAsk","minOfferValue","sizeMin","sizeMax","skipMarginalOffers","makeOfferFilter","addMultipleOperations","tradeSize","trade","liquidate","_addToTrade","misallocatedKey","misallocated","sizeKey","tradable","amountsSum","operationsToDescription","price_r","n","d","operationToOdesc","desc","market","spreadTightening","clone","diff","premium","maxSpread","anchorPrice","minPrice","maxPrice","clampOfferPrice","updateOfferPriceR","tightenSpread","amountDelta","liabilities","description","isActive","setBalancesTargets","areTargetAnchorsBalanced","riskMax","anchorsRebalanceRiskMax","under","over","currentRisk","valueDiffP","amountCap","transferAmount","buy","sell","balanceTargetAnchors","isOneOperationEnough","_construct","delayed","weights","weight","allocated","available","checkUnderFlag","overP","msg","underP","checkAllocationLimits","ignore","TargetSetupAnchors","TargetSetupSize","sizeSetup","anchorsSetup","maybeSwitchMode","AnchorCheckbox","getState","isTargetAnchorActive","callback","switchAnchor","targetIsXlm","modified","AssetPrompt","targets","toTargetRow","sortTargets","TargetRow","_addAsset","assetPrompt","open","answer","toCommand","toPercent","AssetSelector","Dialog","Modal","_Modal","assetSelector","actions","returns","groups","natives","addGroup","AssetGroup","AssetRadio","_this5","onchange","_ref2","_ref2$","styleParams","translate","left","bottom","transform","setPosition","donate","Icon","Footer","icons","links","MYPUBKEY","demoConfig","footer","displayDemo","displayLicense","displayAbout","prompt","isNaN","confirm","showDonateFrame","match","rel"],"mappings":"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","file":"app.js","sourcesContent":["\"use strict\"\n/**\n * Login interface\n */\nconst dom = require(\"@cosmic-plus/domutils/es5/dom\")\nconst Gui = require(\"@cosmic-plus/domutils/es5/gui\")\nconst html = require(\"@cosmic-plus/domutils/es5/html\")\nconst Tabs = require(\"@cosmic-plus/domutils/es5/tabs\")\nconst params = require(\"@cosmic-plus/domutils/es5/params\")\nconst { __ } = require(\"@cosmic-plus/i18n\")\n\nconst global = require(\"./logic/global\")\nconst Portfolio = require(\"./logic/portfolio\")\n\nconst ClickWall = require(\"./helpers/click-wall\")\nconst Form = require(\"./helpers/form\")\nconst { isOverflowing } = require(\"./helpers/dom\")\n\nconst ActivityGui = require(\"./activity-gui\")\nconst PortfolioGui = require(\"./portfolio-gui\")\nconst SettingsGui = require(\"./settings-gui\")\nconst RebalanceGui = require(\"./rebalance-gui\")\n\nconst license = new Gui(require(\"../bundled/license.html\"))\nconst welcome = new Gui(require(\"../bundled/welcome.html\"))\n\nrequire(\"./footer\")\n\n/**\n * Init\n */\n\n// Load known assets.\nconst Asset = require(\"./logic/asset\")\nconst knownAssets = require(\"./data/assets.json\")\nAsset.register(knownAssets.fiat, { type: \"fiat\", isTether: true })\nAsset.register(knownAssets.foreign, { type: \"crypto\", isTether: true })\nAsset.register(knownAssets.native, { type: \"crypto\", isTether: false })\nAsset.resolve(global.currency, { type: \"fiat\", isTether: true })\n\n// Load known anchors.\nconst Anchor = require(\"./logic/anchor\")\nAnchor.register(require(\"./data/anchors.json\"))\n\nconst tabs = global.tabs = new Tabs({ nav: dom.header, view: dom.main })\ntabs.add(\"#welcome\", __(\"Welcome\"), welcome)\ntabs.add(\"#login\", __(\"Login\"), dom.loginForm)\ntabs.add(\"#license\", null, license)\ntabs.add(\"#about\", null, welcome)\n\ntabs.select(location.hash)\nif (!tabs.selected) tabs.select(\"#welcome\")\n\ntabs.fitScreen = function () {\n  if (isOverflowing(dom.header)) {\n    html.replace(tabs.nav.domNode, tabs.selector.domNode)\n  }\n}\ntabs.fitScreen()\n\nconst loginForm = new Form(dom.loginForm, { hidden: false, onsubmit: login })\nloginForm.dom.loginWithLedger.onclick = loginWithLedgerWallet\n\nif (params.address) {\n  tabs.select(\"#login\")\n  loginForm[\"stellar-public-key\"] = params.address\n  login()\n}\n\ntabs.listen(\"select\", page => {\n  location.hash = page\n  window.scrollTo(0, 0)\n})\n\n/**\n * Functions\n */\n\nlet ledger\nasync function loginWithLedgerWallet () {\n  loginForm[\"stellar-public-key\"] = null\n  ledger = await getLedgerModule()\n  loginForm.info(__(\"Please open the Stellar App in your Ledger Wallet\"))\n  try {\n    await ledger.connect()\n    loginForm[\"stellar-public-key\"] = ledger.publicKey\n    login()\n  } catch (error) {\n    loginForm.error(error)\n  }\n}\n\nasync function login () {\n  const address = loginForm[\"stellar-public-key\"]\n  if (!address) loginForm.error(__(\"Please enter an address.\"))\n  if (ledger) ledger.disconnect()\n\n  loginForm.info(__(\"Connecting to your account...\"))\n  params.$set({ address })\n\n  const clickWall = new ClickWall()\n  clickWall.enable()\n\n  try {\n    global.portfolio = await Portfolio.resolve(address)\n    loginForm.info(`${__(\"Fetching market data\")}...`)\n    setTimeout(\n      () => loginForm.info(`${__(\"Sorry, it takes a while (^.^)\\\"\")}...`),\n      10000\n    )\n    setTimeout(() => loginForm.info(`${__(\"Almost there\")}...`), 20000)\n    setTimeout(\n      () => loginForm.info(`${__(\"I'm running, I'm running\")}...`),\n      30000\n    )\n    global.portfolio.listen(\"open\", () => {\n      initGui()\n      clickWall.destroy()\n    })\n  } catch (error) {\n    clickWall.destroy()\n    loginForm.error(error)\n  }\n}\n\nfunction initGui () {\n  const portfolio = global.portfolio\n\n  const selected = location.hash\n  tabs.remove(\"#welcome\")\n  tabs.remove(\"#login\")\n  tabs.add(\"#portfolio\", __(\"Portfolio\"), new PortfolioGui(portfolio))\n  tabs.add(\"#rebalance\", __(\"Rebalance\"), new RebalanceGui(portfolio))\n  tabs.add(\"#activity\", __(\"Activity\"), new ActivityGui(portfolio))\n  tabs.add(\"#settings\", __(\"Settings\"), new SettingsGui())\n  tabs.add(\"#logout\", __(\"Logout\"), () => {\n    location.replace(location.href.replace(/\\?.*$/, \"#login\"))\n  })\n  tabs.fitScreen()\n\n  // Fix portfolio pie chart positioning.\n  tabs.listen(\"select\", id => {\n    if (id === \"#portfolio\") tabs.selected.content.pieChart.reflow()\n  })\n\n  tabs.select(selected)\n  if (!tabs.selected) tabs.select(\"#portfolio\")\n}\n\n/**\n * Module loading\n */\n\nfunction getLedgerModule () {\n  return import(\n    /* webpackChunkName: \"ledger\" */ \"@cosmic-plus/ledger-wallet\"\n  ).then(ledger => ledger.default)\n}\n","\"use strict\"\n/**\n * Various independent helpers.\n */\nconst misc = exports\n\n/**\n * Returns **number** if it is greater than 0, else returns 0.\n */\nmisc.positive = function (number) {\n  return Math.max(0, number)\n}\n\n/**\n * Returns **number** if it is lesser than 0, else returns 0.\n */\nmisc.negative = function (number) {\n  return Math.min(0, number)\n}\n\n/**\n * Returns **number** with 7 digits after the dot.\n */\nmisc.fixed7 = function (number) {\n  return +Number(number).toFixed(7)\n}\n\n/**\n * Returns a number whose value is limited to the given range.\n */\nmisc.clamp = function (value, min, max) {\n  return Math.min(Math.max(value, min), max)\n}\n\n/**\n * Returns **value1** if its absolute is lesser than or equal **value2**\n * absolute, else returns **value2**.\n */\nmisc.absoluteMin = function (value1, value2) {\n  return Math.abs(value1) <= Math.abs(value2) ? value1 : value2\n}\n\n/**\n * Return whether or not **array** contains **value**.\n */\nmisc.arrayContains = function (array, value) {\n  return array.indexOf(value) !== -1\n}\n\n/**\n * Remove all the occurences of **item** from **array**.\n */\nmisc.arrayRemove = function (array, item) {\n  for (let index = array.length - 1; index >= 0; index--) {\n    if (array[index] === item) array.splice(index, 1)\n  }\n}\n\n/**\n * Returns values that are in **array1** but not in **array2**.\n */\nmisc.arrayOnlyInFirst = function (array1, array2) {\n  return array1.filter(item => !misc.arrayContains(array2, item))\n}\n\n/**\n * Sum array values, or array elements `key` if specified.\n */\nmisc.arraySum = function (array, key) {\n  if (key) return array.reduce((sum, obj) => sum + obj[key], 0)\n  else return array.reduce((sum, x) => sum + x, 0)\n}\n\n/**\n * Proportionally scale **array** values, or **array** elements **key** property\n * if provided, to make their sum equal **targetSum**.\n */\nmisc.arrayScale = function (array, targetSum, key) {\n  const sum = misc.arraySum(array, key)\n  if (!sum) return array.map(() => 0)\n\n  if (key) return array.map(obj => obj[key] * targetSum / sum)\n  else return array.map(x => x * targetSum / sum)\n}\n","\"use strict\"\n/**\n * Asset class\n */\n\nconst AUTO_REFRESH_PRICES = true\nconst CRYPTO_PRICES_REFRESH_DELAY = 60 * 1000\nconst FIAT_PRICES_REFRESH_DELAY = 60 * 60 * 1000\nconst FIAT_BASEURL = \"https://www.xe.com/themes/xe/images/flags/svg/\"\nconst FIAT_IMAGEFORMAT = \".svg\"\n\nconst Mirrorable = require(\"@cosmic-plus/jsutils/es5/mirrorable\")\nconst Projectable = require(\"@cosmic-plus/jsutils/es5/projectable\")\n\nconst marketData = require(\"./market-data\")\nconst Orderbook = require(\"./orderbook\")\nconst { fixed7, arraySum } = require(\"../helpers/misc\")\n\n/**\n * Class\n */\n\nconst Asset = module.exports = class Asset extends Projectable {\n  static resolve (id, params) {\n    return Asset.table[id] || new Asset(id, params)\n  }\n\n  constructor (id, params) {\n    super()\n    if (params) Object.assign(this, params)\n\n    this.id = id\n    Asset.table[id] = this\n\n    // Empty image by default\n    this.image = \"data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=\"\n\n    if (this.type) {\n      this.code = id\n      if (this.type === \"fiat\") {\n        Asset.fiats.push(this)\n        this.image = `${FIAT_BASEURL}${id.toLowerCase()}${FIAT_IMAGEFORMAT}`\n        this.useGlobalPrice = true\n      } else {\n        Asset.cryptos.push(this)\n        this.type = \"crypto\"\n        if (this.isTether || this.id === \"XLM\") this.useGlobalPrice = true\n      }\n    } else {\n      this.code = id.replace(/:.*/, \"\")\n      this.name = this.code\n      this.type = \"unknown\"\n    }\n\n    this.anchors = new Mirrorable()\n    this.balances = new Mirrorable()\n    this.offers = new Mirrorable()\n\n    this.balances.mirror(balance => {\n      this.watch(balance, \"amount\", () => this.compute(\"amount\"))\n      this.watch(balance, [\"buying\", \"selling\"], () => {\n        this.compute(\"liabilities\")\n      })\n    })\n\n    this.orderbook = Orderbook.forAsset(this)\n    this.define(\"price\", \"globalPrice\", () => {\n      return this.globalPrice || this.orderbook.price\n    })\n    this.watch(this.orderbook, \"price\", () => this.compute(\"price\"))\n  }\n\n  async getInfo () {\n    // Happens once & only for cryptos.\n    if (this.name || this.type !== \"crypto\") return\n    this.info = await marketData.crypto.info(this)\n    this.name = this.info.name\n    this.image = this.info.image.small\n  }\n\n  addOrderbook (orderbook) {\n    this.orderbook.addChild(orderbook)\n  }\n}\n\nAsset.define(\"amount\", \"balances\", function () {\n  return this.balances && fixed7(arraySum(this.balances, \"amount\"))\n})\n\nAsset.define(\"value\", [\"amount\", \"price\"], function () {\n  return this.amount === 0 ? 0 : this.amount * this.price\n})\n\nAsset.define(\"liabilities\", [\"balances\", \"price\"], function () {\n  if (this.balances) {\n    const rawLiabilities = this.balances.reduce(\n      (sum, entry) => sum + entry.buying - entry.selling,\n      0\n    )\n    return this.price * rawLiabilities\n  }\n})\n\nAsset.define(\"isSupported\", [\"type\", \"price\"], function () {\n  return !!(this.type !== \"unknown\" || this.price)\n})\n\n/**\n * Utilities\n */\n\n/**\n * Registers **assets** as known assets, assigns **params** to them.\n */\nAsset.register = function (assets, defaults) {\n  for (let code in assets) {\n    const params = Object.assign({}, defaults, assets[code])\n    Asset.resolve(code, params)\n  }\n}\n\n/**\n * Get general information (name, logo, ...) for all known assets.\n */\nAsset.getAllInfo = function () {\n  const assets = Object.values(Asset.table)\n  assets.forEach(asset => asset.getInfo())\n}\n\nAsset.refreshPrices = async function (array) {\n  if (!array) {\n    await Asset.refreshCryptoPrices()\n    await Asset.refreshFiatPrices()\n  } else {\n    await Asset.refreshCryptoPrices(\n      array.filter(asset => asset.type === \"crypto\").map(asset => asset.code)\n    )\n    await Asset.refreshFiatPrices(\n      array.filter(asset => asset.type === \"fiat\").map(asset => asset.code)\n    )\n  }\n}\n\nAsset.refreshCryptoPrices = async function (assets = Asset.cryptos) {\n  if (!assets.length) return\n  const prices = await marketData.crypto.prices(assets)\n  assets.forEach(asset => {\n    if (asset.useGlobalPrice) asset.globalPrice = prices[asset.code]\n  })\n}\n\nAsset.refreshFiatPrices = async function (fiats = Asset.fiats) {\n  if (!fiats.length) return\n  const prices = await marketData.fiat.prices(fiats)\n  fiats.forEach(asset => {\n    if (asset.useGlobalPrice) asset.globalPrice = prices[asset.code]\n  })\n}\n\n/**\n * Init\n */\n\nAsset.table = {}\nAsset.cryptos = []\nAsset.fiats = []\n\n// Automatic global price refresh\nif (AUTO_REFRESH_PRICES) {\n  setInterval(Asset.refreshCryptoPrices, CRYPTO_PRICES_REFRESH_DELAY)\n  setInterval(Asset.refreshFiatPrices, FIAT_PRICES_REFRESH_DELAY)\n}\n\n// eslint-disable-next-line no-console\nconsole.log(Asset.table)\n","\"use strict\"\n/**\n * Balance\n */\nconst Mirrorable = require(\"@cosmic-plus/jsutils/es5/mirrorable\")\nconst Projectable = require(\"@cosmic-plus/jsutils/es5/projectable\")\n\nconst Anchor = require(\"./anchor\")\nconst Asset = require(\"./asset\")\nconst Orderbook = require(\"./orderbook\")\n\nconst global = require(\"./global\")\nconst { fixed7, positive, negative, arrayRemove } = require(\"../helpers/misc\")\n\n/**\n * Definition\n */\nclass Balance extends Projectable {\n  static resolve (code, issuer) {\n    const id = Balance.makeId(code, issuer)\n    return Balance.table[id] || new Balance({ code, issuer })\n  }\n\n  static ingest (record) {\n    const params = Balance.recordToParams(record)\n    const balance = Balance.resolve(params.code, params.issuer)\n    balance.update(params)\n    balance.hasTrustline = true\n    return balance\n  }\n\n  constructor (params) {\n    const { code, issuer } = params\n\n    super()\n\n    // Identification\n    this.code = code\n    this.anchor = Anchor.resolve(issuer || \"stellar.org\")\n    this.id = Balance.makeId(code, issuer)\n    Balance.table[this.id] = this\n\n    // Link with an asset object.\n    if (this.code in this.anchor.assets) {\n      this.asset = this.anchor.assets[this.code]\n      this.known = true\n    } else {\n      this.asset = Asset.resolve(this.id)\n      this.known = false\n    }\n    this.asset.balances.push(this)\n\n    // Set updatable properties.\n    this.update(params)\n    this.offers = new Mirrorable()\n\n    // Dynamic price definition.\n    if (this.code === \"XLM\") {\n      this.asset.project(\"price\", this)\n    } else {\n      this.orderbook = Orderbook.forBalance(this, Asset.resolve(\"XLM\"))\n      this.orderbook.project(\"price\", this)\n    }\n  }\n\n  update (params) {\n    const { amount, buying, selling } = params\n    this.amount = amount || 0\n    this.buying = buying || 0\n    this.selling = selling || 0\n  }\n}\n\nBalance.table = {}\n\nBalance.trap(\"hasTrustline\", () => {\n  if (this.hasTrustline) {\n    arrayRemove(this.asset.target.opening, this.anchor.pubkey)\n  }\n})\n\nBalance.define(\"isActive\", [\"action\", \"hasTrustline\"], function () {\n  if (this.hasTrustline) return this.action !== \"closing\"\n  else return this.action === \"opening\"\n})\n\nBalance.define(\"value\", [\"amount\", \"price\"], function () {\n  return this.amount === 0 ? 0 : this.amount * this.price\n})\n\n// targetAmount is set by \"./order.js\"\nBalance.define(\"targetMin\", [\"targetAmount\"], function () {\n  return fixed7(this.targetAmount * (1 - global.balanceTargetDeviation))\n})\nBalance.define(\"targetMax\", [\"targetAmount\"], function () {\n  return fixed7(this.targetAmount * (1 + global.balanceTargetDeviation))\n})\nBalance.define(\"targetMinDiff\", [\"amount\", \"targetMin\"], function () {\n  return fixed7(this.targetMin - this.amount)\n})\nBalance.define(\"targetMaxDiff\", [\"amount\", \"targetMax\"], function () {\n  return fixed7(this.targetMax - this.amount)\n})\nBalance.define(\"sizeMin\", [\"targetMinDiff\"], function () {\n  return negative(this.targetMinDiff)\n})\nBalance.define(\"sizeMax\", [\"targetMaxDiff\"], function () {\n  return positive(this.targetMaxDiff)\n})\nBalance.define(\"underMin\", [\"targetMinDiff\"], function () {\n  return negative(-this.targetMinDiff)\n})\nBalance.define(\"overMax\", [\"targetMaxDiff\"], function () {\n  return positive(-this.targetMaxDiff)\n})\n\n/**\n * Utilities\n */\n\nBalance.makeId = function (code, issuer) {\n  if (issuer) return `${code}:${issuer}`\n  else if (code === \"XLM\") return \"XLM\"\n  else throw new Error(`Missing issuer for ${code}.`)\n}\n\n/**\n * API-Specific Format: Record\n **/\n\nBalance.fromRecord = function (record) {\n  const params = Balance.recordToParams(record)\n  return new Balance(params)\n}\n\nBalance.recordToParams = function (record) {\n  const params = Object.create(record)\n  params.code = record.asset_type === \"native\" ? \"XLM\" : record.asset_code\n  params.issuer = record.asset_issuer\n  params.amount = +record.balance\n  params.buying = +record.buying_liabilities\n  params.selling = +record.selling_liabilities\n  return params\n}\n\n/**\n * Export\n */\nmodule.exports = Balance\n","\"use strict\"\n/**\n * Overlay that prevent user interaction\n */\nconst html = require(\"@cosmic-plus/domutils/es5/html\")\nconst { timeout } = require(\"@cosmic-plus/jsutils/es5/misc\")\n\n/**\n * Definition\n */\n\nclass ClickWall {\n  constructor (params = {}) {\n    this.domNode = html.create(\"div\", {\n      className: \"ClickWall\",\n      onclick: () => this.click(),\n      hidden: true\n    })\n\n    Object.assign(this.domNode.style, ClickWall.style)\n    document.body.insertBefore(this.domNode, document.body.firstChild)\n\n    this.onclick = params.onclick\n    this.scrollbar = params.scrollbar\n    this.opacity = params.opacity\n    this.delay = params.delay || ClickWall.delay\n  }\n\n  click () {\n    if (this.isEnabled && this.onclick) this.onclick()\n  }\n\n  async enable () {\n    // Scrollbar hidding.\n    if (this.scrollbar === \"hide\") {\n      this.htmlOverflow = document.documentElement.style.overflow\n      this.bodyOverflow = document.body.style.overflow\n      document.documentElement.style.overflow = \"hidden\"\n      document.body.style.overflow = \"hidden\"\n    }\n\n    // Fade in.\n    html.show(this.domNode)\n    if (this.opacity) await this.setOpacity(this.opacity)\n    this.isEnabled = true\n  }\n\n  async disable () {\n    // Handle scrollbar hidding.\n    if (this.scrollbar === \"hide\") {\n      document.documentElement.style.overflow = this.htmlOverflow\n      document.body.style.overflow = this.bodyOverflow\n    }\n\n    // Fade out.\n    this.isEnabled = false\n    if (this.opacity) await this.setOpacity(0)\n    html.hide(this.domNode)\n  }\n\n  async destroy () {\n    await this.disable()\n    html.destroy(this.domNode)\n  }\n\n  async setOpacity (opacity = this.opacity) {\n    await timeout(0)\n    Object.assign(this.domNode.style, {\n      transition: `background ${this.delay}ms`,\n      background: `rgba(0, 0, 0, ${opacity})`\n    })\n    return timeout(this.delay)\n  }\n}\n\n/**\n * Configuration\n */\n\nClickWall.delay = 500\n\nClickWall.style = {\n  position: \"fixed\",\n  zIndex: 999,\n  top: 0,\n  width: \"100%\",\n  height: \"100%\"\n}\n\n/**\n * Export\n */\nmodule.exports = ClickWall\n","\"use strict\"\n/**\n * Signing Side Frame\n */\nconst html = require(\"@cosmic-plus/domutils/es5/html\")\nconst Observable = require(\"@cosmic-plus/jsutils/es5/observable\")\nconst { __ } = require(\"@cosmic-plus/i18n\")\n\nconst ClickWall = require(\"./click-wall\")\n\n/**\n * Class\n */\n\nclass SideFrame extends Observable {\n  constructor (url) {\n    super()\n\n    if (SideFrame.current) SideFrame.current.close()\n    SideFrame.current = this\n\n    this.domNode = html.create(\"iframe\", {\n      title: \"Signing Frame\",\n      className: \"animated\",\n      src: url,\n      sandbox: \"allow-same-origin allow-scripts allow-forms allow-popups\",\n      hidden: true\n    })\n    Object.assign(this.domNode.style, SideFrame.style)\n    html.append(document.body, this.domNode)\n\n    this.show()\n  }\n\n  show () {\n    if (!this.domNode.hidden) return\n\n    this.domNode.style.animationName = \"slideInRight\"\n    html.show(SideFrame.close, this.domNode)\n\n    return SideFrame.shadow.enable().then(() => {\n      SideFrame.shadow.onclick = () => this.close()\n      SideFrame.close.onclick = () => this.close()\n      this.trigger(\"show\")\n    })\n  }\n\n  hide () {\n    if (this.domNode.hidden) return\n\n    html.hide(SideFrame.close)\n    this.domNode.style.animationName = \"slideOutRight\"\n\n    return SideFrame.shadow.disable().then(() => {\n      html.hide(this.domNode)\n      this.trigger(\"hide\")\n    })\n  }\n\n  close () {\n    SideFrame.current = null\n    this.hide().then(() => {\n      html.destroy(this.domNode)\n      this.trigger(\"close\")\n      this.destroy()\n    })\n  }\n}\n\n/**\n * Event\n */\n\nwindow.addEventListener(\"message\", event => {\n  const frameWindow =\n    SideFrame.current && SideFrame.current.domNode.contentWindow\n\n  if (event.source === frameWindow) {\n    switch (event.data) {\n    case \"show\":\n      SideFrame.current.show()\n      break\n    case \"hide\":\n      SideFrame.current.hide()\n      break\n    case \"close\":\n      SideFrame.current.close()\n      break\n    }\n  }\n})\n\n/**\n * Frame style\n */\n\nSideFrame.style = {\n  position: \"fixed\",\n  zIndex: 1000,\n  right: 0,\n  top: 0,\n  width: \"30em\",\n  maxWidth: \"100%\",\n  height: \"100vh\",\n  border: \"0.1em solid hsl(240, 10%, 75%)\",\n  background: \"hsl(240, 40%, 98%)\",\n  backgroundImage: `url('./images/cosmic-link.svg')`,\n  backgroundRepeat: \"no-repeat\",\n  backgroundPosition: \"center\",\n  backgroundSize: \"12em 12em\",\n  padding: 0\n}\n\n/**\n * Closing button\n */\n\nSideFrame.close = html.create(\"span\", { hidden: true }, `× ${__(\"Close\")}`)\nObject.assign(SideFrame.close.style, {\n  position: \"fixed\",\n  zIndex: 1001,\n  top: \"0.1em\",\n  right: \"0.1em\",\n  color: \"hsl(0, 0%, 40%)\",\n  fontSize: \"0.9em\",\n  fontWeight: \"bold\",\n  cursor: \"pointer\",\n  background: \"hsl(0, 0%, 95%)\",\n  borderBottomLeftRadius: \"0.1em\",\n  padding: \"0.1em 0.3em\"\n})\ndocument.body.insertBefore(SideFrame.close, document.body.firstChild)\n\n/**\n * Shadow Layer\n */\n\nSideFrame.shadow = new ClickWall({\n  scrollbar: \"hide\",\n  opacity: 0.3,\n  delay: 400\n})\n\n/**\n * Export\n */\n\nmodule.exports = SideFrame\n","\"use strict\"\n/**\n * Markets statistics & data\n *\n * @exports marketData\n */\nconst marketData = exports\n\nconst axios = require(\"@cosmic-plus/base/es5/axios\")\nconst nice = require(\"@cosmic-plus/jsutils/es5/nice\")\nconst { day } = require(\"@cosmic-plus/jsutils/es5/misc\")\n\nconst global = require(\"./global\")\n\n/**\n * Generic price/history\n */\n\nmarketData.assetHistory = function (asset, limit = 1000) {\n  if (asset.type === \"crypto\") return marketData.crypto.history(asset, limit)\n  else if (asset.type === \"fiat\") return marketData.fiat.history(asset, limit)\n}\n\n/**\n * Crypto price/history by \"https://www.coingecko.com\"\n */\n\nmarketData.crypto = {}\n\nfunction coingeckoCall (page, params) {\n  return axios.get(`https://api.coingecko.com/api/v3/${page}`, { params })\n}\n\nmarketData.crypto.list = async function () {\n  const response = await coingeckoCall(\"coins/list\")\n  const list = {}\n  response.data.forEach(entry => {\n    const symbol = entry.symbol.toUpperCase()\n    list[symbol] = { apiId: entry.id, name: entry.name }\n  })\n  return list\n}\n\nmarketData.crypto.stellarNative = async function () {\n  const response = await coingeckoCall(\"exchanges/stellar_term\")\n  return response.data.tickers.map(x => x.coin_id).filter(x => x)\n}\n\nmarketData.crypto.info = async function (asset) {\n  const response = await coingeckoCall(`coins/${asset.apiId}`, {\n    localization: false,\n    tickers: false,\n    market_data: false,\n    community_data: false,\n    developer_data: false,\n    sparkline: false\n  })\n  return response.data\n}\n\nmarketData.crypto.prices = async function (assets) {\n  const ids = assets.map(asset => asset.apiId).join(\",\")\n  const quote = global.currency.toLowerCase()\n  const response = await coingeckoCall(\"simple/price\", {\n    ids,\n    vs_currencies: quote\n  })\n  const prices = {}\n  assets.forEach(asset => {\n    const assetData = response.data[asset.apiId]\n    if (assetData) prices[asset.code] = assetData[quote]\n  })\n  return prices\n}\n\nmarketData.crypto.history = async function (asset, limit = 1000) {\n  const response = await coingeckoCall(`coins/${asset.apiId}/market_chart`, {\n    vs_currency: global.currency,\n    days: limit\n  })\n  const data = response.data.prices.map((record, index) => {\n    return {\n      time: record[0],\n      price: record[1],\n      // volume: response.data.total_volumes[index][1]\n      volume: +nice(response.data.total_volumes[index][1] / record[1])\n    }\n  })\n\n  // Normalize last day timestamp.\n  const oneDay = 24 * 60 * 60 * 1000\n  data[data.length - 1].time = data[data.length - 2].time + oneDay\n\n  setHistoryLatestPrice(asset, data)\n  return data\n}\n\n/**\n * Fiat prices / history by \"https://exchangeratesapi.io\"\n */\n\nmarketData.fiat = {}\n\nasync function exchangeratesCall (page, symbols, params = {}) {\n  params.base = global.currency\n  if (typeof symbols === \"string\") {\n    params.symbols = symbols\n  } else {\n    if (global.currency === \"EUR\") symbols = symbols.filter(x => x !== \"EUR\")\n    params.symbols = symbols.join(\",\")\n  }\n  params.source = \"equilibre.io\"\n\n  return axios\n    .get(`https://api.exchangeratesapi.io/${page}`, { params })\n    .then(response => {\n      if (global.currency === \"EUR\" && !response.data.start_at) {\n        response.data.rates.EUR = 1\n      }\n      return response\n    })\n}\n\nmarketData.fiat.prices = async function (assets) {\n  const symbols = assets.map(asset => asset.code)\n  const response = await exchangeratesCall(\"latest\", symbols)\n  const data = response.data.rates\n  for (let symbol in data) {\n    data[symbol] = nice(1 / data[symbol], 8)\n  }\n  return data\n}\n\nmarketData.fiat.history = async function (asset, limit = 1000) {\n  const cached = cachedHistory(asset)\n  if (cached) return cached\n\n  const end_at = new Date().toISOString().slice(0, 10)\n  const today = new Date(end_at)\n  today.setDate(today.getDate() - limit)\n  const start_at = today.toISOString().slice(0, 10)\n  const response = await exchangeratesCall(\"history\", asset.code, {\n    start_at,\n    end_at\n  })\n\n  const data = Object.keys(response.data.rates)\n    .sort()\n    .map(date => {\n      return {\n        time: new Date(date).getTime(),\n        price: +nice(1 / response.data.rates[date][asset.code], 8)\n      }\n    })\n  cacheHistory(asset, data)\n  return data\n}\n\n/**\n * Helpers\n */\n\nfunction cacheHistory (asset, data) {\n  localStorage[`prices.${asset.code}`] = JSON.stringify([day(), data])\n}\n\nfunction cachedHistory (asset) {\n  const json = localStorage[`prices.${asset.code}`]\n  if (!json) return\n\n  const [date, data] = JSON.parse(json)\n  if (date !== day()) return\n\n  setHistoryLatestPrice(asset, data)\n  return data\n}\n\nfunction setHistoryLatestPrice (asset, data) {\n  data[data.length - 1].price = asset.price\n}\n","\"use strict\"\n/**\n * Orderbook class\n */\n\nconst cosmicLib = require(\"cosmic-lib\")\nconst Projectable = require(\"@cosmic-plus/jsutils/es5/projectable\")\nconst StellarSdk = require(\"@cosmic-plus/base/es5/stellar-sdk\")\nconst { timeout } = require(\"@cosmic-plus/jsutils/es5/misc\")\nconst { __ } = require(\"@cosmic-plus/i18n\")\n\nconst { fixed7 } = require(\"../helpers/misc\")\n\nconst Orderbook = module.exports = class Orderbook extends Projectable {\n  static forBalance (balance, quote) {\n    if (balance.asset === quote) return\n\n    const orderbook = new Orderbook({ balance, quote })\n    orderbook.streamOffers()\n\n    balance.orderbook = orderbook\n    balance.asset.addOrderbook(orderbook)\n\n    return orderbook\n  }\n\n  static forAsset (asset) {\n    return new Orderbook({ asset })\n  }\n\n  constructor (params) {\n    super()\n\n    if (params.balance) {\n      this.type = \"native\"\n      this.balance = params.balance\n      this.base = params.balance.asset\n      this.quote = params.quote\n      this.name = `${this.base.code}/${this.quote.code}`\n      this.offersCallBuilder = Orderbook.offersCallBuilder(this.balance)\n\n      this.watch(this.quote, \"price\", () => this.updateOffersPrices())\n    } else if (params.asset) {\n      this.type = \"agregated\"\n      this.base = params.asset\n      this.name = `${this.base.code} (${__(\"Agregated\")})`\n      this.childs = []\n    }\n\n    this.watch(this.base, \"globalPrice\", () => this.compute(\"price\"))\n  }\n\n  static offersCallBuilder (balance) {\n    const baseAsset = new StellarSdk.Asset(balance.code, balance.anchor.pubkey)\n    const quoteAsset = StellarSdk.Asset.native()\n    const server = cosmicLib.resolve.server()\n    return server.orderbook(baseAsset, quoteAsset)\n  }\n\n  async streamOffers () {\n    // eslint-disable-next-line no-constant-condition\n    while (true) {\n      await this.getOffers()\n      await timeout(15000)\n    }\n  }\n\n  async getOffers () {\n    try {\n      const offers = await this.offersCallBuilder.limit(200).call()\n      this.ingest(offers)\n    } catch (error) {\n      console.error(error)\n    }\n  }\n\n  ingest (offers) {\n    if (!areOffersEquals(this.bids, offers.bids)) {\n      this.bids = normalizeOffers(offers.bids, this.quote, this.balance, \"bids\")\n    }\n    if (!areOffersEquals(this.asks, offers.asks)) {\n      this.asks = normalizeOffers(offers.asks, this.quote, this.balance, \"asks\")\n    }\n  }\n\n  updateOffersPrices () {\n    if (this.bids) {\n      this.set(\"bids\", updateOffersPrices(this.bids, this.quote))\n    }\n    if (this.asks) {\n      this.set(\"asks\", updateOffersPrices(this.asks, this.quote))\n    }\n  }\n\n  mergeOffers (side) {\n    if (this.childs.length < 2) {\n      this.set(side, this.childs[0] && this.childs[0][side])\n      return\n    }\n\n    /// Merge order books\n    const merged = this.childs.reduce((merged, child) => {\n      return child[side] ? merged.concat(child[side]) : merged\n    }, [])\n    if (!merged.length) {\n      this[side] = null\n      return\n    }\n\n    const sortOffers =\n      side === \"bids\"\n        ? (a, b) => b.price - a.price\n        : (a, b) => a.price - b.price\n\n    /// Update volumes.\n    let volume = 0,\n      baseVolume = 0,\n      quoteVolume = 0\n    this.set(\n      side,\n      merged.sort(sortOffers).map(row => {\n        const mergedRow = Object.assign({}, row)\n        mergedRow.volume = volume += fixed7(row.amount * row.price)\n        mergedRow.baseVolume = baseVolume += +row.amount\n        mergedRow.quoteVolume = quoteVolume += +row.quoteAmount\n        return mergedRow\n      })\n    )\n  }\n\n  addChild (orderbook) {\n    this.childs.push(orderbook)\n    this.watch(orderbook, \"bids\", () => this.mergeOffers(\"bids\"))\n    this.watch(orderbook, \"asks\", () => this.mergeOffers(\"asks\"))\n  }\n}\n\nOrderbook.define(\"bestBid\", \"bids\", function () {\n  return this.bids && this.bids[0] && this.bids[0].price\n})\nOrderbook.define(\"bestAsk\", \"asks\", function () {\n  return this.asks && this.asks[0] && this.asks[0].price\n})\nOrderbook.define(\"price\", [\"bestBid\", \"bestAsk\"], function () {\n  if (this.base.globalPrice) return (this.bestBid + this.bestAsk) / 2\n  else return this.marketPrice()\n})\nOrderbook.define(\"spread\", [\"bestBid\", \"bestAsk\"], function () {\n  return this.bestAsk - this.bestBid\n})\nOrderbook.define(\"spread%\", [\"spread\", \"bestAsk\"], function () {\n  return 100 * this.spread / this.bestAsk\n})\n\n/**\n * Utilities\n */\n\n/**\n * Returns whether or not an orderbook offers has been fetched at least once.\n * Agregated orderbooks return `true` only when each child orderbook has been\n * fetched.\n */\nOrderbook.prototype.isFetched = function () {\n  if (this.childs) {\n    return this.childs.reduce((and, child) => and && child.isFetched(), true)\n  } else {\n    return this.asks != null && this.bids != null\n  }\n}\n\n/**\n * Look for the best first offer in **orderbook** **side** that match **filter**\n * (if provided) among child orderbooks.\n *\n * @param  {Orderbook} orderbook [description]\n * @param  {String}    side      `bids` or `asks`\n * @param  {Function}  [filter]  A filter that is passed by the returned offer\n * @return {Object}    An orderbook offer\n */\nOrderbook.prototype.findOffer = function (side, filter) {\n  const offers = this[side]\n  const childsNum = this.childs ? this.childs.length : 1\n  const anchors = {}\n\n  let last\n  for (let index in offers) {\n    const offer = offers[index]\n    if (filter && !filter(offer)) continue\n    const anchor = offer.balance.anchor.pubkey\n    if (!anchors[anchor]) {\n      anchors[anchor] = true\n      last = offer\n    }\n    if (Object.keys(anchors).length === childsNum) break\n  }\n  return last\n}\n\nOrderbook.prototype.findAsk = function (filter) {\n  return this.findOffer(\"asks\", filter)\n}\nOrderbook.prototype.findBid = function (filter) {\n  return this.findOffer(\"bids\", filter)\n}\n\n/**\n * Returns the price of asset at **depth** XLM of orderbook's **side**.\n *\n * @param  {String} [side=\"bids\"] Either \"bids\" or \"asks\"\n * @param  {Number} [depth] The depth to look at, in term of XLM\n * @return {Number} Offer price at requested depth\n */\nOrderbook.prototype.marketPrice = function (side = \"bids\", depth = 50) {\n  const offer = this.findOffer(side, offer => offer.quoteVolume > depth)\n  return offer ? offer.price : 0\n}\n\n/**\n * Helpers\n */\n\nfunction areOffersEquals (array1, array2) {\n  if (!array1) return false\n  if (array1.length !== array2.length) return false\n  for (let index in array1.length) {\n    if (array1[index].amount !== array2[index].amount) return false\n    if (array1[index].price !== array2[index].price) return false\n  }\n  return true\n}\n\nfunction normalizeOffers (offers, quote, balance, side) {\n  offers.forEach(row => {\n    row.volume = undefined\n    row.baseVolume = undefined\n    row.basePrice = +row.price\n    row.quoteAmount = +row.amount\n    row.quoteVolume = undefined\n    row.balance = balance\n    row.side = side\n  })\n  return updateOffersPrices(offers, quote)\n}\n\nfunction updateOffersPrices (offers, quote) {\n  let volume = 0,\n    quoteVolume = 0,\n    baseVolume = 0\n  offers.forEach(row => {\n    if (row.side === \"asks\") {\n      row.quoteAmount = fixed7(row.amount * row.basePrice)\n    } else {\n      row.amount = fixed7(row.quoteAmount / row.basePrice)\n    }\n    row.price = fixed7(row.basePrice * quote.price)\n    row.volume = volume += fixed7(row.amount * row.price)\n    row.baseVolume = baseVolume += +row.amount\n    row.quoteVolume = quoteVolume += +row.quoteAmount\n  })\n  return offers\n}\n","\"use strict\"\n/**\n * Anchor\n */\nconst aliases = require(\"@cosmic-plus/base/es5/aliases\")\nconst helpers = require(\"@cosmic-plus/jsutils/es5/misc\")\nconst Projectable = require(\"@cosmic-plus/jsutils/es5/projectable\")\n\nconst Asset = require(\"./asset\")\n\n/**\n * Definition\n */\n\nclass Anchor extends Projectable {\n  static resolve (pubkey, params) {\n    return Anchor.table[pubkey] || new Anchor(pubkey, params)\n  }\n\n  constructor (pubkey, params) {\n    super()\n    if (params) Object.assign(this, params)\n\n    Anchor.table[pubkey] = this\n\n    this.pubkey = pubkey\n    this.alias = aliases.all[pubkey]\n    this.name = helpers.shorter(this.alias || this.pubkey)\n\n    this.assets = {}\n\n    if (this.emit)\n      this.emit.forEach(entry => {\n        if (typeof entry !== \"string\") this.addAsset(entry[0], entry[1])\n        else this.addAsset(entry)\n      })\n  }\n\n  addAsset (code, alias = code) {\n    this.assets[alias] = Asset.resolve(code)\n    this.assets[alias].anchors.push(this)\n  }\n}\n\nAnchor.table = {}\n\n/**\n * Utilities\n */\n\n/**\n * Register known **anchors**.\n */\nAnchor.register = function (anchors) {\n  for (let pubkey in anchors) {\n    Anchor.resolve(pubkey, anchors[pubkey])\n  }\n}\n\n/**\n * Returns the anchor local code for **assetCode**.\n */\nAnchor.prototype.tetherCode = function (assetCode) {\n  for (let index in this.emit) {\n    const entry = this.emit[index]\n\n    if (entry === assetCode) {\n      return assetCode\n    } else if (Array.isArray(entry)) {\n      if (entry[0] === assetCode) return entry[1]\n    }\n  }\n}\n\n/**\n * Export\n */\nmodule.exports = Anchor\n","\"use strict\"\n/**\n * form.js − Generate formulary with ease\n *\n * Differences with ordinary interface:\n *\n * - Form request is sent only if `method=\"get\"` or `method=\"post\"` is\n *   explicitely set.\n * - Form inputs are `required` by default.\n * - Select control is renamed selector (verbs are reserved).\n */\n\nconst Projectable = require(\"@cosmic-plus/jsutils/es5/projectable\")\nconst hiddenKey = require(\"@cosmic-plus/jsutils/es5/misc\").setHiddenProperty\n\nconst bindDomKey = require(\"./bind-dom-key\")\nconst handleExtraAttributes = require(\"./handle-extra-attributes\")\nconst html = require(\"./html-extra\")\n\n/**\n * Definition\n */\n\nclass Form extends Projectable {\n  /**\n   * Two forms:\n   *\n   * * new Form($form, attributes)\n   * * new Form([attributes], ...childs)\n   */\n  constructor (...params) {\n    super()\n\n    // Import or create the form DOM node.\n    if (params.length && params[0].tagName === \"FORM\") {\n      hiddenKey(this, \"domNode\", params[0])\n      if (params[1]) Object.assign(this.domNode, params[1])\n    } else {\n      hiddenKey(this, \"domNode\", html.element(\"form\", ...params))\n    }\n\n    // Validation - request is sent only if a method is explicitely set.\n    this.domNode.addEventListener(\"submit\", () => {\n      const method = this.domNode.getAttribute(\"method\")\n      if (!method) event.preventDefault()\n      this.trigger(\"submit\")\n    })\n\n    // Bind values\n    Form.bindInputs(this, this.domNode)\n    hiddenKey(this, \"dom\", handleExtraAttributes(this.domNode))\n\n    // Add message box if none exists.\n    if (!this.dom.status) {\n      this.dom.status = [Form.status()]\n      html.append(this.domNode, this.dom.status[0])\n    }\n  }\n\n  /**\n   * Controls\n   */\n\n  submit () {\n    this.domNode.submit()\n  }\n\n  reset () {\n    this.domNode.reset()\n  }\n\n  /**\n   * Status Display\n   */\n\n  report (type, ...content) {\n    const $status = this.dom.status[0]\n    if ($status) {\n      $status.className = type\n      html.rewrite($status, ...content)\n    }\n  }\n\n  info (content) {\n    this.report(\"info\", content, Form.spinner())\n  }\n\n  error (content) {\n    // Extract message from Error object. (TODO: handle it in html)\n    this.report(\"error\", content.message || content)\n    if (content instanceof Error) throw content\n    else throw new Error(content)\n  }\n}\n\n// Automatically clean report on user input.\nForm.listen(\"change\", event => event.report(null))\n\n/**\n * Binding\n */\n\nForm.bindInputs = function (object, $node) {\n  html.walk($node, binder, object)\n}\n\nfunction binder ($node, object) {\n  if ($node.name) bindDomKey(object, $node.name, $node)\n}\n\n/**\n * Helpers (Actions)\n */\n\nForm.enable = function (element, attributes) {\n  element.disabled = false\n  Object.assign(element, attributes)\n}\n\nForm.disable = function (element, attributes) {\n  element.enabled = true\n  Object.assign(element, attributes)\n}\n\nForm.hide = html.hide\nForm.show = html.show\n\n/**\n * Elements\n */\n\nForm.element = html.element\n\nForm.status = function (message = \"\") {\n  return Form.element(\"p\", { alias: \"status\" }, message)\n}\n\nForm.spinner = function () {\n  return Form.element(\"span\", { className: \"spinner\" })\n}\n\nForm.label = function (...params) {\n  return Form.element(\"label\", ...params)\n}\n\nForm.button = function (params, ...childs) {\n  if (!childs.length) childs = [params.value]\n  return Form.element(\"button\", params, ...childs)\n}\n\nForm.control = function (tag, params) {\n  const defaults = { required: true }\n  const attributes = Object.assign(defaults, params)\n  return Form.element(tag, attributes)\n}\n\nForm.textarea = function (params) {\n  return Form.control(\"textarea\", params)\n}\n\nForm.selector = function (params) {\n  const selector = Form.control(\"select\", params)\n  if (selector.values) {\n    html.append(selector, ...makeOptions(selector.values))\n  }\n  if (selector.placeholder) {\n    const placeholder = html.element(\n      \"option\",\n      { value: \"\", disabled: true, selected: true, hidden: true },\n      selector.placeholder\n    )\n    html.unshift(selector, placeholder)\n    if (params.selectedIndex != null) params.selectedIndex++\n  }\n\n  if (params.selectedIndex) selector.selectedIndex = params.selectedIndex\n  else if (params.value) selector.value = params.value\n\n  return selector\n}\n\nForm.input = function (type, params = {}) {\n  const input = Form.control(\"input\", params)\n  input.type = type\n  return input\n}\n\n// Exclude: button, datetime-local, reset, submit, select, search (no verbs)\nconst inputTypes = [\n  \"checkbox\",\n  \"color\",\n  \"date\",\n  \"email\",\n  \"file\",\n  \"hidden\",\n  \"image\",\n  \"month\",\n  \"number\",\n  \"password\",\n  \"radio\",\n  \"range\",\n  \"tel\",\n  \"text\",\n  \"time\",\n  \"url\",\n  \"week\"\n]\n\ninputTypes.forEach(type => Form[type] = params => Form.input(type, params))\nForm.datetime = params => Form.input(\"datetime-local\", params)\n\n/**\n * Elements Helpers\n */\n\nfunction makeOptions (object) {\n  if (object instanceof Array) {\n    return object.map(value => {\n      return html.element(\"option\", { value }, value)\n    })\n  } else {\n    return Object.keys(object).map(value => {\n      return html.element(\"option\", { value }, object[value])\n    })\n  }\n}\n\n/**\n * Export\n */\n\nmodule.exports = Form\n","\"use strict\"\n/**\n * Additional methods for html.\n */\nconst html = Object.create(require(\"@cosmic-plus/domutils/es5/html\"))\nmodule.exports = html\n\n/**\n * Creates an new HTML element.\n */\nhtml.element = function (tag, ...params) {\n  let attributes\n  if (\n    params[0]\n    && params[0].constructor === Object\n    && params[0].domNode === undefined\n  ) {\n    attributes = params.shift()\n  }\n\n  return html.create(tag, attributes, ...params)\n}\n\n/**\n * Walks **element** dom tree, applying **func** to each node.\n */\nhtml.walk = function (element, func, ...params) {\n  func(element, ...params)\n  element.childNodes.forEach(child => html.walk(child, func, ...params))\n}\n\n/**\n * Add **...children** as first **parent** children.\n */\nhtml.unshift = function (parent, ...children) {\n  for (let i = 0; i < children.length; i++) {\n    parent.insertBefore(children[i], parent.childNodes[i])\n  }\n}\n","\"use strict\"\n/**\n * Compute portfolio data from Account object.\n */\nconst axios = require(\"@cosmic-plus/base/es5/axios\")\nconst cosmicLib = require(\"cosmic-lib\")\nconst Mirrorable = require(\"@cosmic-plus/jsutils/es5/mirrorable\")\nconst Projectable = require(\"@cosmic-plus/jsutils/es5/projectable\")\nconst { timeout } = require(\"@cosmic-plus/jsutils/es5/misc\")\nconst { __ } = require(\"@cosmic-plus/i18n\")\n\nconst Asset = require(\"./asset\")\nconst Balance = require(\"./balance\")\nconst global = require(\"./global\")\n// const History = require(\"./portfolio-history\")\nconst Offers = require(\"./offers\")\n\nconst { arraySum, arrayOnlyInFirst } = require(\"../helpers/misc\")\n/**\n * Class\n */\n\nclass Portfolio extends Projectable {\n  static async resolve (address) {\n    await checkNetwork()\n\n    const destination = await cosmicLib.resolve.address(address)\n    if (destination.memo)\n      throw new Error(__(\"Invalid federated address: shared account.\"))\n    if (await cosmicLib.resolve.isAccountEmpty(destination.account_id))\n      throw new Error(__(\"Empty account\"))\n\n    const portfolio = new Portfolio(destination.account_id)\n    cosmicLib.config.source = portfolio.address = address\n    portfolio.streamAccount()\n\n    return portfolio\n  }\n\n  constructor (accountId) {\n    super()\n\n    // eslint-disable-next-line no-console\n    console.log(this)\n\n    this.accountId = accountId\n    this.assets = new Mirrorable()\n    this.balances = new Mirrorable()\n    this.accountCallBuilder = Portfolio.accountCallBuilder(accountId)\n\n    this.define(\"total\", \"assets\", () => {\n      const assets = this.assets.filter(asset => asset.isSupported)\n      return arraySum(assets, \"value\")\n    })\n    this.assets.mirror(asset =>\n      this.watch(asset, [\"value\", \"isSupported\"], () => this.compute(\"total\"))\n    )\n\n    this.new = true\n  }\n\n  static accountCallBuilder (accountId) {\n    const server = cosmicLib.resolve.server()\n    return server.accounts().accountId(accountId)\n  }\n\n  async streamAccount () {\n    // eslint-disable-next-line no-constant-condition\n    while (true) {\n      await this.getAccount()\n      await timeout(5000)\n    }\n  }\n\n  async getAccount () {\n    try {\n      const account = await this.accountCallBuilder.call()\n      this.ingest(account)\n    } catch (error) {\n      console.error(error)\n    }\n  }\n\n  async ingest (account) {\n    this.account = account\n\n    for (let index in account.balances) {\n      const balance = Balance.ingest(account.balances[index])\n      const asset = balance.asset\n\n      if (this.assets.indexOf(asset) === -1) {\n        this.assets.push(asset)\n        this.balances.push(balance)\n        asset.watch(this, \"total\", () => asset.compute(\"share\"))\n        asset.getInfo()\n      } else if (this.balances.indexOf(balance) === -1) {\n        this.balances.push(balance)\n      }\n    }\n\n    if (this.new) {\n      delete this.new\n      await Asset.refreshPrices()\n      this.offers = Offers.forPortfolio(this)\n      await this.offers.stream()\n      this.trigger(\"open\")\n      Asset.getAllInfo()\n    }\n  }\n}\n\n/**\n * Utilities\n */\n\n/**\n * List known assets for which account doesn't have any trustline.\n */\nPortfolio.prototype.availableAssets = function () {\n  const allAssets = Object.values(Asset.table)\n  return arrayOnlyInFirst(allAssets, this.assets)\n}\n\n/**\n * Extension\n */\n\nAsset.define(\"share\", \"value\", function () {\n  return global.portfolio && this.value / global.portfolio.total\n})\n\n/**\n * Helpers\n */\n\nasync function checkNetwork () {\n  const horizon = cosmicLib.resolve.horizon()\n  try {\n    await axios.get(horizon)\n  } catch (error) {\n    throw new Error(__(\"Can't connect to the Stellar blockchain\"))\n  }\n}\n\n/**\n * Export\n */\nmodule.exports = Portfolio\n","\"use strict\"\n/**\n * Account offers\n */\n\nconst cosmicLib = require(\"cosmic-lib\")\nconst loopcall = require(\"@cosmic-plus/loopcall\")\nconst Mirrorable = require(\"@cosmic-plus/jsutils/es5/mirrorable\")\nconst Projectable = require(\"@cosmic-plus/jsutils/es5/projectable\")\nconst hiddenKey = require(\"@cosmic-plus/jsutils/es5/misc\").setHiddenProperty\nconst { day } = require(\"@cosmic-plus/jsutils/es5/misc\")\n\nconst Asset = require(\"./asset\")\nconst Balance = require(\"./balance\")\n\nconst { fixed7 } = require(\"../helpers/misc\")\n\n/**\n * Definition: Offers (collection)\n */\n\nclass Offers extends Mirrorable {\n  static forPortfolio (portfolio) {\n    const offers = Offers.forAccount(portfolio.accountId)\n    hiddenKey(offers, \"portfolio\", portfolio)\n    return offers\n  }\n\n  static forAccount (accountId) {\n    const offers = new Offers()\n    hiddenKey(offers, \"accountId\", accountId)\n    hiddenKey(offers, \"callBuilder\", Offers.callBuilder(accountId))\n    return offers\n  }\n\n  static callBuilder (accountId) {\n    const server = cosmicLib.resolve.server()\n    return server.offers(\"accounts\", accountId)\n  }\n\n  async stream (delay = 15000) {\n    // Resolves after first get().\n    return this.get().then(() => setTimeout(() => this.stream(), delay))\n  }\n\n  async get () {\n    try {\n      const records = await loopcall(this.callBuilder, { limit: 200 })\n      this.ingest(records)\n    } catch (error) {\n      console.error(error)\n    }\n  }\n\n  ingest (records) {\n    this.forEach(offer => offer.alive = false)\n    const offers = records.map(record => Offer.ingest(record)).filter(x => x)\n    this.splice(0, 0, ...offers)\n    this.clean()\n  }\n\n  clean () {\n    for (let index = this.length - 1; index > -1; index--) {\n      const offer = this[index]\n      if (!offer.alive) {\n        this.splice(index, 1)\n        offer.destroy()\n      }\n    }\n  }\n}\n\n/**\n * Utilities\n */\n\nOffers.prototype.listOutdated = function () {\n  return this.filter(offer => offer.outdated)\n}\n\n/**\n * Definition: Offer (one)\n */\n\nclass Offer extends Projectable {\n  static resolve (record) {\n    return Offer.table[recordToId(record)]\n  }\n\n  static ingest (record) {\n    const offer = Offer.resolve(record)\n    if (offer) offer.update(record)\n    else return new Offer(record)\n  }\n\n  constructor (record) {\n    super()\n\n    this.intern = recordToId(record)\n    Offer.table[this.intern] = this\n\n    const quote = Asset.resolve(\"XLM\")\n    const asset = record.buying.asset_code ? record.buying : record.selling\n    this.balance = Balance.resolve(asset.asset_code, asset.asset_issuer)\n    this.asset = this.balance.asset\n    this.side = record.buying.asset_code ? \"buy\" : \"sell\"\n\n    this.define(\n      \"price\",\n      \"rawPrice\",\n      this.side === \"sell\"\n        ? () => quote.price * this.rawPrice\n        : () => quote.price / this.rawPrice\n    )\n    this.watch(quote, \"price\", () => this.compute(\"price\"))\n\n    this.update(record)\n\n    this.balance.offers.push(this)\n    this.asset.offers.push(this)\n\n    this.listen(\"destroy\", () => {\n      delete Offer.table[this.intern]\n      this.balance.offers.splice(this.balance.offers.indexOf(this), 1)\n      this.asset.offers.splice(this.asset.offers.indexOf(this), 1)\n    })\n  }\n\n  update (record) {\n    Object.assign(this, record)\n    this.alive = true\n\n    this.rawPrice = record.price\n    this.compute(\"price\")\n    this.rawAmount = record.amount\n    if (this.side === \"buy\") {\n      this.amount = fixed7(this.rawAmount * this.rawPrice)\n    }\n\n    this.date = day(this.last_modified_time)\n    this.outdated = this.date !== day()\n  }\n}\n\nOffer.table = {}\n\n/**\n * Helpers\n */\n\nfunction recordToId (record) {\n  return `${record.id}-${record.last_modified_ledger}`\n}\n\n/**\n * Export\n */\n\nmodule.exports = Offers\n","\"use strict\"\n\nconst Projectable = require(\"@cosmic-plus/jsutils/es5/projectable\")\n\n/**\n * Bind **$input**'s **nodeKey** to **object** **objKey**. If **nodeKey** is not\n * provided, the default value is used.\n */\nmodule.exports = function bindnodeKey (object, objKey, $input, nodeKey) {\n  const binder = bind[$input.tagName]\n  if (binder) binder(object, objKey, $input, nodeKey)\n  else object[objKey] = $input[nodeKey || \"value\"]\n}\n\n/**\n * Element-specific binders\n */\nconst bind = {}\n\nbind.SELECT = function (object, objKey, $select, nodeKey = \"value\") {\n  object[objKey] = $select[nodeKey]\n  if (bind.SELECT.interactive.indexOf(nodeKey) !== -1) {\n    importKeyOn(\"change\", object, objKey, $select, nodeKey)\n  }\n}\nbind.SELECT.interactive = [\"selectedIndex\", \"selectedOptions\", \"value\"]\n\nbind.TEXTAREA = function (object, objKey, $textarea, nodeKey = \"value\") {\n  object[objKey] = $textarea[nodeKey]\n  if (nodeKey === \"value\") {\n    importKeyOn(\"input\", object, objKey, $textarea, nodeKey)\n  }\n}\n\nbind.INPUT = function (object, objKey, $input, nodeKey) {\n  object[objKey] = $input[nodeKey]\n  if ($input.type === \"radio\") {\n    bind.radio(...arguments)\n  } else if ($input.type === \"checkbox\") {\n    bind.checkbox(...arguments)\n  } else if (!nodeKey || nodeKey === \"value\") {\n    importKeyOn(\"input\", object, objKey, $input, nodeKey || \"value\")\n  }\n}\n\nbind.radio = function (object, objKey, $radio) {\n  const setter = () => {\n    if ($radio.checked) object[objKey] = $radio.value\n  }\n  $radio.addEventListener(\"change\", setter)\n  setter()\n}\n\nbind.checkBox = function (object, objKey, $checkbox, nodeKey = \"checked\") {\n  object[objKey] = $checkbox[nodeKey]\n  if (nodeKey === \"checked\") {\n    importKeyOn(\"change\", object, objKey, $checkbox, nodeKey)\n  }\n}\n\n/**\n * Event setter.\n */\nfunction importKeyOn (eventName, object, objKey, $input, nodeKey) {\n  $input.addEventListener(eventName, () => {\n    object[objKey] = $input[nodeKey]\n    $input.setCustomValidity(\"\")\n  })\n  if (object instanceof Projectable) {\n    object.link(objKey, $input, nodeKey, null, { init: false })\n  }\n}\n","\"use strict\"\n\nconst { timeout } = require(\"@cosmic-plus/jsutils/es5/misc\")\n\nconst html = require(\"./html-extra\")\n\n/**\n * Walk **$node** tree and handle extra attributes for each domNode. Extra\n * attributes are:\n *\n * * alias:  Define an identifier for the local context.\n * * label:  Enclose the node into a dedicated label element.\n */\nmodule.exports = function walkNodeTree ($node) {\n  const aliases = {}\n  html.walk($node, handleExtraAttributes, aliases)\n  return aliases\n}\n\nfunction handleExtraAttributes ($node, aliases) {\n  setAliases($node, aliases)\n  handleLabel($node)\n  handleValidate($node)\n}\n\n/**\n * Bind **$node** to **aliases** properties for to its className, alias, name\n * and/or id.\n */\nfunction setAliases ($node, aliases) {\n  // Ordered by priority\n  if ($node.className) {\n    if (!aliases[$node.className]) aliases[$node.className] = []\n    aliases[$node.className].push($node)\n  } else if ($node.alias) {\n    aliases[$node.alias] = $node\n    delete aliases[$node.alias]\n  } else if ($node.name) {\n    aliases[$node.name] = $node\n  } else if ($node.id) {\n    aliases[$node.id] = $node\n  }\n}\n\n/**\n * Enclose **$node** into its own label if it has a `label=` attribute.\n */\nfunction handleLabel ($node) {\n  // `<option>` tags have a `label` attribute in HTML5.\n  if (!$node.label || $node.tagName === \"OPTION\") return\n\n  const $label = html.element(\"label\", { for: $node })\n  const $span = html.element(\"span\", $node.label)\n  html.replace($node, $label)\n  html.append($label, $span, $node)\n  delete $node.label\n}\n\n/**\n * Setup automatic validation using **$node**'s validate function.\n */\nfunction handleValidate ($node) {\n  const validate = $node.validate\n  if (!validate || !$node.hasProperty(\"oninput\")) return\n\n  $node.addEventListener(\"input\", () => {\n    $node.setCustomValidity(\"\")\n    timeout(0).then(() => validateNodeValue($node, validate))\n  })\n  delete $node.validate\n}\n\nfunction validateNodeValue ($node, validate) {\n  try {\n    validate($node.value)\n  } catch (error) {\n    $node.setCustomValidity(error.message)\n    $node.reportValidity()\n    console.error(error)\n  }\n}\n","\"use strict\"\n/**\n * Various helpers\n */\n\nconst helpers = exports\n\nhelpers.isOverflowing = function (element) {\n  return (\n    element.scrollHeight > element.clientHeight\n    || element.scrollWidth > element.clientWidth\n  )\n}\n","\"use strict\"\n/**\n * Activity Gui\n */\n\nconst Gui = require(\"@cosmic-plus/domutils/es5/gui\")\nconst { __ } = require(\"@cosmic-plus/i18n\")\n\nconst ActiveOffersTable = require(\"./widgets/active-offers-table\")\nconst global = require(\"./logic/global\")\n\n/**\n * Class\n */\n\nmodule.exports = class ActivityGui extends Gui {\n  constructor (portfolio) {\n    super(`\n<section class=\"ActivityGui\">\n  <h2>${__(\"Activity\")}</h2>\n\n  %table\n\n  <p class=\"note\">\n    ${__(\"All orders are passed against Stellar Lumens (XLM).\")}\n    ${__(\n    \"For your comfort, prices are displayed in their %%globalCurrency equivalent.\"\n  )}\n    ${__(\n    \"However, those converted values will change according to XLM price movement.\"\n  )}\n  </p>\n\n</section>\n    `)\n\n    this.portfolio = portfolio\n    this.table = new ActiveOffersTable(portfolio)\n    this.globalCurrency = global.currency\n  }\n}\n","\"use strict\"\n/**\n * Active Offers Table\n */\nconst Gui = require(\"@cosmic-plus/domutils/es5/gui\")\nconst nice = require(\"@cosmic-plus/jsutils/es5/nice\")\nconst { CosmicLink } = require(\"cosmic-lib\")\nconst { __ } = require(\"@cosmic-plus/i18n\")\n\nconst SideFrame = require(\"../helpers/side-frame\")\n\nconst global = require(\"../logic/global\")\n\nmodule.exports = class ActiveOffersTable extends Gui {\n  constructor (portfolio) {\n    super(`\n<section class=\"ActiveOffersTable\">\n  <table>\n    <tr>\n      <th>${__(\"Date\")}</th>\n      <th>${__(\"Asset\")}</th>\n      <th>${__(\"Direction\")}</th>\n      <th>${__(\"Amount\")}</th>\n      <th>${__(\"Price\")} (%globalCurrency)</th>\n    </tr>\n    %toOfferRow:offers...\n    <tr><td colspan=\"5\" align=\"center\" onclick=%cancelOffers>\n      <h3>${__(\"Cancel All\")}</h3>\n    </td></tr>\n  </table>\n</section>\n    `)\n\n    this.portfolio = portfolio\n    this.offers = portfolio.offers\n    this.globalCurrency = global.currency\n  }\n\n  toOfferRow (offer) {\n    return new OfferRow(offer)\n  }\n\n  cancelOffers () {\n    if (!this.offers.length) return\n\n    const txParams = {\n      memo: \"Equilibre.io\",\n      network: \"public\",\n      maxTime: \"+5\",\n      source: this.portfolio.accountId\n    }\n\n    const cosmicLink = new CosmicLink(txParams)\n    this.offers.forEach(offer => {\n      cosmicLink.addOperation(\"manageOffer\", { offerId: offer.id, amount: 0 })\n    })\n\n    const sideFrame = new SideFrame(cosmicLink.uri)\n    sideFrame.listen(\"destroy\", () => {\n      this.portfolio.getAccount()\n      this.portfolio.offers.get()\n    })\n  }\n}\n\nclass OfferRow extends Gui {\n  constructor (offer) {\n    super(`\n<tr>\n  <td>%toDate:last_modified_time</td>\n  <td>\n    <img src=%image alt=\"\">\n    <span>%name / %anchor</span>\n  </td>\n  <td>%side</td>\n  <td align=\"right\">%nice:amount</td>\n  <td align=\"right\">%nice:price</td>\n</tr>\n    `)\n\n    this.offer = offer\n    offer.project([\"last_modified_time\", \"amount\", \"price\"], this)\n\n    this.name = offer.asset.code\n    this.side = offer.side === \"buy\" ? __(\"Buy\") : __(\"Sell\")\n    this.anchor = offer.balance.anchor.name\n    offer.asset.link(\"image\", this)\n  }\n\n  nice (number) {\n    return nice(number)\n  }\n\n  toDate (value) {\n    const date = value ? new Date(value) : new Date()\n    return date.toLocaleDateString()\n  }\n}\n","\"use strict\"\n/**\n * Portfolio Graphical User Interface\n */\nconst Gui = require(\"@cosmic-plus/domutils/es5/gui\")\nconst nice = require(\"@cosmic-plus/jsutils/es5/nice\")\nconst Tabs = require(\"@cosmic-plus/domutils/es5/tabs\")\nconst { __ } = require(\"@cosmic-plus/i18n\")\n\nconst AssetPriceChart = require(\"./widgets/asset-price-chart\")\nconst PortfolioPieChart = require(\"./widgets/portfolio-pie-chart\")\nconst PortfolioTable = require(\"./widgets/portfolio-table\")\n\nconst global = require(\"./logic/global\")\n\n/**\n * Class\n */\n\nmodule.exports = class PortfolioGui extends Gui {\n  constructor (portfolio) {\n    super(`\n<section><h2>${__(\"Portfolio\")}: %total %currency</h2>\n\n  %nav\n  <section>%view</section>\n\n  %priceChart\n\n  <p class=\"note\">\n    ${__(\"Anchor prices are from Stellar DEX\")} /\n    ${__(\"Global prices are from %%coingecko when available.\")}\n  </p>\n\n</section>`)\n\n    this.portfolio = portfolio\n\n    // Init.\n    portfolio.project(\"total\", this, x => nice(x, 2))\n    this.currency = global.currency\n    this.coingecko = new Gui(\n      `<a target=\"_blank\" rel=\"noopener\" href=\"https://coingecko.com\">coingecko</a>`\n    )\n\n    // Bind components together.\n    this.table = new PortfolioTable(portfolio)\n    this.project(\"selected\", this.table)\n    this.table.project(\"selected\", this)\n\n    this.pieChart = new PortfolioPieChart(portfolio)\n    this.project(\"selected\", this.pieChart)\n    this.pieChart.project(\"selected\", this)\n\n    this.trap(\"selected\", () => this.maybeDrawPriceChart())\n\n    // Create overview.\n    const overview = new Tabs()\n    overview.add(\"table\", __(\"Table\"), this.table)\n    overview.add(\"chart\", __(\"Chart\"), this.pieChart)\n\n    overview.project([\"nav\", \"view\"], this)\n    overview.listen(\"select\", id => {\n      if (id === \"chart\") this.pieChart.reflow()\n    })\n\n    // Save & load last selected tab.\n    overview.listen(\"select\", id => localStorage[\"PortfolioSummary.tab\"] = id)\n    overview.select(localStorage[\"PortfolioSummary.tab\"])\n    if (!overview.selected) overview.select(\"table\")\n  }\n\n  maybeDrawPriceChart () {\n    if (this.priceChart) this.priceChart.destroy()\n\n    const asset = this.selected\n    const assetHasChart = asset && (asset.isTether || asset.apiId)\n\n    if (assetHasChart && asset.code !== global.currency) {\n      this.priceChart = new AssetPriceChart(asset)\n    } else {\n      this.priceChart = null\n    }\n  }\n}\n","\"use strict\"\n/**\n * Asset Price Chart\n */\nconst Highstock = require(\"highcharts/highstock\")\n\nconst Gui = require(\"@cosmic-plus/domutils/es5/gui\")\nconst nice = require(\"@cosmic-plus/jsutils/es5/nice\")\nconst { __ } = require(\"@cosmic-plus/i18n\")\n\nconst global = require(\"../logic/global\")\nconst marketData = require(\"../logic/market-data\")\n\n/**\n * Class\n */\n\nmodule.exports = class AssetPriceChart extends Gui {\n  constructor (asset) {\n    super(`\n      <section><h3>${asset.code} ${__(\"to\")} ${global.currency}</h3>\n        <div -ref=%container><p>${__(\"Loading...\")}</p></div>\n      </section>\n    `)\n\n    this.asset = asset\n    marketData.assetHistory(asset).then(data => this.drawChart(data))\n\n    this.listen(\"destroy\", () => this.chart && this.chart.destroy())\n  }\n\n  drawChart (data) {\n    this.chart = Highstock.stockChart(this.container, {\n      rangeSelector: { selected: 2 },\n\n      chart: {\n        backgroundColor: \"#fdfdfe\",\n        style: {\n          fontFamily: \"arial\",\n          color: \"#111\"\n        }\n      },\n\n      yAxis: [\n        { labels: { align: \"left\" }, height: \"80%\", resize: { enabled: true } },\n        { labels: { align: \"left\" }, top: \"80%\", height: \"20%\", offset: 0 }\n      ],\n      series: [\n        {\n          type: \"spline\",\n          name: \"Price\",\n          data: data.map(x => [x.time, +nice(x.price)])\n        },\n        {\n          type: \"column\",\n          name: \"Volume\",\n          data: data.map(x => [x.time, x.volume]),\n          yAxis: 1\n        }\n      ],\n      credits: { enabled: false }\n    })\n  }\n}\n","\"use strict\"\n/**\n * Portfolio Pie Chart\n */\nconst Highcharts = require(\"highcharts\")\nrequire(\"./helpers/highcharts-theme\")\n\nconst Gui = require(\"@cosmic-plus/domutils/es5/gui\")\nconst nice = require(\"@cosmic-plus/jsutils/es5/nice\")\nconst { __ } = require(\"@cosmic-plus/i18n\")\n\nconst global = require(\"../logic/global\")\n\n/**\n * Class\n */\n\nmodule.exports = class PortfolioPieChart extends Gui {\n  constructor (portfolio) {\n    super(`<div -ref=%container align=\"center\"></div>`)\n    this.portfolio = portfolio\n\n    this.watch(this.portfolio, \"total\", () => this.draw())\n    this.listen(\"destroy\", () => this.chart && this.chart.destroy())\n  }\n\n  reflow () {\n    if (this.chart) this.chart.reflow()\n  }\n\n  draw () {\n    if (this.chart) this.chart.destroy()\n\n    this.chart = Highcharts.chart(this.container, {\n      title: \"\",\n      legend: { enabled: false },\n      chart: { type: \"pie\" },\n      tooltip: {\n        pointFormat: `\n${__(\"Amount\")}: {point.amount} {point.code}<br>\n${__(\"Price\")}: {point.price} ${global.currency}<br>\n<b>${__(\"Value\")}: {point.y} ${global.currency}</b>\n`\n      },\n\n      plotOptions: {\n        pie: {\n          dataLabels: {\n            format: \"{point.amount} {point.code}<br>({point.percentage:.0f}%)\"\n          },\n          point: {\n            events: {\n              select: x => this.selected = x.target.options.asset,\n              legendItemClick: () => false\n            }\n          }\n        }\n      },\n\n      series: [\n        {\n          name: __(\"Amount\"),\n          colorByPoint: true,\n          ignoreHiddenPoint: true,\n          data: this.portfolio.assets\n            .filter(asset => asset.value)\n            .map(makePoint)\n            .sort((a, b) => b.y - a.y)\n        }\n      ]\n    })\n  }\n}\n\n/**\n * Helpers\n */\n\nfunction makePoint (asset) {\n  return {\n    name: asset.name,\n    code: asset.code,\n    asset: asset,\n    y: +nice(asset.value, 2),\n    amount: nice(asset.amount),\n    price: nice(asset.price),\n    percentage: asset.percentage\n  }\n}\n","\"use_strict\"\n/**\n * Theme for Highchart\n */\n\nconst Highcharts = require(\"highcharts\")\n\nHighcharts.theme = {\n  chart: {\n    backgroundColor: \"#fdfdfe\",\n    style: {\n      fontFamily: \"arial\",\n      color: \"#111\"\n    }\n  },\n\n  tooltip: { style: { fontSize: \"14px\" } },\n  credits: { enabled: false },\n\n  plotOptions: {\n    pie: {\n      allowPointSelect: true,\n      animation: false,\n      cursor: \"pointer\",\n      dataLabels: { style: { fontSize: \"14px\" } }\n    }\n  },\n\n  responsive: {\n    rules: [\n      {\n        condition: {\n          maxWidth: 500\n        },\n        chartOptions: {\n          legend: { enabled: true },\n          plotOptions: {\n            pie: {\n              showInLegend: true,\n              dataLabels: {\n                format: \"{point.percentage:.0f}%\",\n                distance: -20\n              }\n            }\n          }\n        }\n      }\n    ]\n  },\n\n  colors: [\n    \"rgba(231,  76,  60, 0.8)\",\n    \"rgba(230, 126,  34, 0.8)\",\n    \"rgba(242, 202,  39, 0.8)\",\n    \"rgba(46,  204, 112, 0.8)\",\n    \"rgba(52,  152, 219, 0.8)\",\n    \"rgba(155,  89, 182, 0.8)\",\n\n    \"rgba(231,  76,  60, 0.6)\",\n    \"rgba(230, 126,  34, 0.6)\",\n    \"rgba(242, 202,  39, 0.6)\",\n    \"rgba(46,  204, 112, 0.6)\",\n    \"rgba(52,  152, 219, 0.6)\",\n    \"rgba(155,  89, 182, 0.6)\",\n\n    \"rgba(231,  76,  60, 0.4)\",\n    \"rgba(230, 126,  34, 0.4)\",\n    \"rgba(242, 202,  39, 0.4)\",\n    \"rgba(46,  204, 112, 0.4)\",\n    \"rgba(52,  152, 219, 0.4)\",\n    \"rgba(155,  89, 182, 0.4)\"\n  ]\n}\n\nHighcharts.setOptions(Highcharts.theme)\n","\"use strict\"\n/**\n * Portfolio Table\n */\nconst Gui = require(\"@cosmic-plus/domutils/es5/gui\")\nconst html = require(\"@cosmic-plus/domutils/es5/html\")\nconst nice = require(\"@cosmic-plus/jsutils/es5/nice\")\nconst { __ } = require(\"@cosmic-plus/i18n\")\n\n/**\n * Class\n */\nmodule.exports = class PortfolioTable extends Gui {\n  constructor (portfolio) {\n    super(`\n<table class=\"PortfolioTable\">\n  <tr>\n    <th>${__(\"Name\")}</th>\n    <th>${__(\"Anchor\")}</th>\n    <th>${__(\"Amount\")}</th>\n    <th>${__(\"Price\")}</th>\n    <th>${__(\"Value\")}</th>\n  </tr>\n  %rows...\n</table>\n`)\n\n    this.portfolio = portfolio\n    this.rows = portfolio.assets.mirror(asset => this.toAssetRow(asset))\n    this.watch(portfolio, \"total\", () => this.sort())\n    this.trap(\"selected\", () => this.onselect(this.selected))\n  }\n\n  toAssetRow (asset) {\n    const row = new AssetRow(asset)\n    row.domNode.onclick = () => {\n      if (this.selected === row.asset) this.selected = null\n      else this.selected = row.asset\n    }\n    return row\n  }\n\n  sort () {\n    this.rows.sort((a, b) => b.asset.value - a.asset.value)\n  }\n\n  onselect (asset) {\n    if (this.selectedRow) this.selectedRow.simpleView()\n    this.selectedRow = this.rows.find(row => row.asset === asset)\n    if (this.selectedRow) this.selectedRow.detailledView()\n  }\n}\n\nclass AssetRow extends Gui {\n  constructor (asset) {\n    super(`\n<tr %class>\n  <td align=\"left\">\n    <img src=%image alt=\"\">\n    <span>%name</span>\n  </td>\n  <td align=\"left\">\n    <div hidden=%simple>%anchors...</div>\n    <div class=%mode>%anchorTotal</div>\n  </td>\n  <td align=\"right\">\n    <div hidden=%simple>%amounts...</div>\n    <div class=%mode>%amountTotal</div>\n  </td>\n  <td align=\"right\">\n    <div hidden=%simple>%prices...</div>\n    <div class=%mode title=%priceDetails>%priceTotal</div>\n  </td>\n  <td align=\"right\">\n    <div hidden=%simple>%values...</div>\n    <div class=%mode>%valueTotal</div>\n  </td>\n</tr>\n    `)\n\n    this.asset = asset\n\n    this.name = asset.code\n    this.anchors = asset.balances.mirror(x => cell(x.anchor, \"name\"))\n    this.amounts = asset.balances.mirror(x => cell(x, \"amount\", nice))\n    this.prices = asset.balances.mirror(x => priceCell(x, \"price\", nice))\n    this.values = asset.balances.mirror(x => cell(x, \"value\", x => nice(x, 2)))\n    asset.link(\"image\", this)\n    asset.link(\"amount\", this, \"amountTotal\", nice)\n    asset.link(\"price\", this, \"priceTotal\", nice)\n    asset.link(\"value\", this, \"valueTotal\", x => nice(x, 2))\n    asset.balances.feed(this, \"anchorHeader\", anchorName)\n\n    const orderbook = this.asset.orderbook\n    this.define(\"priceDetails\", \"orderbook\", () => priceDetails(orderbook))\n    this.watch(orderbook, [\"bestAsk\", \"bestBid\", \"spread%\"], () => {\n      this.compute(\"priceDetails\")\n    })\n\n    this.simpleView()\n  }\n\n  simpleView () {\n    this.simple = true\n    this.class = \"\"\n    this.mode = \"\"\n    this.anchorTotal = this.anchorHeader\n  }\n\n  detailledView () {\n    this.simple = false\n    this.class = \"selected\"\n    this.mode = \"footer\"\n    this.anchorTotal = \"Total\"\n  }\n}\n\n/**\n * Helpers\n */\n\nfunction anchorName (balances) {\n  if (balances.length === 1) return balances[0].anchor.name\n  else return `${__(\"multiple\")} (${balances.length})`\n}\n\nfunction cell (object, key, func) {\n  const node = html.create(\"div\", null, object[key])\n  object.link(key, node, \"textContent\", func)\n  return node\n}\n\nfunction priceCell (object, key, func) {\n  const node = cell(object, \"price\", func)\n  object.trap(\"orderbook\", () => {\n    if (object.orderbook) {\n      object.orderbook.trap([\"bestAsk\", \"bestBid\", \"spread%\"], () => {\n        node.title = priceDetails(object.orderbook)\n      })\n    }\n  })\n  return node\n}\n\nfunction priceDetails (orderbook) {\n  if (orderbook.base.code === \"XLM\") return \"\"\n  return `\nBuy: ${nice(orderbook.bestBid)} \\\n- Sell: ${nice(orderbook.bestAsk)} \\\n- Spread: ${nice(orderbook[\"spread%\"], 2)}%\n  `\n}\n","\"use strict\"\n/**\n * Settings Graphical User Interface\n */\nconst Gui = require(\"@cosmic-plus/domutils/es5/gui\")\nconst { __ } = require(\"@cosmic-plus/i18n\")\n\nconst Form = require(\"./helpers/form\")\nconst global = require(\"./logic/global\")\n\n/**\n * Available translations.\n */\nconst languages = {\n  us: \"English\",\n  fr: \"Français\"\n}\n\n/**\n * Possible reference currencies.\n */\nconst currencies = [\n  \"AUD\",\n  \"BGN\",\n  \"BRL\",\n  \"CAD\",\n  \"CHF\",\n  \"CNY\",\n  \"CZK\",\n  \"DKK\",\n  \"EUR\",\n  \"GBP\",\n  \"HKD\",\n  \"HRK\",\n  \"HUF\",\n  \"IDR\",\n  \"ILS\",\n  \"INR\",\n  \"ISK\",\n  \"JPY\",\n  \"KRW\",\n  \"MXN\",\n  \"MYR\",\n  \"NOK\",\n  \"NZD\",\n  \"PHP\",\n  \"PLN\",\n  \"RON\",\n  \"RUB\",\n  \"SEK\",\n  \"SGD\",\n  \"THB\",\n  \"TRY\",\n  \"USD\",\n  \"ZAR\"\n]\n\n/**\n * Class\n */\n\nclass SettingsGui extends Gui {\n  constructor () {\n    super(`\n      <section><h2>${__(\"Settings\")}</h2>\n        <section><h3>${__(\"General Settings\")}</h3>\n          <hr>\n          %general\n        </section>\n      </section>\n    `)\n\n    this.general = new GeneralSettings(global)\n  }\n}\n\nclass GeneralSettings extends Form {\n  constructor (global) {\n    super(\n      Form.selector({\n        label: __(\"Language\"),\n        name: \"language\",\n        values: languages\n      }),\n      Form.selector({\n        label: __(\"Currency\"),\n        name: \"currency\",\n        values: currencies\n      })\n    )\n\n    // Two-way binding.\n    global.project([\"currency\", \"language\"], this)\n    this.project([\"currency\", \"language\"], global)\n\n    // Refresh interface.\n    this.listen(\"change\", () => location.reload())\n  }\n}\n\n/**\n * Export\n */\n\nmodule.exports = SettingsGui\n","\"use strict\"\n/**\n * Target Graphical User Interface\n */\nconst Gui = require(\"@cosmic-plus/domutils/es5/gui\")\nconst { __ } = require(\"@cosmic-plus/i18n\")\n\nconst Target = require(\"./logic/target\")\nconst TargetSetup = require(\"./widgets/target-setup\")\nconst TargetsControls = require(\"./widgets/targets-controls\")\nconst TargetsTable = require(\"./widgets/targets-table\")\n\n/**\n * Class\n */\n\nmodule.exports = class RebalanceGui extends Gui {\n  constructor (portfolio) {\n    super(`\n<section class=\"RebalanceGui\">\n  <h2>${__(\"Rebalance\")}</h2>\n\n  %table\n\n  %controls\n\n</section>\n    `)\n\n    this.portfolio = portfolio\n\n    // Load & bind template from localStorage.\n    const targetKey = `target:${portfolio.account.id}`\n    const template = localStorage[targetKey]\n    this.target = Target.forPortfolio(portfolio, template)\n    this.target.link(\"json\", localStorage, targetKey, null, { init: false })\n    this.target.json = this.target.toJson()\n\n    // Targets table.\n    this.table = new TargetsTable(this.target)\n    this.table.project(\"selected\", this)\n    this.project(\"selected\", this.table)\n\n    // Controls.\n    this.trap(\"selected\", () => {\n      if (this.controls) this.controls.destroy()\n      if (this.selected) {\n        this.controls = new TargetSetup(this.selected)\n        this.controls.listen(\"close\", () => this.selected = null)\n      } else {\n        this.controls = new TargetsControls(this.target)\n      }\n    })\n  }\n}\n","\"use strict\"\n/**\n * Target class.\n *\n * A (portfolio) Target object represents a statically or dynamically allocated\n * target slice of the user portfolio. It is a theoric goal that the rebalancing\n * process aims to reach as much as possible.\n *\n * A Target may be composed by several Target subentries, in such a way that the\n * complete portfolio balancing target ends up being a tree made of Targets.\n */\nconst Mirrorable = require(\"@cosmic-plus/jsutils/es5/mirrorable\")\nconst Projectable = require(\"@cosmic-plus/jsutils/es5/projectable\")\n\nconst Asset = require(\"./asset\")\nconst Balance = require(\"./balance\")\nconst Order = require(\"./order\")\n\nconst strategy = require(\"./strategy\")\nconst {\n  arrayContains,\n  arrayRemove,\n  arraySum,\n  fixed7,\n  positive\n} = require(\"../helpers/misc\")\n\n/**\n * Definition\n */\n\nclass Target extends Projectable {\n  constructor (asset) {\n    super()\n\n    if (asset) {\n      this.asset = asset\n      this.mode = \"ignore\"\n      this.order = Order.rebalance(this)\n\n      asset.target = this\n      this.watch(asset, \"value\", () => this.compute(\"valueDiff\"))\n\n      // Asset with 0 amount won't trigger recompute by moving portfolio total\n      // value.\n      this.watch(asset, \"price\", () => {\n        if (!this.asset.amount && this.size) this.computeAll()\n      })\n\n      // Operations on trustlines.\n      this.opening = []\n      this.closing = []\n\n      // XLM is never ignored.\n      if (asset.id === \"XLM\") {\n        this.mode = \"weight\"\n        this.size = 1\n      }\n    } else {\n      this.childs = new Mirrorable()\n      this.childs.listen(\"add\", child => child.parent = this)\n      this.childs.listen(\"change\", () => this.computeAll())\n    }\n\n    // Normalize & compute\n    this.trap(\"size\", () => {\n      if (this.size) {\n        this.size = positive(this.size)\n        if (this.mode === \"percentage\") this.size = Math.min(100, this.size)\n      }\n      this.computeAll()\n    })\n  }\n\n  get root () {\n    if (this.parent) return this.parent.root\n    else return this\n  }\n}\n\nTarget.define(\"name\", [\"group\", \"asset\"], function () {\n  return this.group || this.asset.id\n})\nTarget.define(\"modified\", [\"json\"], function () {\n  return this.hasChanged()\n})\nTarget.define(\"valueDiff\", [\"value\", \"asset\"], function () {\n  return this.asset && this.asset.value - this.value\n})\nTarget.define(\"valueDiffP\", \"valueDiff\", function () {\n  return this.value ? this.valueDiff / this.value : null\n})\nTarget.define(\"amountDiff\", [\"amount\"], function () {\n  return fixed7(this.amount - this.asset.amount)\n})\nTarget.define(\"amountDelta\", [\"amountDiff\"], function () {\n  return Math.abs(this.amountDiff)\n})\n// Gets computed by \"strategy.js\".\nTarget.define(\"share\", null, function () {\n  return this.value / this.root.portfolio.total\n})\nTarget.define(\"shareDiff\", [\"share\"], function () {\n  return this.asset.share - this.share\n})\n\n/**\n * Actions\n */\n\nTarget.prototype.computeAll = function () {\n  if (this.parent) {\n    this.root.computeAll()\n  } else if (this.portfolio && this.portfolio.total) {\n    try {\n      this.error = null\n      this.value = this.portfolio.total\n      this.compute(\"modified\")\n      strategy.apply(this)\n    } catch (error) {\n      this.error = error.message\n      console.error(error)\n    }\n    this.trigger(\"update\")\n  }\n}\n\n/**\n * Add a target for **asset** into portfolio.\n */\nTarget.prototype.addAsset = function (asset) {\n  if (!this.childs) throw new Error(\"Target is not a group: \", target)\n  if (asset.target) throw new Error(\"Asset already has a target: \", asset)\n\n  // Add asset & target to current portfolio.\n  const target = new Target(asset)\n  target.parent = this\n  asset.anchors.forEach(anchor => target.addAnchor(anchor))\n  this.childs.push(target)\n  this.root.portfolio.assets.push(asset)\n\n  // Default setup.\n  target.mode = \"weight\"\n  target.size = 1\n\n  return target\n}\n\n/**\n * Open a new trustline then fund the new position.\n */\nTarget.prototype.addAnchor = function (anchor) {\n  const code = anchor.tetherCode(this.asset.code)\n  const issuer = anchor.pubkey\n  const balance = Balance.resolve(code, issuer)\n\n  if (balance.action === \"closing\") {\n    arrayRemove(this.closing, issuer)\n    balance.action = null\n  } else {\n    this.root.portfolio.balances.push(balance)\n    this.opening.push(issuer)\n    balance.action = \"opening\"\n  }\n\n  this.root.compute(\"modified\")\n  this.order.refresh()\n}\n\n/**\n * Begin anchor liquidation process, remove the trustline once done.\n */\nTarget.prototype.removeAnchor = function (anchor) {\n  const code = anchor.tetherCode(this.asset.code)\n  const issuer = anchor.pubkey\n  const balance = Balance.resolve(code, issuer)\n\n  if (balance.action === \"opening\") {\n    arrayRemove(this.root.portfolio.balances, balance)\n    arrayRemove(this.asset.balances, this)\n    arrayRemove(this.opening, issuer)\n    balance.action = null\n  } else {\n    this.closing.push(issuer)\n    balance.action = \"closing\"\n  }\n\n  this.root.compute(\"modified\")\n  this.order.refresh()\n}\n\n/**\n * Utilities\n */\n\n/**\n * Return deterministically sorted **target** childs without mutating source\n * object.\n */\nTarget.sortChilds = function (target) {\n  const childs = target.childs.slice()\n  return childs.sort((a, b) => a.name.localeCompare(b.name))\n}\n\n/**\n * Source: Portfolio\n */\n\nTarget.forPortfolio = function (portfolio, json) {\n  const target = json ? Target.fromJson(json) : new Target()\n  target.portfolio = portfolio\n\n  portfolio.target = target\n  target.watch(portfolio, \"total\", () => target.computeAll())\n\n  // Add/Remove assets after trustline change.\n  portfolio.assets.forEach(asset => {\n    if (\n      !target.childs.find(child => asset === child.asset)\n      && asset.isSupported\n    )\n      target.childs.push(new Target(asset))\n  })\n  target.childs.forEach((child, index) => {\n    if (\n      !portfolio.assets.find(asset => asset === child.asset)\n      || !child.asset.isSupported\n    )\n      target.childs.splice(index, 1)\n  })\n  portfolio.assets.listen(\"add\", asset => {\n    if (asset.isValid) target.childs.push(new Target(asset))\n  })\n  portfolio.assets.listen(\"remove\", asset => {\n    const index = target.childs.findIndex(child => child.asset === asset)\n    target.childs.splice(index, 1)\n  })\n\n  return target\n}\n\n/**\n * Format: JSON\n */\n\nTarget.fromJson = function (json) {\n  const object = JSON.parse(json)\n  const target = Target.fromObject(object)\n  target.json = json\n  return target\n}\n\nTarget.prototype.toJson = function (beautifyFlag) {\n  const object = this.toObject()\n  return JSON.stringify(object, null, beautifyFlag && 2)\n}\n\nTarget.prototype.hasChanged = function () {\n  return this.toJson() !== (this.json || \"{\\\"childs\\\":[]}\")\n}\n\n/**\n * Format: Object\n */\n\nTarget.fromObject = function (object) {\n  if (typeof object === \"string\") object = { asset: object }\n\n  // Create Target instance.\n  const asset = object.asset && Asset.resolve(object.asset)\n  const target = new Target(asset)\n  target.size = object.size\n  target.mode = object.mode\n\n  // Conversion from versions <= 0.5 − REMOVAL: 2020-05 (one year).\n  if (target.mode === \"equal\") target.mode = \"weight\"\n  if (target.mode === \"skip\") target.mode = \"ignore\"\n\n  // Fix for versions <= 0.6.1 - REMOVAL: 2020-06 (one year).\n  if (target.asset && target.asset.id === \"XLM\" && target.mode === \"ignore\") {\n    target.mode = \"weight\"\n    target.size = 1\n  }\n\n  // Set defaults.\n  if (!target.mode) target.mode = \"weight\"\n  if (target.size == null && target.mode === \"weight\") target.size = 1\n\n  // Group Target: Parse childs.\n  if (object.childs) {\n    target.group = object.group\n    const childs = object.childs.map(entry => Target.fromObject(entry))\n\n    // Conversion from versions <= 0.5 − REMOVAL: 2020-05 (one year).\n    //\n    // When there was no \"equal\" target, percentage targets whose sum is under\n    // 100 would act like \"weight\".\n    const percentChilds = childs.filter(child => child.mode === \"percentage\")\n    if (\n      percentChilds.length\n      && !childs.find(child => child.mode === \"weight\")\n      && arraySum(percentChilds, \"size\") !== 100\n    ) {\n      percentChilds.forEach(child => child.mode = \"weight\")\n    }\n\n    target.childs.push(...childs)\n  } else {\n    // Asset Target: Deal with trustline opening/closing.\n    const balances = target.asset.balances\n    if (object.opening) target.opening = object.opening\n    if (object.closing) target.closing = object.closing\n\n    balances.forEach(balance => {\n      const issuer = balance.anchor.pubkey\n      if (arrayContains(target.closing, issuer)) {\n        // Trustline is still not closed.\n        balance.action = \"closing\"\n      } else {\n        // Trustline has been opened.\n        arrayRemove(target.opening, issuer)\n      }\n    })\n\n    // Trustline has been closed.\n    target.closing.forEach(issuer => {\n      if (!balances.find(balance => balance.anchor.pubkey === issuer)) {\n        arrayRemove(target.closing, issuer)\n      }\n    })\n\n    // No balance for asset.\n    if (!balances.length) asset.target = null\n  }\n\n  return target\n}\n\nTarget.prototype.toObject = function () {\n  if (this.mode === \"ignore\") return\n\n  // Parameters reduction.\n  let object = { mode: this.mode, size: this.size }\n  if (object.mode === \"weight\") {\n    delete object.mode\n    if (object.size === 1) delete object.size\n  }\n\n  // Asset target.\n  if (this.asset) {\n    object.asset = this.name\n    if (this.opening.length) object.opening = this.opening\n    if (this.closing.length) object.closing = this.closing\n    if (Object.keys(object).length === 1) object = object.asset\n\n    // Group target.\n  } else if (this.childs) {\n    object.group = this.group\n    const childs = Target.sortChilds(this)\n    object.childs = childs.map(target => target.toObject()).filter(x => x)\n  }\n\n  return object\n}\n\n/**\n * Format: CosmicLink\n */\n\nTarget.prototype.toCosmicLink = function () {\n  if (this !== this.root) {\n    throw new Error(\"Only root target can be converted to CosmicLink\")\n  }\n\n  // Generate CosmicLink.\n  const operations = this.toOperations()\n  const cosmicLink = Order.operationsToCosmicLink(operations)\n\n  // Set outdated offers to be replaced.\n  const outdated = this.portfolio.offers.listOutdated()\n  cosmicLink.tdesc.operations.forEach(odesc => {\n    if (outdated.length) odesc.offerId = outdated.pop().id\n  })\n  outdated.forEach(remains => {\n    cosmicLink.addOperation(\"manageOffer\", { offerId: remains.id, amount: 0 })\n  })\n\n  // Open/close trustlines.\n  this.portfolio.balances\n    .filter(b => b.asset.target)\n    .forEach(balance => {\n      if (shouldOpenTrustline(balance)) {\n        cosmicLink.tdesc.operations.unshift({})\n        cosmicLink.setOperation(0, \"changeTrust\", { asset: balance.id })\n      }\n      if (shouldCloseTrustline(balance)) {\n        cosmicLink.tdesc.operations.unshift({})\n        cosmicLink.setOperation(0, \"changeTrust\", {\n          asset: balance.id,\n          limit: 0\n        })\n      }\n    })\n\n  return cosmicLink.tdesc.operations.length ? cosmicLink : null\n}\n\nfunction shouldOpenTrustline (balance) {\n  if (balance.asset.target.mode === \"remove\") return false\n  else return balance.action === \"opening\"\n}\n\nfunction shouldCloseTrustline (balance) {\n  if (!balance.hasTrustline) return false\n  else\n    return (\n      balance.amount === 0 && balance.action === \"closing\"\n      || balance.asset.target.mode === \"remove\" && balance.asset.amount === 0\n    )\n}\n\n/**\n * Format: Operations\n */\nTarget.prototype.toOperations = function () {\n  if (this.childs) {\n    return [].concat(...this.childs.map(child => child.toOperations()))\n  } else if (this.order) {\n    return this.order.operations\n  } else {\n    return []\n  }\n}\n\n/**\n * Export\n */\n\nmodule.exports = Target\n","\"use strict\"\n/**\n * Order class\n */\n\nconst cosmicLib = require(\"cosmic-lib\")\nconst CosmicLink = cosmicLib.CosmicLink\nconst Mirrorable = require(\"@cosmic-plus/jsutils/es5/mirrorable\")\nconst nice = require(\"@cosmic-plus/jsutils/es5/nice\")\nconst Projectable = require(\"@cosmic-plus/jsutils/es5/projectable\")\nconst { __ } = require(\"@cosmic-plus/i18n\")\n\nconst global = require(\"./global\")\nconst {\n  positive,\n  negative,\n  fixed7,\n  clamp,\n  absoluteMin,\n  arraySum,\n  arrayScale\n} = require(\"../helpers/misc\")\n\n/**\n * Class\n */\n\nconst Order = module.exports = class Order extends Projectable {\n  static rebalance (target) {\n    if (target.asset.code === \"XLM\") return\n\n    const order = new Order(\"balance\", target.asset.orderbook, target)\n    order.watch(target, \"amount\", () => order.refresh())\n    order.watch(target.asset.orderbook, [\"bids\", \"asks\"], () => order.refresh())\n    target.asset.offers.listen(\"change\", () => order.refresh(), order)\n\n    return order\n  }\n\n  constructor (type, orderbook, ...parameters) {\n    super()\n    this.type = type\n    this.method = Order.type[this.type]\n    this.operations = new Mirrorable()\n    this.orderbook = orderbook\n    this.parameters = parameters\n\n    this.operations.listen(\"update\", () => {\n      this.compute([\"cosmicLink\", \"description\"])\n    })\n\n    this.refresh()\n  }\n\n  refresh () {\n    this.operations.splice(0, this.operations.length)\n    this.operations.trigger(\"update\")\n    this.method(this, ...this.parameters)\n    this.trigger(\"refresh\")\n  }\n\n  /**\n   * Operations Management\n   */\n\n  getOperation (offer, make) {\n    const id = `${offer.balance.anchor.name}:${make ? offer.price : \"take\"}`\n    const operation = this.operations.find(x => x.id === id)\n    if (operation) {\n      return operation\n    } else {\n      const newOperation = { id }\n      this.operations.push(newOperation)\n      return newOperation\n    }\n  }\n\n  addOperation (offer, amount) {\n    const operation = this.getOperation(offer, amount > 0)\n    this.setOperation(operation, offer, Number(amount) || operation.amount)\n  }\n\n  setOperation (operation, offer, amount) {\n    operation.amount = fixed7(amount)\n    operation.cost = amount * offer.price\n    operation.offer = offer\n    this.operations.trigger(\"update\")\n  }\n}\n\nOrder.define(\"description\", \"operations\", function () {\n  return Order.operationsToDescription(this.operations)\n})\n\n/**\n * Utilities\n */\n\nOrder.operationsToCosmicLink = function (operations = []) {\n  // Create CosmicLink.\n  const cosmicLink = new CosmicLink({\n    memo: \"Equilibre.io\",\n    maxTime: \"+5\",\n    source: global.portfolio.accountId\n  })\n\n  // Set operations.\n  operations.forEach(operation => {\n    cosmicLink.addOperation(\"manageOffer\", operationToOdesc(operation))\n  })\n\n  return cosmicLink\n}\n\nOrder.operationsToDescription = function (operations = []) {\n  const desc = []\n  operations.forEach(op => {\n    if (operationDirection(op) === \"buy\") {\n      desc.push(`\n${__(\"Buy\")} ${nice(op.amount)} ${op.offer.balance.code} ${__(\"at\")} \\\n${nice(op.offer.price)} ${global.currency}\n      `)\n    } else {\n      desc.push(`\n${__(\"Sell\")} ${nice(op.amount)} ${op.offer.balance.code} ${__(\"at\")} \\\n${nice(op.offer.price)} ${global.currency}\n      `)\n    }\n  })\n  return desc\n}\n\n/**\n * Helpers\n */\n\nfunction operationDirection (op) {\n  if (\n    op.amount > 0 && op.offer.side === \"bids\"\n    || op.amount < 0 && op.offer.side === \"asks\"\n  ) {\n    return \"buy\"\n  } else {\n    return \"sell\"\n  }\n}\n\nfunction operationToOdesc (operation) {\n  const offer = operation.offer\n  const base = offer.balance.code + \":\" + offer.balance.anchor.pubkey\n  const quote = \"XLM\"\n\n  let odesc\n  if (operationDirection(operation) === \"buy\") {\n    odesc = {\n      buying: base,\n      selling: quote,\n      amount: fixed7(operation.amount * offer.price_r.n / offer.price_r.d),\n      price: { n: offer.price_r.d, d: offer.price_r.n }\n    }\n  } else {\n    odesc = {\n      buying: quote,\n      selling: base,\n      amount: operation.amount,\n      price: offer.price_r\n    }\n  }\n  odesc.offerId = operation.offer.id\n\n  return odesc\n}\n\n/**\n * Orders types\n */\n\nOrder.type = {}\n\nOrder.type.market = function (order, size) {\n  if (!size) return\n\n  const side = size > 0 ? \"asks\" : \"bids\"\n  const amount = Math.abs(size)\n  const offer = order.orderbook.findOffer(side, offer => {\n    return offer.baseVolume > amount\n  })\n  order.addOperation(offer, amount)\n}\n\nOrder.type.limit = function (order, size, { orderbook, filter }) {\n  if (!size) return\n\n  const side = size > 0 ? \"bids\" : \"asks\"\n  const offer = (orderbook || order.orderbook).findOffer(side, filter)\n  if (offer) order.addOperation(tightenSpread(offer), Math.abs(size))\n}\n\n/**\n * Rebalancing\n */\n\nOrder.type.balance = function (order, target) {\n  const asset = target.asset\n  const orderbook = asset.orderbook\n\n  // Requirements\n\n  if (target.amount == null || target.amountDelta === 0) return\n\n  if (!orderbook.isFetched()) {\n    order.description = [__(\"Fetching orderbook...\")]\n    return\n  }\n\n  if (asset.liabilities) {\n    const currentOffers = asset.offers.filter(offer => !offer.outdated)\n    if (currentOffers.length) {\n      order.description = [__(\"Rebalancing...\")]\n      return\n    }\n  }\n\n  // Rebalancing\n\n  setBalancesTargets(target)\n  if (!areTargetAnchorsBalanced(target)) {\n    balanceTargetAnchors(target, target.amountDiff)\n  } else if (isOneOperationEnough(target, target.amountDiff)) {\n    addOneOperation(target, target.amountDiff)\n  } else {\n    addMultipleOperations(target, target.amountDiff)\n  }\n}\n\n/**\n * Set the `targetAmount` property of **target** balances according to\n * `target.amount`.\n */\nfunction setBalancesTargets (target) {\n  // Empty orderbooks cannot be traded.\n  const balances = []\n  target.asset.balances.forEach(balance => {\n    if (balance.orderbook.price == null || !balance.isActive) {\n      balance.targetAmount = null\n    } else {\n      balances.push(balance)\n    }\n  })\n\n  // Special cases.\n  if (!balances.length) {\n    return\n  } else if (balances.length === 1) {\n    return balances[0].targetAmount = target.amount\n  }\n\n  // Set each balance tradable amount.\n  const targetAmount = fixed7(target.amount / balances.length)\n  balances.forEach(balance => balance.targetAmount = targetAmount)\n}\n\n/**\n * Returns whether or not **target** asset anchors current funds are risk\n * balanced.\n */\nfunction areTargetAnchorsBalanced (target) {\n  const balances = target.asset.balances\n  return !(arraySum(balances, \"underMin\") && arraySum(balances, \"overMax\"))\n}\n\n/**\n * Create a set of operations that even out anchor amounts of `target.asset`.\n */\nfunction balanceTargetAnchors (\n  target,\n  size = target.amountDiff,\n  riskMax = global.anchorsRebalanceRiskMax\n) {\n  const balances = target.asset.balances\n\n  // Compute the amount to transfer between anchors.\n  const under = -arraySum(balances, \"underMin\")\n  const over = arraySum(balances, \"overMax\")\n  const misallocated = Math.max(under - positive(size), over + negative(size))\n\n  // Eventually limit risk by capping that amount.\n  const currentRisk = Math.abs(target.valueDiffP)\n  const amountCap = target.amount * positive(riskMax - currentRisk)\n  const transferAmount = Math.min(misallocated, amountCap)\n\n  // Factor in the amount of asset to buy/sell to balance portfolio.\n  const buy = fixed7(transferAmount + positive(size))\n  const sell = fixed7(transferAmount - negative(size))\n\n  // Generate operations accordingly.\n  addMultipleOperations(target, buy)\n  addMultipleOperations(target, -sell)\n}\n\n/**\n * Returns whether or not it is possible meet **target** rebalancing target in\n * one operation.\n */\nfunction isOneOperationEnough (target, size) {\n  const balances = target.asset.balances\n  return !!balances.filter(b => b.sizeMin <= size && size <= b.sizeMax).length\n}\n\n/**\n * Adds an operation to `target.order` that trades **size** `target.asset` on\n * **orderbook**.\n */\nfunction addOneOperation (target, size, orderbook = target.asset.orderbook) {\n  const noMinValue = target.mode === \"quantity\" || target.amount === 0\n  const baseAsk = orderbook.asks[0].basePrice\n  if (!noMinValue && Math.abs(size * baseAsk) < global.minOfferValue) return\n\n  const filter = makeOfferFilter(target, size)\n  Order.type.limit(target.order, size, { orderbook, filter })\n}\n\n/**\n * Split a trade over multiple anchors.\n */\nfunction addMultipleOperations (target, size) {\n  const balances = target.asset.balances\n  let tradeSize = 0,\n    trade = balances.map(() => 0)\n\n  // 1. Sell balances being closed.\n  if (negative(size)) {\n    const liquidate = balances.map(balance => {\n      return balance.action === \"closing\" ? -balance.amount : 0\n    })\n    tradeSize = _addToTrade(trade, liquidate, size)\n  }\n\n  // 2. If this was not enough, trade imbalanced anchors.\n  const misallocatedKey = positive(size) ? \"underMin\" : \"overMax\"\n  if (tradeSize !== size) {\n    const misallocated = balances.map(balance => {\n      return balance.action !== \"closing\" ? balance[misallocatedKey] : 0\n    })\n    tradeSize = _addToTrade(trade, misallocated, size - tradeSize)\n  }\n\n  // 3. If this was not enough, trade balanced anchors.\n  if (tradeSize !== size) {\n    const sizeKey = positive(size) ? \"sizeMax\" : \"sizeMin\"\n    const tradable = balances.map(b => b[sizeKey] - b[misallocatedKey])\n    _addToTrade(trade, tradable, size - tradeSize)\n  }\n\n  // Create operations according to **trade**.\n  balances.forEach((balance, index) => {\n    const size = fixed7(trade[index])\n    addOneOperation(target, size, balance.orderbook)\n  })\n}\n\n/**\n * Adds **amounts** to **trade**, which is an array of trade sizes. Caps summed\n * **trade** sizes to **sizeMax**. Returns the summed **trade** size.\n */\nfunction _addToTrade (trade, amounts, sizeMax) {\n  const amountsSum = arraySum(amounts)\n  const tradeSize = absoluteMin(sizeMax, amountsSum)\n  const toBeAdded = arrayScale(amounts, tradeSize)\n  toBeAdded.forEach((value, index) => trade[index] += value)\n  return arraySum(trade)\n}\n\n/**\n * Returns a balancing offer filter for **tradedAmount** to be used with\n * `Orderbook.findOffer()`.\n */\nfunction makeOfferFilter (target, size) {\n  return offer => {\n    return (\n      size >= offer.balance.sizeMin\n      && size <= offer.balance.sizeMax\n      && offer.baseVolume > Math.abs(size) * global.skipMarginalOffers\n    )\n  }\n}\n\n/**\n * Create a copy of **offer** with a delta to global market price reduced by\n * **percentage**.\n */\nfunction tightenSpread (offer, percentage = global.spreadTightening) {\n  const clone = Object.assign({}, offer)\n  const diff = percentage * offer.balance.asset.orderbook[\"spread%\"] / 100\n\n  if (offer.side === \"bids\") clone.price = offer.price * (1 + diff)\n  else clone.price = offer.price * (1 - diff)\n\n  if (offer.balance.asset.globalPrice) clampOfferPrice(clone)\n  updateOfferPriceR(clone)\n\n  return clone\n}\n\n/**\n * Floor/ceil **offer**'s price between global market price and a **premium**.\n * **premium** soft cap is given in argument; hard cap is the average anchor\n * price.\n */\nfunction clampOfferPrice (offer, premium = global.maxSpread / 2) {\n  const globalPrice = offer.balance.asset.price\n  const anchorPrice = offer.balance.orderbook.price\n\n  if (offer.side === \"bids\") {\n    const minPrice = Math.min(anchorPrice, globalPrice * (1 - premium))\n    offer.price = clamp(offer.price, minPrice, globalPrice)\n  } else {\n    const maxPrice = Math.max(anchorPrice, globalPrice * (1 + premium))\n    offer.price = clamp(offer.price, globalPrice, maxPrice)\n  }\n}\n\n/**\n * Set `offer.price_r` according to `offer.price`.\n *\n * @param  {Object} offer\n */\nfunction updateOfferPriceR (offer) {\n  const quote = offer.balance.orderbook.quote\n\n  offer.price_r = {\n    n: nice(offer.price * 10000000000, 0),\n    d: nice(quote.price * 10000000000, 0)\n  }\n\n  // Ten characters maximum\n  while (offer.price_r.n > 999999999 || offer.price_r.d > 999999999) {\n    offer.price_r.n = nice(offer.price_r.n / 10, 0)\n    offer.price_r.d = nice(offer.price_r.d / 10, 0)\n  }\n}\n\n/**\n * Append Order.type to Order class\n */\n\nfor (let key in Order.type) {\n  if (!Order[key]) Order[key] = (...parameters) => new Order(key, ...parameters)\n}\n","\"use strict\"\n/**\n * Rebalancing strategies\n */\nconst strategy = exports\n\nconst nice = require(\"@cosmic-plus/jsutils/es5/nice\")\nconst { __ } = require(\"@cosmic-plus/i18n\")\n\nconst global = require(\"./global\")\nconst { fixed7, positive } = require(\"../helpers/misc\")\n\n/**\n * Applicator\n */\n\nstrategy.apply = function (target) {\n  const delayed = []\n  let sum = 0,\n    weights = 0\n\n  target.childs.forEach(child => {\n    const mode = child.mode\n    if (mode === \"weight\") {\n      delayed.push(child)\n      weights += child.size\n    } else {\n      strategy[mode](child)\n      sum += child.value\n    }\n  })\n\n  const remains = positive(target.value - sum)\n  delayed.forEach(child => strategy.weight(child, remains, weights))\n\n  checkAllocationLimits(sum, target.value, delayed.length)\n}\n\nfunction checkAllocationLimits (allocated, available, checkUnderFlag) {\n  if (allocated > available) {\n    const over = +nice(allocated - available, 2)\n    const overP = +nice(100 * over / available, 2)\n    let msg = __(\"Rebalance setup is over portfolio value by\")\n    msg += ` ${over} ${global.currency} (${overP}%) `\n    throw new Error(msg)\n  } else if (!checkUnderFlag && allocated < available) {\n    const under = +nice(available - allocated, 2)\n    const underP = +nice(100 * under / available, 2)\n    let msg = __(\"Rebalance setup is under portfolio value by\")\n    msg += ` ${under} ${global.currency} (${underP}%) `\n    throw new Error(msg)\n  }\n}\n\n/**\n * Strategies\n */\n\nstrategy.amount = function (target) {\n  target.amount = target.size\n  target.value = target.amount * target.asset.price\n  target.compute(\"share\")\n}\n\nstrategy.ignore = function (target) {\n  target.value = target.asset.value\n  target.amount = target.asset.amount\n  target.compute(\"share\")\n}\n\nstrategy.remove = function (target) {\n  target.amount = 0\n  target.value = 0\n  target.compute(\"share\")\n}\n\nstrategy.percentage = function (target) {\n  strategy.weight(target, target.parent.value, 100)\n}\n\nstrategy.weight = function (target, remains, weights) {\n  if (!weights) {\n    target.value = target.amount = 0\n  } else {\n    target.value = target.size * remains / weights\n    target.amount = fixed7(target.value / target.asset.price)\n  }\n  target.compute(\"share\")\n}\n","\"use strict\"\n/**\n * Target Setup Form\n */\nconst Gui = require(\"@cosmic-plus/domutils/es5/gui\")\nconst { __ } = require(\"@cosmic-plus/i18n\")\n\nconst TargetSetupAnchors = require(\"./target-setup-anchors\")\nconst TargetSetupSize = require(\"./target-setup-size\")\n\n/** Definition **/\n\nmodule.exports = class TargetSetup extends Gui {\n  constructor (target) {\n    super(`\n<section class=\"TargetSetup\">\n  <form onsubmit=\"return false\">\n\n    <h3>%name</h3>\n    <hr>\n\n    %sizeSetup\n    %anchorsSetup\n\n    <hr>\n    <input type=\"submit\" onclick=%close value=\"${__(\"Close\")}\">\n\n  </form>\n</section>\n    `)\n\n    this.target = target\n    this.name = target.asset.name\n\n    this.sizeSetup = new TargetSetupSize(target)\n\n    if (this.target.asset.anchors.length > 1) {\n      this.anchorsSetup = new TargetSetupAnchors(target)\n    }\n  }\n\n  close () {\n    this.sizeSetup.maybeSwitchMode()\n    this.trigger(\"close\")\n    this.destroy()\n  }\n}\n","\"use strict\"\n/**\n * Target Setup Anchors\n */\nconst Gui = require(\"@cosmic-plus/domutils/es5/gui\")\nconst { __ } = require(\"@cosmic-plus/i18n\")\n\n/* Definition */\n\nmodule.exports = class TargetSetupAnchors extends Gui {\n  constructor (target) {\n    super(`\n<fieldset class=\"TargetSetupAnchors\">\n  <legend>${__(\"Anchor\")}:</legend>\n  %toAnchorCheckbox:anchors...\n</fieldset>\n  `)\n\n    this.target = target\n    this.anchors = target.asset.anchors\n  }\n\n  toAnchorCheckbox (anchor) {\n    return new AnchorCheckbox(anchor, {\n      getState: () => isTargetAnchorActive(this.target, anchor),\n      callback: this.switchAnchor.bind(this)\n    })\n  }\n\n  switchAnchor (anchor, checked) {\n    if (checked) {\n      this.target.addAnchor(anchor)\n    } else if (areTwoOrMoreAnchorsActive(this.target)) {\n      this.target.removeAnchor(anchor)\n    }\n  }\n}\n\nfunction isTargetAnchorActive (target, anchor) {\n  const balance = target.asset.balances.find(b => b.anchor === anchor)\n  return balance && balance.isActive\n}\n\nfunction areTwoOrMoreAnchorsActive (target) {\n  const count = target.asset.balances.reduce((sum, balance) => {\n    return balance.isActive ? sum + 1 : sum\n  }, 0)\n  return count > 1\n}\n\nclass AnchorCheckbox extends Gui {\n  constructor (anchor, params = {}) {\n    const { getState, callback } = params\n\n    super(`\n<span class=\"AnchorCheckbox half\">\n  <input -ref=%checkbox type=\"checkbox\" %checked>\n  <label -ref=%label %onclick>%name</label>\n</span>\n`)\n    this.name = anchor.name\n    this.checked = getState()\n\n    this.onclick = () => {\n      callback(anchor, !this.checked)\n      this.checked = getState()\n    }\n  }\n}\n","\"use strict\"\n/**\n * Target Setup Size\n */\nconst Gui = require(\"@cosmic-plus/domutils/es5/gui\")\n\nconst nice = require(\"@cosmic-plus/jsutils/es5/nice\")\nconst { __ } = require(\"@cosmic-plus/i18n\")\n\n/** Definition **/\n\nmodule.exports = class TargetSetupSize extends Gui {\n  constructor (target) {\n    super(`\n<fieldset class=\"TargetSetupSize\">\n  <legend>${__(\"Size\")}:</legend>\n\n  <input class=\"half\" type=\"number\" step=\"any\" min=\"0\" %max value=%size\n    placeholder=%share onchange=%maybeSwitchMode>\n\n  <select class=\"half\" onchange=%setMode value=%mode>\n    <option value=\"weight\">${__(\"Weight\")}</option>\n    <option value=\"percentage\">${__(\"Percentage\")}</option>\n    <option value=\"amount\">${__(\"Amount\")}</option>\n    <option value=\"ignore\" hidden=%targetIsXlm>${__(\"Ignore\")}</option>\n    <option value=\"remove\" hidden=%targetIsXlm>${__(\"Remove\")}</option>\n  </select>\n\n</fieldset>\n    `)\n\n    this.target = target\n    this.targetIsXlm = target.asset.id === \"XLM\"\n\n    target.project(\"share\", this, x => nice(100 * x, 2))\n\n    target.project(\"size\", this)\n    this.project(\"size\", target, x => x != null ? Number(x) : null)\n\n    target.project(\"mode\", this)\n    this.project(\"mode\", target)\n  }\n\n  maybeSwitchMode () {\n    if (this.size === 0) {\n      this.mode = \"amount\"\n    } else if (!this.size) {\n      if (this.mode !== \"remove\") this.mode = \"ignore\"\n    } else if (this.mode === \"ignore\" || this.mode === \"remove\") {\n      this.mode = \"percentage\"\n      this.target.computeAll()\n    }\n  }\n\n  setMode () {\n    // TODO: Move this logic to Target model.\n    switch (this.mode) {\n    case \"weight\":\n      this.size = 1\n      this.max = null\n      break\n    case \"percentage\":\n      this.size = +nice(100 * this.target.asset.share, 2)\n      this.max = 100\n      break\n    case \"amount\":\n      this.size = this.target.asset.amount\n      this.max = null\n      break\n    case \"ignore\":\n    case \"remove\":\n      this.target.set(\"size\", null)\n      break\n    }\n  }\n}\n","\"use strict\"\n/**\n * Targets Controls\n */\nconst Gui = require(\"@cosmic-plus/domutils/es5/gui\")\nconst html = require(\"@cosmic-plus/domutils/es5/html\")\nconst { __ } = require(\"@cosmic-plus/i18n\")\n\nconst SideFrame = require(\"../helpers/side-frame\")\n\n/**\n * Class\n */\n\nmodule.exports = class TargetsControls extends Gui {\n  constructor (target) {\n    super(`\n<section class=\"TargetControls\">\n  <form onsubmit=\"return false\" hidden=%hideRebalance>\n    <button onclick=%rebalance disabled=%invalid>${__(\"Rebalance\")}</button>\n  </form>\n\n  <form onsubmit=\"return false\" hidden=%hideSave>\n    <button onclick=%save disabled=%invalid>${__(\"Save\")}</button>\n    <button onclick=%cancel>${__(\"Cancel\")}</button>\n  </form>\n\n  %toParagraph:error\n</section>\n    `)\n\n    this.target = target\n    target.project([\"error\", \"modified\"], this)\n\n    this.define(\"hideRebalance\", [\"modified\"], () => this.modified)\n    this.define(\"hideSave\", [\"modified\"], () => !this.modified)\n    this.define(\"invalid\", [\"error\"], () => !!this.error)\n  }\n\n  toParagraph (error) {\n    if (error) return html.create(\"p\", \".error\", error)\n  }\n\n  cancel () {\n    location.reload()\n  }\n\n  save () {\n    this.target.json = this.target.toJson()\n  }\n\n  rebalance () {\n    const cosmicLink = this.target.toCosmicLink()\n\n    if (cosmicLink) {\n      const sideFrame = new SideFrame(cosmicLink.uri)\n      sideFrame.listen(\"destroy\", () => {\n        this.target.portfolio.getAccount()\n        this.target.portfolio.offers.get()\n      })\n    }\n  }\n}\n","\"use strict\"\n/**\n * Targets Table\n */\nconst Gui = require(\"@cosmic-plus/domutils/es5/gui\")\nconst html = require(\"@cosmic-plus/domutils/es5/html\")\nconst nice = require(\"@cosmic-plus/jsutils/es5/nice\")\nconst { __ } = require(\"@cosmic-plus/i18n\")\n\nconst AssetPrompt = require(\"./asset-prompt\")\n\n/**\n * Definition\n */\n\nmodule.exports = class TargetsTable extends Gui {\n  constructor (target) {\n    super(`\n<section class=\"TargetsTable\">\n  <table>\n    <tr>\n      <th>${__(\"Name\")}</th>\n      <th>${__(\"Goal\")}</th>\n      <th>${__(\"Divergence\")}</th>\n      <th>${__(\"Operation\")}</th>\n    </tr>\n\n    %targets...\n\n    <tr><td colspan=\"4\" align=\"center\" onclick=%addAsset>\n      <h3>${__(\"Add Asset\")}</h3>\n    </td></tr>\n\n  </table>\n</section>\n    `)\n\n    this.target = target\n\n    this.targets = target.childs.mirror(child => this.toTargetRow(child))\n    this.selected = undefined\n\n    target.listen(\"update\", () => this.sortTargets())\n    this.sortTargets()\n  }\n\n  toTargetRow (target) {\n    const row = new TargetRow(target)\n    row.domNode.onclick = () => this.selected = target\n    return row\n  }\n\n  sortTargets () {\n    this.targets.sort((a, b) => {\n      a = a.target\n      b = b.target\n      if (b.mode === \"ignore\" && a.mode !== \"ignore\") return -1\n      else if (a.mode === \"ignore\" && b.mode !== \"ignore\") return 1\n      if (b.mode === \"remove\" && a.mode !== \"remove\") return -1\n      else if (a.mode === \"remove\" && b.mode !== \"remove\") return 1\n      return b.value - a.value || a.asset.code.localeCompare(b.asset.code)\n    })\n  }\n\n  async addAsset () {\n    const assets = this.target.portfolio.availableAssets().filter(a => a.show)\n    const assetPrompt = new AssetPrompt(assets)\n    assetPrompt.open()\n\n    const asset = await assetPrompt.answer\n    if (!asset) return\n\n    const target = this.target.addAsset(asset)\n    this.selected = target\n  }\n}\n\nclass TargetRow extends Gui {\n  constructor (target) {\n    super(`\n<tr class=\"TargetRow\">\n  <td align=\"left\">\n    <img src=%image alt=\"\">\n    <span>%name</span>\n  </td>\n  <td align=\"right\">%command</td>\n  <td align=\"right\">%toPercent:shareDiff</td>\n  <td align=\"right\">%toDiv:description...</td>\n</tr>\n    `)\n\n    this.target = target\n    this.name = target.asset.code\n\n    this.define(\"command\", null, () => this.toCommand(target))\n    this.watch(target, [\"size\", \"mode\", \"share\"], () => this.compute(\"command\"))\n\n    target.asset.project(\"image\", this)\n    target.project(\"shareDiff\", this)\n\n    if (target.order) target.order.project(\"description\", this)\n  }\n\n  toCommand (target) {\n    switch (target.mode) {\n    case \"ignore\":\n      return __(\"Ignore\")\n    case \"remove\":\n      return __(\"Remove\")\n    case \"amount\":\n      return `${target.amount} ${target.asset.code}`\n    case \"weight\":\n      return `${target.size} − ${this.toPercent(target.share)}`\n    case \"percentage\":\n      return this.toPercent(target.share)\n    }\n  }\n\n  toPercent (x) {\n    return !x ? \"-\" : nice(x * 100, 2) + \"%\"\n  }\n\n  toDiv (obj) {\n    return html.create(\"div\", null, obj)\n  }\n}\n","\"use strict\"\n/**\n * Asset Prompt\n */\nconst { __ } = require(\"@cosmic-plus/i18n\")\n\nconst AssetSelector = require(\"./asset-selector\")\nconst Dialog = require(\"../helpers/dialog\")\nconst Modal = require(\"../helpers/modal\")\n\n/**\n * Definition\n */\n\nmodule.exports = class AssetPrompt extends Modal {\n  constructor (assets) {\n    super()\n\n    // Interaction.\n    const assetSelector = new AssetSelector(assets)\n    this.content = new Dialog(assetSelector)\n    this.content.actions = [\n      [__(\"OK\"), () => this.returns(assetSelector.selected), \"submit\"],\n      [__(\"Cancel\"), () => this.returns(null)]\n    ]\n    this.content.listen(\"close\", () => this.returns(null))\n\n    // Promise an answer.\n    this.answer = new Promise(resolve => this.returns = resolve)\n    this.answer.then(() => {\n      this.close()\n      this.destroy()\n    })\n  }\n}\n","\"use strict\"\n/**\n * Asset Selector\n */\nconst Gui = require(\"@cosmic-plus/domutils/es5/gui\")\nconst Mirrorable = require(\"@cosmic-plus/jsutils/es5/mirrorable\")\nconst { __ } = require(\"@cosmic-plus/i18n\")\n\n/**\n * Definition\n */\n\nmodule.exports = class AssetSelector extends Gui {\n  constructor (assets) {\n    super(`\n<div class=\"AssetSelector\">\n  %groups...\n</div>\n    `)\n\n    this.groups = new Mirrorable()\n\n    const fiats = assets.filter(a => a.type === \"fiat\")\n    const cryptos = assets.filter(a => a.type === \"crypto\" && a.isTether)\n    const natives = assets.filter(a => a.type === \"crypto\" && !a.isTether)\n\n    this.addGroup(__(\"Fiat Tethers\"), fiats)\n    this.addGroup(__(\"Crypto Tethers\"), cryptos)\n    this.addGroup(__(\"Native Assets\"), natives)\n  }\n\n  addGroup (name, assets) {\n    if (!assets.length) return\n\n    const onselect = asset => this.selected = asset\n    const group = new AssetGroup(name, assets, onselect)\n    this.groups.push(group)\n  }\n}\n\n/**\n * Helpers\n */\n\nclass AssetGroup extends Gui {\n  constructor (name, assets, onselect) {\n    super(`\n<fieldset class=\"AssetGroup\">\n  <legend>%name</legend>\n  %toAssetRadio:assets...\n</fieldset>\n    `)\n\n    this.name = name\n    this.assets = assets\n    this.onselect = onselect\n  }\n\n  toAssetRadio (asset) {\n    return new AssetRadio(asset, () => this.onselect(asset))\n  }\n}\n\nclass AssetRadio extends Gui {\n  constructor (asset, onselect) {\n    super(`\n<span class=\"AssetRadio half\">\n  <input -ref=%radio type=\"radio\" name=\"asset-selector-group\" %onchange>\n  <label -ref=%label for=%radio>\n    <img src=%image>\n    %name\n  </label>\n</span>\n    `)\n\n    this.name = asset.name\n    this.image = asset.image\n    this.onchange = () => this.radio.checked && onselect()\n\n    this.label.for = this.radio\n    this.label.onclick = () => this.radio.click()\n  }\n}\n","\"use strict\"\n/**\n * Dialog\n */\nconst Gui = require(\"@cosmic-plus/domutils/es5/gui\")\nconst html = require(\"@cosmic-plus/domutils/es5/html\")\n\n/**\n * Definition\n */\n\nmodule.exports = class Dialog extends Gui {\n  constructor (...content) {\n    super(`\n<form class=\"Dialog\" onsubmit=\"return false\">\n\n  %content...\n\n  <div class=\"DialogControls\">\n    %toButton:actions...\n  </div>\n</form>\n    `)\n\n    this.content = content\n  }\n\n  toButton ([name, onclick, type = \"button\"]) {\n    return html.create(\"button\", { type, onclick }, name)\n  }\n}\n","\"use strict\"\n/**\n * Modal boxes helper\n */\nconst Gui = require(\"@cosmic-plus/domutils/es5/gui\")\n\nconst ClickWall = require(\"./click-wall\")\n\n/**\n * Definition\n */\n\nclass Modal extends Gui {\n  constructor (params = {}) {\n    super(`\n<div class=\"Modal\" %style %hidden>%content</div>\n    `)\n\n    Object.assign(this.style, Modal.style)\n    this.hidden = true\n    this.content = params.content\n\n    // Handle styling parameters.\n    this.trap(Modal.styleParams, event => this.style[event.key] = event.value)\n    Modal.styleParams.forEach(key => this[key] = params[key])\n\n    // Initialization.\n    document.body.insertBefore(this.domNode, document.body.firstChild)\n  }\n\n  setPosition () {\n    const translate = { x: 0, y: 0 }\n    if (!this.left && !this.right) {\n      this.style.left = \"50%\"\n      translate.x = \"-50%\"\n    }\n    if (!this.top && !this.bottom) {\n      this.style.bottom = \"50%\"\n      translate.y = \"50%\"\n    }\n    this.style.transform = `translate(${translate.x}, ${translate.y})`\n  }\n\n  async open () {\n    Modal.clickWall.enable()\n\n    this.hidden = false\n    this.setPosition()\n\n    await Modal.shadow.enable()\n    Modal.shadow.onclick = () => this.close()\n\n    Modal.clickWall.disable()\n    this.trigger(\"open\")\n  }\n\n  async close () {\n    Modal.clickWall.enable()\n\n    this.hidden = true\n    await Modal.shadow.disable()\n\n    Modal.clickWall.disable()\n    this.trigger(\"close\")\n  }\n}\n\n/**\n * Configuration\n */\n\nModal.styleParams = [\n  \"height\",\n  \"width\",\n  \"top\",\n  \"right\",\n  \"bottom\",\n  \"left\",\n  \"padding\"\n]\n\nModal.style = {\n  zIndex: 1000,\n  position: \"fixed\",\n}\n\nModal.shadow = new ClickWall({\n  scrollbar: \"hide\",\n  opacity: 0.3,\n  delay: 300\n})\n\nModal.clickWall = new ClickWall()\nModal.clickWall.domNode.style.zIndex = \"2000\"\n\n/**\n * Export\n */\nmodule.exports = Modal\n","module.exports = \"<section><h2>License</h2>\\n  <section><h3>MIT License</h3>\\n\\n    <p>Copyright (c) 2019 Antoine Bodin &lt;<a\\n    href=\\\"mailto:mister.ticot@cosmic.plus\\\">mister.ticot@cosmic.plus</a>&gt;</p>\\n\\n    <p>Permission is hereby granted, free of charge, to any person obtaining a\\n    copy of this software and associated documentation files (the \\\"Software\\\"),\\n    to deal in the Software without restriction, including without limitation\\n    the rights to use, copy, modify, merge, publish, distribute, sublicense,\\n    and/or sell copies of the Software, and to permit persons to whom the\\n    Software is furnished to do so, subject to the following conditions:</p>\\n\\n    <p>The above copyright notice and this permission notice shall be included\\n    in all copies or substantial portions of the Software.</p>\\n\\n    <p>THE SOFTWARE IS PROVIDED \\\"AS IS\\\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\\n    OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\\n    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\\n    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\\n    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\\n    FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS\\n    IN THE SOFTWARE.</p>\\n  </section>\\n</section>\\n\"","module.exports = \"<section><h2>February, 16th − Beta 1 Release</h2>\\n  <section><h3>Welcome!</h3>\\n\\n    <p>Equilibre.io is a portfolio balancer that runs on the Stellar\\n    Decentralized Exchange. It is a convenient trading tool to manage long-term\\n    positions.</p>\\n\\n    <p>Regularly balancing an investment portfolio is known to boost its\\n    performances, providing you choose wisely the assets to bet on. Equilibre.io\\n    also lets you spread your positions over several anchors, for better fund\\n    safety.</p>\\n\\n    <p>Equilibre.io is still under testing & development. If you use it now,\\n    I'll ask you to consider yourself as a tester. Please report any bug you\\n    could encounter, and double-check transactions before signing them.</p>\\n\\n    <p>Your feedback matters to me and will be listened to.</p>\\n\\n    <p>Respectfully, <br>MisterTicot</p>\\n\\n  </section>\\n\\n  <section><h3>To Be Implemented</h3>\\n    <ul>\\n      <li>Portfolio historic value</li>\\n      <li>Customizable rebalancing periodicity</li>\\n      <li>Pie graph for rebalancing tab</li>\\n    </ul>\\n  </section>\\n\\n  <section><h3>Known Limitations</h3>\\n    <ul>\\n\\n      <li>It is required to \\\"Cancel All\\\" offers between applying a new balance\\n      setup</li>\\n\\n    </ul>\\n  </section>\\n</section>\\n\"","\"use strict\"\n/**\n * Footer\n */\nconst Gui = require(\"@cosmic-plus/domutils/es5/gui\")\nconst html = require(\"@cosmic-plus/domutils/es5/html\")\nconst { __ } = require(\"@cosmic-plus/i18n\")\n\nconst donate = require(\"./helpers/donate\")\nconst Icon = require(\"./helpers/icon\")\n\nconst global = require(\"./logic/global\")\n\n/**\n * Class\n */\n\nclass Footer extends Gui {\n  constructor (icons, links) {\n    super(\n      `\n<footer id=\"footer\" class=\"scrollable\">\n  <div class=\"nobreak\">%icons...</div>\n  %links\n</footer>\n    `,\n      { icons, links }\n    )\n  }\n}\n\n/**\n * Icons\n *\n * SVG from @fortawesome/font-awesome-free\n * CC BY 4.0 License (https://creativecommons.org/licenses/by/4.0/)\n */\n\nconst icons = [\n  new Icon(\n    require(\"@fortawesome/fontawesome-free/svgs/brands/keybase.svg\"),\n    \"Keybase\",\n    \"https://keybase.io/team/cosmic_plus\"\n  ),\n  new Icon(\n    require(\"@fortawesome/fontawesome-free/svgs/brands/telegram-plane.svg\"),\n    \"Telegram\",\n    \"https://t.me/cosmic_plus\"\n  ),\n  new Icon(\n    require(\"@fortawesome/fontawesome-free/svgs/brands/reddit.svg\"),\n    \"Reddit\",\n    \"https://reddit.com/r/cosmic_plus\"\n  ),\n  new Icon(\n    require(\"@fortawesome/fontawesome-free/svgs/brands/twitter.svg\"),\n    \"Twitter\",\n    \"https://twitter.com/cosmic_plus\"\n  ),\n  new Icon(\n    require(\"@fortawesome/fontawesome-free/svgs/brands/medium.svg\"),\n    \"Medium\",\n    \"https://medium.com/cosmic-plus\"\n  ),\n  new Icon(\n    require(\"@fortawesome/fontawesome-free/svgs/brands/github.svg\"),\n    \"GitHub\",\n    \"https://github.com/cosmic-plus/webapp-equilibre-io\"\n  ),\n  new Icon(\n    require(\"@fortawesome/fontawesome-free/svgs/solid/globe.svg\"),\n    __(\"Website\"),\n    \"https://cosmic.plus\"\n  ),\n  new Icon(\n    require(\"@fortawesome/fontawesome-free/svgs/solid/envelope.svg\"),\n    __(\"Email\"),\n    \"mailto:mister.ticot@cosmic.plus\"\n  ),\n  new Icon(require(\"../bundled/donate.svg\"), \"Donate\", donate)\n]\n\n/**\n * Demo Page\n */\nconst MYPUBKEY = \"GAWO2C52D57XBT7SQL6YB3XPHFLFD2J4Z5RN7HPFZSHXJMXH72HRXNV3\"\nfunction displayDemo () {\n  localStorage[`target:${MYPUBKEY}`] = demoConfig\n  location.href = `?address=${MYPUBKEY}`\n}\n\nconst demoConfig = `{\"childs\":[{\"mode\":\"percentage\",\"size\":12.5,\"asset\":\"BTC\"},\"CNY\",{\"mode\":\"percentage\",\"size\":12.5,\"asset\":\"ETH\"},\"EUR\",{\"mode\":\"percentage\",\"size\":2.5,\"asset\":\"MOBI\"},{\"mode\":\"percentage\",\"size\":2.5,\"asset\":\"REPO\"},{\"mode\":\"percentage\",\"size\":2.5,\"asset\":\"RMT\"},{\"mode\":\"percentage\",\"size\":2.5,\"asset\":\"SLT\"},{\"mode\":\"percentage\",\"size\":2.5,\"asset\":\"TERN\"},\"USD\",{\"mode\":\"percentage\",\"size\":12.5,\"asset\":\"XLM\"}]}`\n\n/**\n * Links\n */\nconst links = new Gui(\n  `\n<p>\n  <a target=\"_blank\" rel=\"noopener\" href=\"https://cosmic.plus\">\n    ${__(\"By Cosmic.Plus\")}\n  </a>\n  − <a onclick=%displayDemo>${__(\"Demo\")}</a>\n  − <a onclick=%displayLicense>${__(\"License\")}</a>\n  − <a onclick=%displayAbout>${__(\"About\")}</a>\n</p>\n`,\n  {\n    displayDemo,\n    displayLicense: () => global.tabs.select(\"#license\"),\n    displayAbout: () => global.tabs.select(\"#about\")\n  }\n)\n\n/**\n * Create footer\n */\n\nconst footer = new Footer(icons, links)\nhtml.append(document.body, footer)\n","\"use strict\"\n/**\n * Donate Interface\n */\nconst { CosmicLink } = require(\"cosmic-lib\")\nconst { __ } = require(\"@cosmic-plus/i18n\")\n\nconst SideFrame = require(\"./side-frame\")\n\nconst MYPUBKEY = \"GAWO2C52D57XBT7SQL6YB3XPHFLFD2J4Z5RN7HPFZSHXJMXH72HRXNV3\"\n\nmodule.exports = function promptDonation () {\n  const amount = prompt(`\\\n${__(\"Equilibre.io runs on donation.\")} \\\n${__(\"Each contribution matters to me.\")} \\\n${__(\"Thank you!\")}\n\n${__(\"Enter an amount (in Lumens)\")}:\\\n`)\n\n  if (amount === \"0\" || isNaN(+amount)) {\n    confirm(`${__(\"Not a valid amount\")}: ${amount}`)\n  } else if (amount) {\n    showDonateFrame(amount)\n  }\n}\n\nfunction showDonateFrame (amount) {\n  const memo = __(\"Donation to Equilibre.io\")\n  const network = \"public\"\n  const cosmicLink = new CosmicLink({ memo, network }).addOperation(\"payment\", {\n    amount,\n    destination: MYPUBKEY\n  })\n\n  new SideFrame(cosmicLink.uri)\n}\n","\"use strict\"\n/**\n * Footer Icons\n */\nconst Gui = require(\"@cosmic-plus/domutils/es5/gui\")\n\nclass Icon extends Gui {\n  constructor (image, name, action) {\n    super(`<a -ref=%link class=\"Icon\">%image</a>`)\n\n    this.image = typeof image === \"string\" ? new Gui(image) : image\n    this.link.title = name\n\n    if (typeof action === \"function\") {\n      this.link.onclick = action\n    } else if (typeof action === \"string\") {\n      this.link.href = action\n      if (action.match(/^http/)) {\n        this.link.target = \"_blank\"\n        this.link.rel = \"noopener\"\n      }\n    }\n  }\n}\n\nmodule.exports = Icon\n","module.exports = \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" viewBox=\\\"0 0 512 512\\\"><path fill=\\\"none\\\" d=\\\"M0 0h512v512H0z\\\"/><path d=\\\"M211.719 367.797C219.469 379.281 224 393.109 224 408c0 39.734-32.266 72-72 72-39.758 0-72-32.266-72-72 0-23.172 11.148-43.563 28.164-56.734 1.852 5.594 4.336 11.125 8.289 15.906 7.055 8.516 20.336 18.266 43.531 16.344 7.578-.641 15.844-2.547 24.586-5.641 8.875-3.078 18.508-6.5 27.149-10.078zM389.875 32.578c-13.344 3.797-24.156 10.672-38.813 18.328-90 47-196.25 39.25-220 77-27.469 51.672-48.883 89.203-48.945 107.625-.016.063-.055.094-.07.141.586 19.953 19.625 58.438 29.07 75.969 6.789-15.516 17.492-29.219 32.25-40.688 7.414-5.766 13.289-9.922 18.617-13.5-3.016-9.25-6.945-20.016-10.875-28.203 10.742-7.391 26.078-26.484 31.398-40.313 13.227.094 30.25-3.172 44.773-6.938 6.406 6.844 12.977 13.563 21.766 20.016-3.961 14.344-7.07 27.063-23.438 38.359-22.313 15.438-42.734 21.578-69.484 43.109-16.086 12.953-26.07 28.203-30.625 45.641-3.148 12.094 4.734 53.016 58 33.141 10.023-3.75 23.398-8.531 34.875-14.25 23.797-11.813 52.922-40.781 61-44.828 15.234-7.641 49.813-10.656 86.313-35.016 12.531-8.375 22.063-20.688 26.477-33.625 33.242-64.828 60.883-59.656 68.633-72.563C477.734 133.734 423.563 23 389.875 32.578z\\\"/></svg>\\n\""],"sourceRoot":""}
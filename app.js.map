{"version":3,"sources":["webpack:///./src/logic/strategy.js","webpack:///./src/target-gui.js","webpack:///./src/html/license.html","webpack:///./src/html/welcome.html","webpack:///./src/footer.js","webpack:///./src/helpers/donate.js","webpack:///./src/helpers/icon.js","webpack:///./src/svg/donate.svg","webpack:///./src/app.js","webpack:///./src/logic/asset.js","webpack:///./src/helpers/side-frame.js","webpack:///./src/logic/market-data.js","webpack:///./src/logic/orderbook.js","webpack:///./src/logic/balance.js","webpack:///./src/helpers/form.js","webpack:///./src/helpers/html-extra.js","webpack:///./src/logic/order.js","webpack:///./src/logic/portfolio.js","webpack:///./src/logic/anchor.js","webpack:///./src/logic/offers.js","webpack:///./src/helpers/click-wall.js","webpack:///./src/helpers/bind-dom-key.js","webpack:///./src/helpers/handle-extra-attributes.js","webpack:///./src/helpers/misc.js","webpack:///./src/activity-gui.js","webpack:///./src/portfolio-gui.js","webpack:///./src/highcharts-theme.js","webpack:///./src/asset-gui.js","webpack:///./src/settings-gui.js","webpack:///./src/rebalance-gui.js","webpack:///./src/logic/target.js"],"names":["strategy","exports","nice","require","__","global","apply","target","delayed","sum","weights","childs","forEach","child","mode","push","size","value","remains","Math","max","weight","allocated","available","checkUnderFlag","over","overP","msg","concat","currency","Error","under","underP","checkAllocationLimits","length","amount","asset","price","compute","ignore","percentage","parent","Gui","i18n","html","TargetGui","_this","_classCallCheck","this","_possibleConstructorReturn","_getPrototypeOf","call","name","code","define","toCommand","watch","project","_assertThisInitialized","order","toPercent","share","x","obj","create","Setup","_Gui2","TargetSetup","_this2","targetIsXlm","id","Number","_inherits","_createClass","key","computeAll","maybeSwitchMode","trigger","destroy","module","donate","Icon","Footer","icons","links","MYPUBKEY","demoConfig","footer","displayDemo","localStorage","location","href","displayLicense","tabs","select","displayAbout","append","document","body","CosmicLink","SideFrame","prompt","isNaN","confirm","memo","cosmicLink","network","addOperation","destination","uri","showDonateFrame","image","action","link","title","onclick","match","rel","dom","Tabs","params","Portfolio","clickWall","Form","isOverflowing","ActivityGui","PortfolioGui","SettingsGui","RebalanceGui","license","welcome","nav","header","view","main","add","loginForm","hash","selected","fitScreen","replace","domNode","selector","ledger","hidden","onsubmit","login","_callee","_regeneratorRuntime","wrap","_context","prev","next","Promise","all","__webpack_require__","e","then","t","bind","sent","info","connect","publicKey","t0","error","stop","_callee2","address","_context2","disconnect","$set","enable","resolve","portfolio","setTimeout","listen","initGui","disable","remove","loginWithLedger","page","window","scrollTo","AUTO_REFRESH_PRICES","FIAT_BASEURL","FIAT_IMAGEFORMAT","Mirrorable","Projectable","marketData","Orderbook","Asset","_Projectable","table","Object","assign","type","fiats","toLowerCase","cryptos","anchors","balances","offers","autoUpdatePrice","mirror","balance","anchor","orderbook","forAsset","globalPrice","_getInfo","_asyncToGenerator","mark","abrupt","crypto","small","arguments","addChild","reduce","el","rawLiabilities","entry","buying","selling","refreshPrices","_ref","array","refreshCryptoPrices","refreshFiatPrices","filter","map","_x","_callee3","assets","prices","_args3","_context3","undefined","_callee4","_args4","_context4","fiat","USD","EUR","CNY","BTC","apiId","ETH","XRP","XLM","KIN","BAT","ZRX","BCH","STEEM","SBD","LINK","SLT","MOBI","SHX","RMT","TERN","PEDI","GRAT","REPO","setInterval","console","log","Observable","timeout","url","current","close","className","src","sandbox","style","show","htmlOverflow","documentElement","overflow","bodyOverflow","shadow","animationName","background","_this3","hide","_this4","addEventListener","event","frameWindow","contentWindow","source","data","position","zIndex","right","top","width","maxWidth","height","border","backgroundImage","backgroundRepeat","backgroundPosition","backgroundSize","padding","color","fontSize","fontWeight","cursor","borderBottomLeftRadius","insertBefore","firstChild","transition","axios","day","coingeckoCall","get","exchangeratesCall","_callee8","symbols","_args8","_context8","base","join","response","start_at","rates","cacheHistory","JSON","stringify","cachedHistory","json","parse","assetHistory","limit","history","list","symbol","toUpperCase","stellarNative","tickers","coin_id","_ref3","localization","market_data","community_data","developer_data","sparkline","_ref4","ids","quote","vs_currencies","assetData","_x2","_ref5","_callee5","_args5","_context5","vs_currency","days","record","index","time","volume","total_volumes","_x3","_ref6","_callee6","_context6","_x6","_ref7","_callee7","cached","end_at","today","_args7","_context7","Date","toISOString","slice","setDate","getDate","keys","sort","date","getTime","_x7","cosmicLib","StellarSdk","offersCallBuilder","updateOffersPrices","streamOffers","addOrderbook","_streamOffers","getOffers","_getOffers","ingest","areOffersEquals","bids","normalizeOffers","asks","set","side","merged","sortOffers","a","b","baseVolume","quoteVolume","row","mergedRow","quoteAmount","mergeOffers","baseAsset","quoteAsset","server","array1","array2","basePrice","bestBid","bestAsk","marketPrice","spread","prototype","findOffer","last","childsNum","offer","findAsk","findBid","depth","Anchor","Balance","entryId","asset_code","asset_issuer","known","buying_liabilities","selling_liabilities","forBalance","issuer","hiddenKey","setHiddenProperty","bindDomKey","handleExtraAttributes","_len","Array","_key","tagName","element","getAttribute","preventDefault","bindInputs","status","submit","reset","$status","_len2","content","_key2","rewrite","report","spinner","message","binder","$node","object","walk","attributes","disabled","enabled","alias","label","_len3","_key3","button","_len4","_key4","_toConsumableArray","control","tag","required","textarea","values","placeholder","unshift","selectedIndex","input","datetime","constructor","shift","func","childNodes","i","Order","method","operations","parameters","refresh","splice","make","operation","find","newOperation","getOperation","setOperation","cost","operationDirection","op","filterTradableBalances","amountTraded","amountTradable","addBalancingOperation","noMinValue","skipMarginalOffers","minOfferValue","makeOfferFilter","abs","clamp","min","operationsToCosmicLink","operationsToDescription","maxTime","accountId","odesc","price_r","n","d","toFixed","offerId","operationToOdesc","desc","market","spreadTightening","clone","diff","maxSpread","refPrice","clampOfferPrice","updateOfferPriceR","tightenSpread","amountDelta","liabilities","outdated","description","deviation","balanceTargetDeviation","amountTarget","amountMin","amountMax","amountDiff","setBalancesLimits","isOneOperationEnough","tradableBalances","tradableAmounts","tradableTotal","tradeAmounts","addSplitTrade","_construct","_loop","Offers","checkNetwork","horizon","accountCallBuilder","isSupported","_resolve","isAccountEmpty","account_id","config","streamAccount","_streamAccount","getAccount","_getAccount","account","_ingest","indexOf","getInfo","forPortfolio","stream","accounts","total","aliases","helpers","shorter","USD:GDUKMGUGDZQK6YHYA5Z6AY2G4XDSZPSZ3SW5UN3ARVMO6QSRDWP5YLEX","WSD:GDSVWEA7XV6M5XNLODVTPCGMAJTNBLZBXOFNQD3BNPNYALEYBNT6CE2V","USD:GDSRCV5VTM3U7Y3L6DFRP3PEGBNQMGOWSRTGSBWX6Z3H6C7JHRI4XFJP","USD:GBUYUAI75XXWDZEKLY66CFYKQPET5JR4EENXZBUZ3YXZ7DS56Z4OKOFU","CNY:GAREELUB43IRHWEASCFBLKHURCGMHE5IF6XSE7EXDLACYHGRHM43RFOX","XCN:GCNY5OXYSY4FKHOPT2SPOQZAOEIGXB5LBYW3HVU3OWSTQITS65M5RCNY","BCNY:GBCNYBHAAPDSU3UIHXXQTHYZVSBJBI4YUNWXMKJBCPDHTVYR75G6NFHD","EURT:GAP5LETOV6YIE62YAM56STDANPRDO7ZFDBGSNHJQIYGGKSMOZAHOOS2S","SLT:GCKA6K5PCQ6PNF5RQBF7PQDJWRHO6UOGFMRLK3DYHDOI244V47XKQ4GP","MOBI:GA6HCMBLTZS5VYYBCATRBRZ3BZJMAFUDKYYF6AH6MVCMGWMRDNSWJPIH","SHX:GDSTRSHXHGJ7ZIVRBXEYE5Q74XUVCUSEKEBR7UCHEUUEK72N7I7KJ6JH","RMT:GDEGOXPCHXWFYY234D2YZSPEJ24BX42ESJNVHY5H7TWWQSYRN5ZKZE3N","TERN:GDGQDVO6XPFSY4NMX75A7AOVYCF5JYGW2SHCJJNWCQWIDGOZB53DGP6C","PEDI:GBVUDZLMHTLMZANLZB6P4S4RYF52MVWTYVYXTQ2EJBPBX4DZI2SDOLLY","GRAT:GAJ7V3EMD3FRWAPBEJAP7EC4223XI5EACDZ46RFMY5DYOMCIMWEFR5II","REPO:GCZNF24HPMYTV6NOEHI7Q5RJFFUI23JKUKY3H3XTQAFBQIBOHD5OXG3B","BTC:GATEMHCCKCY67ZUCKTROYN24ZYT5GK4EQZ65JJLDHKHRUZI3EUEKMTCH","BTC:GAUTUYY2THLF7SGITDFMXJVYH3LHDSMGEAKSBU267M2K7A3W543CKUEF","BTC:GCNSGHUCG5VMGLT5RIYYZSO7VQULQKAJ62QA33DBC5PPBSO57LFWVV6P","BTC:GBVOL67TMUQBGL4TZYNMY3ZQ5WGQYFPFD5VJRWXR72VA33VFNL225PL5","ETH:GCNSGHUCG5VMGLT5RIYYZSO7VQULQKAJ62QA33DBC5PPBSO57LFWVV6P","ETH:GBVOL67TMUQBGL4TZYNMY3ZQ5WGQYFPFD5VJRWXR72VA33VFNL225PL5","ETH:GBETHKBL5TCUTQ3JPDIYOZ5RDARTMHMEKIO2QZQ7IOZ4YC5XV3C2IKYU","ETH:GBDEVU63Y6NTHJQQZIKVTC23NWLQVP3WJ2RI2OTSJTNYOIGICST6DUXR","LTC:GC5LOR3BK6KIOK7GKAUD5EGHQCMFOGHJTC7I3ELB66PTDFXORC2VM5LP","LTC:GBVOL67TMUQBGL4TZYNMY3ZQ5WGQYFPFD5VJRWXR72VA33VFNL225PL5","LTC:GCNSGHUCG5VMGLT5RIYYZSO7VQULQKAJ62QA33DBC5PPBSO57LFWVV6P","XRP:GBVOL67TMUQBGL4TZYNMY3ZQ5WGQYFPFD5VJRWXR72VA33VFNL225PL5","XRP:GCNSGHUCG5VMGLT5RIYYZSO7VQULQKAJ62QA33DBC5PPBSO57LFWVV6P","KIN:GBDEVU63Y6NTHJQQZIKVTC23NWLQVP3WJ2RI2OTSJTNYOIGICST6DUXR","BAT:GBDEVU63Y6NTHJQQZIKVTC23NWLQVP3WJ2RI2OTSJTNYOIGICST6DUXR","ZRX:GBDEVU63Y6NTHJQQZIKVTC23NWLQVP3WJ2RI2OTSJTNYOIGICST6DUXR","BCH:GAEGOS7I6TYZSVHPSN76RSPIVL3SELATXZWLFO4DIAFYJF7MPAHFE7H4","STEEM:GB3KBOFUCVTWEZ7YIZ7PAKLQMKPCTGWU3LOMANMCT7V6I3AAK4USTEEM","SBD:GB3KBOFUCVTWEZ7YIZ7PAKLQMKPCTGWU3LOMANMCT7V6I3AAK4USTEEM","LINK:GBDEVU63Y6NTHJQQZIKVTC23NWLQVP3WJ2RI2OTSJTNYOIGICST6DUXR","loopcall","delay","callBuilder","records","alive","Offer","clean","forAccount","intern","recordToId","rawPrice","update","rawAmount","last_modified_time","last_modified_ledger","overlay","objKey","$input","nodeKey","importKeyOn","eventName","setCustomValidity","init","SELECT","$select","interactive","TEXTAREA","$textarea","INPUT","radio","checkbox","$radio","setter","checked","checkBox","$checkbox","setAliases","$label","for","$span","handleLabel","validate","hasProperty","reportValidity","validateNodeValue","handleValidate","scrollHeight","clientHeight","scrollWidth","clientWidth","ActivityOffers","globalCurrency","txParams","_Gui3","ActivityOffer","number","toLocaleDateString","Highcharts","Highstock","AssetGui","summary","Summary","coingecko","chart","Chart","makeAssetPoint","y","PortfolioSummary","Table","Graph","PortfolioTable","assetsGui","assetGui","simpleView","detailledView","_Gui4","PortfolioGraph","makePie","_this5","container","legend","tooltip","pointFormat","plotOptions","pie","dataLabels","format","point","events","options","legendItemClick","series","colorByPoint","ignoreHiddenPoint","_Gui5","PortfolioChart","_this6","makeChart","stockChart","rangeSelector","backgroundColor","yAxis","labels","align","resize","offset","credits","theme","allowPointSelect","animation","responsive","rules","condition","chartOptions","showInLegend","distance","colors","setOptions","cell","amounts","node","trap","priceDetails","feed","anchorName","simple","anchorTotal","anchorHeader","languages","us","fr","currencies","general","GeneralSettings","reload","Target","targetKey","template","setup","hideRebalance","hideApply","modified","toJson","listOperations","remaining","pop","RebalanceTable","targets","toTargetGui","sortTargets","targetGui","localeCompare","rebalance","root","group","valueDiff","hasChanged","sortChilds","fromJson","isValid","findIndex","fromObject","beautifyFlag","toObject","_target$childs","percentChilds"],"mappings":"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","file":"app.js","sourcesContent":["\"use_strict\"\n/**\n * Rebalancing strategies\n */\nconst strategy = exports\n\nconst nice = require(\"@cosmic-plus/jsutils/es5/nice\")\nconst { __ } = require(\"@cosmic-plus/i18n\")\n\nconst global = require(\"./global\")\n\n/**\n * Applicator\n */\n\nstrategy.apply = function (target) {\n  const delayed = []\n  let sum = 0,\n    weights = 0\n\n  target.childs.forEach(child => {\n    const mode = child.mode\n    if (mode === \"weight\") {\n      delayed.push(child)\n      weights += child.size\n    } else {\n      strategy[mode](child)\n      sum += child.value\n    }\n  })\n\n  const remains = Math.max(0, target.value - sum)\n  delayed.forEach(child => strategy.weight(child, remains, weights))\n\n  checkAllocationLimits(sum, target.value, delayed.length)\n}\n\nfunction checkAllocationLimits (allocated, available, checkUnderFlag) {\n  if (allocated > available) {\n    const over = +nice(allocated - available, 2)\n    const overP = +nice(100 * over / available, 2)\n    let msg = __(\"Rebalance setup is over portfolio value by\")\n    msg += ` ${over} ${global.currency} (${overP}%) `\n    throw new Error(msg)\n  } else if (!checkUnderFlag && allocated < available) {\n    const under = +nice(available - allocated, 2)\n    const underP = +nice(100 * under / available, 2)\n    let msg = __(\"Rebalance setup is under portfolio value by\")\n    msg += ` ${under} ${global.currency} (${underP}%) `\n    throw new Error(msg)\n  }\n}\n\n/**\n * Strategies\n */\n\nstrategy.amount = function (target) {\n  target.amount = target.size\n  target.value = target.amount * target.asset.price\n  target.compute(\"share\")\n}\n\nstrategy.ignore = function (target) {\n  target.value = target.asset.value\n  target.amount = target.asset.amount\n  target.compute(\"share\")\n}\n\nstrategy.percentage = function (target) {\n  strategy.weight(target, target.parent.value, 100)\n}\n\nstrategy.weight = function (target, remains, weights) {\n  if (!weights) {\n    target.value = target.amount = 0\n  } else {\n    target.value = target.size * remains / weights\n    target.amount = +nice(target.value / target.asset.price, 7)\n  }\n  target.compute(\"share\")\n}\n","\"use_strict\"\n/**\n * Target Graphical User Interface\n */\nconst Gui = require(\"@cosmic-plus/domutils/es5/gui\")\nconst i18n = require(\"@cosmic-plus/i18n\")\nconst html = require(\"@cosmic-plus/domutils/es5/html\")\nconst nice = require(\"@cosmic-plus/jsutils/es5/nice\")\nconst { __ } = i18n\n\n/**\n * Class\n */\n\nclass TargetGui extends Gui {\n  constructor (target) {\n    super(`\n<tr class=\"TargetGui\">\n  <td align=\"left\">\n    <img src=%image alt=\"\">\n    <span>%name</span>\n  </td>\n  <td align=\"right\">%command</td>\n  <td align=\"right\">%toPercent:shareDiff</td>\n  <td align=\"right\">%toDiv:description...</td>\n</tr>\n    `)\n\n    this.target = target\n    this.name = target.asset.code\n\n    this.define(\"command\", null, () => this.toCommand(target))\n    this.watch(target, [\"size\", \"mode\", \"share\"], () => this.compute(\"command\"))\n\n    target.asset.project(\"image\", this)\n    target.project(\"shareDiff\", this)\n\n    if (target.order) target.order.project(\"description\", this)\n  }\n\n  toCommand (target) {\n    switch (target.mode) {\n    case \"ignore\":\n      return __(\"Ignore\")\n    case \"amount\":\n      return `${target.amount} ${target.asset.code}`\n    case \"weight\":\n      return `${target.size}  ${this.toPercent(target.share)}`\n    case \"percentage\":\n      return this.toPercent(target.share)\n    }\n  }\n\n  toPercent (x) {\n    return !x ? \"-\" : nice(x * 100, 2) + \"%\"\n  }\n\n  toDiv (obj) {\n    return html.create(\"div\", null, obj)\n  }\n}\n\nTargetGui.Setup = class TargetSetup extends Gui {\n  constructor (target) {\n    super(`\n<section>\n  <form onsubmit=\"return false\">\n\n    <h3>%name</h3>\n    <hr>\n\n    <label><span>${__(\"Size\")}:</span>\n\n      <input class=\"half\" type=\"number\" step=\"any\" min=\"0\" %max\n        value=%size placeholder=%share onchange=%maybeSwitchMode>\n\n      <select class=\"half\" onchange=%setMode value=%mode>\n        <option value=\"weight\">${__(\"Weight\")}</option>\n        <option value=\"percentage\">${__(\"Percentage\")}</option>\n        <option value=\"amount\">${__(\"Amount\")}</option>\n        <option value=\"ignore\" hidden=%targetIsXlm>${__(\"Ignore\")}</option>\n      </select>\n\n    </label>\n\n    <hr>\n    <input type=\"submit\" onclick=%close value=\"${__(\"Close\")}\">\n\n  </form>\n</section>\n    `)\n\n    this.target = target\n    this.name = target.asset.name\n    this.targetIsXlm = target.asset.id === \"XLM\"\n\n    target.project(\"share\", this, x => nice(100 * x, 2))\n\n    target.project(\"size\", this)\n    this.project(\"size\", target, x => x != null ? Number(x) : null)\n\n    target.project(\"mode\", this)\n    this.project(\"mode\", target)\n  }\n\n  maybeSwitchMode () {\n    if (this.size === 0) {\n      this.mode = \"amount\"\n    } else if (!this.size) {\n      this.mode = \"ignore\"\n    } else if (this.mode === \"ignore\") {\n      this.mode = \"percentage\"\n      this.target.computeAll()\n    }\n  }\n\n  setMode () {\n    // TODO: Move this logic to Target model.\n    switch (this.mode) {\n    case \"weight\":\n      this.size = 1\n      this.max = null\n      break\n    case \"percentage\":\n      this.size = +nice(100 * this.target.asset.share, 2)\n      this.max = 100\n      break\n    case \"amount\":\n      this.size = this.target.asset.amount\n      this.max = null\n      break\n    case \"ignore\":\n      this.size = null\n      break\n    }\n  }\n\n  close () {\n    this.maybeSwitchMode()\n    this.trigger(\"close\")\n    this.destroy()\n  }\n}\n\n/**\n * Export\n */\n\nmodule.exports = TargetGui\n","module.exports = \"<section><h2>License</h2>\\n  <section><h3>MIT License</h3>\\n\\n    <p>Copyright (c) 2019 Antoine Bodin &lt;<a\\n    href=\\\"mailto:mister.ticot@cosmic.plus\\\">mister.ticot@cosmic.plus</a>&gt;</p>\\n\\n    <p>Permission is hereby granted, free of charge, to any person obtaining a\\n    copy of this software and associated documentation files (the \\\"Software\\\"),\\n    to deal in the Software without restriction, including without limitation\\n    the rights to use, copy, modify, merge, publish, distribute, sublicense,\\n    and/or sell copies of the Software, and to permit persons to whom the\\n    Software is furnished to do so, subject to the following conditions:</p>\\n\\n    <p>The above copyright notice and this permission notice shall be included\\n    in all copies or substantial portions of the Software.</p>\\n\\n    <p>THE SOFTWARE IS PROVIDED \\\"AS IS\\\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\\n    OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\\n    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\\n    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\\n    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\\n    FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS\\n    IN THE SOFTWARE.</p>\\n  </section>\\n</section>\\n\"","module.exports = \"<section><h2>February, 16th  Beta 1 Release</h2>\\n  <section><h3>Welcome!</h3>\\n\\n    <p>Equilibre.io is a portfolio balancer that runs on the Stellar\\n    Decentralized Exchange. It is a convenient trading tool to manage long-term\\n    positions.</p>\\n\\n    <p>Regularly balancing an investment portfolio is known to boost its\\n    performances, providing you choose wisely the assets to bet on. Equilibre.io\\n    also lets you spread your positions over several anchors, for better fund\\n    safety.</p>\\n\\n    <p>Equilibre.io is still under testing & development. If you use it now,\\n    I'll ask you to consider yourself as a tester. Please report any bug you\\n    could encounter, and double-check transactions before signing them.</p>\\n\\n    <p>Your feedback matters to me and will be listened to.</p>\\n\\n    <p>Respectfully, <br>MisterTicot</p>\\n\\n  </section>\\n\\n  <section><h3>To Be Implemented</h3>\\n    <ul>\\n      <li>Interface to add/remove assets</li>\\n      <li>Portfolio historic value</li>\\n      <li>Customizable rebalancing periodicity</li>\\n      <li>Pie graph for rebalancing tab</li>\\n    </ul>\\n  </section>\\n\\n  <section><h3>Known Limitations</h3>\\n    <ul>\\n\\n      <li>It is required to \\\"Cancel All\\\" offers between applying a new balance\\n      setup</li>\\n\\n    </ul>\\n  </section>\\n</section>\\n\"","\"use_strict\"\n/**\n * Footer\n */\nconst Gui = require(\"@cosmic-plus/domutils/es5/gui\")\nconst html = require(\"@cosmic-plus/domutils/es5/html\")\nconst { __ } = require(\"@cosmic-plus/i18n\")\n\nconst donate = require(\"./helpers/donate\")\nconst Icon = require(\"./helpers/icon\")\n\nconst global = require(\"./logic/global\")\n\n/**\n * Class\n */\n\nclass Footer extends Gui {\n  constructor (icons, links) {\n    super(\n      `\n<footer id=\"footer\" class=\"scrollable\">\n  <div class=\"nobreak\">%icons...</div>\n  %links\n</footer>\n    `,\n      { icons, links }\n    )\n  }\n}\n\n/**\n * Icons\n *\n * SVG from @fortawesome/font-awesome-free\n * CC BY 4.0 License (https://creativecommons.org/licenses/by/4.0/)\n */\n\nconst icons = [\n  new Icon(\n    require(\"@fortawesome/fontawesome-free/svgs/brands/keybase.svg\"),\n    \"Keybase\",\n    \"https://keybase.io/team/cosmic_plus\"\n  ),\n  new Icon(\n    require(\"@fortawesome/fontawesome-free/svgs/brands/telegram-plane.svg\"),\n    \"Telegram\",\n    \"https://t.me/cosmic_plus\"\n  ),\n  new Icon(\n    require(\"@fortawesome/fontawesome-free/svgs/brands/reddit.svg\"),\n    \"Reddit\",\n    \"https://reddit.com/r/cosmic_plus\"\n  ),\n  new Icon(\n    require(\"@fortawesome/fontawesome-free/svgs/brands/twitter.svg\"),\n    \"Twitter\",\n    \"https://twitter.com/cosmic_plus\"\n  ),\n  new Icon(\n    require(\"@fortawesome/fontawesome-free/svgs/brands/medium.svg\"),\n    \"Medium\",\n    \"https://medium.com/cosmic-plus\"\n  ),\n  new Icon(\n    require(\"@fortawesome/fontawesome-free/svgs/brands/github.svg\"),\n    \"GitHub\",\n    \"https://github.com/cosmic-plus/webapp-equilibre-io\"\n  ),\n  new Icon(\n    require(\"@fortawesome/fontawesome-free/svgs/solid/globe.svg\"),\n    __(\"Website\"),\n    \"https://cosmic.plus\"\n  ),\n  new Icon(\n    require(\"@fortawesome/fontawesome-free/svgs/solid/envelope.svg\"),\n    __(\"Email\"),\n    \"mailto:mister.ticot@cosmic.plus\"\n  ),\n  new Icon(require(\"./svg/donate.svg\"), \"Donate\", donate)\n]\n\n/**\n * Demo Page\n */\nconst MYPUBKEY = \"GAWO2C52D57XBT7SQL6YB3XPHFLFD2J4Z5RN7HPFZSHXJMXH72HRXNV3\"\nfunction displayDemo () {\n  localStorage[`target:${MYPUBKEY}`] = demoConfig\n  location.href = `?address=${MYPUBKEY}`\n}\n\nconst demoConfig = `{\"childs\":[\"EUR\",\"CNY\",\"USD\",{\"size\":12.5,\"mode\":\"percentage\",\"asset\":\"XLM\"},{\"size\":12.5,\"mode\":\"percentage\",\"asset\":\"ETH\"},{\"size\":12.5,\"mode\":\"percentage\",\"asset\":\"BTC\"},{\"size\":4,\"mode\":\"percentage\",\"asset\":\"SLT\"},{\"size\":4,\"mode\":\"percentage\",\"asset\":\"REPO\"},{\"size\":2.25,\"mode\":\"percentage\",\"asset\":\"PEDI\"},{\"size\":2.25,\"mode\":\"percentage\",\"asset\":\"TERN\"}]}`\n\n/**\n * Links\n */\nconst links = new Gui(\n  `\n<p>\n  <a target=\"_blank\" rel=\"noopener\" href=\"https://cosmic.plus\">${__(\n    \"A Cosmic.Plus Software\"\n  )}</a>\n   <a onclick=%displayDemo>${__(\"Demo\")}</a>\n   <a target=\"_blank\" rel=\"noopener\" href=\"https://nucleo.fi/leaderboard/top/?span=3m\">Performance</a>\n   <a onclick=%displayLicense>${__(\"License\")}</a>\n   <a onclick=%displayAbout>${__(\"About\")}</a>\n</p>\n`,\n  {\n    displayDemo,\n    displayLicense: () => global.tabs.select(\"#license\"),\n    displayAbout: () => global.tabs.select(\"#about\")\n  }\n)\n\n/**\n * Create footer\n */\n\nconst footer = new Footer(icons, links)\nhtml.append(document.body, footer)\n","\"use_strict\"\n/**\n * Donate Interface\n */\nconst { CosmicLink } = require(\"cosmic-lib\")\nconst { __ } = require(\"@cosmic-plus/i18n\")\n\nconst SideFrame = require(\"./side-frame\")\n\nconst MYPUBKEY = \"GAWO2C52D57XBT7SQL6YB3XPHFLFD2J4Z5RN7HPFZSHXJMXH72HRXNV3\"\n\nmodule.exports = function promptDonation () {\n  const amount = prompt(`\\\n${__(\"Equilibre.io runs on donation.\")}\\\n${__(\"Each contribution is a pleasant surprise for me. :)\")}\n\n${__(\"Enter an amount (in Lumens)\")}:\\\n`)\n\n  if (amount === \"0\" || isNaN(+amount)) {\n    confirm(`${__(\"Not a valid amount\")}: ${amount}`)\n  } else if (amount) {\n    showDonateFrame(amount)\n  }\n}\n\nfunction showDonateFrame (amount) {\n  const memo = __(\"Donation to Equilibre.io\")\n  const network = \"public\"\n  const cosmicLink = new CosmicLink({ memo, network }).addOperation(\"payment\", {\n    amount,\n    destination: MYPUBKEY\n  })\n\n  new SideFrame(cosmicLink.uri)\n}\n","\"use_strict\"\n/**\n * Footer Icons\n */\nconst Gui = require(\"@cosmic-plus/domutils/es5/gui\")\n\nclass Icon extends Gui {\n  constructor (image, name, action) {\n    super(`<a -ref=%link class=\"Icon\">%image</a>`)\n\n    this.image = typeof image === \"string\" ? new Gui(image) : image\n    this.link.title = name\n\n    if (typeof action === \"function\") {\n      this.link.onclick = action\n    } else if (typeof action === \"string\") {\n      this.link.href = action\n      if (action.match(/^http/)) {\n        this.link.target = \"_blank\"\n        this.link.rel = \"noopener\"\n      }\n    }\n  }\n}\n\nmodule.exports = Icon\n","module.exports = \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" viewBox=\\\"0 0 512 512\\\"><path fill=\\\"none\\\" d=\\\"M0 0h512v512H0z\\\"/><path d=\\\"M211.719 367.797C219.469 379.281 224 393.109 224 408c0 39.734-32.266 72-72 72-39.758 0-72-32.266-72-72 0-23.172 11.148-43.563 28.164-56.734 1.852 5.594 4.336 11.125 8.289 15.906 7.055 8.516 20.336 18.266 43.531 16.344 7.578-.641 15.844-2.547 24.586-5.641 8.875-3.078 18.508-6.5 27.149-10.078zM389.875 32.578c-13.344 3.797-24.156 10.672-38.813 18.328-90 47-196.25 39.25-220 77-27.469 51.672-48.883 89.203-48.945 107.625-.016.063-.055.094-.07.141.586 19.953 19.625 58.438 29.07 75.969 6.789-15.516 17.492-29.219 32.25-40.688 7.414-5.766 13.289-9.922 18.617-13.5-3.016-9.25-6.945-20.016-10.875-28.203 10.742-7.391 26.078-26.484 31.398-40.313 13.227.094 30.25-3.172 44.773-6.938 6.406 6.844 12.977 13.563 21.766 20.016-3.961 14.344-7.07 27.063-23.438 38.359-22.313 15.438-42.734 21.578-69.484 43.109-16.086 12.953-26.07 28.203-30.625 45.641-3.148 12.094 4.734 53.016 58 33.141 10.023-3.75 23.398-8.531 34.875-14.25 23.797-11.813 52.922-40.781 61-44.828 15.234-7.641 49.813-10.656 86.313-35.016 12.531-8.375 22.063-20.688 26.477-33.625 33.242-64.828 60.883-59.656 68.633-72.563C477.734 133.734 423.563 23 389.875 32.578z\\\"/></svg>\\n\"","\"use_strict\"\n/**\n * Login interface\n */\nconst dom = require(\"@cosmic-plus/domutils/es5/dom\")\nconst Gui = require(\"@cosmic-plus/domutils/es5/gui\")\nconst html = require(\"@cosmic-plus/domutils/es5/html\")\nconst Tabs = require(\"@cosmic-plus/domutils/es5/tabs\")\nconst params = require(\"@cosmic-plus/domutils/es5/params\")\nconst { __ } = require(\"@cosmic-plus/i18n\")\n\nconst global = require(\"./logic/global\")\nconst Portfolio = require(\"./logic/portfolio\")\n\nconst clickWall = require(\"./helpers/click-wall\")\nconst Form = require(\"./helpers/form\")\nconst { isOverflowing } = require(\"./helpers/misc\")\n\nconst ActivityGui = require(\"./activity-gui\")\nconst PortfolioGui = require(\"./portfolio-gui\")\nconst SettingsGui = require(\"./settings-gui\")\nconst RebalanceGui = require(\"./rebalance-gui\")\n\nconst license = new Gui(require(\"./html/license.html\"))\nconst welcome = new Gui(require(\"./html/welcome.html\"))\n\nrequire(\"./footer\")\n\n/**\n * Init\n */\nconst tabs = global.tabs = new Tabs({ nav: dom.header, view: dom.main })\ntabs.add(\"#welcome\", __(\"Welcome\"), welcome)\ntabs.add(\"#login\", __(\"Login\"), dom.loginForm)\ntabs.add(\"#license\", null, license)\ntabs.add(\"#about\", null, welcome)\n\ntabs.select(location.hash)\nif (!tabs.selected) tabs.select(\"#welcome\")\n\ntabs.fitScreen = function () {\n  if (isOverflowing(dom.header)) {\n    html.replace(tabs.nav.domNode, tabs.selector.domNode)\n  }\n}\ntabs.fitScreen()\n\nconst loginForm = new Form(dom.loginForm, { hidden: false, onsubmit: login })\nloginForm.dom.loginWithLedger.onclick = loginWithLedgerWallet\n\nif (params.address) {\n  tabs.select(\"#login\")\n  loginForm[\"stellar-public-key\"] = params.address\n  login()\n}\n\ntabs.listen(\"select\", page => {\n  location.hash = page\n  window.scrollTo(0, 0)\n})\n\n/**\n * Functions\n */\n\nlet ledger\nasync function loginWithLedgerWallet () {\n  loginForm[\"stellar-public-key\"] = null\n  ledger = await getLedgerModule()\n  loginForm.info(__(\"Please open the Stellar App in your Ledger Wallet\"))\n  try {\n    await ledger.connect()\n    loginForm[\"stellar-public-key\"] = ledger.publicKey\n    login()\n  } catch (error) {\n    loginForm.error(error)\n  }\n}\n\nasync function login () {\n  const address = loginForm[\"stellar-public-key\"]\n  if (!address) loginForm.error(__(\"Please enter an address.\"))\n  if (ledger) ledger.disconnect()\n\n  loginForm.info(__(\"Connecting to your account...\"))\n  params.$set({ address })\n  clickWall.enable()\n\n  try {\n    global.portfolio = await Portfolio.resolve(address)\n    loginForm.info(`${__(\"Fetching market data\")}...`)\n    setTimeout(\n      () => loginForm.info(`${__(\"Sorry, it takes a while (^.^)\\\"\")}...`),\n      10000\n    )\n    setTimeout(() => loginForm.info(`${__(\"Almost there\")}...`), 20000)\n    setTimeout(\n      () => loginForm.info(`${__(\"I'm running, I'm running\")}...`),\n      30000\n    )\n    global.portfolio.listen(\"open\", () => {\n      initGui()\n      clickWall.disable()\n    })\n  } catch (error) {\n    clickWall.disable()\n    loginForm.error(error)\n  }\n}\n\nfunction initGui () {\n  const portfolio = global.portfolio\n\n  const selected = location.hash\n  tabs.remove(\"#welcome\")\n  tabs.remove(\"#login\")\n  tabs.add(\"#portfolio\", __(\"Portfolio\"), new PortfolioGui(portfolio))\n  tabs.add(\"#rebalance\", __(\"Rebalance\"), new RebalanceGui(portfolio))\n  tabs.add(\"#activity\", __(\"Activity\"), new ActivityGui(portfolio))\n  tabs.add(\"#settings\", __(\"Settings\"), new SettingsGui())\n  tabs.add(\"#logout\", __(\"Logout\"), () => {\n    location.replace(location.href.replace(/\\?.*$/, \"#login\"))\n  })\n  tabs.fitScreen()\n\n  tabs.select(selected)\n  if (!tabs.selected) tabs.select(\"#portfolio\")\n}\n\n/**\n * Module loading\n */\n\nfunction getLedgerModule () {\n  return import(\n    /* webpackChunkName: \"ledger\" */ \"@cosmic-plus/ledger-wallet\"\n  ).then(ledger => ledger.default)\n}\n","\"use_strict\"\n/**\n * Asset class\n */\n\nconst AUTO_REFRESH_PRICES = true\nconst CRYPTO_PRICES_REFRESH_DELAY = 60 * 1000\nconst FIAT_PRICES_REFRESH_DELAY = 60 * 60 * 1000\nconst FIAT_BASEURL = \"https://www.xe.com/themes/xe/images/flags/svg/\"\nconst FIAT_IMAGEFORMAT = \".svg\"\n\nconst Mirrorable = require(\"@cosmic-plus/jsutils/es5/mirrorable\")\nconst Projectable = require(\"@cosmic-plus/jsutils/es5/projectable\")\n\nconst global = require(\"./global\")\nconst marketData = require(\"./market-data\")\nconst Orderbook = require(\"./orderbook\")\n\n/**\n * Class\n */\n\nconst Asset = module.exports = class Asset extends Projectable {\n  static resolve (id) {\n    return Asset.table[id] || new Asset(id)\n  }\n\n  constructor (id) {\n    super()\n\n    this.id = id\n    Asset.table[id] = this\n\n    // Empty image by default\n    this.image = \"data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=\"\n\n    if (Asset.info[id]) {\n      this.code = id\n      Object.assign(this, Asset.info[id])\n      if (this.type === \"fiat\") {\n        Asset.fiats.push(this)\n        this.image = `${FIAT_BASEURL}${id.toLowerCase()}${FIAT_IMAGEFORMAT}`\n      } else {\n        Asset.cryptos.push(this)\n        this.type = \"crypto\"\n      }\n    } else {\n      this.code = id.replace(/:.*/, \"\")\n      this.name = this.code\n      this.type = \"unknown\"\n    }\n\n    this.anchors = new Mirrorable()\n    this.balances = new Mirrorable()\n    this.offers = new Mirrorable()\n    this.autoUpdatePrice = AUTO_REFRESH_PRICES\n\n    this.balances.mirror(balance => {\n      this.anchors.push(balance.anchor)\n      this.watch(balance, \"amount\", () => this.compute(\"amount\"))\n      this.watch(balance, [\"buying\", \"selling\"], () => {\n        this.compute(\"liabilities\")\n      })\n    })\n\n    this.orderbook = Orderbook.forAsset(this)\n    this.define(\"price\", \"globalPrice\", () => {\n      return this.globalPrice || this.orderbook.price\n    })\n    this.watch(this.orderbook, \"price\", () => this.compute(\"price\"))\n  }\n\n  async getInfo () {\n    // Happens once & only for cryptos.\n    if (this.name || this.type !== \"crypto\") return\n    this.info = await marketData.crypto.info(this)\n    this.name = this.info.name\n    this.image = this.info.image.small\n  }\n\n  addOrderbook (orderbook) {\n    this.orderbook.addChild(orderbook)\n  }\n}\n\nAsset.define(\"amount\", \"balances\", function () {\n  return this.balances && this.balances.reduce((sum, el) => sum + el.amount, 0)\n})\n\nAsset.define(\"value\", [\"amount\", \"price\"], function () {\n  return this.amount === 0 ? 0 : this.amount * this.price\n})\n\nAsset.define(\"liabilities\", [\"balances\", \"price\"], function () {\n  if (this.balances) {\n    const rawLiabilities = this.balances.reduce(\n      (sum, entry) => sum + entry.buying - entry.selling,\n      0\n    )\n    return this.price * rawLiabilities\n  }\n})\n\nAsset.define(\"isSupported\", [\"type\", \"price\"], function () {\n  return !!(this.type !== \"unknown\" || this.price)\n})\n\n/**\n * Utilities\n */\n\nAsset.refreshPrices = async function (array) {\n  if (!array) {\n    await Asset.refreshCryptoPrices()\n    await Asset.refreshFiatPrices()\n  } else {\n    await Asset.refreshCryptoPrices(\n      array.filter(asset => asset.type === \"crypto\").map(asset => asset.code)\n    )\n    await Asset.refreshFiatPrices(\n      array.filter(asset => asset.type === \"fiat\").map(asset => asset.code)\n    )\n  }\n}\n\nAsset.refreshCryptoPrices = async function (assets = Asset.cryptos) {\n  if (!assets.length) return\n  const prices = await marketData.crypto.prices(assets)\n  assets.forEach(asset => {\n    if (asset.autoUpdatePrice) asset.globalPrice = prices[asset.code]\n  })\n}\n\nAsset.refreshFiatPrices = async function (fiats = Asset.fiats) {\n  if (!fiats.length) return\n  const prices = await marketData.fiat.prices(fiats)\n  fiats.forEach(asset => {\n    if (asset.autoUpdatePrice) asset.globalPrice = prices[asset.code]\n  })\n}\n\n/**\n * Known Assets\n */\n\nAsset.info = {\n  USD: { type: \"fiat\", name: \"US Dollar\" },\n  EUR: { type: \"fiat\", name: \"Euro\" },\n  CNY: { type: \"fiat\", name: \"Renminbi\" },\n\n  BTC: { apiId: \"bitcoin\" },\n  ETH: { apiId: \"ethereum\" },\n  XRP: { apiId: \"ripple\" },\n  XLM: { apiId: \"stellar\" },\n  KIN: { apiId: \"kin\" },\n  BAT: { apiId: \"basic-attention-token\" },\n  ZRX: { apiId: \"0x\" },\n  BCH: { apiId: \"bitcoin-cash\" },\n  STEEM: { apiId: \"steem\" },\n  SBD: { apiId: \"steem-dollar\" },\n  LINK: { apiId: \"chainlink\" },\n\n  SLT: { apiId: \"smartlands\" },\n  MOBI: { apiId: \"mobius\" },\n  SHX: { apiId: \"stronghold-token\" },\n  RMT: { apiId: \"sureremit\" },\n  TERN: { apiId: \"ternio\" },\n  PEDI: { apiId: \"pedity\" },\n  GRAT: { apiId: \"gratz\" },\n  REPO: { apiId: \"repo\" }\n}\n\n/**\n * Init\n */\n\nAsset.table = {}\nAsset.cryptos = []\nAsset.fiats = []\nnew Asset(global.currency)\n\n// Automatic global price refresh\nif (AUTO_REFRESH_PRICES) {\n  setInterval(Asset.refreshCryptoPrices, CRYPTO_PRICES_REFRESH_DELAY)\n  setInterval(Asset.refreshFiatPrices, FIAT_PRICES_REFRESH_DELAY)\n}\n\n// eslint-disable-next-line no-console\nconsole.log(Asset.table)\n","\"use_strict\"\n/**\n * Signing Side Frame\n */\nconst html = require(\"@cosmic-plus/domutils/es5/html\")\nconst Observable = require(\"@cosmic-plus/jsutils/es5/observable\")\nconst { timeout } = require(\"@cosmic-plus/jsutils/es5/misc\")\nconst { __ } = require(\"@cosmic-plus/i18n\")\n\n/**\n * Class\n */\n\nclass SideFrame extends Observable {\n  constructor (url) {\n    super()\n\n    if (SideFrame.current) SideFrame.current.close()\n    SideFrame.current = this\n\n    this.domNode = html.create(\"iframe\", {\n      title: \"Signing Frame\",\n      className: \"animated\",\n      src: url,\n      sandbox: \"allow-same-origin allow-scripts allow-forms allow-popups\",\n      hidden: true\n    })\n    Object.assign(this.domNode.style, SideFrame.style)\n    html.append(document.body, this.domNode)\n\n    this.show()\n  }\n\n  show () {\n    if (!this.domNode.hidden) return\n\n    this.htmlOverflow = document.documentElement.style.overflow\n    this.bodyOverflow = document.body.style.overflow\n    document.documentElement.style.overflow = \"hidden\"\n    document.body.style.overflow = \"hidden\"\n\n    html.show(SideFrame.shadow, SideFrame.close, this.domNode)\n    this.domNode.style.animationName = \"slideInRight\"\n    SideFrame.shadow.style.background = \"rgba(0,0,0,0.3)\"\n\n    return timeout(400).then(() => {\n      SideFrame.shadow.onclick = () => this.close()\n      SideFrame.close.onclick = () => this.close()\n      this.trigger(\"show\")\n    })\n  }\n\n  hide () {\n    if (this.domNode.hidden) return\n\n    document.documentElement.style.overflow = this.htmlOverflow\n    document.body.style.overflow = this.bodyOverflow\n\n    SideFrame.shadow.onclick = null\n    html.hide(SideFrame.close)\n\n    this.domNode.style.animationName = \"slideOutRight\"\n    SideFrame.shadow.style.background = \"transparent\"\n\n    return timeout(400).then(() => {\n      html.hide(SideFrame.shadow, SideFrame.close, this.domNode)\n      this.trigger(\"hide\")\n    })\n  }\n\n  close () {\n    SideFrame.current = null\n    this.hide().then(() => {\n      html.destroy(this.domNode)\n      this.trigger(\"close\")\n      this.destroy()\n    })\n  }\n}\n\n/**\n * Event\n */\n\nwindow.addEventListener(\"message\", event => {\n  const frameWindow =\n    SideFrame.current && SideFrame.current.domNode.contentWindow\n\n  if (event.source === frameWindow) {\n    switch (event.data) {\n    case \"show\":\n      SideFrame.current.show()\n      break\n    case \"hide\":\n      SideFrame.current.hide()\n      break\n    case \"close\":\n      SideFrame.current.close()\n      break\n    }\n  }\n})\n\n/**\n * Frame style\n */\n\nSideFrame.style = {\n  position: \"fixed\",\n  zIndex: 998,\n  right: 0,\n  top: 0,\n  width: \"30em\",\n  maxWidth: \"100%\",\n  height: \"100vh\",\n  border: \"0.1em solid hsl(240, 10%, 75%)\",\n  background: \"hsl(240, 40%, 98%)\",\n  backgroundImage: `url('./images/cosmic-link.svg')`,\n  backgroundRepeat: \"no-repeat\",\n  backgroundPosition: \"center\",\n  backgroundSize: \"12em 12em\",\n  padding: 0\n}\n\n/**\n * Closing button\n */\n\nSideFrame.close = html.create(\"span\", { hidden: true }, ` ${__(\"Close\")}`)\nObject.assign(SideFrame.close.style, {\n  position: \"fixed\",\n  zIndex: 999,\n  top: \"0.1em\",\n  right: \"0.1em\",\n  color: \"hsl(0, 0%, 40%)\",\n  fontSize: \"0.9em\",\n  fontWeight: \"bold\",\n  cursor: \"pointer\",\n  background: \"hsl(0, 0%, 95%)\",\n  borderBottomLeftRadius: \"0.1em\",\n  padding: \"0.1em 0.3em\"\n})\ndocument.body.insertBefore(SideFrame.close, document.body.firstChild)\n\n/**\n * Shadow Layer\n */\n\nSideFrame.shadow = html.create(\"div\", { hidden: true })\nObject.assign(SideFrame.shadow.style, {\n  position: \"fixed\",\n  zIndex: 997,\n  top: 0,\n  width: \"100%\",\n  height: \"100%\",\n  background: \"transparent\",\n  transition: \"background 0.4s\"\n})\ndocument.body.insertBefore(SideFrame.shadow, document.body.firstChild)\n\n/**\n * Export\n */\n\nmodule.exports = SideFrame\n","\"use_strict\"\n/**\n * Markets statistics & data\n *\n * @exports marketData\n */\nconst marketData = exports\n\nconst axios = require(\"@cosmic-plus/base/es5/axios\")\nconst nice = require(\"@cosmic-plus/jsutils/es5/nice\")\nconst { day } = require(\"@cosmic-plus/jsutils/es5/misc\")\n\nconst global = require(\"./global\")\n\n/**\n * Generic price/history\n */\n\nmarketData.assetHistory = function (asset, limit = 1000) {\n  if (asset.type === \"crypto\") return marketData.crypto.history(asset, limit)\n  else if (asset.type === \"fiat\") return marketData.fiat.history(asset, limit)\n}\n\n/**\n * Crypto price/history by \"https://www.coingecko.com\"\n */\n\nmarketData.crypto = {}\n\nfunction coingeckoCall (page, params) {\n  return axios.get(`https://api.coingecko.com/api/v3/${page}`, { params })\n}\n\nmarketData.crypto.list = async function () {\n  const response = await coingeckoCall(\"coins/list\")\n  const list = {}\n  response.data.forEach(entry => {\n    const symbol = entry.symbol.toUpperCase()\n    list[symbol] = { apiId: entry.id, name: entry.name }\n  })\n  return list\n}\n\nmarketData.crypto.stellarNative = async function () {\n  const response = await coingeckoCall(\"exchanges/stellar_term\")\n  return response.data.tickers.map(x => x.coin_id).filter(x => x)\n}\n\nmarketData.crypto.info = async function (asset) {\n  const response = await coingeckoCall(`coins/${asset.apiId}`, {\n    localization: false,\n    tickers: false,\n    market_data: false,\n    community_data: false,\n    developer_data: false,\n    sparkline: false\n  })\n  return response.data\n}\n\nmarketData.crypto.prices = async function (assets) {\n  const ids = assets.map(asset => asset.apiId).join(\",\")\n  const quote = global.currency.toLowerCase()\n  const response = await coingeckoCall(\"simple/price\", {\n    ids,\n    vs_currencies: quote\n  })\n  const prices = {}\n  assets.forEach(asset => {\n    const assetData = response.data[asset.apiId]\n    if (assetData) prices[asset.code] = assetData[quote]\n  })\n  return prices\n}\n\nmarketData.crypto.history = async function (asset, limit = 1000) {\n  const response = await coingeckoCall(`coins/${asset.apiId}/market_chart`, {\n    vs_currency: global.currency,\n    days: limit\n  })\n  const data = response.data.prices.map((record, index) => {\n    return {\n      time: record[0],\n      price: record[1],\n      // volume: response.data.total_volumes[index][1]\n      volume: +nice(response.data.total_volumes[index][1] / record[1])\n    }\n  })\n  return data\n}\n\n/**\n * Fiat prices / history by \"https://exchangeratesapi.io\"\n */\n\nmarketData.fiat = {}\n\nasync function exchangeratesCall (page, symbols, params = {}) {\n  params.base = global.currency\n  if (typeof symbols === \"string\") {\n    params.symbols = symbols\n  } else {\n    if (global.currency === \"EUR\") symbols = symbols.filter(x => x !== \"EUR\")\n    params.symbols = symbols.join(\",\")\n  }\n  params.source = \"equilibre.io\"\n\n  return axios\n    .get(`https://api.exchangeratesapi.io/${page}`, { params })\n    .then(response => {\n      if (global.currency === \"EUR\" && !response.data.start_at) {\n        response.data.rates.EUR = 1\n      }\n      return response\n    })\n}\n\nmarketData.fiat.prices = async function (assets) {\n  const symbols = assets.map(asset => asset.code)\n  const response = await exchangeratesCall(\"latest\", symbols)\n  const data = response.data.rates\n  for (let symbol in data) {\n    data[symbol] = nice(1 / data[symbol], 8)\n  }\n  return data\n}\n\nmarketData.fiat.history = async function (asset, limit = 1000) {\n  const cached = cachedHistory(asset)\n  if (cached) return cached\n\n  const end_at = new Date().toISOString().slice(0, 10)\n  const today = new Date(end_at)\n  today.setDate(today.getDate() - limit)\n  const start_at = today.toISOString().slice(0, 10)\n  const response = await exchangeratesCall(\"history\", asset.code, {\n    start_at,\n    end_at\n  })\n\n  const data = Object.keys(response.data.rates)\n    .sort()\n    .map(date => {\n      return {\n        time: new Date(date).getTime(),\n        price: +nice(1 / response.data.rates[date][asset.code], 8)\n      }\n    })\n  cacheHistory(asset, data)\n  return data\n}\n\n/**\n * Helpers\n */\n\nfunction cacheHistory (asset, data) {\n  localStorage[`prices.${asset.code}`] = JSON.stringify([day(), data])\n}\n\nfunction cachedHistory (asset) {\n  const json = localStorage[`prices.${asset.code}`]\n  if (!json) return\n  const data = JSON.parse(json)\n  if (data[0] === day()) return data[1]\n}\n","\"use_strict\"\n/**\n * Orderbook class\n */\n\nconst cosmicLib = require(\"cosmic-lib\")\nconst nice = require(\"@cosmic-plus/jsutils/es5/nice\")\nconst Projectable = require(\"@cosmic-plus/jsutils/es5/projectable\")\nconst StellarSdk = require(\"@cosmic-plus/base/es5/stellar-sdk\")\nconst { timeout } = require(\"@cosmic-plus/jsutils/es5/misc\")\nconst { __ } = require(\"@cosmic-plus/i18n\")\n\nconst Orderbook = module.exports = class Orderbook extends Projectable {\n  static forBalance (balance, quote) {\n    if (balance.asset === quote) return\n\n    const orderbook = new Orderbook({ balance, quote })\n    orderbook.streamOffers()\n\n    balance.orderbook = orderbook\n    balance.asset.addOrderbook(orderbook)\n\n    return orderbook\n  }\n\n  static forAsset (asset) {\n    return new Orderbook({ asset })\n  }\n\n  constructor (params) {\n    super()\n\n    if (params.balance) {\n      this.type = \"native\"\n      this.balance = params.balance\n      this.base = params.balance.asset\n      this.quote = params.quote\n      this.name = `${this.base.code}/${this.quote.code}`\n      this.offersCallBuilder = Orderbook.offersCallBuilder(this.balance)\n\n      this.watch(this.quote, \"price\", () => this.updateOffersPrices())\n    } else if (params.asset) {\n      this.type = \"agregated\"\n      this.base = params.asset\n      this.name = `${this.base.code} (${__(\"Agregated\")})`\n      this.childs = []\n    }\n\n    this.watch(this.base, \"globalPrice\", () => this.compute(\"price\"))\n  }\n\n  static offersCallBuilder (balance) {\n    const baseAsset = new StellarSdk.Asset(balance.code, balance.anchor.address)\n    const quoteAsset = StellarSdk.Asset.native()\n    const server = cosmicLib.resolve.server()\n    return server.orderbook(baseAsset, quoteAsset)\n  }\n\n  async streamOffers () {\n    // eslint-disable-next-line no-constant-condition\n    while (true) {\n      await this.getOffers()\n      await timeout(15000)\n    }\n  }\n\n  async getOffers () {\n    try {\n      const offers = await this.offersCallBuilder.call()\n      this.ingest(offers)\n    } catch (error) {\n      console.error(error)\n    }\n  }\n\n  ingest (offers) {\n    if (!areOffersEquals(this.bids, offers.bids)) {\n      this.bids = normalizeOffers(offers.bids, this.quote, this.balance, \"bids\")\n    }\n    if (!areOffersEquals(this.asks, offers.asks)) {\n      this.asks = normalizeOffers(offers.asks, this.quote, this.balance, \"asks\")\n    }\n  }\n\n  updateOffersPrices () {\n    if (this.bids) {\n      this.set(\"bids\", updateOffersPrices(this.bids, this.quote))\n    }\n    if (this.asks) {\n      this.set(\"asks\", updateOffersPrices(this.asks, this.quote))\n    }\n  }\n\n  mergeOffers (side) {\n    if (this.childs.length < 2) {\n      this.set(side, this.childs[0] && this.childs[0][side])\n      return\n    }\n\n    /// Merge order books\n    const merged = this.childs.reduce((merged, child) => {\n      return child[side] ? merged.concat(child[side]) : merged\n    }, [])\n    if (!merged.length) {\n      this[side] = null\n      return\n    }\n\n    const sortOffers =\n      side === \"bids\"\n        ? (a, b) => b.price - a.price\n        : (a, b) => a.price - b.price\n\n    /// Update volumes.\n    let volume = 0,\n      baseVolume = 0,\n      quoteVolume = 0\n    this.set(\n      side,\n      merged.sort(sortOffers).map(row => {\n        const mergedRow = Object.assign({}, row)\n        mergedRow.volume = volume += +nice(row.amount * row.price, 7)\n        mergedRow.baseVolume = baseVolume += +row.amount\n        mergedRow.quoteVolume = quoteVolume += +row.quoteAmount\n        return mergedRow\n      })\n    )\n  }\n\n  addChild (orderbook) {\n    this.childs.push(orderbook)\n    this.watch(orderbook, \"bids\", () => this.mergeOffers(\"bids\"))\n    this.watch(orderbook, \"asks\", () => this.mergeOffers(\"asks\"))\n  }\n}\n\nOrderbook.define(\"bestBid\", \"bids\", function () {\n  return this.bids && this.bids[0] && this.bids[0].price\n})\nOrderbook.define(\"bestAsk\", \"asks\", function () {\n  return this.asks && this.asks[0] && this.asks[0].price\n})\nOrderbook.define(\"price\", [\"bestBid\", \"bestAsk\"], function () {\n  if (this.base.globalPrice) return (this.bestBid + this.bestAsk) / 2\n  else return this.marketPrice()\n})\nOrderbook.define(\"spread\", [\"bestBid\", \"bestAsk\"], function () {\n  return this.bestAsk - this.bestBid\n})\nOrderbook.define(\"spread%\", [\"spread\", \"bestAsk\"], function () {\n  return 100 * this.spread / this.bestAsk\n})\n\n/**\n * Utilities\n */\n\n/**\n * Look for the best first offer in **orderbook** **side** that match **filter**\n * (if provided) among child orderbooks.\n *\n * @param  {Orderbook} orderbook [description]\n * @param  {String}    side      `bids` or `asks`\n * @param  {Function}  [filter]  A filter that is passed by the returned offer\n * @return {Object}    An orderbook offer\n */\nOrderbook.prototype.findOffer = function (side, filter) {\n  const offers = this[side]\n  const childsNum = this.childs ? this.childs.length : 1\n  const anchors = {}\n\n  let last\n  for (let index in offers) {\n    const offer = offers[index]\n    if (filter && !filter(offer)) continue\n    const anchor = offer.balance.anchor.address\n    if (!anchors[anchor]) {\n      anchors[anchor] = true\n      last = offer\n    }\n    if (Object.keys(anchors).length === childsNum) break\n  }\n  return last\n}\n\nOrderbook.prototype.findAsk = function (filter) {\n  return this.findOffer(\"asks\", filter)\n}\nOrderbook.prototype.findBid = function (filter) {\n  return this.findOffer(\"bids\", filter)\n}\n\n/**\n * Returns the price of asset at **depth** XLM of orderbook's **side**.\n *\n * @param  {String} [side=\"bids\"] Either \"bids\" or \"asks\"\n * @param  {Number} [depth] The depth to look at, in term of XLM\n * @return {Number} Offer price at requested depth\n */\nOrderbook.prototype.marketPrice = function (side = \"bids\", depth = 50) {\n  const offer = this.findOffer(side, offer => offer.quoteVolume > depth)\n  return offer ? offer.price : 0\n}\n\n/**\n * Helpers\n */\n\nfunction areOffersEquals (array1, array2) {\n  if (!array1) return false\n  if (array1.length !== array2.length) return false\n  for (let index in array1.length) {\n    if (array1[index].amount !== array2[index].amount) return false\n    if (array1[index].price !== array2[index].price) return false\n  }\n  return true\n}\n\nfunction normalizeOffers (offers, quote, balance, side) {\n  offers.forEach(row => {\n    row.volume = undefined\n    row.baseVolume = undefined\n    row.basePrice = +row.price\n    row.quoteAmount = +row.amount\n    row.quoteVolume = undefined\n    row.balance = balance\n    row.side = side\n  })\n  return updateOffersPrices(offers, quote)\n}\n\nfunction updateOffersPrices (offers, quote) {\n  let volume = 0,\n    quoteVolume = 0,\n    baseVolume = 0\n  offers.forEach(row => {\n    if (row.side === \"asks\") {\n      row.quoteAmount = +nice(row.amount * row.basePrice, 7)\n    } else {\n      row.amount = +nice(row.quoteAmount / row.basePrice, 7)\n    }\n    row.price = +nice(row.basePrice * quote.price, 7)\n    row.volume = volume += +nice(row.amount * row.price, 7)\n    row.baseVolume = baseVolume += +row.amount\n    row.quoteVolume = quoteVolume += +row.quoteAmount\n  })\n  return offers\n}\n","\"use_strict\"\n/**\n * Balance entry\n */\nconst Mirrorable = require(\"@cosmic-plus/jsutils/es5/mirrorable\")\nconst Projectable = require(\"@cosmic-plus/jsutils/es5/projectable\")\n\nconst Anchor = require(\"./anchor\")\nconst Asset = require(\"./asset\")\nconst Orderbook = require(\"./orderbook\")\n\nconst Balance = module.exports = class Balance extends Projectable {\n  static resolve (code, issuer) {\n    const id = code ? `${code}:${issuer}` : \"XLM\"\n    return Balance.table[id]\n  }\n\n  static ingest (entry) {\n    const id = entryId(entry)\n    const balance = Balance.table[id]\n    if (!balance) return new Balance(entry, id)\n\n    balance.amount = +entry.balance\n    balance.buying = +entry.buying_liabilities\n    balance.selling = +entry.selling_liabilities\n    return balance\n  }\n\n  constructor (entry) {\n    super()\n\n    this.id = entryId(entry)\n    this.code = entry.asset_code || \"XLM\"\n    this.anchor = Anchor.resolve(entry.asset_issuer || \"stellar.org\")\n    Balance.table[this.id] = this\n\n    if (this.id === \"XLM\" || this.id in Anchor.known) {\n      this.asset = Asset.resolve(Anchor.known[this.id] || this.code)\n      this.known = true\n    } else {\n      this.asset = Asset.resolve(this.id)\n      this.known = false\n    }\n    this.amount = +entry.balance\n    this.buying = +entry.buying_liabilities\n    this.offers = new Mirrorable()\n    this.selling = +entry.selling_liabilities\n\n    this.asset.balances.push(this)\n\n    if (this.code === \"XLM\") {\n      this.asset.project(\"price\", this)\n    } else {\n      this.orderbook = Orderbook.forBalance(this, Asset.resolve(\"XLM\"))\n      this.orderbook.project(\"price\", this)\n    }\n  }\n}\n\nBalance.table = {}\nBalance.define(\"value\", [\"amount\", \"price\"], function () {\n  return this.amount === 0 ? 0 : this.amount * this.price\n})\n\n/**\n * Helpers\n */\n\nfunction entryId (entry) {\n  return entry.asset_code ? `${entry.asset_code}:${entry.asset_issuer}` : \"XLM\"\n}\n","\"use_strict\"\n/**\n * form.js  Generate formulary with ease\n *\n * Differences with ordinary interface:\n *\n * - Form request is sent only if `method=\"get\"` or `method=\"post\"` is\n *   explicitely set.\n * - Form inputs are `required` by default.\n * - Select control is renamed selector (verbs are reserved).\n */\n\nconst Projectable = require(\"@cosmic-plus/jsutils/es5/projectable\")\nconst hiddenKey = require(\"@cosmic-plus/jsutils/es5/misc\").setHiddenProperty\n\nconst bindDomKey = require(\"./bind-dom-key\")\nconst handleExtraAttributes = require(\"./handle-extra-attributes\")\nconst html = require(\"./html-extra\")\n\n/**\n * Definition\n */\n\nclass Form extends Projectable {\n  /**\n   * Two forms:\n   *\n   * * new Form($form, attributes)\n   * * new Form([attributes], ...childs)\n   */\n  constructor (...params) {\n    super()\n\n    // Import or create the form DOM node.\n    if (params.length && params[0].tagName === \"FORM\") {\n      hiddenKey(this, \"domNode\", params[0])\n      if (params[1]) Object.assign(this.domNode, params[1])\n    } else {\n      hiddenKey(this, \"domNode\", html.element(\"form\", ...params))\n    }\n\n    // Validation - request is sent only if a method is explicitely set.\n    this.domNode.addEventListener(\"submit\", () => {\n      const method = this.domNode.getAttribute(\"method\")\n      if (!method) event.preventDefault()\n      this.trigger(\"submit\")\n    })\n\n    // Bind values\n    Form.bindInputs(this, this.domNode)\n    hiddenKey(this, \"dom\", handleExtraAttributes(this.domNode))\n\n    // Add message box if none exists.\n    if (!this.dom.status) {\n      this.dom.status = [Form.status()]\n      html.append(this.domNode, this.dom.status[0])\n    }\n  }\n\n  /**\n   * Controls\n   */\n\n  submit () {\n    this.domNode.submit()\n  }\n\n  reset () {\n    this.domNode.reset()\n  }\n\n  /**\n   * Status Display\n   */\n\n  report (type, ...content) {\n    const $status = this.dom.status[0]\n    if ($status) {\n      $status.className = type\n      html.rewrite($status, ...content)\n    }\n  }\n\n  info (content) {\n    this.report(\"info\", content, Form.spinner())\n  }\n\n  error (content) {\n    // Extract message from Error object. (TODO: handle it in html)\n    this.report(\"error\", content.message || content)\n    if (content instanceof Error) throw content\n    else throw new Error(content)\n  }\n}\n\n// Automatically clean report on user input.\nForm.listen(\"change\", event => event.report(null))\n\n/**\n * Binding\n */\n\nForm.bindInputs = function (object, $node) {\n  html.walk($node, binder, object)\n}\n\nfunction binder ($node, object) {\n  if ($node.name) bindDomKey(object, $node.name, $node)\n}\n\n/**\n * Helpers (Actions)\n */\n\nForm.enable = function (element, attributes) {\n  element.disabled = false\n  Object.assign(element, attributes)\n}\n\nForm.disable = function (element, attributes) {\n  element.enabled = true\n  Object.assign(element, attributes)\n}\n\nForm.hide = html.hide\nForm.show = html.show\n\n/**\n * Elements\n */\n\nForm.element = html.element\n\nForm.status = function (message = \"\") {\n  return Form.element(\"p\", { alias: \"status\" }, message)\n}\n\nForm.spinner = function () {\n  return Form.element(\"span\", { className: \"spinner\" })\n}\n\nForm.label = function (...params) {\n  return Form.element(\"label\", ...params)\n}\n\nForm.button = function (params, ...childs) {\n  if (!childs.length) childs = [params.value]\n  return Form.element(\"button\", params, ...childs)\n}\n\nForm.control = function (tag, params) {\n  const defaults = { required: true }\n  const attributes = Object.assign(defaults, params)\n  return Form.element(tag, attributes)\n}\n\nForm.textarea = function (params) {\n  return Form.control(\"textarea\", params)\n}\n\nForm.selector = function (params) {\n  const selector = Form.control(\"select\", params)\n  if (selector.values) {\n    html.append(selector, ...makeOptions(selector.values))\n  }\n  if (selector.placeholder) {\n    const placeholder = html.element(\n      \"option\",\n      { value: \"\", disabled: true, selected: true, hidden: true },\n      selector.placeholder\n    )\n    html.unshift(selector, placeholder)\n    if (params.selectedIndex != null) params.selectedIndex++\n  }\n\n  if (params.selectedIndex) selector.selectedIndex = params.selectedIndex\n  else if (params.value) selector.value = params.value\n\n  return selector\n}\n\nForm.input = function (type, params = {}) {\n  const input = Form.control(\"input\", params)\n  input.type = type\n  return input\n}\n\n// Exclude: button, datetime-local, reset, submit, select, search (no verbs)\nconst inputTypes = [\n  \"checkbox\",\n  \"color\",\n  \"date\",\n  \"email\",\n  \"file\",\n  \"hidden\",\n  \"image\",\n  \"month\",\n  \"number\",\n  \"password\",\n  \"radio\",\n  \"range\",\n  \"tel\",\n  \"text\",\n  \"time\",\n  \"url\",\n  \"week\"\n]\n\ninputTypes.forEach(type => Form[type] = params => Form.input(type, params))\nForm.datetime = params => Form.input(\"datetime-local\", params)\n\n/**\n * Elements Helpers\n */\n\nfunction makeOptions (object) {\n  if (object instanceof Array) {\n    return object.map(value => {\n      return html.element(\"option\", { value }, value)\n    })\n  } else {\n    return Object.keys(object).map(value => {\n      return html.element(\"option\", { value }, object[value])\n    })\n  }\n}\n\n/**\n * Export\n */\n\nmodule.exports = Form\n","\"use_strict\"\n/**\n * Additional methods for html.\n */\nconst html = Object.create(require(\"@cosmic-plus/domutils/es5/html\"))\nmodule.exports = html\n\n/**\n * Creates an new HTML element.\n */\nhtml.element = function (tag, ...params) {\n  let attributes\n  if (\n    params[0]\n    && params[0].constructor === Object\n    && params[0].domNode === undefined\n  ) {\n    attributes = params.shift()\n  }\n\n  return html.create(tag, attributes, ...params)\n}\n\n/**\n * Walks **element** dom tree, applying **func** to each node.\n */\nhtml.walk = function (element, func, ...params) {\n  func(element, ...params)\n  element.childNodes.forEach(child => html.walk(child, func, ...params))\n}\n\n/**\n * Add **...children** as first **parent** children.\n */\nhtml.unshift = function (parent, ...children) {\n  for (let i = 0; i < children.length; i++) {\n    parent.insertBefore(children[i], parent.childNodes[i])\n  }\n}\n","\"use_strict\"\n/**\n * Order class\n */\n\nconst cosmicLib = require(\"cosmic-lib\")\nconst CosmicLink = cosmicLib.CosmicLink\nconst Mirrorable = require(\"@cosmic-plus/jsutils/es5/mirrorable\")\nconst nice = require(\"@cosmic-plus/jsutils/es5/nice\")\nconst Projectable = require(\"@cosmic-plus/jsutils/es5/projectable\")\nconst { __ } = require(\"@cosmic-plus/i18n\")\n\nconst global = require(\"./global\")\n\n/**\n * Class\n */\n\nconst Order = module.exports = class Order extends Projectable {\n  static rebalance (target) {\n    if (target.asset.code === \"XLM\") return\n\n    const order = new Order(\"balance\", target.asset.orderbook, target)\n    order.watch(target, \"amount\", () => order.refresh())\n    order.watch(target.asset.orderbook, [\"bids\", \"asks\"], () => order.refresh())\n    target.asset.offers.listen(\"change\", () => order.refresh(), order)\n\n    return order\n  }\n\n  constructor (type, orderbook, ...parameters) {\n    super()\n    this.type = type\n    this.method = Order.type[this.type]\n    this.operations = new Mirrorable()\n    this.orderbook = orderbook\n    this.parameters = parameters\n\n    this.operations.listen(\"update\", () => {\n      this.compute([\"cosmicLink\", \"description\"])\n    })\n\n    this.refresh()\n  }\n\n  refresh () {\n    this.operations.splice(0, this.operations.length)\n    this.operations.trigger(\"update\")\n    this.method(this, ...this.parameters)\n    this.trigger(\"refresh\")\n  }\n\n  /**\n   * Operations Management\n   */\n\n  getOperation (offer, make) {\n    const id = `${offer.balance.anchor.name}:${make ? offer.price : \"take\"}`\n    const operation = this.operations.find(x => x.id === id)\n    if (operation) {\n      return operation\n    } else {\n      const newOperation = { id }\n      this.operations.push(newOperation)\n      return newOperation\n    }\n  }\n\n  addOperation (offer, amount) {\n    const operation = this.getOperation(offer, amount > 0)\n    this.setOperation(operation, offer, Number(amount) || operation.amount)\n  }\n\n  setOperation (operation, offer, amount) {\n    operation.amount = amount\n    operation.cost = amount * offer.price\n    operation.offer = offer\n    this.operations.trigger(\"update\")\n  }\n}\n\nOrder.define(\"cosmicLink\", \"operations\", function () {\n  return Order.operationsToCosmicLink(this.operations)\n})\nOrder.define(\"description\", \"operations\", function () {\n  return Order.operationsToDescription(this.operations)\n})\n\n/**\n * Utilities\n */\n\nOrder.operationsToCosmicLink = function (operations = []) {\n  const cosmicLink = new CosmicLink({\n    memo: \"Equilibre.io\",\n    maxTime: \"+5\",\n    source: global.portfolio.accountId\n  })\n  operations.forEach(operation => {\n    cosmicLink.addOperation(\"manageOffer\", operationToOdesc(operation))\n  })\n\n  return cosmicLink\n}\n\nOrder.operationsToDescription = function (operations = []) {\n  const desc = []\n  operations.forEach(op => {\n    if (operationDirection(op) === \"buy\") {\n      desc.push(`\n${__(\"Buy\")} ${nice(op.amount)} ${op.offer.balance.code} ${__(\"at\")} \\\n${nice(op.offer.price)} ${global.currency}\n      `)\n    } else {\n      desc.push(`\n${__(\"Sell\")} ${nice(op.amount)} ${op.offer.balance.code} ${__(\"at\")} \\\n${nice(op.offer.price)} ${global.currency}\n      `)\n    }\n  })\n  return desc\n}\n\n/**\n * Helpers\n */\n\nfunction operationDirection (op) {\n  if (\n    op.amount > 0 && op.offer.side === \"bids\"\n    || op.amount < 0 && op.offer.side === \"asks\"\n  ) {\n    return \"buy\"\n  } else {\n    return \"sell\"\n  }\n}\n\nfunction operationToOdesc (operation) {\n  const offer = operation.offer\n  const base = offer.balance.code + \":\" + offer.balance.anchor.address\n  const quote = \"XLM\"\n\n  let odesc\n  if (operationDirection(operation) === \"buy\") {\n    odesc = {\n      buying: base,\n      selling: quote,\n      amount: operation.amount * offer.price_r.n / offer.price_r.d,\n      price: { n: offer.price_r.d, d: offer.price_r.n }\n    }\n  } else {\n    odesc = {\n      buying: quote,\n      selling: base,\n      amount: operation.amount,\n      price: offer.price_r\n    }\n  }\n  odesc.amount = Math.abs(odesc.amount).toFixed(7)\n  odesc.offerId = operation.offer.id\n\n  return odesc\n}\n\n/**\n * Orders types\n */\n\nOrder.type = {}\n\nOrder.type.market = function (order, size) {\n  if (!size) return\n\n  const side = size > 0 ? \"asks\" : \"bids\"\n  const amount = Math.abs(size)\n  const offer = order.orderbook.findOffer(side, offer => {\n    return offer.baseVolume > amount\n  })\n  order.addOperation(offer, amount)\n}\n\nOrder.type.limit = function (order, size, { orderbook, filter }) {\n  if (!size) return\n\n  const side = size > 0 ? \"bids\" : \"asks\"\n  const offer = (orderbook || order.orderbook).findOffer(side, filter)\n  if (offer) order.addOperation(tightenSpread(offer), Math.abs(size))\n}\n\n/**\n * Rebalancing\n */\n\nOrder.type.balance = function (order, target) {\n  const asset = target.asset\n  const orderbook = asset.orderbook\n\n  // Requirements\n\n  if (target.amount == null || target.amountDelta === 0) return\n\n  if (!orderbook.bestBid || !orderbook.bestAsk) {\n    order.description = [__(\"Fetching orderbook...\")]\n    return\n  }\n\n  if (asset.liabilities) {\n    const currentOffers = asset.offers.filter(offer => !offer.outdated)\n    if (currentOffers.length) {\n      order.description = [__(\"Rebalancing...\")]\n      return\n    }\n  }\n\n  // Rebalancing\n\n  setBalancesLimits(target)\n  if (isOneOperationEnough(target)) {\n    addBalancingOperation(target, orderbook, target.amountDiff)\n  } else {\n    addSplitTrade(target)\n  }\n}\n\n/**\n * Set the `amountTradable` property of **target** balances according to\n * **target** target.\n */\nfunction setBalancesLimits (target, deviation = global.balanceTargetDeviation) {\n  // Empty orderbooks cannot be traded.\n  const balances = []\n  target.asset.balances.forEach(balance => {\n    if (balance.orderbook.price != null) balances.push(balance)\n    else balance.amountTradable = 0\n  })\n\n  // Special cases.\n  if (!balances.length) {\n    return\n  } else if (balances.length === 1) {\n    return balances[0].amountTradable = target.amountDelta\n  }\n\n  // Set each balance tradable amount.\n  const amountTarget = +nice(target.amount / balances.length, 7)\n  const amountMin = +nice(amountTarget * (1 - deviation), 7)\n  const amountMax = +nice(amountTarget * (1 + deviation), 7)\n\n  balances.forEach(balance => {\n    if (target.amountDiff > 0) {\n      balance.amountTradable = amountMax - balance.amount\n    } else {\n      balance.amountTradable = balance.amount - amountMin\n    }\n  })\n}\n\n/**\n * Returns whether or not it is possible meet **target** rebalancing target in\n * one operation.\n */\nfunction isOneOperationEnough (target) {\n  const balances = target.asset.balances\n  return !!filterTradableBalances(balances, target.amountDelta).length\n}\n\n/**\n * Return the **balances** that can be traded for **amountTraded**.\n */\nfunction filterTradableBalances (balances, amountTraded = 0) {\n  return balances.filter(balance => balance.amountTradable >= amountTraded)\n}\n\n/**\n * Adds an operation to `target.order` that trades **size** `target.asset` on\n * **orderbook**.\n */\nfunction addBalancingOperation (target, orderbook, size) {\n  const filter = makeOfferFilter(target, Math.abs(size))\n  Order.type.limit(target.order, size, { orderbook, filter })\n}\n\n/**\n * Split a trade over multiple anchors.\n */\nfunction addSplitTrade (target) {\n  const tradableBalances = filterTradableBalances(target.asset.balances)\n  const tradableAmounts = tradableBalances.map(x => x.amountTradable)\n  const tradableTotal = tradableAmounts.reduce((x, sum) => x + sum, 0)\n  const tradeShares = tradableAmounts.map(x => x / tradableTotal)\n  const tradeAmounts = tradeShares.map(x => +nice(x * target.amountDiff, 7))\n\n  tradableBalances.forEach((balance, index) => {\n    addBalancingOperation(target, balance.orderbook, tradeAmounts[index])\n  })\n}\n\n/**\n * Returns a balancing offer filter for **tradedAmount** to be used with\n * `Orderbook.findOffer()`.\n */\nfunction makeOfferFilter (target, amountTraded) {\n  const noMinValue = target.mode === \"quantity\" || target.amount === 0\n  return offer => {\n    return (\n      offer.balance.amountTradable >= amountTraded\n      && offer.baseVolume > amountTraded * global.skipMarginalOffers\n      && (noMinValue || amountTraded * offer.basePrice > global.minOfferValue)\n    )\n  }\n}\n\n/**\n * Create a copy of **offer** with a delta to global market price reduced by\n * **percentage**.\n */\nfunction tightenSpread (offer, percentage = global.spreadTightening) {\n  const clone = Object.assign({}, offer)\n  const diff = percentage * offer.balance.asset.orderbook[\"spread%\"] / 100\n\n  if (offer.side === \"bids\") clone.price = offer.price * (1 + diff)\n  else clone.price = offer.price * (1 - diff)\n\n  if (offer.balance.asset.globalPrice) clampOfferPrice(clone)\n  updateOfferPriceR(clone)\n\n  return clone\n}\n\n/**\n * Floor/ceil **offer**'s price to maintain a maximum spread of **spread**\n * from its price.\n *\n * @param {Object} offer offer to price-cap\n * @param {Number} [spread=0.025] Maximum spread from asset price (in percent)\n */\nfunction clampOfferPrice (offer, spread = global.maxSpread / 2) {\n  const refPrice = offer.balance.asset.price\n  if (offer.side === \"bids\") {\n    offer.price = clamp(offer.price, refPrice * (1 - spread), refPrice)\n  } else {\n    offer.price = clamp(offer.price, refPrice, refPrice * (1 + spread))\n  }\n}\n\n/**\n * Returns a number whose value is limited to the given range.\n *\n * @param  {Number} value An arbitrary number\n * @param  {Number} min Lower boundary\n * @param  {[type]} max Upper boundary\n * @return {Number}\n */\nfunction clamp (value, min, max) {\n  return Math.min(Math.max(value, min), max)\n}\n\n/**\n * Set `offer.price_r` according to `offer.price`.\n *\n * @param  {Object} offer\n */\nfunction updateOfferPriceR (offer) {\n  const quote = offer.balance.orderbook.quote\n\n  offer.price_r = {\n    n: nice(offer.price * 10000000000, 0),\n    d: nice(quote.price * 10000000000, 0)\n  }\n\n  // Ten characters maximum\n  while (offer.price_r.n > 999999999 || offer.price_r.d > 999999999) {\n    offer.price_r.n = nice(offer.price_r.n / 10, 0)\n    offer.price_r.d = nice(offer.price_r.d / 10, 0)\n  }\n}\n\n/**\n * Append Order.type to Order class\n */\n\nfor (let key in Order.type) {\n  if (!Order[key]) Order[key] = (...parameters) => new Order(key, ...parameters)\n}\n","\"use_strict\"\n/**\n * Compute portfolio data from Account object.\n */\nconst axios = require(\"@cosmic-plus/base/es5/axios\")\nconst cosmicLib = require(\"cosmic-lib\")\nconst Mirrorable = require(\"@cosmic-plus/jsutils/es5/mirrorable\")\nconst Projectable = require(\"@cosmic-plus/jsutils/es5/projectable\")\nconst { timeout } = require(\"@cosmic-plus/jsutils/es5/misc\")\nconst { __ } = require(\"@cosmic-plus/i18n\")\n\nconst Asset = require(\"./asset\")\nconst Balance = require(\"./balance\")\nconst global = require(\"./global\")\n// const History = require(\"./portfolio-history\")\nconst Offers = require(\"./offers\")\n\n/**\n * Class\n */\n\nmodule.exports = class Portfolio extends Projectable {\n  static async resolve (address) {\n    await checkNetwork()\n\n    const destination = await cosmicLib.resolve.address(address)\n    if (destination.memo)\n      throw new Error(__(\"Invalid federated address: shared account.\"))\n    if (await cosmicLib.resolve.isAccountEmpty(destination.account_id))\n      throw new Error(__(\"Empty account\"))\n\n    const portfolio = new Portfolio(destination.account_id)\n    cosmicLib.config.source = portfolio.address = address\n    portfolio.streamAccount()\n\n    return portfolio\n  }\n\n  constructor (accountId) {\n    super()\n\n    // eslint-disable-next-line no-console\n    console.log(this)\n\n    this.accountId = accountId\n    this.assets = new Mirrorable()\n    this.balances = new Mirrorable()\n    this.accountCallBuilder = Portfolio.accountCallBuilder(accountId)\n\n    this.define(\"total\", \"assets\", () => {\n      return this.assets\n        .filter(asset => asset.isSupported)\n        .reduce((sum, x) => sum + x.value, 0)\n    })\n    this.assets.mirror(asset =>\n      this.watch(asset, [\"value\", \"isSupported\"], () => this.compute(\"total\"))\n    )\n\n    this.new = true\n  }\n\n  static accountCallBuilder (accountId) {\n    const server = cosmicLib.resolve.server()\n    return server.accounts().accountId(accountId)\n  }\n\n  async streamAccount () {\n    // eslint-disable-next-line no-constant-condition\n    while (true) {\n      await this.getAccount()\n      await timeout(5000)\n    }\n  }\n\n  async getAccount () {\n    try {\n      const account = await this.accountCallBuilder.call()\n      this.ingest(account)\n    } catch (error) {\n      console.error(error)\n    }\n  }\n\n  async ingest (account) {\n    this.account = account\n\n    for (let index in account.balances) {\n      const balance = Balance.ingest(account.balances[index])\n      const asset = balance.asset\n\n      if (this.assets.indexOf(asset) === -1) {\n        this.assets.push(asset)\n        this.balances.push(balance)\n        asset.watch(this, \"total\", () => asset.compute(\"share\"))\n        asset.getInfo()\n      } else if (this.balances.indexOf(balance) === -1) {\n        this.balances.push(balance)\n      }\n    }\n\n    if (this.new) {\n      delete this.new\n      await Asset.refreshPrices()\n      this.offers = Offers.forPortfolio(this)\n      await this.offers.stream()\n      this.trigger(\"open\")\n    }\n  }\n}\n\n/**\n * Extension\n */\n\nAsset.define(\"share\", \"value\", function () {\n  return global.portfolio && this.value / global.portfolio.total\n})\n\n/**\n * Helpers\n */\n\nasync function checkNetwork () {\n  const horizon = cosmicLib.resolve.horizon()\n  try {\n    await axios.get(horizon)\n  } catch (error) {\n    throw new Error(__(\"Can't connect to the Stellar blockchain\"))\n  }\n}\n","\"use_strict\"\n/**\n * Anchor class\n */\nconst aliases = require(\"@cosmic-plus/base/es5/aliases\")\nconst helpers = require(\"@cosmic-plus/jsutils/es5/misc\")\nconst Projectable = require(\"@cosmic-plus/jsutils/es5/projectable\")\n\n/**\n * Class\n */\n\nconst Anchor = module.exports = class Anchor extends Projectable {\n  static resolve (address) {\n    return Anchor.all[address] || new Anchor(address)\n  }\n\n  constructor (address) {\n    super()\n\n    this.address = address\n    this.alias = aliases.all[address]\n    this.name = helpers.shorter(this.alias || this.address)\n    Anchor.all[address] = this\n\n    this.assets = {}\n  }\n}\n\nAnchor.all = {}\n\n/**\n * Known Anchors\n */\n\nAnchor.known = {\n  \"USD:GDUKMGUGDZQK6YHYA5Z6AY2G4XDSZPSZ3SW5UN3ARVMO6QSRDWP5YLEX\": \"USD\",\n  \"WSD:GDSVWEA7XV6M5XNLODVTPCGMAJTNBLZBXOFNQD3BNPNYALEYBNT6CE2V\": \"USD\",\n  \"USD:GDSRCV5VTM3U7Y3L6DFRP3PEGBNQMGOWSRTGSBWX6Z3H6C7JHRI4XFJP\": \"USD\",\n  \"USD:GBUYUAI75XXWDZEKLY66CFYKQPET5JR4EENXZBUZ3YXZ7DS56Z4OKOFU\": \"USD\",\n  \"CNY:GAREELUB43IRHWEASCFBLKHURCGMHE5IF6XSE7EXDLACYHGRHM43RFOX\": \"CNY\",\n  \"XCN:GCNY5OXYSY4FKHOPT2SPOQZAOEIGXB5LBYW3HVU3OWSTQITS65M5RCNY\": \"CNY\",\n  \"BCNY:GBCNYBHAAPDSU3UIHXXQTHYZVSBJBI4YUNWXMKJBCPDHTVYR75G6NFHD\": \"CNY\",\n  \"EURT:GAP5LETOV6YIE62YAM56STDANPRDO7ZFDBGSNHJQIYGGKSMOZAHOOS2S\": \"EUR\",\n\n  \"SLT:GCKA6K5PCQ6PNF5RQBF7PQDJWRHO6UOGFMRLK3DYHDOI244V47XKQ4GP\": null,\n  \"MOBI:GA6HCMBLTZS5VYYBCATRBRZ3BZJMAFUDKYYF6AH6MVCMGWMRDNSWJPIH\": null,\n  \"SHX:GDSTRSHXHGJ7ZIVRBXEYE5Q74XUVCUSEKEBR7UCHEUUEK72N7I7KJ6JH\": null,\n  \"RMT:GDEGOXPCHXWFYY234D2YZSPEJ24BX42ESJNVHY5H7TWWQSYRN5ZKZE3N\": null,\n  \"TERN:GDGQDVO6XPFSY4NMX75A7AOVYCF5JYGW2SHCJJNWCQWIDGOZB53DGP6C\": null,\n  \"PEDI:GBVUDZLMHTLMZANLZB6P4S4RYF52MVWTYVYXTQ2EJBPBX4DZI2SDOLLY\": null,\n  \"GRAT:GAJ7V3EMD3FRWAPBEJAP7EC4223XI5EACDZ46RFMY5DYOMCIMWEFR5II\": null,\n  \"REPO:GCZNF24HPMYTV6NOEHI7Q5RJFFUI23JKUKY3H3XTQAFBQIBOHD5OXG3B\": null,\n\n  \"BTC:GATEMHCCKCY67ZUCKTROYN24ZYT5GK4EQZ65JJLDHKHRUZI3EUEKMTCH\": null,\n  \"BTC:GAUTUYY2THLF7SGITDFMXJVYH3LHDSMGEAKSBU267M2K7A3W543CKUEF\": null,\n  \"BTC:GCNSGHUCG5VMGLT5RIYYZSO7VQULQKAJ62QA33DBC5PPBSO57LFWVV6P\": null,\n  \"BTC:GBVOL67TMUQBGL4TZYNMY3ZQ5WGQYFPFD5VJRWXR72VA33VFNL225PL5\": null,\n  \"ETH:GCNSGHUCG5VMGLT5RIYYZSO7VQULQKAJ62QA33DBC5PPBSO57LFWVV6P\": null,\n  \"ETH:GBVOL67TMUQBGL4TZYNMY3ZQ5WGQYFPFD5VJRWXR72VA33VFNL225PL5\": null,\n  \"ETH:GBETHKBL5TCUTQ3JPDIYOZ5RDARTMHMEKIO2QZQ7IOZ4YC5XV3C2IKYU\": null,\n  \"ETH:GBDEVU63Y6NTHJQQZIKVTC23NWLQVP3WJ2RI2OTSJTNYOIGICST6DUXR\": null,\n  \"LTC:GC5LOR3BK6KIOK7GKAUD5EGHQCMFOGHJTC7I3ELB66PTDFXORC2VM5LP\": null,\n  \"LTC:GBVOL67TMUQBGL4TZYNMY3ZQ5WGQYFPFD5VJRWXR72VA33VFNL225PL5\": null,\n  \"LTC:GCNSGHUCG5VMGLT5RIYYZSO7VQULQKAJ62QA33DBC5PPBSO57LFWVV6P\": null,\n  \"XRP:GBVOL67TMUQBGL4TZYNMY3ZQ5WGQYFPFD5VJRWXR72VA33VFNL225PL5\": null,\n  \"XRP:GCNSGHUCG5VMGLT5RIYYZSO7VQULQKAJ62QA33DBC5PPBSO57LFWVV6P\": null,\n  \"KIN:GBDEVU63Y6NTHJQQZIKVTC23NWLQVP3WJ2RI2OTSJTNYOIGICST6DUXR\": null,\n  \"BAT:GBDEVU63Y6NTHJQQZIKVTC23NWLQVP3WJ2RI2OTSJTNYOIGICST6DUXR\": null,\n  \"ZRX:GBDEVU63Y6NTHJQQZIKVTC23NWLQVP3WJ2RI2OTSJTNYOIGICST6DUXR\": null,\n  \"BCH:GAEGOS7I6TYZSVHPSN76RSPIVL3SELATXZWLFO4DIAFYJF7MPAHFE7H4\": null,\n  \"STEEM:GB3KBOFUCVTWEZ7YIZ7PAKLQMKPCTGWU3LOMANMCT7V6I3AAK4USTEEM\": null,\n  \"SBD:GB3KBOFUCVTWEZ7YIZ7PAKLQMKPCTGWU3LOMANMCT7V6I3AAK4USTEEM\": null,\n  \"LINK:GBDEVU63Y6NTHJQQZIKVTC23NWLQVP3WJ2RI2OTSJTNYOIGICST6DUXR\": null\n}\n","\"use_strict\"\n/**\n * Account offers\n */\n\nconst cosmicLib = require(\"cosmic-lib\")\nconst loopcall = require(\"@cosmic-plus/loopcall\")\nconst Mirrorable = require(\"@cosmic-plus/jsutils/es5/mirrorable\")\nconst nice = require(\"@cosmic-plus/jsutils/es5/nice\")\nconst Projectable = require(\"@cosmic-plus/jsutils/es5/projectable\")\nconst hiddenKey = require(\"@cosmic-plus/jsutils/es5/misc\").setHiddenProperty\nconst { day } = require(\"@cosmic-plus/jsutils/es5/misc\")\n\nconst Asset = require(\"./asset\")\nconst Balance = require(\"./balance\")\n\n/**\n * Class\n */\n\nclass Offers extends Mirrorable {\n  static forPortfolio (portfolio) {\n    const offers = Offers.forAccount(portfolio.accountId)\n    hiddenKey(offers, \"portfolio\", portfolio)\n    return offers\n  }\n\n  static forAccount (accountId) {\n    const offers = new Offers()\n    hiddenKey(offers, \"accountId\", accountId)\n    hiddenKey(offers, \"callBuilder\", Offers.callBuilder(accountId))\n    return offers\n  }\n\n  static callBuilder (accountId) {\n    const server = cosmicLib.resolve.server()\n    return server.offers(\"accounts\", accountId)\n  }\n\n  async stream (delay = 15000) {\n    // Resolves after first get().\n    return this.get().then(() => setTimeout(() => this.stream(), delay))\n  }\n\n  async get () {\n    try {\n      const records = await loopcall(this.callBuilder, { limit: 200 })\n      this.ingest(records)\n    } catch (error) {\n      console.error(error)\n    }\n  }\n\n  ingest (records) {\n    this.forEach(offer => offer.alive = false)\n    const offers = records.map(record => Offer.ingest(record)).filter(x => x)\n    this.splice(0, 0, ...offers)\n    this.clean()\n  }\n\n  clean () {\n    for (let index = this.length - 1; index > -1; index--) {\n      const offer = this[index]\n      if (!offer.alive) {\n        this.splice(index, 1)\n        offer.destroy()\n      }\n    }\n  }\n}\n\nclass Offer extends Projectable {\n  static resolve (record) {\n    return Offer.table[recordToId(record)]\n  }\n\n  static ingest (record) {\n    const offer = Offer.resolve(record)\n    if (offer) offer.update(record)\n    else return new Offer(record)\n  }\n\n  constructor (record) {\n    super()\n\n    this.intern = recordToId(record)\n    Offer.table[this.intern] = this\n\n    const quote = Asset.resolve(\"XLM\")\n    const asset = record.buying.asset_code ? record.buying : record.selling\n    this.balance = Balance.resolve(asset.asset_code, asset.asset_issuer)\n    this.asset = this.balance.asset\n    this.side = record.buying.asset_code ? \"buy\" : \"sell\"\n\n    this.define(\n      \"price\",\n      \"rawPrice\",\n      this.side === \"sell\"\n        ? () => quote.price * this.rawPrice\n        : () => quote.price / this.rawPrice\n    )\n    this.watch(quote, \"price\", () => this.compute(\"price\"))\n\n    this.update(record)\n\n    this.balance.offers.push(this)\n    this.asset.offers.push(this)\n\n    this.listen(\"destroy\", () => {\n      delete Offer.table[this.intern]\n      this.balance.offers.splice(this.balance.offers.indexOf(this), 1)\n      this.asset.offers.splice(this.asset.offers.indexOf(this), 1)\n    })\n  }\n\n  update (record) {\n    Object.assign(this, record)\n    this.alive = true\n\n    this.rawPrice = record.price\n    this.compute(\"price\")\n    this.rawAmount = record.amount\n    if (this.side === \"buy\") {\n      this.amount = nice(this.rawAmount * this.rawPrice, 7)\n    }\n\n    this.date = day(this.last_modified_time)\n    this.outdated = this.date !== day()\n  }\n}\n\nOffer.table = {}\n\n/**\n * Helpers\n */\n\nfunction recordToId (record) {\n  return `${record.id}-${record.last_modified_ledger}`\n}\n\n/**\n * Export\n */\n\nmodule.exports = Offers\n","\"use_strict\"\n/**\n * Overlay that prevent user interaction\n */\nconst clickWall = module.exports\n\nconst html = require(\"@cosmic-plus/domutils/es5/html\")\n\nconst overlay = html.create(\"div\", { hidden: true })\nhtml.append(document.body, overlay)\n\nObject.assign(overlay.style, {\n  position: \"fixed\",\n  zIndex: 999,\n  top: 0,\n  width: \"100%\",\n  height: \"100%\"\n})\n\nclickWall.enable = () => html.show(overlay)\nclickWall.disable = () => html.hide(overlay)\n","\"use_strict\"\n\nconst Projectable = require(\"@cosmic-plus/jsutils/es5/projectable\")\n\n/**\n * Bind **$input**'s **nodeKey** to **object** **objKey**. If **nodeKey** is not\n * provided, the default value is used.\n */\nmodule.exports = function bindnodeKey (object, objKey, $input, nodeKey) {\n  const binder = bind[$input.tagName]\n  if (binder) binder(object, objKey, $input, nodeKey)\n  else object[objKey] = $input[nodeKey || \"value\"]\n}\n\n/**\n * Element-specific binders\n */\nconst bind = {}\n\nbind.SELECT = function (object, objKey, $select, nodeKey = \"value\") {\n  object[objKey] = $select[nodeKey]\n  if (bind.SELECT.interactive.indexOf(nodeKey) !== -1) {\n    importKeyOn(\"change\", object, objKey, $select, nodeKey)\n  }\n}\nbind.SELECT.interactive = [\"selectedIndex\", \"selectedOptions\", \"value\"]\n\nbind.TEXTAREA = function (object, objKey, $textarea, nodeKey = \"value\") {\n  object[objKey] = $textarea[nodeKey]\n  if (nodeKey === \"value\") {\n    importKeyOn(\"input\", object, objKey, $textarea, nodeKey)\n  }\n}\n\nbind.INPUT = function (object, objKey, $input, nodeKey) {\n  object[objKey] = $input[nodeKey]\n  if ($input.type === \"radio\") {\n    bind.radio(...arguments)\n  } else if ($input.type === \"checkbox\") {\n    bind.checkbox(...arguments)\n  } else if (!nodeKey || nodeKey === \"value\") {\n    importKeyOn(\"input\", object, objKey, $input, nodeKey || \"value\")\n  }\n}\n\nbind.radio = function (object, objKey, $radio) {\n  const setter = () => {\n    if ($radio.checked) object[objKey] = $radio.value\n  }\n  $radio.addEventListener(\"change\", setter)\n  setter()\n}\n\nbind.checkBox = function (object, objKey, $checkbox, nodeKey = \"checked\") {\n  object[objKey] = $checkbox[nodeKey]\n  if (nodeKey === \"checked\") {\n    importKeyOn(\"change\", object, objKey, $checkbox, nodeKey)\n  }\n}\n\n/**\n * Event setter.\n */\nfunction importKeyOn (eventName, object, objKey, $input, nodeKey) {\n  $input.addEventListener(eventName, () => {\n    object[objKey] = $input[nodeKey]\n    $input.setCustomValidity(\"\")\n  })\n  if (object instanceof Projectable) {\n    object.link(objKey, $input, nodeKey, null, { init: false })\n  }\n}\n","\"use_strict\"\n\nconst { timeout } = require(\"@cosmic-plus/jsutils/es5/misc\")\n\nconst html = require(\"./html-extra\")\n\n/**\n * Walk **$node** tree and handle extra attributes for each domNode. Extra\n * attributes are:\n *\n * * alias:  Define an identifier for the local context.\n * * label:  Enclose the node into a dedicated label element.\n */\nmodule.exports = function walkNodeTree ($node) {\n  const aliases = {}\n  html.walk($node, handleExtraAttributes, aliases)\n  return aliases\n}\n\nfunction handleExtraAttributes ($node, aliases) {\n  setAliases($node, aliases)\n  handleLabel($node)\n  handleValidate($node)\n}\n\n/**\n * Bind **$node** to **aliases** properties for to its className, alias, name\n * and/or id.\n */\nfunction setAliases ($node, aliases) {\n  // Ordered by priority\n  if ($node.className) {\n    if (!aliases[$node.className]) aliases[$node.className] = []\n    aliases[$node.className].push($node)\n  } else if ($node.alias) {\n    aliases[$node.alias] = $node\n    delete aliases[$node.alias]\n  } else if ($node.name) {\n    aliases[$node.name] = $node\n  } else if ($node.id) {\n    aliases[$node.id] = $node\n  }\n}\n\n/**\n * Enclose **$node** into its own label if it has a `label=` attribute.\n */\nfunction handleLabel ($node) {\n  // `<option>` tags have a `label` attribute in HTML5.\n  if (!$node.label || $node.tagName === \"OPTION\") return\n\n  const $label = html.element(\"label\", { for: $node })\n  const $span = html.element(\"span\", $node.label)\n  html.replace($node, $label)\n  html.append($label, $span, $node)\n  delete $node.label\n}\n\n/**\n * Setup automatic validation using **$node**'s validate function.\n */\nfunction handleValidate ($node) {\n  const validate = $node.validate\n  if (!validate || !$node.hasProperty(\"oninput\")) return\n\n  $node.addEventListener(\"input\", () => {\n    $node.setCustomValidity(\"\")\n    timeout(0).then(() => validateNodeValue($node, validate))\n  })\n  delete $node.validate\n}\n\nfunction validateNodeValue ($node, validate) {\n  try {\n    validate($node.value)\n  } catch (error) {\n    $node.setCustomValidity(error.message)\n    $node.reportValidity()\n    console.error(error)\n  }\n}\n","\"use_strict\"\n/**\n * Various helpers\n */\n\nconst helpers = exports\n\nhelpers.isOverflowing = function (element) {\n  return (\n    element.scrollHeight > element.clientHeight\n    || element.scrollWidth > element.clientWidth\n  )\n}\n","\"use_strict\"\n/**\n * Activity Gui\n */\n\nconst Gui = require(\"@cosmic-plus/domutils/es5/gui\")\nconst nice = require(\"@cosmic-plus/jsutils/es5/nice\")\nconst Tabs = require(\"@cosmic-plus/domutils/es5/tabs\")\nconst { __ } = require(\"@cosmic-plus/i18n\")\nconst { CosmicLink } = require(\"cosmic-lib\")\n\nconst SideFrame = require(\"./helpers/side-frame\")\nconst global = require(\"./logic/global\")\n\n/**\n * Class\n */\n\nclass ActivityGui extends Gui {\n  constructor (portfolio) {\n    super(`\n<section>\n  <h2>${__(\"Activity\")}</h2>\n  %selector\n  %view\n</section>\n    `)\n\n    this.portfolio = portfolio\n\n    const tabs = new Tabs()\n    // tabs.project([\"selector\", \"view\"], this)\n    tabs.project(\"view\", this)\n\n    tabs.add(\n      \"offers\",\n      __(\"Open Orders\"),\n      new ActivityGui.Offers(portfolio),\n      \"select\"\n    )\n    // tabs.add(\"orders\", __(\"Orders\"), new ActivityGui.Orders(portfolio))\n    // tabs.add(\"transfers\", __(\"Transfers\"), new ActivityGui.Transfers(portfolio))\n    // tabs.select(__(\"Orders\"))\n  }\n}\n\nActivityGui.Offers = class ActivityOffers extends Gui {\n  constructor (portfolio) {\n    super(`\n<section>\n  <table>\n    <tr>\n      <th>${__(\"Date\")}</th>\n      <th>${__(\"Asset\")}</th>\n      <th>${__(\"Direction\")}</th>\n      <th>${__(\"Amount\")}</th>\n      <th>${__(\"Price\")} (%globalCurrency)</th>\n    </tr>\n    %formatOffer:offers...\n    <tr><td colspan=\"5\" align=\"center\" onclick=%cancelOffers>\n      <h3>${__(\"Cancel All\")}</h3>\n    </td></tr>\n  </table>\n</section>\n\n<p class=\"note\">\n  ${__(\"All orders are passed against Stellar Lumens (XLM).\")}\n  ${__(\n    \"For your comfort, prices are displayed in their %%globalCurrency equivalent.\"\n  )}\n  ${__(\n    \"However, those converted values will change according to XLM price movement.\"\n  )}\n</p>\n    `)\n\n    this.portfolio = portfolio\n    this.offers = portfolio.offers\n    this.globalCurrency = global.currency\n  }\n\n  formatOffer (offer) {\n    return new ActivityGui.Offer(offer)\n  }\n\n  cancelOffers () {\n    if (!this.offers.length) return\n\n    const txParams = {\n      memo: \"Equilibre.io\",\n      network: \"public\",\n      maxTime: \"+5\",\n      source: this.portfolio.accountId\n    }\n\n    const cosmicLink = new CosmicLink(txParams)\n    this.offers.forEach(offer => {\n      cosmicLink.addOperation(\"manageOffer\", { offerId: offer.id, amount: 0 })\n    })\n\n    const sideFrame = new SideFrame(cosmicLink.uri)\n    sideFrame.listen(\"destroy\", () => {\n      this.portfolio.getAccount()\n      this.portfolio.offers.get()\n    })\n  }\n}\n\nActivityGui.Offer = class ActivityOffer extends Gui {\n  constructor (offer) {\n    super(`\n<tr>\n  <td>%formatDate:last_modified_time</td>\n  <td>\n    <img src=%image alt=\"\">\n    <span>%name / %anchor</span>\n  </td>\n  <td>%side</td>\n  <td align=\"right\">%nice:amount</td>\n  <td align=\"right\">%nice:price</td>\n</tr>\n    `)\n\n    this.offer = offer\n    offer.project([\"last_modified_time\", \"amount\", \"price\"], this)\n\n    this.name = offer.asset.code\n    this.side = offer.side === \"buy\" ? __(\"Buy\") : __(\"Sell\")\n    this.anchor = offer.balance.anchor.name\n    offer.asset.link(\"image\", this)\n  }\n\n  nice (number) {\n    return nice(number)\n  }\n\n  formatDate (value) {\n    const date = value ? new Date(value) : new Date()\n    return date.toLocaleDateString()\n  }\n}\n\n// ## Unused code\n//\n// ActivityGui.Orders = class ActivityOrders extends Gui {\n//   constructor (portfolio) {\n//     super(`\n// <table>\n//   <tr>\n//     <th>${__(\"Date\")}</th>\n//     <th>${__(\"Asset\")}</th>\n//     <th>${__(\"Direction\")}</th>\n//     <th>${__(\"Amount\")}</th>\n//     <th>${__(\"Price\")}</th>\n//   </tr>\n//   <tr>\n//     <td colspan=\"6\"><h3><i18n>${__(\"Open Orders\")}</i18n></h3></td>\n//   </tr>\n//   %openOrders...\n//   <tr>\n//     <td colspan=\"6\"><h3><i18n>${__(\"Completed Orders\")}</i18n></h3></td>\n//   </tr>\n//   %completedOrders...\n// </table>\n//     `)\n//     this.portfolio = portfolio\n//   }\n// }\n\n// ActivityGui.Transfers = class ActivityTransfers extends Gui {\n//   constructor (portfolio) {\n//     super(`\n// <table>\n//   <tr>\n//     <th>${__(\"Date\")}</th>\n//     <th>${__(\"Asset\")}</th>\n//     <th>${__(\"With\")}</th>\n//     <th>${__(\"Amount\")}</th>\n//   </tr>\n//   %transfers...\n// </table>\n//     `)\n//     this.portfolio = portfolio\n//   }\n// }\n\n/**\n * Export\n */\n\nmodule.exports = ActivityGui\n","\"use_strict\"\n/**\n * Portfolio Graphical User Interface\n */\nconst Highcharts = require(\"highcharts\")\nconst Highstock = require(\"highcharts/highstock\")\nrequire(\"./highcharts-theme\")\n\nconst Gui = require(\"@cosmic-plus/domutils/es5/gui\")\nconst nice = require(\"@cosmic-plus/jsutils/es5/nice\")\nconst Tabs = require(\"@cosmic-plus/domutils/es5/tabs\")\nconst { __ } = require(\"@cosmic-plus/i18n\")\n\nconst AssetGui = require(\"./asset-gui\")\nconst global = require(\"./logic/global\")\nconst marketData = require(\"./logic/market-data\")\n\n/**\n * Class\n */\n\nclass PortfolioGui extends Gui {\n  constructor (portfolio) {\n    super(`\n<section><h2>${__(\"Portfolio\")}: %total %currency</h2>\n  %summary\n  %chart\n\n  <p class=\"note\" align=\"center\">\n    ${__(\"Anchor prices are from Stellar DEX\")} /\n    ${__(\"Global prices are from %%coingecko when available.\")}\n    </p>\n\n</section>`)\n\n    this.portfolio = portfolio\n\n    portfolio.project(\"total\", this, x => nice(x, 2))\n    this.currency = global.currency\n    this.summary = new PortfolioGui.Summary(this)\n    this.coingecko = new Gui(\n      `<a target=\"_blank\" rel=\"noopener\" href=\"https://coingecko.com\">coingecko</a>`\n    )\n  }\n\n  select (asset) {\n    if (this.chart) this.chart.destroy()\n    if (asset && asset.globalPrice && asset.code !== global.currency) {\n      this.chart = new PortfolioGui.Chart(asset)\n    } else {\n      this.chart = null\n    }\n  }\n}\n\nPortfolioGui.Summary = class PortfolioSummary extends Gui {\n  constructor (parent) {\n    const tabs = new Tabs()\n    super(`%nav <section>%view</section>`, tabs)\n\n    tabs.add(\"table\", __(\"Table\"), new PortfolioGui.Table(parent))\n    tabs.add(\"graph\", __(\"Graph\"), () => new PortfolioGui.Graph(parent))\n    tabs.listen(\"select\", id => localStorage[\"PortfolioSummary.tab\"] = id)\n    tabs.select(localStorage[\"PortfolioSummary.tab\"] || \"table\")\n  }\n}\n\nPortfolioGui.Table = class PortfolioTable extends Gui {\n  constructor (parent) {\n    super(`\n<table>\n  <tr>\n    <th>${__(\"Name\")}</th>\n    <th>${__(\"Anchor\")}</th>\n    <th>${__(\"Amount\")}</th>\n    <th>${__(\"Price\")}</th>\n    <th>${__(\"Value\")}</th>\n  </tr>\n  %assetsGui...\n</table>\n`)\n\n    this.parent = parent\n\n    this.assetsGui = parent.portfolio.assets.mirror(asset => {\n      const assetGui = new AssetGui(asset)\n      assetGui.domNode.onclick = () => this.select(assetGui)\n      return assetGui\n    })\n\n    this.watch(parent.portfolio, \"total\", () => this.sort())\n  }\n\n  sort () {\n    this.assetsGui.sort((a, b) => b.asset.value - a.asset.value)\n  }\n\n  select (assetGui) {\n    if (this.selected) {\n      this.selected.domNode.className = \"\"\n      this.selected.simpleView()\n    }\n\n    if (this.selected === assetGui) {\n      this.parent.select()\n      this.selected = null\n    } else {\n      this.parent.select(assetGui.asset)\n      assetGui.domNode.className = \"selected\"\n      this.selected = assetGui\n      assetGui.detailledView()\n    }\n  }\n}\n\nPortfolioGui.Graph = class PortfolioGraph extends Gui {\n  constructor (parent) {\n    super(`<div -ref=%container align=\"center\"></div>`)\n    this.parent = parent\n\n    this.listen(\"destroy\", () => this.chart && this.chart.destroy())\n    this.watch(parent.portfolio, \"total\", () => {\n      // For some unknow reason the timeout makes the chart draw better.\n      setTimeout(() => this.makePie(), 1)\n    })\n  }\n\n  makePie () {\n    if (this.chart) this.chart.destroy()\n\n    this.chart = Highcharts.chart(this.container, {\n      title: \"\",\n      legend: { enabled: false },\n      chart: { type: \"pie\" },\n      tooltip: {\n        pointFormat: `\n${__(\"Amount\")}: {point.amount} {point.code}<br>\n${__(\"Price\")}: {point.price} ${global.currency}<br>\n<b>${__(\"Value\")}: {point.y} ${global.currency}</b>\n`\n      },\n\n      plotOptions: {\n        pie: {\n          dataLabels: {\n            format: \"{point.amount} {point.code}<br>({point.percentage:.0f}%)\"\n          },\n          point: {\n            events: {\n              select: x => this.parent.select(x.target.options.asset),\n              legendItemClick: () => false\n            }\n          }\n        }\n      },\n\n      series: [\n        {\n          name: __(\"Amount\"),\n          colorByPoint: true,\n          ignoreHiddenPoint: true,\n          data: this.parent.portfolio.assets\n            .filter(asset => asset.value)\n            .map(makeAssetPoint)\n            .sort((a, b) => b.y - a.y)\n        }\n      ]\n    })\n  }\n}\n\nfunction makeAssetPoint (asset) {\n  return {\n    name: asset.name,\n    code: asset.code,\n    asset: asset,\n    y: +nice(asset.value, 2),\n    amount: nice(asset.amount),\n    price: nice(asset.price),\n    percentage: asset.percentage\n  }\n}\n\nPortfolioGui.Chart = class PortfolioChart extends Gui {\n  constructor (asset) {\n    super(`\n      <section><h3>${asset.code} ${__(\"to\")} ${global.currency}</h3>\n        <div -ref=%container><p>${__(\"Loading...\")}</p></div>\n      </section>\n    `)\n\n    this.asset = asset\n    this.listen(\"destroy\", () => this.chart && this.chart.destroy())\n    marketData.assetHistory(asset).then(data => this.makeChart(data))\n  }\n\n  makeChart (data) {\n    this.chart = Highstock.stockChart(this.container, {\n      rangeSelector: { selected: 2 },\n      chart: {\n        backgroundColor: \"#fbfbfd\"\n      },\n      yAxis: [\n        { labels: { align: \"left\" }, height: \"80%\", resize: { enabled: true } },\n        { labels: { align: \"left\" }, top: \"80%\", height: \"20%\", offset: 0 }\n      ],\n      series: [\n        {\n          type: \"spline\",\n          name: \"Price\",\n          data: data.map(x => [x.time, +nice(x.price)])\n        },\n        {\n          type: \"column\",\n          name: \"Volume\",\n          data: data.map(x => [x.time, x.volume]),\n          yAxis: 1\n        }\n      ],\n      credits: { enabled: false }\n    })\n  }\n}\n\n/**\n * Export\n */\n\nmodule.exports = PortfolioGui\n","\"use_strict\"\n/**\n * Theme for Highchart\n */\n\nconst Highcharts = require(\"highcharts\")\n\nHighcharts.theme = {\n  chart: { backgroundColor: \"#fbfbfd\" },\n  tooltip: { style: { fontSize: \"14px\" } },\n  credits: { enabled: false },\n\n  plotOptions: {\n    pie: {\n      allowPointSelect: true,\n      animation: false,\n      cursor: \"pointer\",\n      dataLabels: { style: { fontSize: \"14px\" } }\n    }\n  },\n\n  responsive: {\n    rules: [\n      {\n        condition: {\n          maxWidth: 500\n        },\n        chartOptions: {\n          legend: { enabled: true },\n          plotOptions: {\n            pie: {\n              showInLegend: true,\n              dataLabels: {\n                format: \"{point.percentage:.0f}%\",\n                distance: -20\n              }\n            }\n          }\n        }\n      }\n    ]\n  },\n\n  colors: [\n    \"rgba(231,  76,  60, 0.8)\",\n    \"rgba(230, 126,  34, 0.8)\",\n    \"rgba(242, 202,  39, 0.8)\",\n    \"rgba(46,  204, 112, 0.8)\",\n    \"rgba(52,  152, 219, 0.8)\",\n    \"rgba(155,  89, 182, 0.8)\",\n\n    \"rgba(231,  76,  60, 0.6)\",\n    \"rgba(230, 126,  34, 0.6)\",\n    \"rgba(242, 202,  39, 0.6)\",\n    \"rgba(46,  204, 112, 0.6)\",\n    \"rgba(52,  152, 219, 0.6)\",\n    \"rgba(155,  89, 182, 0.6)\",\n\n    \"rgba(231,  76,  60, 0.4)\",\n    \"rgba(230, 126,  34, 0.4)\",\n    \"rgba(242, 202,  39, 0.4)\",\n    \"rgba(46,  204, 112, 0.4)\",\n    \"rgba(52,  152, 219, 0.4)\",\n    \"rgba(155,  89, 182, 0.4)\"\n  ]\n}\n\nHighcharts.setOptions(Highcharts.theme)\n","\"use_strict\"\n/**\n * Asset GUI\n */\nconst Gui = require(\"@cosmic-plus/domutils/es5/gui\")\nconst html = require(\"@cosmic-plus/domutils/es5/html\")\nconst nice = require(\"@cosmic-plus/jsutils/es5/nice\")\nconst msg = require(\"@cosmic-plus/i18n\").__\n\n/**\n * Class\n */\n\nclass AssetGui extends Gui {\n  constructor (asset) {\n    super(`\n<tr %style>\n  <td align=\"left\">\n    <img src=%image alt=\"\">\n    <span>%name</span>\n  </td>\n  <td align=\"left\">\n    <div hidden=%simple>%anchors...</div>\n    <div %class>%anchorTotal</div>\n  </td>\n  <td align=\"right\">\n    <div hidden=%simple>%amounts...</div>\n    <div %class>%amountTotal</div>\n  </td>\n  <td align=\"right\">\n    <div hidden=%simple>%prices...</div>\n    <div %class title=%priceDetails>%priceTotal</div>\n  </td>\n  <td align=\"right\">\n    <div hidden=%simple>%values...</div>\n    <div %class>%valueTotal</div>\n  </td>\n</tr>\n    `)\n\n    this.asset = asset\n\n    this.name = asset.code\n    this.anchors = asset.balances.mirror(x => cell(x.anchor, \"name\"))\n    this.amounts = asset.balances.mirror(x => cell(x, \"amount\", nice))\n    this.prices = asset.balances.mirror(x => priceCell(x, \"price\", nice))\n    this.values = asset.balances.mirror(x => cell(x, \"value\", x => nice(x, 2)))\n    asset.link(\"image\", this)\n    asset.link(\"amount\", this, \"amountTotal\", nice)\n    asset.link(\"price\", this, \"priceTotal\", nice)\n    asset.link(\"value\", this, \"valueTotal\", x => nice(x, 2))\n    asset.anchors.feed(this, \"anchorHeader\", anchorName)\n\n    const orderbook = this.asset.orderbook\n    this.define(\"priceDetails\", \"orderbook\", () => priceDetails(orderbook))\n    this.watch(orderbook, [\"bestAsk\", \"bestBid\", \"spread%\"], () => {\n      this.compute(\"priceDetails\")\n    })\n\n    this.simpleView()\n  }\n\n  simpleView () {\n    this.simple = true\n    this.class = \"\"\n    this.anchorTotal = this.anchorHeader\n  }\n\n  detailledView () {\n    this.simple = false\n    this.class = \"footer\"\n    this.anchorTotal = \"Total\"\n  }\n}\n\n/**\n * Export\n */\n\nmodule.exports = AssetGui\n\n/**\n * Helpers\n */\n\nfunction anchorName (anchors) {\n  if (anchors.length === 1) return anchors[0].name\n  else return `${msg(\"Multiple\")} (${anchors.length})`\n}\n\nfunction cell (object, key, func) {\n  const node = html.create(\"div\", null, object[key])\n  object.link(key, node, \"textContent\", func)\n  return node\n}\n\nfunction priceCell (object, key, func) {\n  const node = cell(object, \"price\", func)\n  object.trap(\"orderbook\", () => {\n    if (object.orderbook) {\n      object.orderbook.trap([\"bestAsk\", \"bestBid\", \"spread%\"], () => {\n        node.title = priceDetails(object.orderbook)\n      })\n    }\n  })\n  return node\n}\n\nfunction priceDetails (orderbook) {\n  if (orderbook.base.code === \"XLM\") return \"\"\n  return `\nBuy: ${nice(orderbook.bestBid)} \\\n- Sell: ${nice(orderbook.bestAsk)} \\\n- Spread: ${nice(orderbook[\"spread%\"], 2)}%\n  `\n}\n","\"use_strict\"\n/**\n * Settings Graphical User Interface\n */\nconst Gui = require(\"@cosmic-plus/domutils/es5/gui\")\nconst { __ } = require(\"@cosmic-plus/i18n\")\n\nconst Form = require(\"./helpers/form\")\nconst global = require(\"./logic/global\")\n\n/**\n * Available translations.\n */\nconst languages = {\n  us: \"English\",\n  fr: \"Franais\"\n}\n\n/**\n * Possible reference currencies.\n */\nconst currencies = [\n  \"AUD\",\n  \"BGN\",\n  \"BRL\",\n  \"CAD\",\n  \"CHF\",\n  \"CNY\",\n  \"CZK\",\n  \"DKK\",\n  \"EUR\",\n  \"GBP\",\n  \"HKD\",\n  \"HRK\",\n  \"HUF\",\n  \"IDR\",\n  \"ILS\",\n  \"INR\",\n  \"ISK\",\n  \"JPY\",\n  \"KRW\",\n  \"MXN\",\n  \"MYR\",\n  \"NOK\",\n  \"NZD\",\n  \"PHP\",\n  \"PLN\",\n  \"RON\",\n  \"RUB\",\n  \"SEK\",\n  \"SGD\",\n  \"THB\",\n  \"TRY\",\n  \"USD\",\n  \"ZAR\"\n]\n\n/**\n * Class\n */\n\nclass SettingsGui extends Gui {\n  constructor () {\n    super(`\n      <section><h2>${__(\"Settings\")}</h2>\n        <section><h3>${__(\"General Settings\")}</h3>\n          %general\n        </section>\n      </section>\n    `)\n\n    this.general = new GeneralSettings(global)\n  }\n}\n\nclass GeneralSettings extends Form {\n  constructor (global) {\n    super(\n      Form.selector({\n        label: __(\"Language\"),\n        name: \"language\",\n        values: languages\n      }),\n      Form.selector({\n        label: __(\"Currency\"),\n        name: \"currency\",\n        values: currencies\n      })\n    )\n\n    // Two-way binding.\n    global.project([\"currency\", \"language\"], this)\n    this.project([\"currency\", \"language\"], global)\n\n    // Refresh interface.\n    this.listen(\"change\", () => location.reload())\n  }\n}\n\n/**\n * Export\n */\n\nmodule.exports = SettingsGui\n","\"use_strict\"\n/**\n * Target Graphical User Interface\n */\nconst Gui = require(\"@cosmic-plus/domutils/es5/gui\")\nconst i18n = require(\"@cosmic-plus/i18n\")\nconst html = require(\"@cosmic-plus/domutils/es5/html\")\nconst { __ } = i18n\n\nconst SideFrame = require(\"./helpers/side-frame\")\nconst Order = require(\"./logic/order\")\nconst Target = require(\"./logic/target\")\nconst TargetGui = require(\"./target-gui\")\n\n/**\n * Class\n */\n\nclass RebalanceGui extends Gui {\n  constructor (portfolio) {\n    super(`\n<section class=\"RebalanceGui\">\n  <h2>${__(\"Rebalance\")}</h2>\n\n  %table\n\n  %setup\n\n  <section hidden=%hideControls>\n    <form onsubmit=\"return false\" hidden=%hideRebalance>\n      <button onclick=%rebalance disabled=%invalid>${__(\"Rebalance\")}</button>\n    </form>\n\n    <form onsubmit=\"return false\" hidden=%hideApply>\n      <button onclick=%apply disabled=%invalid>${__(\"Save\")}</button>\n      <button onclick=%cancel>${__(\"Cancel\")}</button>\n    </form>\n\n    %toParagraph:error\n  </section>\n\n</section>\n    `)\n\n    this.portfolio = portfolio\n\n    // Load & bind template from localStorage.\n    const targetKey = `target:${portfolio.account.id}`\n    const template = localStorage[targetKey]\n    this.target = Target.forPortfolio(portfolio, template)\n    this.target.link(\"json\", localStorage, targetKey, null, { init: false })\n\n    // Targets table.\n    this.table = new RebalanceGui.Table(this.target)\n    this.table.project(\"selected\", this)\n    this.project(\"selected\", this.table)\n\n    // Target Setup.\n    this.trap(\"selected\", () => {\n      if (this.setup) this.setup.destroy()\n      if (this.selected) {\n        this.setup = new TargetGui.Setup(this.selected)\n        this.setup.listen(\"close\", () => this.selected = null)\n      } else {\n        this.setup = null\n      }\n    })\n\n    // Control Panel.\n    this.target.project([\"error\", \"modified\"], this)\n\n    this.define(\"hideControls\", [\"hideRebalance\", \"hideApply\"], () => {\n      return this.hideRebalance && this.hideApply\n    })\n    this.define(\"hideRebalance\", [\"selected\", \"modified\"], () => {\n      return this.selected || this.modified\n    })\n    this.define(\"hideApply\", [\"selected\", \"modified\"], () => {\n      return this.selected || !this.modified\n    })\n    this.define(\"invalid\", [\"error\"], () => !!this.error)\n  }\n\n  toParagraph (error) {\n    if (error) return html.create(\"p\", \".error\", error)\n  }\n\n  cancel () {\n    location.reload()\n  }\n\n  apply () {\n    this.target.json = this.target.toJson()\n    this.target.modified = false\n  }\n\n  rebalance () {\n    // TODO: Move this logic to Order & Offers models.\n    const operations = listOperations(this.target)\n    const outdated = this.portfolio.offers.filter(offer => offer.outdated)\n    const remaining = outdated.filter(offer => {\n      return !operations.find(op => op.offer.id === offer.id)\n    })\n    operations.forEach(op => {\n      if (!op.offer.id && remaining.length) op.offer.id = remaining.pop().id\n    })\n\n    if (!operations.length) return false\n    const cosmicLink = Order.operationsToCosmicLink(operations)\n    remaining.forEach(offer => {\n      cosmicLink.addOperation(\"manageOffer\", { amount: 0, offerId: offer.id })\n    })\n    if (cosmicLink) {\n      const sideFrame = new SideFrame(cosmicLink.uri)\n      sideFrame.listen(\"destroy\", () => {\n        this.portfolio.getAccount()\n        this.portfolio.offers.get()\n      })\n    }\n  }\n}\n\nfunction listOperations (target) {\n  let operations = []\n  target.childs.forEach(child => {\n    if (child.order) operations = operations.concat(child.order.operations)\n  })\n  return operations\n}\n\nRebalanceGui.Table = class RebalanceTable extends Gui {\n  constructor (target) {\n    super(`\n<section class=\"RebalanceTable\">\n  <table>\n    <tr>\n      <th>${__(\"Name\")}</th>\n      <th>${__(\"Goal\")}</th>\n      <th>${__(\"Divergence\")}</th>\n      <th>${__(\"Operation\")}</th>\n    </tr>\n\n    %targets...\n\n    <tr hidden=true>\n      <td align=\"center\" colspan=\"4\"><h3>${__(\"Add Asset\")}</h3></td>\n    </tr>\n  </table>\n</section>\n    `)\n\n    this.targets = target.childs.mirror(child => this.toTargetGui(child))\n    this.selected = undefined\n\n    target.listen(\"update\", () => this.sortTargets())\n    this.sortTargets()\n  }\n\n  toTargetGui (target) {\n    const targetGui = new TargetGui(target)\n    targetGui.domNode.onclick = () => this.selected = target\n    return targetGui\n  }\n\n  sortTargets () {\n    this.targets.sort((a, b) => {\n      a = a.target\n      b = b.target\n      if (b.mode === \"ignore\" && a.mode !== \"ignore\") return -1\n      else if (a.mode === \"ignore\" && b.mode !== \"ignore\") return 1\n      return b.value - a.value || a.asset.code.localeCompare(b.asset.code)\n    })\n  }\n}\n\n/**\n * Export\n */\n\nmodule.exports = RebalanceGui\n","\"use_strict\"\n/**\n * Target class.\n *\n * A (portfolio) Target object represents a statically or dynamically allocated\n * target slice of the user portfolio. It is a theoric goal that the rebalancing\n * process aims to reach as much as possible.\n *\n * A Target may be composed by several Target subentries, in such a way that the\n * complete portfolio balancing target ends up being a tree made of Targets.\n */\nconst Mirrorable = require(\"@cosmic-plus/jsutils/es5/mirrorable\")\nconst nice = require(\"@cosmic-plus/jsutils/es5/nice\")\nconst Projectable = require(\"@cosmic-plus/jsutils/es5/projectable\")\n\nconst Asset = require(\"./asset\")\nconst Order = require(\"./order\")\nconst strategy = require(\"./strategy\")\n\n/**\n * Definition\n */\n\nclass Target extends Projectable {\n  constructor (asset) {\n    super()\n\n    if (asset) {\n      this.asset = asset\n      this.mode = \"ignore\"\n      this.order = Order.rebalance(this)\n\n      asset.target = this\n      this.watch(asset, \"value\", () => this.compute(\"valueDiff\"))\n\n      // XLM is never ignored.\n      if (asset.id === \"XLM\") {\n        this.mode = \"weight\"\n        this.size = 1\n      }\n    } else {\n      this.childs = new Mirrorable()\n      this.childs.listen(\"add\", child => child.parent = this)\n      this.childs.listen(\"change\", () => this.computeAll())\n    }\n\n    // Normalize & compute\n    this.trap(\"size\", () => {\n      if (this.size) {\n        this.size = Math.max(0, this.size)\n        if (this.mode === \"percentage\") this.size = Math.min(100, this.size)\n      }\n      this.computeAll()\n    })\n  }\n\n  get root () {\n    if (this.parent) return this.parent.root\n    else return this\n  }\n}\n\nTarget.define(\"name\", [\"group\", \"asset\"], function () {\n  return this.group || this.asset.id\n})\nTarget.define(\"valueDiff\", [\"value\", \"asset\"], function () {\n  return this.asset && this.asset.value - this.value\n})\nTarget.define(\"valueDiffP\", \"valueDiff\", function () {\n  return this.value ? this.valueDiff / this.value : null\n})\nTarget.define(\"amountDiff\", [\"amount\"], function () {\n  return +nice(this.amount - this.asset.amount, 7)\n})\nTarget.define(\"amountDelta\", [\"amountDiff\"], function () {\n  return Math.abs(this.amountDiff)\n})\n// Gets computed by \"strategy.js\".\nTarget.define(\"share\", null, function () {\n  return this.value / this.root.portfolio.total\n})\nTarget.define(\"shareDiff\", [\"share\"], function () {\n  return this.asset.share - this.share\n})\n\n/**\n * Actions\n */\n\nTarget.prototype.computeAll = function () {\n  if (this.parent) {\n    this.root.computeAll()\n  } else if (this.portfolio && this.portfolio.total) {\n    try {\n      this.error = null\n      this.value = this.portfolio.total\n      this.modified = this.hasChanged()\n      strategy.apply(this)\n    } catch (error) {\n      this.error = error.message\n      console.error(error)\n    }\n    this.trigger(\"update\")\n  }\n}\n\n/**\n * Utilities\n */\n\n/**\n * Return deterministically sorted **target** childs without mutating source\n * object.\n */\nTarget.sortChilds = function (target) {\n  const childs = target.childs.slice()\n  return childs.sort((a, b) => a.name.localeCompare(b.name))\n}\n\n/**\n * Source: Portfolio\n */\n\nTarget.forPortfolio = function (portfolio, json) {\n  const target = json ? Target.fromJson(json) : new Target()\n  target.portfolio = portfolio\n\n  portfolio.target = target\n  target.watch(portfolio, \"total\", () => target.computeAll())\n\n  // Add/Remove assets after trustline change.\n  portfolio.assets.forEach(asset => {\n    if (\n      !target.childs.find(child => asset === child.asset)\n      && asset.isSupported\n    )\n      target.childs.push(new Target(asset))\n  })\n  target.childs.forEach((child, index) => {\n    if (\n      !portfolio.assets.find(asset => asset === child.asset)\n      || !child.asset.isSupported\n    )\n      target.childs.splice(index, 1)\n  })\n  portfolio.assets.listen(\"add\", asset => {\n    if (asset.isValid) target.childs.push(new Target(asset))\n  })\n  portfolio.assets.listen(\"remove\", asset => {\n    const index = target.childs.findIndex(child => child.asset === asset)\n    target.childs.splice(index, 1)\n  })\n\n  return target\n}\n\n/**\n * Format: JSON\n */\n\nTarget.fromJson = function (json) {\n  const object = JSON.parse(json)\n  const target = Target.fromObject(object)\n  target.json = json\n  return target\n}\n\nTarget.prototype.toJson = function (beautifyFlag) {\n  const object = this.toObject()\n  return JSON.stringify(object, null, beautifyFlag && 2)\n}\n\nTarget.prototype.hasChanged = function () {\n  return this.toJson() !== (this.json || \"{\\\"childs\\\":[]}\")\n}\n\n/**\n * Format: Object\n */\n\nTarget.fromObject = function (object) {\n  if (typeof object === \"string\") object = { asset: object }\n\n  // Create Target instance.\n  const asset = object.asset && Asset.resolve(object.asset)\n  const target = new Target(asset)\n  target.size = object.size\n  target.mode = object.mode\n\n  // Conversion from versions <= 0.5  REMOVAL: 2020-05 (one year).\n  if (target.mode === \"equal\") target.mode = \"weight\"\n  if (target.mode === \"skip\") target.mode = \"ignore\"\n\n  // Fix for versions <= 0.6.1 - REMOVAL: 2020-06 (one year).\n  if (target.asset && target.asset.id === \"XLM\" && target.mode === \"ignore\") {\n    target.mode = \"weight\"\n    target.size = 1\n  }\n\n  // Set defaults.\n  if (!target.mode) target.mode = \"weight\"\n  if (target.size == null && target.mode === \"weight\") target.size = 1\n\n  // Parse childs.\n  if (object.childs) {\n    target.group = object.group\n    const childs = object.childs.map(entry => Target.fromObject(entry))\n\n    // Conversion from versions <= 0.5  REMOVAL: 2020-05 (one year).\n    //\n    // When there was no \"equal\" target, percentage targets whose sum is under\n    // 100 would act like \"weight\".\n    const percentChilds = childs.filter(child => child.mode === \"percentage\")\n    if (\n      percentChilds.length\n      && !childs.find(child => child.mode === \"weight\")\n      && 100 !== percentChilds.reduce((child, sum) => child.size + sum, 0)\n    ) {\n      percentChilds.forEach(child => child.mode = \"weight\")\n    }\n\n    target.childs.push(...childs)\n  }\n\n  return target\n}\n\nTarget.prototype.toObject = function () {\n  if (this.mode === \"ignore\") return\n  let object = { mode: this.mode, size: this.size }\n  if (object.mode === \"weight\") {\n    delete object.mode\n    if (object.size === 1) delete object.size\n  }\n\n  if (this.asset) {\n    object.asset = this.name\n    if (Object.keys(object).length === 1) object = object.asset\n  } else if (this.childs) {\n    object.group = this.group\n    const childs = Target.sortChilds(this)\n    object.childs = childs.map(target => target.toObject()).filter(x => x)\n  }\n\n  return object\n}\n\n/**\n * Export\n */\n\nmodule.exports = Target\n"],"sourceRoot":""}